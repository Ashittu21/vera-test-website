(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))c(h);new MutationObserver(h=>{for(const p of h)if(p.type==="childList")for(const _ of p.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&c(_)}).observe(document,{childList:!0,subtree:!0});function a(h){const p={};return h.integrity&&(p.integrity=h.integrity),h.referrerpolicy&&(p.referrerPolicy=h.referrerpolicy),h.crossorigin==="use-credentials"?p.credentials="include":h.crossorigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function c(h){if(h.ep)return;h.ep=!0;const p=a(h);fetch(h.href,p)}})();function Ft(){}function s1(t,n){for(const a in n)t[a]=n[a];return t}function n_(t){return t()}function jd(){return Object.create(null)}function dr(t){t.forEach(n_)}function eh(t){return typeof t=="function"}function di(t,n){return t!=t?n==n:t!==n||t&&typeof t=="object"||typeof t=="function"}function o1(t){return Object.keys(t).length===0}function r_(t,...n){if(t==null)return Ft;const a=t.subscribe(...n);return a.unsubscribe?()=>a.unsubscribe():a}function wt(t,n,a){t.$$.on_destroy.push(r_(n,a))}function kr(t,n,a,c){if(t){const h=a_(t,n,a,c);return t[0](h)}}function a_(t,n,a,c){return t[1]&&c?s1(a.ctx.slice(),t[1](c(n))):a.ctx}function Sr(t,n,a,c){if(t[2]&&c){const h=t[2](c(a));if(n.dirty===void 0)return h;if(typeof h=="object"){const p=[],_=Math.max(n.dirty.length,h.length);for(let o=0;o<_;o+=1)p[o]=n.dirty[o]|h[o];return p}return n.dirty|h}return n.dirty}function Er(t,n,a,c,h,p){if(h){const _=a_(n,a,c,p);t.p(_,h)}}function Cr(t){if(t.ctx.length>32){const n=[],a=t.ctx.length/32;for(let c=0;c<a;c++)n[c]=-1;return n}return-1}function Vd(t){return t??""}function Ti(t,n,a){return t.set(a),n}function ue(t,n){t.appendChild(n)}function fe(t,n,a){t.insertBefore(n,a||null)}function ce(t){t.parentNode&&t.parentNode.removeChild(t)}function Ia(t,n){for(let a=0;a<t.length;a+=1)t[a]&&t[a].d(n)}function Ae(t){return document.createElement(t)}function $t(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function st(t){return document.createTextNode(t)}function Ge(){return st(" ")}function mr(){return st("")}function Hi(t,n,a,c){return t.addEventListener(n,a,c),()=>t.removeEventListener(n,a,c)}function O(t,n,a){a==null?t.removeAttribute(n):t.getAttribute(n)!==a&&t.setAttribute(n,a)}function vu(t,n,a){n in t?t[n]=typeof t[n]=="boolean"&&a===""?!0:a:O(t,n,a)}function l1(t,n,a){t.setAttributeNS("http://www.w3.org/1999/xlink",n,a)}function c1(t){return Array.from(t.childNodes)}function hi(t,n){n=""+n,t.wholeText!==n&&(t.data=n)}function Ht(t,n,a,c){a===null?t.style.removeProperty(n):t.style.setProperty(n,a,c?"important":"")}function Qo(t,n){for(let a=0;a<t.options.length;a+=1){const c=t.options[a];if(c.__value===n){c.selected=!0;return}}t.selectedIndex=-1}function Ef(t){const n=t.querySelector(":checked")||t.options[0];return n&&n.__value}let xu;function u1(){if(xu===void 0){xu=!1;try{typeof window<"u"&&window.parent&&window.parent.document}catch{xu=!0}}return xu}function h1(t,n){getComputedStyle(t).position==="static"&&(t.style.position="relative");const c=Ae("iframe");c.setAttribute("style","display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; border: 0; opacity: 0; pointer-events: none; z-index: -1;"),c.setAttribute("aria-hidden","true"),c.tabIndex=-1;const h=u1();let p;return h?(c.src="data:text/html,<script>onresize=function(){parent.postMessage(0,'*')}<\/script>",p=Hi(window,"message",_=>{_.source===c.contentWindow&&n()})):(c.src="about:blank",c.onload=()=>{p=Hi(c.contentWindow,"resize",n)}),ue(t,c),()=>{(h||p&&c.contentWindow)&&p(),ce(c)}}function Fu(t,n,a){t.classList[a?"add":"remove"](n)}function f1(t,n,{bubbles:a=!1,cancelable:c=!1}={}){const h=document.createEvent("CustomEvent");return h.initCustomEvent(t,a,c,n),h}function Ou(t,n){return new t(n)}let lc;function oc(t){lc=t}function mc(){if(!lc)throw new Error("Function called outside component initialization");return lc}function Fn(t){mc().$$.on_mount.push(t)}function th(t){mc().$$.on_destroy.push(t)}function sl(){const t=mc();return(n,a,{cancelable:c=!1}={})=>{const h=t.$$.callbacks[n];if(h){const p=f1(n,a,{cancelable:c});return h.slice().forEach(_=>{_.call(t,p)}),!p.defaultPrevented}return!0}}function $o(t,n){return mc().$$.context.set(t,n),n}function fr(t){return mc().$$.context.get(t)}const Wo=[],Bn=[],Pu=[],Cf=[],p1=Promise.resolve();let Af=!1;function d1(){Af||(Af=!0,p1.then(s_))}function Es(t){Pu.push(t)}function Kf(t){Cf.push(t)}const hf=new Set;let Go=0;function s_(){if(Go!==0)return;const t=lc;do{try{for(;Go<Wo.length;){const n=Wo[Go];Go++,oc(n),m1(n.$$)}}catch(n){throw Wo.length=0,Go=0,n}for(oc(null),Wo.length=0,Go=0;Bn.length;)Bn.pop()();for(let n=0;n<Pu.length;n+=1){const a=Pu[n];hf.has(a)||(hf.add(a),a())}Pu.length=0}while(Wo.length);for(;Cf.length;)Cf.pop()();Af=!1,hf.clear(),oc(t)}function m1(t){if(t.fragment!==null){t.update(),dr(t.before_update);const n=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,n),t.after_update.forEach(Es)}}const zu=new Set;let ro;function Qn(){ro={r:0,c:[],p:ro}}function $n(){ro.r||dr(ro.c),ro=ro.p}function Ie(t,n){t&&t.i&&(zu.delete(t),t.i(n))}function Re(t,n,a,c){if(t&&t.o){if(zu.has(t))return;zu.add(t),ro.c.push(()=>{zu.delete(t),c&&(a&&t.d(1),c())}),t.o(n)}else c&&c()}const o_=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function l_(t,n){t.d(1),n.delete(t.key)}function c_(t,n,a,c,h,p,_,o,b,S,E,P){let k=t.length,L=p.length,j=k;const q={};for(;j--;)q[t[j].key]=j;const J=[],ee=new Map,ge=new Map;for(j=L;j--;){const ie=P(h,p,j),ke=a(ie);let Je=_.get(ke);Je?c&&Je.p(ie,n):(Je=S(ke,ie),Je.c()),ee.set(ke,J[j]=Je),ke in q&&ge.set(ke,Math.abs(j-q[ke]))}const _e=new Set,Y=new Set;function le(ie){Ie(ie,1),ie.m(o,E),_.set(ie.key,ie),E=ie.first,L--}for(;k&&L;){const ie=J[L-1],ke=t[k-1],Je=ie.key,ve=ke.key;ie===ke?(E=ie.first,k--,L--):ee.has(ve)?!_.has(Je)||_e.has(Je)?le(ie):Y.has(ve)?k--:ge.get(Je)>ge.get(ve)?(Y.add(Je),le(ie)):(_e.add(ve),k--):(b(ke,_),k--)}for(;k--;){const ie=t[k];ee.has(ie.key)||b(ie,_)}for(;L;)le(J[L-1]);return J}function Jf(t,n,a){const c=t.$$.props[n];c!==void 0&&(t.$$.bound[c]=a,a(t.$$.ctx[c]))}function nt(t){t&&t.c()}function et(t,n,a,c){const{fragment:h,after_update:p}=t.$$;h&&h.m(n,a),c||Es(()=>{const _=t.$$.on_mount.map(n_).filter(eh);t.$$.on_destroy?t.$$.on_destroy.push(..._):dr(_),t.$$.on_mount=[]}),p.forEach(Es)}function tt(t,n){const a=t.$$;a.fragment!==null&&(dr(a.on_destroy),a.fragment&&a.fragment.d(n),a.on_destroy=a.fragment=null,a.ctx=[])}function g1(t,n){t.$$.dirty[0]===-1&&(Wo.push(t),d1(),t.$$.dirty.fill(0)),t.$$.dirty[n/31|0]|=1<<n%31}function gi(t,n,a,c,h,p,_,o=[-1]){const b=lc;oc(t);const S=t.$$={fragment:null,ctx:[],props:p,update:Ft,not_equal:h,bound:jd(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(b?b.$$.context:[])),callbacks:jd(),dirty:o,skip_bound:!1,root:n.target||b.$$.root};_&&_(S.root);let E=!1;if(S.ctx=a?a(t,n.props||{},(P,k,...L)=>{const j=L.length?L[0]:k;return S.ctx&&h(S.ctx[P],S.ctx[P]=j)&&(!S.skip_bound&&S.bound[P]&&S.bound[P](j),E&&g1(t,P)),k}):[],S.update(),E=!0,dr(S.before_update),S.fragment=c?c(S.ctx):!1,n.target){if(n.hydrate){const P=c1(n.target);S.fragment&&S.fragment.l(P),P.forEach(ce)}else S.fragment&&S.fragment.c();n.intro&&Ie(t.$$.fragment),et(t,n.target,n.anchor,n.customElement),s_()}oc(b)}class _i{$destroy(){tt(this,1),this.$destroy=Ft}$on(n,a){if(!eh(a))return Ft;const c=this.$$.callbacks[n]||(this.$$.callbacks[n]=[]);return c.push(a),()=>{const h=c.indexOf(a);h!==-1&&c.splice(h,1)}}$set(n){this.$$set&&!o1(n)&&(this.$$.skip_bound=!0,this.$$set(n),this.$$.skip_bound=!1)}}var If=Array.isArray||function(t){return Object.prototype.toString.call(t)=="[object Array]"},gc=p_,_1=Yf,y1=w1,v1=u_,x1=f_,b1=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^()])+)\\))?|\\(((?:\\\\.|[^()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function Yf(t){for(var n=[],a=0,c=0,h="",p;(p=b1.exec(t))!=null;){var _=p[0],o=p[1],b=p.index;if(h+=t.slice(c,b),c=b+_.length,o){h+=o[1];continue}h&&(n.push(h),h="");var S=p[2],E=p[3],P=p[4],k=p[5],L=p[6],j=p[7],q=L==="+"||L==="*",J=L==="?"||L==="*",ee=S||"/",ge=P||k||(j?".*":"[^"+ee+"]+?");n.push({name:E||a++,prefix:S||"",delimiter:ee,optional:J,repeat:q,pattern:T1(ge)})}return c<t.length&&(h+=t.substr(c)),h&&n.push(h),n}function w1(t){return u_(Yf(t))}function u_(t){for(var n=new Array(t.length),a=0;a<t.length;a++)typeof t[a]=="object"&&(n[a]=new RegExp("^"+t[a].pattern+"$"));return function(c){for(var h="",p=c||{},_=0;_<t.length;_++){var o=t[_];if(typeof o=="string"){h+=o;continue}var b=p[o.name],S;if(b==null){if(o.optional)continue;throw new TypeError('Expected "'+o.name+'" to be defined')}if(If(b)){if(!o.repeat)throw new TypeError('Expected "'+o.name+'" to not repeat, but received "'+b+'"');if(b.length===0){if(o.optional)continue;throw new TypeError('Expected "'+o.name+'" to not be empty')}for(var E=0;E<b.length;E++){if(S=encodeURIComponent(b[E]),!n[_].test(S))throw new TypeError('Expected all "'+o.name+'" to match "'+o.pattern+'", but received "'+S+'"');h+=(E===0?o.prefix:o.delimiter)+S}continue}if(S=encodeURIComponent(b),!n[_].test(S))throw new TypeError('Expected "'+o.name+'" to match "'+o.pattern+'", but received "'+S+'"');h+=o.prefix+S}return h}}function qd(t){return t.replace(/([.+*?=^!:${}()[\]|\/])/g,"\\$1")}function T1(t){return t.replace(/([=!:$\/()])/g,"\\$1")}function Qf(t,n){return t.keys=n,t}function h_(t){return t.sensitive?"":"i"}function k1(t,n){var a=t.source.match(/\((?!\?)/g);if(a)for(var c=0;c<a.length;c++)n.push({name:c,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return Qf(t,n)}function S1(t,n,a){for(var c=[],h=0;h<t.length;h++)c.push(p_(t[h],n,a).source);var p=new RegExp("(?:"+c.join("|")+")",h_(a));return Qf(p,n)}function E1(t,n,a){for(var c=Yf(t),h=f_(c,a),p=0;p<c.length;p++)typeof c[p]!="string"&&n.push(c[p]);return Qf(h,n)}function f_(t,n){n=n||{};for(var a=n.strict,c=n.end!==!1,h="",p=t[t.length-1],_=typeof p=="string"&&/\/$/.test(p),o=0;o<t.length;o++){var b=t[o];if(typeof b=="string")h+=qd(b);else{var S=qd(b.prefix),E=b.pattern;b.repeat&&(E+="(?:"+S+E+")*"),b.optional?S?E="(?:"+S+"("+E+"))?":E="("+E+")?":E=S+"("+E+")",h+=E}}return a||(h=(_?h.slice(0,-2):h)+"(?:\\/(?=$))?"),c?h+="$":h+=a&&_?"":"(?=\\/|$)",new RegExp("^"+h,h_(n))}function p_(t,n,a){return n=n||[],If(n)?a||(a={}):(a=n,n=[]),t instanceof RegExp?k1(t,n):If(t)?S1(t,n,a):E1(t,n,a)}gc.parse=_1;gc.compile=y1;gc.tokensToFunction=v1;gc.tokensToRegExp=x1;var el=typeof document<"u",Xr=typeof window<"u",ih=typeof history<"u",C1=typeof process<"u",Mf=el&&document.ontouchstart?"touchstart":"click",$a=Xr&&!!(window.history.location||window.location);function Tn(){this.callbacks=[],this.exits=[],this.current="",this.len=0,this._decodeURLComponents=!0,this._base="",this._strict=!1,this._running=!1,this._hashbang=!1,this.clickHandler=this.clickHandler.bind(this),this._onpopstate=this._onpopstate.bind(this)}Tn.prototype.configure=function(t){var n=t||{};this._window=n.window||Xr&&window,this._decodeURLComponents=n.decodeURLComponents!==!1,this._popstate=n.popstate!==!1&&Xr,this._click=n.click!==!1&&el,this._hashbang=!!n.hashbang;var a=this._window;this._popstate?a.addEventListener("popstate",this._onpopstate,!1):Xr&&a.removeEventListener("popstate",this._onpopstate,!1),this._click?a.document.addEventListener(Mf,this.clickHandler,!1):el&&a.document.removeEventListener(Mf,this.clickHandler,!1),this._hashbang&&Xr&&!ih?a.addEventListener("hashchange",this._onpopstate,!1):Xr&&a.removeEventListener("hashchange",this._onpopstate,!1)};Tn.prototype.base=function(t){if(arguments.length===0)return this._base;this._base=t};Tn.prototype._getBase=function(){var t=this._base;if(t)return t;var n=Xr&&this._window&&this._window.location;return Xr&&this._hashbang&&n&&n.protocol==="file:"&&(t=n.pathname),t};Tn.prototype.strict=function(t){if(arguments.length===0)return this._strict;this._strict=t};Tn.prototype.start=function(t){var n=t||{};if(this.configure(n),n.dispatch!==!1){this._running=!0;var a;if($a){var c=this._window,h=c.location;this._hashbang&&~h.hash.indexOf("#!")?a=h.hash.substr(2)+h.search:this._hashbang?a=h.search+h.hash:a=h.pathname+h.search+h.hash}this.replace(a,null,!0,n.dispatch)}};Tn.prototype.stop=function(){if(this._running){this.current="",this.len=0,this._running=!1;var t=this._window;this._click&&t.document.removeEventListener(Mf,this.clickHandler,!1),Xr&&t.removeEventListener("popstate",this._onpopstate,!1),Xr&&t.removeEventListener("hashchange",this._onpopstate,!1)}};Tn.prototype.show=function(t,n,a,c){var h=new _c(t,n,this),p=this.prevContext;return this.prevContext=h,this.current=h.path,a!==!1&&this.dispatch(h,p),h.handled!==!1&&c!==!1&&h.pushState(),h};Tn.prototype.back=function(t,n){var a=this;if(this.len>0){var c=this._window;ih&&c.history.back(),this.len--}else setTimeout(t?function(){a.show(t,n)}:function(){a.show(a._getBase(),n)})};Tn.prototype.redirect=function(t,n){var a=this;typeof t=="string"&&typeof n=="string"&&nh.call(this,t,function(c){setTimeout(function(){a.replace(n)},0)}),typeof t=="string"&&typeof n>"u"&&setTimeout(function(){a.replace(t)},0)};Tn.prototype.replace=function(t,n,a,c){var h=new _c(t,n,this),p=this.prevContext;return this.prevContext=h,this.current=h.path,h.init=a,h.save(),c!==!1&&this.dispatch(h,p),h};Tn.prototype.dispatch=function(t,n){var a=0,c=0,h=this;function p(){var o=h.exits[c++];if(!o)return _();o(n,p)}function _(){var o=h.callbacks[a++];if(t.path!==h.current){t.handled=!1;return}if(!o)return A1.call(h,t);o(t,_)}n?p():_()};Tn.prototype.exit=function(t,n){if(typeof t=="function")return this.exit("*",t);for(var a=new yc(t,null,this),c=1;c<arguments.length;++c)this.exits.push(a.middleware(arguments[c]))};Tn.prototype.clickHandler=function(t){if(this._which(t)===1&&!(t.metaKey||t.ctrlKey||t.shiftKey)&&!t.defaultPrevented){var n=t.target,a=t.path||(t.composedPath?t.composedPath():null);if(a){for(var c=0;c<a.length;c++)if(a[c].nodeName&&a[c].nodeName.toUpperCase()==="A"&&a[c].href){n=a[c];break}}for(;n&&n.nodeName.toUpperCase()!=="A";)n=n.parentNode;if(!(!n||n.nodeName.toUpperCase()!=="A")){var h=typeof n.href=="object"&&n.href.constructor.name==="SVGAnimatedString";if(!(n.hasAttribute("download")||n.getAttribute("rel")==="external")){var p=n.getAttribute("href");if(!(!this._hashbang&&this._samePath(n)&&(n.hash||p==="#"))&&!(p&&p.indexOf("mailto:")>-1)&&!(h?n.target.baseVal:n.target)&&!(!h&&!this.sameOrigin(n.href))){var _=h?n.href.baseVal:n.pathname+n.search+(n.hash||"");_=_[0]!=="/"?"/"+_:_,C1&&_.match(/^\/[a-zA-Z]:\//)&&(_=_.replace(/^\/[a-zA-Z]:\//,"/"));var o=_,b=this._getBase();_.indexOf(b)===0&&(_=_.substr(b.length)),this._hashbang&&(_=_.replace("#!","")),!(b&&o===_&&(!$a||this._window.location.protocol!=="file:"))&&(t.preventDefault(),this.show(o))}}}}};Tn.prototype._onpopstate=function(){var t=!1;return Xr?(el&&document.readyState==="complete"?t=!0:window.addEventListener("load",function(){setTimeout(function(){t=!0},0)}),function(a){if(t){var c=this;if(a.state){var h=a.state.path;c.replace(h,a.state)}else if($a){var p=c._window.location;c.show(p.pathname+p.search+p.hash,void 0,void 0,!1)}}}):function(){}}();Tn.prototype._which=function(t){return t=t||Xr&&this._window.event,t.which==null?t.button:t.which};Tn.prototype._toURL=function(t){var n=this._window;if(typeof URL=="function"&&$a)return new URL(t,n.location.toString());if(el){var a=n.document.createElement("a");return a.href=t,a}};Tn.prototype.sameOrigin=function(t){if(!t||!$a)return!1;var n=this._toURL(t),a=this._window,c=a.location;return c.protocol===n.protocol&&c.hostname===n.hostname&&(c.port===n.port||c.port===""&&(n.port==80||n.port==443))};Tn.prototype._samePath=function(t){if(!$a)return!1;var n=this._window,a=n.location;return t.pathname===a.pathname&&t.search===a.search};Tn.prototype._decodeURLEncodedURIComponent=function(t){return typeof t!="string"?t:this._decodeURLComponents?decodeURIComponent(t.replace(/\+/g," ")):t};function d_(){var t=new Tn;function n(){return nh.apply(t,arguments)}return n.callbacks=t.callbacks,n.exits=t.exits,n.base=t.base.bind(t),n.strict=t.strict.bind(t),n.start=t.start.bind(t),n.stop=t.stop.bind(t),n.show=t.show.bind(t),n.back=t.back.bind(t),n.redirect=t.redirect.bind(t),n.replace=t.replace.bind(t),n.dispatch=t.dispatch.bind(t),n.exit=t.exit.bind(t),n.configure=t.configure.bind(t),n.sameOrigin=t.sameOrigin.bind(t),n.clickHandler=t.clickHandler.bind(t),n.create=d_,Object.defineProperty(n,"len",{get:function(){return t.len},set:function(a){t.len=a}}),Object.defineProperty(n,"current",{get:function(){return t.current},set:function(a){t.current=a}}),n.Context=_c,n.Route=yc,n}function nh(t,n){if(typeof t=="function")return nh.call(this,"*",t);if(typeof n=="function")for(var a=new yc(t,null,this),c=1;c<arguments.length;++c)this.callbacks.push(a.middleware(arguments[c]));else typeof t=="string"?this[typeof n=="string"?"redirect":"show"](t,n):this.start(t)}function A1(t){if(!t.handled){var n,a=this,c=a._window;a._hashbang?n=$a&&this._getBase()+c.location.hash.replace("#!",""):n=$a&&c.location.pathname+c.location.search,n!==t.canonicalPath&&(a.stop(),t.handled=!1,$a&&(c.location.href=t.canonicalPath))}}function I1(t){return t.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function _c(t,n,a){var c=this.page=a||nh,h=c._window,p=c._hashbang,_=c._getBase();t[0]==="/"&&t.indexOf(_)!==0&&(t=_+(p?"#!":"")+t);var o=t.indexOf("?");this.canonicalPath=t;var b=new RegExp("^"+I1(_));if(this.path=t.replace(b,"")||"/",p&&(this.path=this.path.replace("#!","")||"/"),this.title=el&&h.document.title,this.state=n||{},this.state.path=t,this.querystring=~o?c._decodeURLEncodedURIComponent(t.slice(o+1)):"",this.pathname=c._decodeURLEncodedURIComponent(~o?t.slice(0,o):t),this.params={},this.hash="",!p){if(!~this.path.indexOf("#"))return;var S=this.path.split("#");this.path=this.pathname=S[0],this.hash=c._decodeURLEncodedURIComponent(S[1])||"",this.querystring=this.querystring.split("#")[0]}}_c.prototype.pushState=function(){var t=this.page,n=t._window,a=t._hashbang;t.len++,ih&&n.history.pushState(this.state,this.title,a&&this.path!=="/"?"#!"+this.path:this.canonicalPath)};_c.prototype.save=function(){var t=this.page;ih&&t._window.history.replaceState(this.state,this.title,t._hashbang&&this.path!=="/"?"#!"+this.path:this.canonicalPath)};function yc(t,n,a){var c=this.page=a||$f,h=n||{};h.strict=h.strict||c._strict,this.path=t==="*"?"(.*)":t,this.method="GET",this.regexp=gc(this.path,this.keys=[],h)}yc.prototype.middleware=function(t){var n=this;return function(a,c){if(n.match(a.path,a.params))return a.routePath=n.path,t(a,c);c()}};yc.prototype.match=function(t,n){var a=this.keys,c=t.indexOf("?"),h=~c?t.slice(0,c):t,p=this.regexp.exec(decodeURIComponent(h));if(!p)return!1;delete n[0];for(var _=1,o=p.length;_<o;++_){var b=a[_-1],S=this.page._decodeURLEncodedURIComponent(p[_]);(S!==void 0||!hasOwnProperty.call(n,b.name))&&(n[b.name]=S)}return!0};var $f=d_(),Kr=$f,M1=$f;Kr.default=M1;var Gd={},ff={},pf=34,Kl=10,df=13;function m_(t){return new Function("d","return {"+t.map(function(n,a){return JSON.stringify(n)+": d["+a+'] || ""'}).join(",")+"}")}function P1(t,n){var a=m_(t);return function(c,h){return n(a(c),h,t)}}function Zd(t){var n=Object.create(null),a=[];return t.forEach(function(c){for(var h in c)h in n||a.push(n[h]=h)}),a}function wr(t,n){var a=t+"",c=a.length;return c<n?new Array(n-c+1).join(0)+a:a}function z1(t){return t<0?"-"+wr(-t,6):t>9999?"+"+wr(t,6):wr(t,4)}function D1(t){var n=t.getUTCHours(),a=t.getUTCMinutes(),c=t.getUTCSeconds(),h=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":z1(t.getUTCFullYear())+"-"+wr(t.getUTCMonth()+1,2)+"-"+wr(t.getUTCDate(),2)+(h?"T"+wr(n,2)+":"+wr(a,2)+":"+wr(c,2)+"."+wr(h,3)+"Z":c?"T"+wr(n,2)+":"+wr(a,2)+":"+wr(c,2)+"Z":a||n?"T"+wr(n,2)+":"+wr(a,2)+"Z":"")}function L1(t){var n=new RegExp('["'+t+`
\r]`),a=t.charCodeAt(0);function c(P,k){var L,j,q=h(P,function(J,ee){if(L)return L(J,ee-1);j=J,L=k?P1(J,k):m_(J)});return q.columns=j||[],q}function h(P,k){var L=[],j=P.length,q=0,J=0,ee,ge=j<=0,_e=!1;P.charCodeAt(j-1)===Kl&&--j,P.charCodeAt(j-1)===df&&--j;function Y(){if(ge)return ff;if(_e)return _e=!1,Gd;var ie,ke=q,Je;if(P.charCodeAt(ke)===pf){for(;q++<j&&P.charCodeAt(q)!==pf||P.charCodeAt(++q)===pf;);return(ie=q)>=j?ge=!0:(Je=P.charCodeAt(q++))===Kl?_e=!0:Je===df&&(_e=!0,P.charCodeAt(q)===Kl&&++q),P.slice(ke+1,ie-1).replace(/""/g,'"')}for(;q<j;){if((Je=P.charCodeAt(ie=q++))===Kl)_e=!0;else if(Je===df)_e=!0,P.charCodeAt(q)===Kl&&++q;else if(Je!==a)continue;return P.slice(ke,ie)}return ge=!0,P.slice(ke,j)}for(;(ee=Y())!==ff;){for(var le=[];ee!==Gd&&ee!==ff;)le.push(ee),ee=Y();k&&(le=k(le,J++))==null||L.push(le)}return L}function p(P,k){return P.map(function(L){return k.map(function(j){return E(L[j])}).join(t)})}function _(P,k){return k==null&&(k=Zd(P)),[k.map(E).join(t)].concat(p(P,k)).join(`
`)}function o(P,k){return k==null&&(k=Zd(P)),p(P,k).join(`
`)}function b(P){return P.map(S).join(`
`)}function S(P){return P.map(E).join(t)}function E(P){return P==null?"":P instanceof Date?D1(P):n.test(P+="")?'"'+P.replace(/"/g,'""')+'"':P}return{parse:c,parseRows:h,format:_,formatBody:o,formatRows:b,formatRow:S,formatValue:E}}var R1=L1(","),g_=R1.parse;function B1(t){for(var n in t){var a=t[n].trim(),c,h;if(!a)a=null;else if(a==="true")a=!0;else if(a==="false")a=!1;else if(a==="NaN")a=NaN;else if(!isNaN(c=+a))a=c;else if(h=a.match(/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/))F1&&h[4]&&!h[7]&&(a=a.replace(/-/g,"/").replace(/T/," ")),a=new Date(a);else continue;t[n]=a}return t}const F1=new Date("2019-01-01T00:00").getHours()||new Date("2019-07-01T00:00").getHours();function O1(t){return t}function U1(t){if(t==null)return O1;var n,a,c=t.scale[0],h=t.scale[1],p=t.translate[0],_=t.translate[1];return function(o,b){b||(n=a=0);var S=2,E=o.length,P=new Array(E);for(P[0]=(n+=o[0])*c+p,P[1]=(a+=o[1])*h+_;S<E;)P[S]=o[S],++S;return P}}function N1(t,n){for(var a,c=t.length,h=c-n;h<--c;)a=t[h],t[h++]=t[c],t[c]=a}function __(t,n){return typeof n=="string"&&(n=t.objects[n]),n.type==="GeometryCollection"?{type:"FeatureCollection",features:n.geometries.map(function(a){return Hd(t,a)})}:Hd(t,n)}function Hd(t,n){var a=n.id,c=n.bbox,h=n.properties==null?{}:n.properties,p=j1(t,n);return a==null&&c==null?{type:"Feature",properties:h,geometry:p}:c==null?{type:"Feature",id:a,properties:h,geometry:p}:{type:"Feature",id:a,bbox:c,properties:h,geometry:p}}function j1(t,n){var a=U1(t.transform),c=t.arcs;function h(E,P){P.length&&P.pop();for(var k=c[E<0?~E:E],L=0,j=k.length;L<j;++L)P.push(a(k[L],L));E<0&&N1(P,j)}function p(E){return a(E)}function _(E){for(var P=[],k=0,L=E.length;k<L;++k)h(E[k],P);return P.length<2&&P.push(P[0]),P}function o(E){for(var P=_(E);P.length<4;)P.push(P[0]);return P}function b(E){return E.map(o)}function S(E){var P=E.type,k;switch(P){case"GeometryCollection":return{type:P,geometries:E.geometries.map(S)};case"Point":k=p(E.coordinates);break;case"MultiPoint":k=E.coordinates.map(p);break;case"LineString":k=_(E.arcs);break;case"MultiLineString":k=E.arcs.map(_);break;case"Polygon":k=b(E.arcs);break;case"MultiPolygon":k=E.arcs.map(b);break;default:return null}return{type:P,coordinates:k}}return S(n)}function V1(t,n){for(let a in t[n])document.documentElement.style.setProperty("--"+a,t[n][a])}function y_(){let t=window.matchMedia("(prefers-reduced-motion: reduce)");return!(!t||t.matches)}async function Wd(t){let a=await(await fetch(t)).text();return await g_(a,B1)}async function Ya(t,n){let c=await(await fetch(t)).json();return await __(c,n)}async function Jl(t,n){let c=await(await fetch(t)).json();return await __(c,n)}function Xd(t,n,a){let c,h=!1,p=1;for(;h==!1;)t<=n[p]?(c=a[p-1],h=!0):p++;return c||"lightgrey"}function Kd(t,n){let a,c=n.length;return t=="pretrial"?a=[0,12.4,24.8,n[c-1]]:t=="admission"?a=[0,13.6,27.2,n[c-1]]:t=="over_1000_19"?a=[0,1,2]:t=="over_1000_99"?a=[0,1,2]:t=="GT_1000_beds_99"?a=[-1,0,1]:t=="GT_1000_beds_19"?a=[-1,0,1]:t=="est_doc_rev"?a=[-1,0,1]:t=="ice"?a=[-1,0,1]:t=="map_twp"?a=[-1,0,1]:t=="map_private"?a=[-1,0,1]:t=="map_prison"?a=[-1,0,1]:t=="map_all"?a=[-1,0,1]:a=[n[0],n[Math.floor(c*.33333)],n[Math.floor(c*.66666)],n[c-1]],a}const nc={light:{text:"#222",muted:"#777",pale:"#f0f0f0",background:"#fff7f0"},dark:{text:"#fff",muted:"#bbb",pale:"#333",background:"#222"},lightblue:{text:"#206095",muted:"#707070",pale:"#f0f0f0",background:"rgb(188, 207, 222)"}},Jd={pretrial:["#ef4136","#b81c1f","#790f09"],admission:["#ef4136","#b81c1f","#790f09"],over_1000_19:["rgba(255,255,255,0)","rgba(255,240,0,.5)"],over_1000_99:["rgba(255,255,255,0)","rgba(255,240,0,.5)"],map_jails:["rgba(255,255,255,0)","rgba(46,29,151,.9)"],GT_1000_beds_99:["rgba(255,255,255,0)","rgba(46,29,151,.9)"],GT_1000_beds_19:["rgba(255,255,255,0)","rgba(46,29,151,.9)"],est_doc_rev:["rgba(255,255,255,0)","rgba(23,134,31,.9)"],ice:["rgba(255,255,255,0)","rgba(138,158,30,.9)"],map_prison:["rgba(255,255,255,0)","rgba(0,92,229, 0.9)"],map_private:["rgba(255,255,255,0)","rgba(143,50,161,.9)"],map_twp:["rgba(255,255,255,0)","rgba(255,158,68,0.9)"],map_all:["rgba(255,255,255,0)","rgba(0,0,0,.9)"]};function q1(t){let n;return{c(){n=Ae("div"),n.innerHTML=`<p>Louisiana’s 64 parishes range from bustling cities to vast rural stretches,
    from the parks and preserves of the north to the swamps and marshes of the
    gulf. Yet, they all share one defining characteristic: a stake in the
    state’s vast network of jails, prisons, and juvenile detention facilities.</p> 

  <p>The prevalence of incarceration in Louisiana is hard to see in many places
    due to an alarming lack of transparency and data, as well as a convoluted
    carceral landscape where local jails also function as prisons. But parish-
    and state-level research by the Vera Institute of Justice brings much-needed
    clarity to this picture. Vera’s datahub provides illuminating access to
    parish-level data on arrests, pretrial detention, incarceration, and local
    spending on the criminal legal system. Together, these data points create a
    detailed—and highly damning—picture of mass incarceration in Louisiana.</p> 

  <p>It is a system of clear winners and losers, financially benefiting those
    with a stake in the system, including the state, local sheriffs, and private
    corporations. The Louisiana Department of Public Safety &amp; Corrections pays
    local jails <a href="https://house.louisiana.gov/housefiscal/DOCS_APP_BDGT_MEETINGS/DOCS_APPBudgetMeetings2022/FY%2023%20Corrections.pdf" target="_blank">$177 million</a> annually to hold more than half the people who have been sentenced to
    prison.</p> 

  <p>But the people of Louisiana are losing. If incarceration created safety,
    Louisiana would be among the safest places in the world. Instead, making
    Louisiana a safer place requires scaling back its vast incarceration system
    and reallocating funds to the <a href="https://www.brookings.edu/essay/a-new-community-safety-blueprint-how-the-federal-government-can-address-violence-and-harm-through-a-public-health-approach/" target="_blank">things that actually make communities safe</a>: jobs, housing, healthcare, good schools, and infrastructure.</p> 
  <p>Conversations around Louisiana’s high incarceration rates tend to center on
    dense population centers. But a closer look at the data collected by Vera
    tells a different story: incarceration has expanded across the state,
    especially in rural parishes.</p>`,O(n,"id","top"),O(n,"class","col-wide svelte-b3douq")},m(a,c){fe(a,n,c)},p:Ft,i:Ft,o:Ft,d(a){a&&ce(n)}}}class G1 extends _i{constructor(n){super(),gi(this,n,null,q1,di,{})}}function Z1(t){let n;return{c(){n=Ae("div"),n.innerHTML=`<p class="point svelte-krasw1">The parish and state-level data collected by Vera for this project reveals
    how both the state and local governments can scale back the destructive
    influence of mass incarceration. Local and state-level government bodies in
    Louisiana should do the following:</p> 
  <ul class="svelte-krasw1"><li class="svelte-krasw1">End Louisiana’s practice of housing distinct groups of people with vastly
      different needs in the same multi-use facilities; for example, housing
      juveniles at Louisiana State Penitentiary (Angola) and housing people with
      prison sentences in pretrial detention facilities, like parish jails. The
      state should use sentencing reform, applied retroactively, to reduce the
      number of incarcerated people to fit current Department of Public Safety &amp;
      Corrections capacity.</li> 

    <li class="svelte-krasw1">Pass a data transparency bill that standardizes the data a carceral
      facility must collect and report.</li> 

    <li class="svelte-krasw1">Reduce the prison population by providing parole eligibility after 20
      years to people serving long sentences and after 25 years to those serving
      life sentences; making parole-eligibility and sentencing reforms available
      retroactively; and implementing a felony classification system to
      eliminate inconsistencies in sentencing and release.</li> 

    <li class="svelte-krasw1">Pass legislation that allows people charged with non-violent felonies and
      misdemeanors to be issued a summons in lieu of arrest, and enact
      comprehensive bail reform so that money does not determine freedom.</li> 

    <li class="svelte-krasw1">Advance civilian responses to <a href="https://www.vera.org/behavioral-health-crisis-alternatives" target="_blank">911 calls that don’t require law enforcement</a>. Removing the police from encounters that don’t require them—like
      mental health crises,
      <a href="https://www.vera.org/ending-mass-incarceration/criminalization-racial-disparities/public-safety/redefining-public-safety-initiative/stop-the-stops" target="_blank">low-level traffic violations</a>, and noise complaints—is
      <a href="https://www.brookings.edu/essay/a-new-community-safety-blueprint-how-the-federal-government-can-address-violence-and-harm-through-a-public-health-approach/" target="_blank">proven to improve safety</a>, while also reducing arrests (and thus jail admissions).</li> 

    <li class="svelte-krasw1">Enact meaningful reforms that will allow for jail decarceration, and then
      close jails and repurpose carceral facilities for non-jail, non-detention
      purposes. Reducing corrections spending and ending mass incarceration in
      Louisiana will require lowering jail capacity. This means working towards
      permanently closing jails.</li></ul>`,O(n,"id","bottom"),O(n,"class","col-wide svelte-krasw1")},m(a,c){fe(a,n,c)},p:Ft,i:Ft,o:Ft,d(a){a&&ce(n)}}}class H1 extends _i{constructor(n){super(),gi(this,n,null,Z1,di,{})}}function W1(t){let n;return{c(){n=Ae("div"),n.innerHTML=`<h2>About the Data</h2> 
  <p>Vera collected data for Louisiana’s prisons, jails, and juvenile justice
    facilities using information published on state and local government
    websites and the U.S. Bureau of Justice Statistics 2019 Census of Jails.
    Vera collected pretrial population data from reports prepared by the
    Louisiana Department of Public Safety &amp; Corrections (DPS&amp;C). Vera collected
    prison admission data from the DPS&amp;C Briefing Book. Vera collected arrest
    data from the FBI Uniform Crime Report accessed via Vera’s Arrest Trends
    tool. Vera collected budget data from the U.S. Census Annual Survey of
    Public Employment &amp; Payroll.</p> 

  <span class="more"><a href="/louisiana-locked-up/about-data">More</a></span>`,O(n,"id","about-data"),O(n,"class","svelte-n7jwkt")},m(a,c){fe(a,n,c)},p:Ft,i:Ft,o:Ft,d(a){a&&ce(n)}}}class v_ extends _i{constructor(n){super(),gi(this,n,null,W1,di,{})}}function X1(t){let n,a,c;const h=t[2].default,p=kr(h,t,t[1],null);return{c(){n=Ae("section"),a=Ae("div"),p&&p.c(),O(a,"class","col-wide"),Ht(n,"color",nc[t[0]].text),Ht(n,"background-color",nc[t[0]].background)},m(_,o){fe(_,n,o),ue(n,a),p&&p.m(a,null),c=!0},p(_,[o]){p&&p.p&&(!c||o&2)&&Er(p,h,_,_[1],c?Sr(h,_[1],o,null):Cr(_[1]),null),(!c||o&1)&&Ht(n,"color",nc[_[0]].text),(!c||o&1)&&Ht(n,"background-color",nc[_[0]].background)},i(_){c||(Ie(p,_),c=!0)},o(_){Re(p,_),c=!1},d(_){_&&ce(n),p&&p.d(_)}}}function K1(t,n,a){let{$$slots:c={},$$scope:h}=n,{theme:p=fr("theme")}=n;return t.$$set=_=>{"theme"in _&&a(0,p=_.theme),"$$scope"in _&&a(1,h=_.$$scope)},[p,h,c]}class J1 extends _i{constructor(n){super(),gi(this,n,K1,X1,di,{theme:0})}}const{window:x_}=o_,Y1=t=>({}),Yd=t=>({}),Q1=t=>({}),Qd=t=>({});function $1(t){let n,a,c,h,p,_,o,b;Es(t[19]);const S=t[18].background,E=kr(S,t,t[17],Qd),P=t[18].foreground,k=kr(P,t,t[17],Yd);return{c(){n=Ae("svelte-scroller-outer"),a=Ae("svelte-scroller-background-container"),c=Ae("svelte-scroller-background"),E&&E.c(),h=Ge(),p=Ae("svelte-scroller-foreground"),k&&k.c(),vu(c,"class","svelte-3stote"),vu(a,"class","background-container svelte-3stote"),vu(p,"class","svelte-3stote"),vu(n,"class","svelte-3stote"),Fu(n,"splitscreen",t[0])},m(L,j){fe(L,n,j),ue(n,a),ue(a,c),E&&E.m(c,null),t[20](c),t[21](a),ue(n,h),ue(n,p),k&&k.m(p,null),t[22](p),t[23](n),_=!0,o||(b=Hi(x_,"resize",t[19]),o=!0)},p(L,j){E&&E.p&&(!_||j[0]&131072)&&Er(E,S,L,L[17],_?Sr(S,L[17],j,Q1):Cr(L[17]),Qd),k&&k.p&&(!_||j[0]&131072)&&Er(k,P,L,L[17],_?Sr(P,L[17],j,Y1):Cr(L[17]),Yd),(!_||j[0]&1)&&Fu(n,"splitscreen",L[0])},i(L){_||(Ie(E,L),Ie(k,L),_=!0)},o(L){Re(E,L),Re(k,L),_=!1},d(L){L&&ce(n),E&&E.d(L),t[20](null),t[21](null),k&&k.d(L),t[22](null),t[23](null),o=!1,b()}}}const Ea=[];let Uu;if(typeof window<"u"){const t=()=>Ea.forEach(n=>n());window.addEventListener("scroll",t),window.addEventListener("resize",t)}if(typeof IntersectionObserver<"u"){const t=new Map,n=new IntersectionObserver((a,c)=>{a.forEach(h=>{const p=t.get(h.target),_=Ea.indexOf(p);h.isIntersecting?_===-1&&Ea.push(p):(p(),_!==-1&&Ea.splice(_,1))})},{rootMargin:"400px 0px"});Uu={add:({outer:a,update:c})=>{const{top:h,bottom:p}=a.getBoundingClientRect();h<window.innerHeight&&p>0&&Ea.push(c),t.set(a,c),n.observe(a)},remove:({outer:a,update:c})=>{const h=Ea.indexOf(c);h!==-1&&Ea.splice(h,1),t.delete(a),n.unobserve(a)}}}else Uu={add:({update:t})=>{Ea.push(t)},remove:({update:t})=>{const n=Ea.indexOf(t);n!==-1&&Ea.splice(n,1)}};function ev(t,n,a){let c,h,p,{$$slots:_={},$$scope:o}=n,{top:b=0}=n,{bottom:S=1}=n,{threshold:E=.5}=n,{query:P="section"}=n,{parallax:k=!1}=n,{index:L=0}=n,{count:j=0}=n,{offset:q=0}=n,{progress:J=0}=n,{visible:ee=!1}=n,{splitscreen:ge=!1}=n,{id:_e=null}=n,Y,le,ie,ke,Je,ve=0,pe,Fe,$e=1;Fn(()=>{Je=ie.querySelectorAll(P),a(7,j=Je.length),We();const Ze={outer:Y,update:We};return Uu.add(Ze),()=>Uu.remove(Ze)});function ct(){if(le){let Ze=`position: ${pe?"fixed":"absolute"}; top: 0; transform: translate(0, ${Fe}px); width: ${$e}px; z-index: ${1};`;a(3,le.style.cssText=Ze,le)}}function We(){if(!ie)return;const Ze=Y.getBoundingClientRect();Ze.left,$e=Ze.right-Ze.left;const qt=ie.getBoundingClientRect(),It=ke.getBoundingClientRect();a(10,ee=qt.top<ve&&qt.bottom>0);const Ut=qt.bottom-qt.top,Kt=It.bottom-It.top,Jt=h-c;for(a(9,J=(c-qt.top)/(Ut-Jt)),J<=0?(Fe=0,pe&&(pe=!1,ct())):J>=1?(Fe=k?Ut-Kt:Ut-Jt,pe&&(pe=!1,ct())):(Fe=k?Math.round(c-J*(Kt-Jt)):c,pe||(pe=!0,ct())),a(6,L=0);L<Je.length;a(6,L+=1)){const li=Je[L],{top:mi}=li.getBoundingClientRect(),Ji=Je[L+1],rt=Ji?Ji.getBoundingClientRect().top:qt.bottom;if(a(8,q=(p-mi)/(rt-mi)),a(11,_e=li.dataset.id?li.dataset.id:null),rt>=p)break}}function mt(){a(1,ve=x_.innerHeight)}function xe(Ze){Bn[Ze?"unshift":"push"](()=>{ke=Ze,a(5,ke)})}function Ne(Ze){Bn[Ze?"unshift":"push"](()=>{le=Ze,a(3,le)})}function Le(Ze){Bn[Ze?"unshift":"push"](()=>{ie=Ze,a(4,ie)})}function ut(Ze){Bn[Ze?"unshift":"push"](()=>{Y=Ze,a(2,Y)})}return t.$$set=Ze=>{"top"in Ze&&a(12,b=Ze.top),"bottom"in Ze&&a(13,S=Ze.bottom),"threshold"in Ze&&a(14,E=Ze.threshold),"query"in Ze&&a(15,P=Ze.query),"parallax"in Ze&&a(16,k=Ze.parallax),"index"in Ze&&a(6,L=Ze.index),"count"in Ze&&a(7,j=Ze.count),"offset"in Ze&&a(8,q=Ze.offset),"progress"in Ze&&a(9,J=Ze.progress),"visible"in Ze&&a(10,ee=Ze.visible),"splitscreen"in Ze&&a(0,ge=Ze.splitscreen),"id"in Ze&&a(11,_e=Ze.id),"$$scope"in Ze&&a(17,o=Ze.$$scope)},t.$$.update=()=>{t.$$.dirty[0]&4098&&(c=Math.round(b*ve)),t.$$.dirty[0]&8194&&(h=Math.round(S*ve)),t.$$.dirty[0]&16386&&(p=Math.round(E*ve)),t.$$.dirty[0]&94208&&We()},[ge,ve,Y,le,ie,ke,L,j,q,J,ee,_e,b,S,E,P,k,o,_,mt,xe,Ne,Le,ut]}class tv extends _i{constructor(n){super(),gi(this,n,ev,$1,di,{top:12,bottom:13,threshold:14,query:15,parallax:16,index:6,count:7,offset:8,progress:9,visible:10,splitscreen:0,id:11},null,[-1,-1])}}var Xo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Pf={},iv={get exports(){return Pf},set exports(t){Pf=t}};(function(t,n){(function(a,c){t.exports=c()})(Xo,function(){var a,c,h;function p(o,b){if(!a)a=b;else if(!c)c=b;else{var S="var sharedChunk = {}; ("+a+")(sharedChunk); ("+c+")(sharedChunk);",E={};a(E),h=b(E),typeof window<"u"&&(h.workerUrl=window.URL.createObjectURL(new Blob([S],{type:"text/javascript"})))}}p(["exports"],function(o){var b=S;function S(r,e,s,u){this.cx=3*r,this.bx=3*(s-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(u-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=e,this.p2x=s,this.p2y=u}function E(r,e,s,u){const m=new b(r,e,s,u);return function(y){return m.solve(y)}}S.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,e){if(e===void 0&&(e=1e-6),r<0)return 0;if(r>1)return 1;for(var s=r,u=0;u<8;u++){var m=this.sampleCurveX(s)-r;if(Math.abs(m)<e)return s;var y=this.sampleCurveDerivativeX(s);if(Math.abs(y)<1e-6)break;s-=m/y}var x=0,T=1;for(s=r,u=0;u<20&&(m=this.sampleCurveX(s),!(Math.abs(m-r)<e));u++)r>m?x=s:T=s,s=.5*(T-x)+x;return s},solve:function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))}};const P=E(.25,.1,.25,1);function k(r,e,s){return Math.min(s,Math.max(e,r))}function L(r,e,s){const u=s-e,m=((r-e)%u+u)%u+e;return m===e?s:m}function j(r,...e){for(const s of e)for(const u in s)r[u]=s[u];return r}let q=1;function J(r,e){r.forEach(s=>{e[s]&&(e[s]=e[s].bind(e))})}function ee(r,e,s){const u={};for(const m in r)u[m]=e.call(s||this,r[m],m,r);return u}function ge(r,e,s){const u={};for(const m in r)e.call(s||this,r[m],m,r)&&(u[m]=r[m]);return u}function _e(r){return Array.isArray(r)?r.map(_e):typeof r=="object"&&r?ee(r,_e):r}const Y={};function le(r){Y[r]||(typeof console<"u"&&console.warn(r),Y[r]=!0)}function ie(r,e,s){return(s.y-r.y)*(e.x-r.x)>(e.y-r.y)*(s.x-r.x)}function ke(r){let e=0;for(let s,u,m=0,y=r.length,x=y-1;m<y;x=m++)s=r[m],u=r[x],e+=(u.x-s.x)*(s.y+u.y);return e}function Je(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ve(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,u,m,y)=>{const x=m||y;return e[u]=!x||x.toLowerCase(),""}),e["max-age"]){const s=parseInt(e["max-age"],10);isNaN(s)?delete e["max-age"]:e["max-age"]=s}return e}let pe,Fe,$e=null;function ct(r){if($e==null){const e=r.navigator?r.navigator.userAgent:null;$e=!!r.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return $e}function We(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const mt={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(r){const e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){const s=window.document.createElement("canvas"),u=s.getContext("2d");if(!u)throw new Error("failed to create canvas 2d context");return s.width=r.width,s.height=r.height,u.drawImage(r,0,0,r.width,r.height),u.getImageData(-e,-e,r.width+2*e,r.height+2*e)},resolveURL:r=>(pe||(pe=document.createElement("a")),pe.href=r,pe.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Fe==null&&(Fe=matchMedia("(prefers-reduced-motion: reduce)")),Fe.matches)}};var xe=Ne;function Ne(r,e){this.x=r,this.y=e}Ne.prototype={clone:function(){return new Ne(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,e){return this.clone()._rotateAround(r,e)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var e=r.x-this.x,s=r.y-this.y;return e*e+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult:function(r){var e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var e=Math.cos(r),s=Math.sin(r),u=s*this.x+e*this.y;return this.x=e*this.x-s*this.y,this.y=u,this},_rotateAround:function(r,e){var s=Math.cos(r),u=Math.sin(r),m=e.y+u*(this.x-e.x)+s*(this.y-e.y);return this.x=e.x+s*(this.x-e.x)-u*(this.y-e.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ne.convert=function(r){return r instanceof Ne?r:Array.isArray(r)?new Ne(r[0],r[1]):r};const Le={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},ut="mapbox-tiles";let Ze,qt,It=500,Ut=50;function Kt(){typeof caches>"u"||Ze||(Ze=caches.open(ut))}let Jt=1/0;const li={supported:!1,testSupport:function(r){!rt&&Ji&&(He?Mt(r):mi=r)}};let mi,Ji,rt=!1,He=!1;function Mt(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,Ji),r.isContextLost())return;li.supported=!0}catch{}r.deleteTexture(e),rt=!0}typeof document<"u"&&(Ji=document.createElement("img"),Ji.onload=function(){mi&&Mt(mi),mi=null,He=!0},Ji.onerror=function(){rt=!0,mi=null},Ji.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Qe={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Qe);class At extends Error{constructor(e,s,u,m){super(`AJAXError: ${s} (${e}): ${u}`),this.status=e,this.statusText=s,this.url=u,this.body=m}}const ei=Je()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function Ei(r,e){const s=new AbortController,u=new Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,referrer:ei(),signal:s.signal});let m=!1,y=!1;return r.type==="json"&&u.headers.set("Accept","application/json"),((x,T,C)=>{if(y)return;const M=Date.now();fetch(u).then(R=>R.ok?((F,V,Z)=>{(r.type==="arrayBuffer"?F.arrayBuffer():r.type==="json"?F.json():F.text()).then(H=>{y||(V&&Z&&function(oe,re,Se){if(Kt(),!Ze)return;const De={status:re.status,statusText:re.statusText,headers:new Headers};re.headers.forEach((Pe,Ke)=>De.headers.set(Ke,Pe));const we=ve(re.headers.get("Cache-Control")||"");we["no-store"]||(we["max-age"]&&De.headers.set("Expires",new Date(Se+1e3*we["max-age"]).toUTCString()),new Date(De.headers.get("Expires")).getTime()-Se<42e4||function(Pe,Ke){if(qt===void 0)try{new Response(new ReadableStream),qt=!0}catch{qt=!1}qt?Ke(Pe.body):Pe.blob().then(Ke)}(re,Pe=>{const Ke=new Response(Pe,De);Kt(),Ze&&Ze.then(Xe=>Xe.put(function(bt){const Ct=bt.indexOf("?");return Ct<0?bt:bt.slice(0,Ct)}(oe.url),Ke)).catch(Xe=>le(Xe.message))}))}(u,V,Z),m=!0,e(null,H,F.headers.get("Cache-Control"),F.headers.get("Expires")))}).catch(H=>{y||e(new Error(H.message))})})(R,null,M):R.blob().then(F=>e(new At(R.status,R.statusText,r.url,F)))).catch(R=>{R.code!==20&&e(new Error(R.message))})})(),{cancel:()=>{y=!0,m||s.abort()}}}const ci=function(r,e){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){if(Je()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e);if(!Je()){const u=r.url.substring(0,r.url.indexOf("://"));return(Le.REGISTERED_PROTOCOLS[u]||Ei)(r,e)}}if(!(/^file:/.test(s=r.url)||/^file:/.test(ei())&&!/^\w+:/.test(s))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Ei(r,e);if(Je()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var s;return function(u,m){const y=new XMLHttpRequest;y.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(y.responseType="arraybuffer");for(const x in u.headers)y.setRequestHeader(x,u.headers[x]);return u.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=u.credentials==="include",y.onerror=()=>{m(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){let x=y.response;if(u.type==="json")try{x=JSON.parse(y.response)}catch(T){return m(T)}m(null,x,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else{const x=new Blob([y.response],{type:y.getResponseHeader("Content-Type")});m(new At(y.status,y.statusText,u.url,x))}},y.send(u.body),{cancel:()=>y.abort()}}(r,e)},Nt=function(r,e){return ci(j(r,{type:"arrayBuffer"}),e)};function fi(r){const e=window.document.createElement("a");return e.href=r,e.protocol===window.document.location.protocol&&e.host===window.document.location.host}const Qt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let fn,kn;fn=[],kn=0;const Sn=function(r,e){if(li.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),kn>=Le.MAX_PARALLEL_IMAGE_REQUESTS){const y={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return fn.push(y),y}kn++;let s=!1;const u=()=>{if(!s)for(s=!0,kn--;fn.length&&kn<Le.MAX_PARALLEL_IMAGE_REQUESTS;){const y=fn.shift(),{requestParameters:x,callback:T,cancelled:C}=y;C||(y.cancel=Sn(x,T).cancel)}},m=Nt(r,(y,x,T,C)=>{u(),y?e(y):x&&function(M,R){typeof createImageBitmap=="function"?function(F,V){const Z=new Blob([new Uint8Array(F)],{type:"image/png"});createImageBitmap(Z).then(H=>{V(null,H)}).catch(H=>{V(new Error(`Could not load image because of ${H.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(M,R):function(F,V){const Z=new Image;Z.onload=()=>{V(null,Z),URL.revokeObjectURL(Z.src),Z.onload=null,window.requestAnimationFrame(()=>{Z.src=Qt})},Z.onerror=()=>V(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const H=new Blob([new Uint8Array(F)],{type:"image/png"});Z.src=F.byteLength?URL.createObjectURL(H):Qt}(M,R)}(x,(M,R)=>{M!=null?e(M):R!=null&&e(null,R,{cacheControl:T,expires:C})})});return{cancel:()=>{m.cancel(),u()}}};function Hn(r,e,s){s[r]&&s[r].indexOf(e)!==-1||(s[r]=s[r]||[],s[r].push(e))}function Tt(r,e,s){if(s&&s[r]){const u=s[r].indexOf(e);u!==-1&&s[r].splice(u,1)}}class si{constructor(e,s={}){j(this,s),this.type=e}}class Ui extends si{constructor(e,s={}){super("error",j({error:e},s))}}class Qi{on(e,s){return this._listeners=this._listeners||{},Hn(e,s,this._listeners),this}off(e,s){return Tt(e,s,this._listeners),Tt(e,s,this._oneTimeListeners),this}once(e,s){return this._oneTimeListeners=this._oneTimeListeners||{},Hn(e,s,this._oneTimeListeners),this}fire(e,s){typeof e=="string"&&(e=new si(e,s||{}));const u=e.type;if(this.listens(u)){e.target=this;const m=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const T of m)T.call(this,e);const y=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const T of y)Tt(u,T,this._oneTimeListeners),T.call(this,e);const x=this._eventedParent;x&&(j(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(e))}else e instanceof Ui&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,s){return this._eventedParent=e,this._eventedParentData=s,this}}var Oe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Ee{constructor(e,s,u,m){this.message=(e?`${e}: `:"")+u,m&&(this.identifier=m),s!=null&&s.__line__&&(this.line=s.__line__)}}function nn(r){const e=r.value;return e?[new Ee(r.key,e,"constants have been deprecated as of v8")]:[]}function sn(r,...e){for(const s of e)for(const u in s)r[u]=s[u];return r}function Gt(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Ni(r){if(Array.isArray(r))return r.map(Ni);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const s in r)e[s]=Ni(r[s]);return e}return Gt(r)}class gn extends Error{constructor(e,s){super(s),this.message=s,this.key=e}}class _n{constructor(e,s=[]){this.parent=e,this.bindings={};for(const[u,m]of s)this.bindings[u]=m}concat(e){return new _n(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const tr={kind:"null"},ot={kind:"number"},Xt={kind:"string"},Zt={kind:"boolean"},Wi={kind:"color"},Un={kind:"object"},jt={kind:"value"},An={kind:"collator"},Yi={kind:"formatted"},Ar={kind:"padding"},ji={kind:"resolvedImage"};function on(r,e){return{kind:"array",itemType:r,N:e}}function bi(r){if(r.kind==="array"){const e=bi(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const Ir=[tr,ot,Xt,Zt,Wi,Yi,Un,on(jt),Ar,ji];function Nn(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Nn(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const s of Ir)if(!Nn(s,e))return null}}return`Expected ${bi(r)} but found ${bi(e)} instead.`}function _r(r,e){return e.some(s=>s.kind===r.kind)}function Mr(r,e){return e.some(s=>s==="null"?r===null:s==="array"?Array.isArray(r):s==="object"?r&&!Array.isArray(r)&&typeof r=="object":s===typeof r)}var ki,In={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function K(r){return(r=Math.round(r))<0?0:r>255?255:r}function D(r){return K(r[r.length-1]==="%"?parseFloat(r)/100*255:parseInt(r))}function U(r){return(e=r[r.length-1]==="%"?parseFloat(r)/100:parseFloat(r))<0?0:e>1?1:e;var e}function W(r,e,s){return s<0?s+=1:s>1&&(s-=1),6*s<1?r+(e-r)*s*6:2*s<1?e:3*s<2?r+(e-r)*(2/3-s)*6:r}try{ki={}.parseCSSColor=function(r){var e,s=r.replace(/ /g,"").toLowerCase();if(s in In)return In[s].slice();if(s[0]==="#")return s.length===4?(e=parseInt(s.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:s.length===7&&(e=parseInt(s.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var u=s.indexOf("("),m=s.indexOf(")");if(u!==-1&&m+1===s.length){var y=s.substr(0,u),x=s.substr(u+1,m-(u+1)).split(","),T=1;switch(y){case"rgba":if(x.length!==4)return null;T=U(x.pop());case"rgb":return x.length!==3?null:[D(x[0]),D(x[1]),D(x[2]),T];case"hsla":if(x.length!==4)return null;T=U(x.pop());case"hsl":if(x.length!==3)return null;var C=(parseFloat(x[0])%360+360)%360/360,M=U(x[1]),R=U(x[2]),F=R<=.5?R*(M+1):R+M-R*M,V=2*R-F;return[K(255*W(V,F,C+1/3)),K(255*W(V,F,C)),K(255*W(V,F,C-1/3)),T];default:return null}}return null}}catch{}class X{constructor(e,s,u,m=1){this.r=e,this.g=s,this.b=u,this.a=m}static parse(e){if(!e)return;if(e instanceof X)return e;if(typeof e!="string")return;const s=ki(e);return s?new X(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[e,s,u,m]=this.toArray();return`rgba(${Math.round(e)},${Math.round(s)},${Math.round(u)},${m})`}toArray(){const{r:e,g:s,b:u,a:m}=this;return m===0?[0,0,0,0]:[255*e/m,255*s/m,255*u/m,m]}}X.black=new X(0,0,0,1),X.white=new X(1,1,1,1),X.transparent=new X(0,0,0,0),X.red=new X(1,0,0,1);class se{constructor(e,s,u){this.sensitivity=e?s?"variant":"case":s?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,s){return this.collator.compare(e,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class me{constructor(e,s,u,m,y){this.text=e,this.image=s,this.scale=u,this.fontStack=m,this.textColor=y}}class he{constructor(e){this.sections=e}static fromString(e){return new he([new me(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof he?e:he.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class ae{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ae)return e;if(typeof e=="number")return new ae([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const s of e)if(typeof s!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new ae(e)}}toString(){return JSON.stringify(this.values)}}class ye{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new ye({name:e,available:!1}):null}}function Ue(r,e,s,u){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof s=="number"&&s>=0&&s<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[r,e,s,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[r,e,s,u]:[r,e,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ye(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof X||r instanceof se||r instanceof he||r instanceof ae||r instanceof ye)return!0;if(Array.isArray(r)){for(const e of r)if(!Ye(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!Ye(r[e]))return!1;return!0}return!1}function Be(r){if(r===null)return tr;if(typeof r=="string")return Xt;if(typeof r=="boolean")return Zt;if(typeof r=="number")return ot;if(r instanceof X)return Wi;if(r instanceof se)return An;if(r instanceof he)return Yi;if(r instanceof ae)return Ar;if(r instanceof ye)return ji;if(Array.isArray(r)){const e=r.length;let s;for(const u of r){const m=Be(u);if(s){if(s===m)continue;s=jt;break}s=m}return on(s||jt,e)}return Un}function kt(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof X||r instanceof he||r instanceof ae||r instanceof ye?r.toString():JSON.stringify(r)}class St{constructor(e,s){this.type=e,this.value=s}static parse(e,s){if(e.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ye(e[1]))return s.error("invalid value");const u=e[1];let m=Be(u);const y=s.expectedType;return m.kind!=="array"||m.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(m=y),new St(m,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ht{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Dt={string:Xt,number:ot,boolean:Zt,object:Un};class Bt{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");let u,m=1;const y=e[0];if(y==="array"){let T,C;if(e.length>2){const M=e[1];if(typeof M!="string"||!(M in Dt)||M==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);T=Dt[M],m++}else T=jt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return s.error('The length argument to "array" must be a positive integer literal',2);C=e[2],m++}u=on(T,C)}else{if(!Dt[y])throw new Error(`Types doesn't contain name = ${y}`);u=Dt[y]}const x=[];for(;m<e.length;m++){const T=s.parse(e[m],m,jt);if(!T)return null;x.push(T)}return new Bt(u,x)}evaluate(e){for(let s=0;s<this.args.length;s++){const u=this.args[s].evaluate(e);if(!Nn(this.type,Be(u)))return u;if(s===this.args.length-1)throw new ht(`Expected value to be of type ${bi(this.type)}, but found ${bi(Be(u))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const ri={"to-boolean":Zt,"to-color":Wi,"to-number":ot,"to-string":Xt};class Vt{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const u=e[0];if(!ri[u])throw new Error(`Can't parse ${u} as it is not part of the known types`);if((u==="to-boolean"||u==="to-string")&&e.length!==2)return s.error("Expected one argument.");const m=ri[u],y=[];for(let x=1;x<e.length;x++){const T=s.parse(e[x],x,jt);if(!T)return null;y.push(T)}return new Vt(m,y)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let s,u;for(const m of this.args){if(s=m.evaluate(e),u=null,s instanceof X)return s;if(typeof s=="string"){const y=e.parseColor(s);if(y)return y}else if(Array.isArray(s)&&(u=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Ue(s[0],s[1],s[2],s[3]),!u))return new X(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new ht(u||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}if(this.type.kind==="padding"){let s;for(const u of this.args){s=u.evaluate(e);const m=ae.parse(s);if(m)return m}throw new ht(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}if(this.type.kind==="number"){let s=null;for(const u of this.args){if(s=u.evaluate(e),s===null)return 0;const m=Number(s);if(!isNaN(m))return m}throw new ht(`Could not convert ${JSON.stringify(s)} to number.`)}return this.type.kind==="formatted"?he.fromString(kt(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?ye.fromString(kt(this.args[0].evaluate(e))):kt(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Wt=["Unknown","Point","LineString","Polygon"];class ai{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Wt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let s=this._parseColorCache[e];return s||(s=this._parseColorCache[e]=X.parse(e)),s}}class wi{constructor(e,s,u,m){this.name=e,this.type=s,this._evaluate=u,this.args=m}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,s){const u=e[0],m=wi.definitions[u];if(!m)return s.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(m)?m[0]:m.type,x=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,T=x.filter(([M])=>!Array.isArray(M)||M.length===e.length-1);let C=null;for(const[M,R]of T){C=new ea(s.registry,s.path,null,s.scope);const F=[];let V=!1;for(let Z=1;Z<e.length;Z++){const H=e[Z],oe=Array.isArray(M)?M[Z-1]:M.type,re=C.parse(H,1+F.length,oe);if(!re){V=!0;break}F.push(re)}if(!V)if(Array.isArray(M)&&M.length!==F.length)C.error(`Expected ${M.length} arguments, but found ${F.length} instead.`);else{for(let Z=0;Z<F.length;Z++){const H=Array.isArray(M)?M[Z]:M.type,oe=F[Z];C.concat(Z+1).checkSubtype(H,oe.type)}if(C.errors.length===0)return new wi(u,y,R,F)}}if(T.length===1)s.errors.push(...C.errors);else{const M=(T.length?T:x).map(([F])=>{return V=F,Array.isArray(V)?`(${V.map(bi).join(", ")})`:`(${bi(V.type)}...)`;var V}).join(" | "),R=[];for(let F=1;F<e.length;F++){const V=s.parse(e[F],1+R.length);if(!V)return null;R.push(bi(V.type))}s.error(`Expected arguments of type ${M}, but found (${R.join(", ")}) instead.`)}return null}static register(e,s){wi.definitions=s;for(const u in s)e[u]=wi}}class Xi{constructor(e,s,u){this.type=An,this.locale=u,this.caseSensitive=e,this.diacriticSensitive=s}static parse(e,s){if(e.length!==2)return s.error("Expected one argument.");const u=e[1];if(typeof u!="object"||Array.isArray(u))return s.error("Collator options argument must be an object.");const m=s.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Zt);if(!m)return null;const y=s.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Zt);if(!y)return null;let x=null;return u.locale&&(x=s.parse(u.locale,1,Xt),!x)?null:new Xi(m,y,x)}evaluate(e){return new se(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const Ii=8192;function $i(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function Pr(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function jr(r,e){const s=(180+r[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,m=Math.pow(2,e.z);return[Math.round(s*m*Ii),Math.round(u*m*Ii)]}function Si(r,e,s){const u=r[0]-e[0],m=r[1]-e[1],y=r[0]-s[0],x=r[1]-s[1];return u*x-y*m==0&&u*y<=0&&m*x<=0}function pa(r,e){let s=!1;for(let x=0,T=e.length;x<T;x++){const C=e[x];for(let M=0,R=C.length;M<R-1;M++){if(Si(r,C[M],C[M+1]))return!1;(m=C[M])[1]>(u=r)[1]!=(y=C[M+1])[1]>u[1]&&u[0]<(y[0]-m[0])*(u[1]-m[1])/(y[1]-m[1])+m[0]&&(s=!s)}}var u,m,y;return s}function Jr(r,e){for(let s=0;s<e.length;s++)if(pa(r,e[s]))return!0;return!1}function da(r,e,s,u){const m=u[0]-s[0],y=u[1]-s[1],x=(r[0]-s[0])*y-m*(r[1]-s[1]),T=(e[0]-s[0])*y-m*(e[1]-s[1]);return x>0&&T<0||x<0&&T>0}function ma(r,e,s){for(const M of s)for(let R=0;R<M.length-1;++R)if((T=[(x=M[R+1])[0]-(y=M[R])[0],x[1]-y[1]])[0]*(C=[(m=e)[0]-(u=r)[0],m[1]-u[1]])[1]-T[1]*C[0]!=0&&da(u,m,y,x)&&da(y,x,u,m))return!0;var u,m,y,x,T,C;return!1}function Yr(r,e){for(let s=0;s<r.length;++s)if(!pa(r[s],e))return!1;for(let s=0;s<r.length-1;++s)if(ma(r[s],r[s+1],e))return!1;return!0}function ns(r,e){for(let s=0;s<e.length;s++)if(Yr(r,e[s]))return!0;return!1}function Qr(r,e,s){const u=[];for(let m=0;m<r.length;m++){const y=[];for(let x=0;x<r[m].length;x++){const T=jr(r[m][x],s);$i(e,T),y.push(T)}u.push(y)}return u}function rs(r,e,s){const u=[];for(let m=0;m<r.length;m++){const y=Qr(r[m],e,s);u.push(y)}return u}function As(r,e,s,u){if(r[0]<s[0]||r[0]>s[2]){const m=.5*u;let y=r[0]-s[0]>m?-u:s[0]-r[0]>m?u:0;y===0&&(y=r[0]-s[2]>m?-u:s[2]-r[0]>m?u:0),r[0]+=y}$i(e,r)}function Is(r,e,s,u){const m=Math.pow(2,u.z)*Ii,y=[u.x*Ii,u.y*Ii],x=[];for(const T of r)for(const C of T){const M=[C.x+y[0],C.y+y[1]];As(M,e,s,m),x.push(M)}return x}function zr(r,e,s,u){const m=Math.pow(2,u.z)*Ii,y=[u.x*Ii,u.y*Ii],x=[];for(const C of r){const M=[];for(const R of C){const F=[R.x+y[0],R.y+y[1]];$i(e,F),M.push(F)}x.push(M)}if(e[2]-e[0]<=m/2){(T=e)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const C of x)for(const M of C)As(M,e,s,m)}var T;return x}class Mn{constructor(e,s){this.type=Zt,this.geojson=e,this.geometries=s}static parse(e,s){if(e.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ye(e[1])){const u=e[1];if(u.type==="FeatureCollection")for(let m=0;m<u.features.length;++m){const y=u.features[m].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new Mn(u,u.features[m].geometry)}else if(u.type==="Feature"){const m=u.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Mn(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new Mn(u,u)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(s,u){const m=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],x=s.canonicalID();if(u.type==="Polygon"){const T=Qr(u.coordinates,y,x),C=Is(s.geometry(),m,y,x);if(!Pr(m,y))return!1;for(const M of C)if(!pa(M,T))return!1}if(u.type==="MultiPolygon"){const T=rs(u.coordinates,y,x),C=Is(s.geometry(),m,y,x);if(!Pr(m,y))return!1;for(const M of C)if(!Jr(M,T))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(s,u){const m=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],x=s.canonicalID();if(u.type==="Polygon"){const T=Qr(u.coordinates,y,x),C=zr(s.geometry(),m,y,x);if(!Pr(m,y))return!1;for(const M of C)if(!Yr(M,T))return!1}if(u.type==="MultiPolygon"){const T=rs(u.coordinates,y,x),C=zr(s.geometry(),m,y,x);if(!Pr(m,y))return!1;for(const M of C)if(!ns(M,T))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function jn(r){if(r instanceof wi&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof Mn)return!1;let e=!0;return r.eachChild(s=>{e&&!jn(s)&&(e=!1)}),e}function $r(r){if(r instanceof wi&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(s=>{e&&!$r(s)&&(e=!1)}),e}function za(r,e){if(r instanceof wi&&e.indexOf(r.name)>=0)return!1;let s=!0;return r.eachChild(u=>{s&&!za(u,e)&&(s=!1)}),s}class Da{constructor(e,s){this.type=s.type,this.name=e,this.boundExpression=s}static parse(e,s){if(e.length!==2||typeof e[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const u=e[1];return s.scope.has(u)?new Da(u,s.scope.get(u)):s.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class ea{constructor(e,s=[],u,m=new _n,y=[]){this.registry=e,this.path=s,this.key=s.map(x=>`[${x}]`).join(""),this.scope=m,this.errors=y,this.expectedType=u}parse(e,s,u,m,y={}){return s?this.concat(s,u,m)._parse(e,y):this._parse(e,y)}_parse(e,s){function u(m,y,x){return x==="assert"?new Bt(y,[m]):x==="coerce"?new Vt(y,[m]):m}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=e[0];if(typeof m!="string")return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[m];if(y){let x=y.parse(e,this);if(!x)return null;if(this.expectedType){const T=this.expectedType,C=x.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||C.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||C.kind!=="value"&&C.kind!=="string")if(T.kind!=="padding"||C.kind!=="value"&&C.kind!=="number"&&C.kind!=="array"){if(this.checkSubtype(T,C))return null}else x=u(x,T,s.typeAnnotation||"coerce");else x=u(x,T,s.typeAnnotation||"coerce");else x=u(x,T,s.typeAnnotation||"assert")}if(!(x instanceof St)&&x.type.kind!=="resolvedImage"&&La(x)){const T=new ai;try{x=new St(x.type,x.evaluate(T))}catch(C){return this.error(C.message),null}}return x}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,s,u){const m=typeof e=="number"?this.path.concat(e):this.path,y=u?this.scope.concat(u):this.scope;return new ea(this.registry,m,s||null,y,this.errors)}error(e,...s){const u=`${this.key}${s.map(m=>`[${m}]`).join("")}`;this.errors.push(new gn(u,e))}checkSubtype(e,s){const u=Nn(e,s);return u&&this.error(u),u}}function La(r){if(r instanceof Da)return La(r.boundExpression);if(r instanceof wi&&r.name==="error"||r instanceof Xi||r instanceof Mn)return!1;const e=r instanceof Vt||r instanceof Bt;let s=!0;return r.eachChild(u=>{s=e?s&&La(u):s&&u instanceof St}),!!s&&jn(r)&&za(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function as(r,e){const s=r.length-1;let u,m,y=0,x=s,T=0;for(;y<=x;)if(T=Math.floor((y+x)/2),u=r[T],m=r[T+1],u<=e){if(T===s||e<m)return T;y=T+1}else{if(!(u>e))throw new ht("Input is not a number.");x=T-1}return 0}class ta{constructor(e,s,u){this.type=e,this.input=s,this.labels=[],this.outputs=[];for(const[m,y]of u)this.labels.push(m),this.outputs.push(y)}static parse(e,s){if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");const u=s.parse(e[1],1,ot);if(!u)return null;const m=[];let y=null;s.expectedType&&s.expectedType.kind!=="value"&&(y=s.expectedType);for(let x=1;x<e.length;x+=2){const T=x===1?-1/0:e[x],C=e[x+1],M=x,R=x+1;if(typeof T!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(m.length&&m[m.length-1][0]>=T)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const F=s.parse(C,R,y);if(!F)return null;y=y||F.type,m.push([T,F])}return new ta(y,u,m)}evaluate(e){const s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(e);const m=this.input.evaluate(e);if(m<=s[0])return u[0].evaluate(e);const y=s.length;return m>=s[y-1]?u[y-1].evaluate(e):u[as(s,m)].evaluate(e)}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Ri(r,e,s){return r*(1-s)+e*s}var ia=Object.freeze({__proto__:null,number:Ri,color:function(r,e,s){return new X(Ri(r.r,e.r,s),Ri(r.g,e.g,s),Ri(r.b,e.b,s),Ri(r.a,e.a,s))},array:function(r,e,s){return r.map((u,m)=>Ri(u,e[m],s))},padding:function(r,e,s){const u=r.values,m=e.values;return new ae([Ri(u[0],m[0],s),Ri(u[1],m[1],s),Ri(u[2],m[2],s),Ri(u[3],m[3],s)])}});const yo=.95047,ss=1.08883,Ms=4/29,os=6/29,vo=3*os*os,ol=Math.PI/180,ll=180/Math.PI;function Ra(r){return r>.008856451679035631?Math.pow(r,1/3):r/vo+Ms}function Ps(r){return r>os?r*r*r:vo*(r-Ms)}function zs(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function Te(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function ti(r){const e=Te(r.r),s=Te(r.g),u=Te(r.b),m=Ra((.4124564*e+.3575761*s+.1804375*u)/yo),y=Ra((.2126729*e+.7151522*s+.072175*u)/1);return{l:116*y-16,a:500*(m-y),b:200*(y-Ra((.0193339*e+.119192*s+.9503041*u)/ss)),alpha:r.a}}function ir(r){let e=(r.l+16)/116,s=isNaN(r.a)?e:e+r.a/500,u=isNaN(r.b)?e:e-r.b/200;return e=1*Ps(e),s=yo*Ps(s),u=ss*Ps(u),new X(zs(3.2404542*s-1.5371385*e-.4985314*u),zs(-.969266*s+1.8760108*e+.041556*u),zs(.0556434*s-.2040259*e+1.0572252*u),r.alpha)}function ln(r,e,s){const u=e-r;return r+s*(u>180||u<-180?u-360*Math.round(u/360):u)}const nr={forward:ti,reverse:ir,interpolate:function(r,e,s){return{l:Ri(r.l,e.l,s),a:Ri(r.a,e.a,s),b:Ri(r.b,e.b,s),alpha:Ri(r.alpha,e.alpha,s)}}},Ba={forward:function(r){const{l:e,a:s,b:u}=ti(r),m=Math.atan2(u,s)*ll;return{h:m<0?m+360:m,c:Math.sqrt(s*s+u*u),l:e,alpha:r.a}},reverse:function(r){const e=r.h*ol,s=r.c;return ir({l:r.l,a:Math.cos(e)*s,b:Math.sin(e)*s,alpha:r.alpha})},interpolate:function(r,e,s){return{h:ln(r.h,e.h,s),c:Ri(r.c,e.c,s),l:Ri(r.l,e.l,s),alpha:Ri(r.alpha,e.alpha,s)}}};var xo=Object.freeze({__proto__:null,lab:nr,hcl:Ba});class Vn{constructor(e,s,u,m,y){this.type=e,this.operator=s,this.interpolation=u,this.input=m,this.labels=[],this.outputs=[];for(const[x,T]of y)this.labels.push(x),this.outputs.push(T)}static interpolationFactor(e,s,u,m){let y=0;if(e.name==="exponential")y=Fa(s,e.base,u,m);else if(e.name==="linear")y=Fa(s,1,u,m);else if(e.name==="cubic-bezier"){const x=e.controlPoints;y=new b(x[0],x[1],x[2],x[3]).solve(Fa(s,1,u,m))}return y}static parse(e,s){let[u,m,y,...x]=e;if(!Array.isArray(m)||m.length===0)return s.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const M=m[1];if(typeof M!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:M}}else{if(m[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const M=m.slice(1);if(M.length!==4||M.some(R=>typeof R!="number"||R<0||R>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:M}}}if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(y=s.parse(y,2,ot),!y)return null;const T=[];let C=null;u==="interpolate-hcl"||u==="interpolate-lab"?C=Wi:s.expectedType&&s.expectedType.kind!=="value"&&(C=s.expectedType);for(let M=0;M<x.length;M+=2){const R=x[M],F=x[M+1],V=M+3,Z=M+4;if(typeof R!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(T.length&&T[T.length-1][0]>=R)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',V);const H=s.parse(F,Z,C);if(!H)return null;C=C||H.type,T.push([R,H])}return C.kind==="number"||C.kind==="color"||C.kind==="padding"||C.kind==="array"&&C.itemType.kind==="number"&&typeof C.N=="number"?new Vn(C,u,m,y,T):s.error(`Type ${bi(C)} is not interpolatable.`)}evaluate(e){const s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(e);const m=this.input.evaluate(e);if(m<=s[0])return u[0].evaluate(e);const y=s.length;if(m>=s[y-1])return u[y-1].evaluate(e);const x=as(s,m),T=Vn.interpolationFactor(this.interpolation,m,s[x],s[x+1]),C=u[x].evaluate(e),M=u[x+1].evaluate(e);return this.operator==="interpolate"?ia[this.type.kind.toLowerCase()](C,M,T):this.operator==="interpolate-hcl"?Ba.reverse(Ba.interpolate(Ba.forward(C),Ba.forward(M),T)):nr.reverse(nr.interpolate(nr.forward(C),nr.forward(M),T))}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Fa(r,e,s,u){const m=u-s,y=r-s;return m===0?0:e===1?y/m:(Math.pow(e,y)-1)/(Math.pow(e,m)-1)}class ls{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expectected at least one argument.");let u=null;const m=s.expectedType;m&&m.kind!=="value"&&(u=m);const y=[];for(const T of e.slice(1)){const C=s.parse(T,1+y.length,u,void 0,{typeAnnotation:"omit"});if(!C)return null;u=u||C.type,y.push(C)}if(!u)throw new Error("No output type");const x=m&&y.some(T=>Nn(m,T.type));return new ls(x?jt:u,y)}evaluate(e){let s,u=null,m=0;for(const y of this.args)if(m++,u=y.evaluate(e),u&&u instanceof ye&&!u.available&&(s||(s=u.name),u=null,m===this.args.length&&(u=s)),u!==null)break;return u}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class ga{constructor(e,s){this.type=s.type,this.bindings=[].concat(e),this.result=s}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const s of this.bindings)e(s[1]);e(this.result)}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const u=[];for(let y=1;y<e.length-1;y+=2){const x=e[y];if(typeof x!="string")return s.error(`Expected string, but found ${typeof x} instead.`,y);if(/[^a-zA-Z0-9_]/.test(x))return s.error("Variable names must contain only alphanumeric characters or '_'.",y);const T=s.parse(e[y+1],y+1);if(!T)return null;u.push([x,T])}const m=s.parse(e[e.length-1],e.length-1,s.expectedType,u);return m?new ga(u,m):null}outputDefined(){return this.result.outputDefined()}}class cl{constructor(e,s,u){this.type=e,this.index=s,this.input=u}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const u=s.parse(e[1],1,ot),m=s.parse(e[2],2,on(s.expectedType||jt));return u&&m?new cl(m.type.itemType,u,m):null}evaluate(e){const s=this.index.evaluate(e),u=this.input.evaluate(e);if(s<0)throw new ht(`Array index out of bounds: ${s} < 0.`);if(s>=u.length)throw new ht(`Array index out of bounds: ${s} > ${u.length-1}.`);if(s!==Math.floor(s))throw new ht(`Array index must be an integer, but found ${s} instead.`);return u[s]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class ul{constructor(e,s){this.type=Zt,this.needle=e,this.haystack=s}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const u=s.parse(e[1],1,jt),m=s.parse(e[2],2,jt);return u&&m?_r(u.type,[Zt,Xt,ot,tr,jt])?new ul(u,m):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${bi(u.type)} instead`):null}evaluate(e){const s=this.needle.evaluate(e),u=this.haystack.evaluate(e);if(!u)return!1;if(!Mr(s,["boolean","string","number","null"]))throw new ht(`Expected first argument to be of type boolean, string, number or null, but found ${bi(Be(s))} instead.`);if(!Mr(u,["string","array"]))throw new ht(`Expected second argument to be of type array or string, but found ${bi(Be(u))} instead.`);return u.indexOf(s)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class bo{constructor(e,s,u){this.type=ot,this.needle=e,this.haystack=s,this.fromIndex=u}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const u=s.parse(e[1],1,jt),m=s.parse(e[2],2,jt);if(!u||!m)return null;if(!_r(u.type,[Zt,Xt,ot,tr,jt]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${bi(u.type)} instead`);if(e.length===4){const y=s.parse(e[3],3,ot);return y?new bo(u,m,y):null}return new bo(u,m)}evaluate(e){const s=this.needle.evaluate(e),u=this.haystack.evaluate(e);if(!Mr(s,["boolean","string","number","null"]))throw new ht(`Expected first argument to be of type boolean, string, number or null, but found ${bi(Be(s))} instead.`);if(!Mr(u,["string","array"]))throw new ht(`Expected second argument to be of type array or string, but found ${bi(Be(u))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(e);return u.indexOf(s,m)}return u.indexOf(s)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class hl{constructor(e,s,u,m,y,x){this.inputType=e,this.type=s,this.input=u,this.cases=m,this.outputs=y,this.otherwise=x}static parse(e,s){if(e.length<5)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return s.error("Expected an even number of arguments.");let u,m;s.expectedType&&s.expectedType.kind!=="value"&&(m=s.expectedType);const y={},x=[];for(let M=2;M<e.length-1;M+=2){let R=e[M];const F=e[M+1];Array.isArray(R)||(R=[R]);const V=s.concat(M);if(R.length===0)return V.error("Expected at least one branch label.");for(const H of R){if(typeof H!="number"&&typeof H!="string")return V.error("Branch labels must be numbers or strings.");if(typeof H=="number"&&Math.abs(H)>Number.MAX_SAFE_INTEGER)return V.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof H=="number"&&Math.floor(H)!==H)return V.error("Numeric branch labels must be integer values.");if(u){if(V.checkSubtype(u,Be(H)))return null}else u=Be(H);if(y[String(H)]!==void 0)return V.error("Branch labels must be unique.");y[String(H)]=x.length}const Z=s.parse(F,M,m);if(!Z)return null;m=m||Z.type,x.push(Z)}const T=s.parse(e[1],1,jt);if(!T)return null;const C=s.parse(e[e.length-1],e.length-1,m);return C?T.type.kind!=="value"&&s.concat(1).checkSubtype(u,T.type)?null:new hl(u,m,T,y,x,C):null}evaluate(e){const s=this.input.evaluate(e);return(Be(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class fl{constructor(e,s,u){this.type=e,this.branches=s,this.otherwise=u}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return s.error("Expected an odd number of arguments.");let u;s.expectedType&&s.expectedType.kind!=="value"&&(u=s.expectedType);const m=[];for(let x=1;x<e.length-1;x+=2){const T=s.parse(e[x],x,Zt);if(!T)return null;const C=s.parse(e[x+1],x+1,u);if(!C)return null;m.push([T,C]),u=u||C.type}const y=s.parse(e[e.length-1],e.length-1,u);if(!y)return null;if(!u)throw new Error("Can't infer output type");return new fl(u,m,y)}evaluate(e){for(const[s,u]of this.branches)if(s.evaluate(e))return u.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[s,u]of this.branches)e(s),e(u);e(this.otherwise)}outputDefined(){return this.branches.every(([e,s])=>s.outputDefined())&&this.otherwise.outputDefined()}}class wo{constructor(e,s,u,m){this.type=e,this.input=s,this.beginIndex=u,this.endIndex=m}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const u=s.parse(e[1],1,jt),m=s.parse(e[2],2,ot);if(!u||!m)return null;if(!_r(u.type,[on(jt),Xt,jt]))return s.error(`Expected first argument to be of type array or string, but found ${bi(u.type)} instead`);if(e.length===4){const y=s.parse(e[3],3,ot);return y?new wo(u.type,u,m,y):null}return new wo(u.type,u,m)}evaluate(e){const s=this.input.evaluate(e),u=this.beginIndex.evaluate(e);if(!Mr(s,["string","array"]))throw new ht(`Expected first argument to be of type array or string, but found ${bi(Be(s))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(e);return s.slice(u,m)}return s.slice(u)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function wc(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Tc(r,e,s,u){return u.compare(e,s)===0}function cs(r,e,s){const u=r!=="=="&&r!=="!=";return class b_{constructor(y,x,T){this.type=Zt,this.lhs=y,this.rhs=x,this.collator=T,this.hasUntypedArgument=y.type.kind==="value"||x.type.kind==="value"}static parse(y,x){if(y.length!==3&&y.length!==4)return x.error("Expected two or three arguments.");const T=y[0];let C=x.parse(y[1],1,jt);if(!C)return null;if(!wc(T,C.type))return x.concat(1).error(`"${T}" comparisons are not supported for type '${bi(C.type)}'.`);let M=x.parse(y[2],2,jt);if(!M)return null;if(!wc(T,M.type))return x.concat(2).error(`"${T}" comparisons are not supported for type '${bi(M.type)}'.`);if(C.type.kind!==M.type.kind&&C.type.kind!=="value"&&M.type.kind!=="value")return x.error(`Cannot compare types '${bi(C.type)}' and '${bi(M.type)}'.`);u&&(C.type.kind==="value"&&M.type.kind!=="value"?C=new Bt(M.type,[C]):C.type.kind!=="value"&&M.type.kind==="value"&&(M=new Bt(C.type,[M])));let R=null;if(y.length===4){if(C.type.kind!=="string"&&M.type.kind!=="string"&&C.type.kind!=="value"&&M.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(R=x.parse(y[3],3,An),!R)return null}return new b_(C,M,R)}evaluate(y){const x=this.lhs.evaluate(y),T=this.rhs.evaluate(y);if(u&&this.hasUntypedArgument){const C=Be(x),M=Be(T);if(C.kind!==M.kind||C.kind!=="string"&&C.kind!=="number")throw new ht(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${C.kind}, ${M.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const C=Be(x),M=Be(T);if(C.kind!=="string"||M.kind!=="string")return e(y,x,T)}return this.collator?s(y,x,T,this.collator.evaluate(y)):e(y,x,T)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}}}const uh=cs("==",function(r,e,s){return e===s},Tc),hh=cs("!=",function(r,e,s){return e!==s},function(r,e,s,u){return!Tc(0,e,s,u)}),fh=cs("<",function(r,e,s){return e<s},function(r,e,s,u){return u.compare(e,s)<0}),ph=cs(">",function(r,e,s){return e>s},function(r,e,s,u){return u.compare(e,s)>0}),dh=cs("<=",function(r,e,s){return e<=s},function(r,e,s,u){return u.compare(e,s)<=0}),mh=cs(">=",function(r,e,s){return e>=s},function(r,e,s,u){return u.compare(e,s)>=0});class pl{constructor(e,s,u,m,y){this.type=Xt,this.number=e,this.locale=s,this.currency=u,this.minFractionDigits=m,this.maxFractionDigits=y}static parse(e,s){if(e.length!==3)return s.error("Expected two arguments.");const u=s.parse(e[1],1,ot);if(!u)return null;const m=e[2];if(typeof m!="object"||Array.isArray(m))return s.error("NumberFormat options argument must be an object.");let y=null;if(m.locale&&(y=s.parse(m.locale,1,Xt),!y))return null;let x=null;if(m.currency&&(x=s.parse(m.currency,1,Xt),!x))return null;let T=null;if(m["min-fraction-digits"]&&(T=s.parse(m["min-fraction-digits"],1,ot),!T))return null;let C=null;return m["max-fraction-digits"]&&(C=s.parse(m["max-fraction-digits"],1,ot),!C)?null:new pl(u,y,x,T,C)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class To{constructor(e){this.type=Yi,this.sections=e}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const u=e[1];if(!Array.isArray(u)&&typeof u=="object")return s.error("First argument must be an image or text section.");const m=[];let y=!1;for(let x=1;x<=e.length-1;++x){const T=e[x];if(y&&typeof T=="object"&&!Array.isArray(T)){y=!1;let C=null;if(T["font-scale"]&&(C=s.parse(T["font-scale"],1,ot),!C))return null;let M=null;if(T["text-font"]&&(M=s.parse(T["text-font"],1,on(Xt)),!M))return null;let R=null;if(T["text-color"]&&(R=s.parse(T["text-color"],1,Wi),!R))return null;const F=m[m.length-1];F.scale=C,F.font=M,F.textColor=R}else{const C=s.parse(e[x],1,jt);if(!C)return null;const M=C.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,m.push({content:C,scale:null,font:null,textColor:null})}}return new To(m)}evaluate(e){return new he(this.sections.map(s=>{const u=s.content.evaluate(e);return Be(u)===ji?new me("",u,null,null,null):new me(kt(u),null,s.scale?s.scale.evaluate(e):null,s.font?s.font.evaluate(e).join(","):null,s.textColor?s.textColor.evaluate(e):null)}))}eachChild(e){for(const s of this.sections)e(s.content),s.scale&&e(s.scale),s.font&&e(s.font),s.textColor&&e(s.textColor)}outputDefined(){return!1}}class dl{constructor(e){this.type=ji,this.input=e}static parse(e,s){if(e.length!==2)return s.error("Expected two arguments.");const u=s.parse(e[1],1,Xt);return u?new dl(u):s.error("No image name provided.")}evaluate(e){const s=this.input.evaluate(e),u=ye.fromString(s);return u&&e.availableImages&&(u.available=e.availableImages.indexOf(s)>-1),u}eachChild(e){e(this.input)}outputDefined(){return!1}}class ml{constructor(e){this.type=ot,this.input=e}static parse(e,s){if(e.length!==2)return s.error(`Expected 1 argument, but found ${e.length-1} instead.`);const u=s.parse(e[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${bi(u.type)} instead.`):new ml(u):null}evaluate(e){const s=this.input.evaluate(e);if(typeof s=="string"||Array.isArray(s))return s.length;throw new ht(`Expected value to be of type string or array, but found ${bi(Be(s))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const us={"==":uh,"!=":hh,">":ph,"<":fh,">=":mh,"<=":dh,array:Bt,at:cl,boolean:Bt,case:fl,coalesce:ls,collator:Xi,format:To,image:dl,in:ul,"index-of":bo,interpolate:Vn,"interpolate-hcl":Vn,"interpolate-lab":Vn,length:ml,let:ga,literal:St,match:hl,number:Bt,"number-format":pl,object:Bt,slice:wo,step:ta,string:Bt,"to-boolean":Vt,"to-color":Vt,"to-number":Vt,"to-string":Vt,var:Da,within:Mn};function kc(r,[e,s,u,m]){e=e.evaluate(r),s=s.evaluate(r),u=u.evaluate(r);const y=m?m.evaluate(r):1,x=Ue(e,s,u,y);if(x)throw new ht(x);return new X(e/255*y,s/255*y,u/255*y,y)}function Sc(r,e){return r in e}function ko(r,e){const s=e[r];return s===void 0?null:s}function Oa(r){return{type:r}}function Ec(r){return{result:"success",value:r}}function hs(r){return{result:"error",value:r}}function Fi(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function Cc(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function pi(r){return!!r.expression&&r.expression.interpolated}function Ci(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function Bi(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Vi(r){return r}function Ds(r,e){const s=e.type==="color",u=r.stops&&typeof r.stops[0][0]=="object",m=u||!(u||r.property!==void 0),y=r.type||(pi(e)?"exponential":"interval");if(s||e.type==="padding"){const M=s?X.parse:ae.parse;(r=sn({},r)).stops&&(r.stops=r.stops.map(R=>[R[0],M(R[1])])),r.default=M(r.default?r.default:e.default)}if(r.colorSpace&&r.colorSpace!=="rgb"&&!xo[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let x,T,C;if(y==="exponential")x=Ac;else if(y==="interval")x=_h;else if(y==="categorical"){x=gh,T=Object.create(null);for(const M of r.stops)T[M[0]]=M[1];C=typeof r.stops[0][0]}else{if(y!=="identity")throw new Error(`Unknown function type "${y}"`);x=yh}if(u){const M={},R=[];for(let Z=0;Z<r.stops.length;Z++){const H=r.stops[Z],oe=H[0].zoom;M[oe]===void 0&&(M[oe]={zoom:oe,type:r.type,property:r.property,default:r.default,stops:[]},R.push(oe)),M[oe].stops.push([H[0].value,H[1]])}const F=[];for(const Z of R)F.push([M[Z].zoom,Ds(M[Z],e)]);const V={name:"linear"};return{kind:"composite",interpolationType:V,interpolationFactor:Vn.interpolationFactor.bind(void 0,V),zoomStops:F.map(Z=>Z[0]),evaluate:({zoom:Z},H)=>Ac({stops:F,base:r.base},e,Z).evaluate(Z,H)}}if(m){const M=y==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:Vn.interpolationFactor.bind(void 0,M),zoomStops:r.stops.map(R=>R[0]),evaluate:({zoom:R})=>x(r,e,R,T,C)}}return{kind:"source",evaluate(M,R){const F=R&&R.properties?R.properties[r.property]:void 0;return F===void 0?fs(r.default,e.default):x(r,e,F,T,C)}}}function fs(r,e,s){return r!==void 0?r:e!==void 0?e:s!==void 0?s:void 0}function gh(r,e,s,u,m){return fs(typeof s===m?u[s]:void 0,r.default,e.default)}function _h(r,e,s){if(Ci(s)!=="number")return fs(r.default,e.default);const u=r.stops.length;if(u===1||s<=r.stops[0][0])return r.stops[0][1];if(s>=r.stops[u-1][0])return r.stops[u-1][1];const m=as(r.stops.map(y=>y[0]),s);return r.stops[m][1]}function Ac(r,e,s){const u=r.base!==void 0?r.base:1;if(Ci(s)!=="number")return fs(r.default,e.default);const m=r.stops.length;if(m===1||s<=r.stops[0][0])return r.stops[0][1];if(s>=r.stops[m-1][0])return r.stops[m-1][1];const y=as(r.stops.map(R=>R[0]),s),x=function(R,F,V,Z){const H=Z-V,oe=R-V;return H===0?0:F===1?oe/H:(Math.pow(F,oe)-1)/(Math.pow(F,H)-1)}(s,u,r.stops[y][0],r.stops[y+1][0]),T=r.stops[y][1],C=r.stops[y+1][1];let M=ia[e.type]||Vi;if(r.colorSpace&&r.colorSpace!=="rgb"){const R=xo[r.colorSpace];M=(F,V)=>R.reverse(R.interpolate(R.forward(F),R.forward(V),x))}return typeof T.evaluate=="function"?{evaluate(...R){const F=T.evaluate.apply(void 0,R),V=C.evaluate.apply(void 0,R);if(F!==void 0&&V!==void 0)return M(F,V,x)}}:M(T,C,x)}function yh(r,e,s){switch(e.type){case"color":s=X.parse(s);break;case"formatted":s=he.fromString(s.toString());break;case"resolvedImage":s=ye.fromString(s.toString());break;case"padding":s=ae.parse(s);break;default:Ci(s)===e.type||e.type==="enum"&&e.values[s]||(s=void 0)}return fs(s,r.default,e.default)}wi.register(us,{error:[{kind:"error"},[Xt],(r,[e])=>{throw new ht(e.evaluate(r))}],typeof:[Xt,[jt],(r,[e])=>bi(Be(e.evaluate(r)))],"to-rgba":[on(ot,4),[Wi],(r,[e])=>e.evaluate(r).toArray()],rgb:[Wi,[ot,ot,ot],kc],rgba:[Wi,[ot,ot,ot,ot],kc],has:{type:Zt,overloads:[[[Xt],(r,[e])=>Sc(e.evaluate(r),r.properties())],[[Xt,Un],(r,[e,s])=>Sc(e.evaluate(r),s.evaluate(r))]]},get:{type:jt,overloads:[[[Xt],(r,[e])=>ko(e.evaluate(r),r.properties())],[[Xt,Un],(r,[e,s])=>ko(e.evaluate(r),s.evaluate(r))]]},"feature-state":[jt,[Xt],(r,[e])=>ko(e.evaluate(r),r.featureState||{})],properties:[Un,[],r=>r.properties()],"geometry-type":[Xt,[],r=>r.geometryType()],id:[jt,[],r=>r.id()],zoom:[ot,[],r=>r.globals.zoom],"heatmap-density":[ot,[],r=>r.globals.heatmapDensity||0],"line-progress":[ot,[],r=>r.globals.lineProgress||0],accumulated:[jt,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[ot,Oa(ot),(r,e)=>{let s=0;for(const u of e)s+=u.evaluate(r);return s}],"*":[ot,Oa(ot),(r,e)=>{let s=1;for(const u of e)s*=u.evaluate(r);return s}],"-":{type:ot,overloads:[[[ot,ot],(r,[e,s])=>e.evaluate(r)-s.evaluate(r)],[[ot],(r,[e])=>-e.evaluate(r)]]},"/":[ot,[ot,ot],(r,[e,s])=>e.evaluate(r)/s.evaluate(r)],"%":[ot,[ot,ot],(r,[e,s])=>e.evaluate(r)%s.evaluate(r)],ln2:[ot,[],()=>Math.LN2],pi:[ot,[],()=>Math.PI],e:[ot,[],()=>Math.E],"^":[ot,[ot,ot],(r,[e,s])=>Math.pow(e.evaluate(r),s.evaluate(r))],sqrt:[ot,[ot],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[ot,[ot],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[ot,[ot],(r,[e])=>Math.log(e.evaluate(r))],log2:[ot,[ot],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[ot,[ot],(r,[e])=>Math.sin(e.evaluate(r))],cos:[ot,[ot],(r,[e])=>Math.cos(e.evaluate(r))],tan:[ot,[ot],(r,[e])=>Math.tan(e.evaluate(r))],asin:[ot,[ot],(r,[e])=>Math.asin(e.evaluate(r))],acos:[ot,[ot],(r,[e])=>Math.acos(e.evaluate(r))],atan:[ot,[ot],(r,[e])=>Math.atan(e.evaluate(r))],min:[ot,Oa(ot),(r,e)=>Math.min(...e.map(s=>s.evaluate(r)))],max:[ot,Oa(ot),(r,e)=>Math.max(...e.map(s=>s.evaluate(r)))],abs:[ot,[ot],(r,[e])=>Math.abs(e.evaluate(r))],round:[ot,[ot],(r,[e])=>{const s=e.evaluate(r);return s<0?-Math.round(-s):Math.round(s)}],floor:[ot,[ot],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[ot,[ot],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[Zt,[Xt,jt],(r,[e,s])=>r.properties()[e.value]===s.value],"filter-id-==":[Zt,[jt],(r,[e])=>r.id()===e.value],"filter-type-==":[Zt,[Xt],(r,[e])=>r.geometryType()===e.value],"filter-<":[Zt,[Xt,jt],(r,[e,s])=>{const u=r.properties()[e.value],m=s.value;return typeof u==typeof m&&u<m}],"filter-id-<":[Zt,[jt],(r,[e])=>{const s=r.id(),u=e.value;return typeof s==typeof u&&s<u}],"filter->":[Zt,[Xt,jt],(r,[e,s])=>{const u=r.properties()[e.value],m=s.value;return typeof u==typeof m&&u>m}],"filter-id->":[Zt,[jt],(r,[e])=>{const s=r.id(),u=e.value;return typeof s==typeof u&&s>u}],"filter-<=":[Zt,[Xt,jt],(r,[e,s])=>{const u=r.properties()[e.value],m=s.value;return typeof u==typeof m&&u<=m}],"filter-id-<=":[Zt,[jt],(r,[e])=>{const s=r.id(),u=e.value;return typeof s==typeof u&&s<=u}],"filter->=":[Zt,[Xt,jt],(r,[e,s])=>{const u=r.properties()[e.value],m=s.value;return typeof u==typeof m&&u>=m}],"filter-id->=":[Zt,[jt],(r,[e])=>{const s=r.id(),u=e.value;return typeof s==typeof u&&s>=u}],"filter-has":[Zt,[jt],(r,[e])=>e.value in r.properties()],"filter-has-id":[Zt,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[Zt,[on(Xt)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[Zt,[on(jt)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[Zt,[Xt,on(jt)],(r,[e,s])=>s.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[Zt,[Xt,on(jt)],(r,[e,s])=>function(u,m,y,x){for(;y<=x;){const T=y+x>>1;if(m[T]===u)return!0;m[T]>u?x=T-1:y=T+1}return!1}(r.properties()[e.value],s.value,0,s.value.length-1)],all:{type:Zt,overloads:[[[Zt,Zt],(r,[e,s])=>e.evaluate(r)&&s.evaluate(r)],[Oa(Zt),(r,e)=>{for(const s of e)if(!s.evaluate(r))return!1;return!0}]]},any:{type:Zt,overloads:[[[Zt,Zt],(r,[e,s])=>e.evaluate(r)||s.evaluate(r)],[Oa(Zt),(r,e)=>{for(const s of e)if(s.evaluate(r))return!0;return!1}]]},"!":[Zt,[Zt],(r,[e])=>!e.evaluate(r)],"is-supported-script":[Zt,[Xt],(r,[e])=>{const s=r.globals&&r.globals.isSupportedScript;return!s||s(e.evaluate(r))}],upcase:[Xt,[Xt],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[Xt,[Xt],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[Xt,Oa(jt),(r,e)=>e.map(s=>kt(s.evaluate(r))).join("")],"resolved-locale":[Xt,[An],(r,[e])=>e.evaluate(r).resolvedLocale()]});class So{constructor(e,s){this.expression=e,this._warningHistory={},this._evaluator=new ai,this._defaultValue=s?function(u){return u.type==="color"&&Bi(u.default)?new X(0,0,0,0):u.type==="color"?X.parse(u.default)||null:u.type==="padding"?ae.parse(u.default)||null:u.default===void 0?null:u.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(e,s,u,m,y,x){return this._evaluator.globals=e,this._evaluator.feature=s,this._evaluator.featureState=u,this._evaluator.canonical=m,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(e,s,u,m,y,x){this._evaluator.globals=e,this._evaluator.feature=s||null,this._evaluator.featureState=u||null,this._evaluator.canonical=m,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=x||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new ht(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function Ls(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in us}function Rs(r,e){const s=new ea(us,[],e?function(m){const y={color:Wi,string:Xt,number:ot,enum:Xt,boolean:Zt,formatted:Yi,padding:Ar,resolvedImage:ji};return m.type==="array"?on(y[m.value]||jt,m.length):y[m.type]}(e):void 0),u=s.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?Ec(new So(u,e)):hs(s.errors)}class Bs{constructor(e,s){this.kind=e,this._styleExpression=s,this.isStateDependent=e!=="constant"&&!$r(s.expression)}evaluateWithoutErrorHandling(e,s,u,m,y,x){return this._styleExpression.evaluateWithoutErrorHandling(e,s,u,m,y,x)}evaluate(e,s,u,m,y,x){return this._styleExpression.evaluate(e,s,u,m,y,x)}}class gl{constructor(e,s,u,m){this.kind=e,this.zoomStops=u,this._styleExpression=s,this.isStateDependent=e!=="camera"&&!$r(s.expression),this.interpolationType=m}evaluateWithoutErrorHandling(e,s,u,m,y,x){return this._styleExpression.evaluateWithoutErrorHandling(e,s,u,m,y,x)}evaluate(e,s,u,m,y,x){return this._styleExpression.evaluate(e,s,u,m,y,x)}interpolationFactor(e,s,u){return this.interpolationType?Vn.interpolationFactor(this.interpolationType,e,s,u):0}}function Ic(r,e){const s=Rs(r,e);if(s.result==="error")return s;const u=s.value.expression,m=jn(u);if(!m&&!Fi(e))return hs([new gn("","data expressions not supported")]);const y=za(u,["zoom"]);if(!y&&!Cc(e))return hs([new gn("","zoom expressions not supported")]);const x=Co(u);return x||y?x instanceof gn?hs([x]):x instanceof Vn&&!pi(e)?hs([new gn("",'"interpolate" expressions cannot be used with this property')]):Ec(x?new gl(m?"camera":"composite",s.value,x.labels,x instanceof Vn?x.interpolation:void 0):new Bs(m?"constant":"source",s.value)):hs([new gn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Eo{constructor(e,s){this._parameters=e,this._specification=s,sn(this,Ds(this._parameters,this._specification))}static deserialize(e){return new Eo(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Co(r){let e=null;if(r instanceof ga)e=Co(r.result);else if(r instanceof ls){for(const s of r.args)if(e=Co(s),e)break}else(r instanceof ta||r instanceof Vn)&&r.input instanceof wi&&r.input.name==="zoom"&&(e=r);return e instanceof gn||r.eachChild(s=>{const u=Co(s);u instanceof gn?e=u:!e&&u?e=new gn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&u&&e!==u&&(e=new gn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Dr(r){const e=r.key,s=r.value,u=r.valueSpec||{},m=r.objectElementValidators||{},y=r.style,x=r.styleSpec;let T=[];const C=Ci(s);if(C!=="object")return[new Ee(e,s,`object expected, ${C} found`)];for(const M in s){const R=M.split(".")[0],F=u[R]||u["*"];let V;if(m[R])V=m[R];else if(u[R])V=ar;else if(m["*"])V=m["*"];else{if(!u["*"]){T.push(new Ee(e,s[M],`unknown property "${M}"`));continue}V=ar}T=T.concat(V({key:(e&&`${e}.`)+M,value:s[M],valueSpec:F,style:y,styleSpec:x,object:s,objectKey:M},s))}for(const M in u)m[M]||u[M].required&&u[M].default===void 0&&s[M]===void 0&&T.push(new Ee(e,s,`missing required property "${M}"`));return T}function Mc(r){const e=r.value,s=r.valueSpec,u=r.style,m=r.styleSpec,y=r.key,x=r.arrayElementValidator||ar;if(Ci(e)!=="array")return[new Ee(y,e,`array expected, ${Ci(e)} found`)];if(s.length&&e.length!==s.length)return[new Ee(y,e,`array length ${s.length} expected, length ${e.length} found`)];if(s["min-length"]&&e.length<s["min-length"])return[new Ee(y,e,`array length at least ${s["min-length"]} expected, length ${e.length} found`)];let T={type:s.value,values:s.values};m.$version<7&&(T.function=s.function),Ci(s.value)==="object"&&(T=s.value);let C=[];for(let M=0;M<e.length;M++)C=C.concat(x({array:e,arrayIndex:M,value:e[M],valueSpec:T,style:u,styleSpec:m,key:`${y}[${M}]`}));return C}function _l(r){const e=r.key,s=r.value,u=r.valueSpec;let m=Ci(s);return m==="number"&&s!=s&&(m="NaN"),m!=="number"?[new Ee(e,s,`number expected, ${m} found`)]:"minimum"in u&&s<u.minimum?[new Ee(e,s,`${s} is less than the minimum value ${u.minimum}`)]:"maximum"in u&&s>u.maximum?[new Ee(e,s,`${s} is greater than the maximum value ${u.maximum}`)]:[]}function Pc(r){const e=r.valueSpec,s=Gt(r.value.type);let u,m,y,x={};const T=s!=="categorical"&&r.value.property===void 0,C=!T,M=Ci(r.value.stops)==="array"&&Ci(r.value.stops[0])==="array"&&Ci(r.value.stops[0][0])==="object",R=Dr({key:r.key,value:r.value,valueSpec:r.styleSpec.function,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(Z){if(s==="identity")return[new Ee(Z.key,Z.value,'identity function may not have a "stops" property')];let H=[];const oe=Z.value;return H=H.concat(Mc({key:Z.key,value:oe,valueSpec:Z.valueSpec,style:Z.style,styleSpec:Z.styleSpec,arrayElementValidator:F})),Ci(oe)==="array"&&oe.length===0&&H.push(new Ee(Z.key,oe,"array must have at least one stop")),H},default:function(Z){return ar({key:Z.key,value:Z.value,valueSpec:e,style:Z.style,styleSpec:Z.styleSpec})}}});return s==="identity"&&T&&R.push(new Ee(r.key,r.value,'missing required property "property"')),s==="identity"||r.value.stops||R.push(new Ee(r.key,r.value,'missing required property "stops"')),s==="exponential"&&r.valueSpec.expression&&!pi(r.valueSpec)&&R.push(new Ee(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(C&&!Fi(r.valueSpec)?R.push(new Ee(r.key,r.value,"property functions not supported")):T&&!Cc(r.valueSpec)&&R.push(new Ee(r.key,r.value,"zoom functions not supported"))),s!=="categorical"&&!M||r.value.property!==void 0||R.push(new Ee(r.key,r.value,'"property" property is required')),R;function F(Z){let H=[];const oe=Z.value,re=Z.key;if(Ci(oe)!=="array")return[new Ee(re,oe,`array expected, ${Ci(oe)} found`)];if(oe.length!==2)return[new Ee(re,oe,`array length 2 expected, length ${oe.length} found`)];if(M){if(Ci(oe[0])!=="object")return[new Ee(re,oe,`object expected, ${Ci(oe[0])} found`)];if(oe[0].zoom===void 0)return[new Ee(re,oe,"object stop key must have zoom")];if(oe[0].value===void 0)return[new Ee(re,oe,"object stop key must have value")];if(y&&y>Gt(oe[0].zoom))return[new Ee(re,oe[0].zoom,"stop zoom values must appear in ascending order")];Gt(oe[0].zoom)!==y&&(y=Gt(oe[0].zoom),m=void 0,x={}),H=H.concat(Dr({key:`${re}[0]`,value:oe[0],valueSpec:{zoom:{}},style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{zoom:_l,value:V}}))}else H=H.concat(V({key:`${re}[0]`,value:oe[0],valueSpec:{},style:Z.style,styleSpec:Z.styleSpec},oe));return Ls(Ni(oe[1]))?H.concat([new Ee(`${re}[1]`,oe[1],"expressions are not allowed in function stops.")]):H.concat(ar({key:`${re}[1]`,value:oe[1],valueSpec:e,style:Z.style,styleSpec:Z.styleSpec}))}function V(Z,H){const oe=Ci(Z.value),re=Gt(Z.value),Se=Z.value!==null?Z.value:H;if(u){if(oe!==u)return[new Ee(Z.key,Se,`${oe} stop domain type must match previous stop domain type ${u}`)]}else u=oe;if(oe!=="number"&&oe!=="string"&&oe!=="boolean")return[new Ee(Z.key,Se,"stop domain value must be a number, string, or boolean")];if(oe!=="number"&&s!=="categorical"){let De=`number expected, ${oe} found`;return Fi(e)&&s===void 0&&(De+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ee(Z.key,Se,De)]}return s!=="categorical"||oe!=="number"||isFinite(re)&&Math.floor(re)===re?s!=="categorical"&&oe==="number"&&m!==void 0&&re<m?[new Ee(Z.key,Se,"stop domain values must appear in ascending order")]:(m=re,s==="categorical"&&re in x?[new Ee(Z.key,Se,"stop domain values must be unique")]:(x[re]=!0,[])):[new Ee(Z.key,Se,`integer expected, found ${re}`)]}}function Ua(r){const e=(r.expressionContext==="property"?Ic:Rs)(Ni(r.value),r.valueSpec);if(e.result==="error")return e.value.map(u=>new Ee(`${r.key}${u.key}`,r.value,u.message));const s=e.value.expression||e.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!s.outputDefined())return[new Ee(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!$r(s))return[new Ee(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!$r(s))return[new Ee(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!za(s,["zoom","feature-state"]))return[new Ee(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!jn(s))return[new Ee(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Fs(r){const e=r.key,s=r.value,u=r.valueSpec,m=[];return Array.isArray(u.values)?u.values.indexOf(Gt(s))===-1&&m.push(new Ee(e,s,`expected one of [${u.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(u.values).indexOf(Gt(s))===-1&&m.push(new Ee(e,s,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(s)} found`)),m}function ps(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!ps(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const vh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ao(r){if(r==null)return{filter:()=>!0,needGeometry:!1};ps(r)||(r=Os(r));const e=Rs(r,vh);if(e.result==="error")throw new Error(e.value.map(s=>`${s.key}: ${s.message}`).join(", "));return{filter:(s,u,m)=>e.value.evaluate(s,u,{},m),needGeometry:Dc(r)}}function zc(r,e){return r<e?-1:r>e?1:0}function Dc(r){if(!Array.isArray(r))return!1;if(r[0]==="within")return!0;for(let e=1;e<r.length;e++)if(Dc(r[e]))return!0;return!1}function Os(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?yl(r[1],r[2],"=="):e==="!="?ds(yl(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?yl(r[1],r[2],e):e==="any"?(s=r.slice(1),["any"].concat(s.map(Os))):e==="all"?["all"].concat(r.slice(1).map(Os)):e==="none"?["all"].concat(r.slice(1).map(Os).map(ds)):e==="in"?Io(r[1],r.slice(2)):e==="!in"?ds(Io(r[1],r.slice(2))):e==="has"?Us(r[1]):e==="!has"?ds(Us(r[1])):e!=="within"||r;var s}function yl(r,e,s){switch(r){case"$type":return[`filter-type-${s}`,e];case"$id":return[`filter-id-${s}`,e];default:return[`filter-${s}`,r,e]}}function Io(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(s=>typeof s!=typeof e[0])?["filter-in-large",r,["literal",e.sort(zc)]]:["filter-in-small",r,["literal",e]]}}function Us(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function ds(r){return["!",r]}function Ns(r){return ps(Ni(r.value))?Ua(sn({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Lc(r)}function Lc(r){const e=r.value,s=r.key;if(Ci(e)!=="array")return[new Ee(s,e,`array expected, ${Ci(e)} found`)];const u=r.styleSpec;let m,y=[];if(e.length<1)return[new Ee(s,e,"filter array must have at least 1 element")];switch(y=y.concat(Fs({key:`${s}[0]`,value:e[0],valueSpec:u.filter_operator,style:r.style,styleSpec:r.styleSpec})),Gt(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Gt(e[1])==="$type"&&y.push(new Ee(s,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&y.push(new Ee(s,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(m=Ci(e[1]),m!=="string"&&y.push(new Ee(`${s}[1]`,e[1],`string expected, ${m} found`)));for(let x=2;x<e.length;x++)m=Ci(e[x]),Gt(e[1])==="$type"?y=y.concat(Fs({key:`${s}[${x}]`,value:e[x],valueSpec:u.geometry_type,style:r.style,styleSpec:r.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&y.push(new Ee(`${s}[${x}]`,e[x],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let x=1;x<e.length;x++)y=y.concat(Lc({key:`${s}[${x}]`,value:e[x],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":m=Ci(e[1]),e.length!==2?y.push(new Ee(s,e,`filter array for "${e[0]}" operator must have 2 elements`)):m!=="string"&&y.push(new Ee(`${s}[1]`,e[1],`string expected, ${m} found`));break;case"within":m=Ci(e[1]),e.length!==2?y.push(new Ee(s,e,`filter array for "${e[0]}" operator must have 2 elements`)):m!=="object"&&y.push(new Ee(`${s}[1]`,e[1],`object expected, ${m} found`))}return y}function js(r,e){const s=r.key,u=r.style,m=r.styleSpec,y=r.value,x=r.objectKey,T=m[`${e}_${r.layerType}`];if(!T)return[];const C=x.match(/^(.*)-transition$/);if(e==="paint"&&C&&T[C[1]]&&T[C[1]].transition)return ar({key:s,value:y,valueSpec:m.transition,style:u,styleSpec:m});const M=r.valueSpec||T[x];if(!M)return[new Ee(s,y,`unknown property "${x}"`)];let R;if(Ci(y)==="string"&&Fi(M)&&!M.tokens&&(R=/^{([^}]+)}$/.exec(y)))return[new Ee(s,y,`"${x}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(R[1])} }\`.`)];const F=[];return r.layerType==="symbol"&&(x==="text-field"&&u&&!u.glyphs&&F.push(new Ee(s,y,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&Bi(Ni(y))&&Gt(y.type)==="identity"&&F.push(new Ee(s,y,'"text-font" does not support identity functions'))),F.concat(ar({key:r.key,value:y,valueSpec:M,style:u,styleSpec:m,expressionContext:"property",propertyType:e,propertyKey:x}))}function Rc(r){return js(r,"paint")}function Bc(r){return js(r,"layout")}function Fc(r){let e=[];const s=r.value,u=r.key,m=r.style,y=r.styleSpec;s.type||s.ref||e.push(new Ee(u,s,'either "type" or "ref" is required'));let x=Gt(s.type);const T=Gt(s.ref);if(s.id){const C=Gt(s.id);for(let M=0;M<r.arrayIndex;M++){const R=m.layers[M];Gt(R.id)===C&&e.push(new Ee(u,s.id,`duplicate layer id "${s.id}", previously used at line ${R.id.__line__}`))}}if("ref"in s){let C;["type","source","source-layer","filter","layout"].forEach(M=>{M in s&&e.push(new Ee(u,s[M],`"${M}" is prohibited for ref layers`))}),m.layers.forEach(M=>{Gt(M.id)===T&&(C=M)}),C?C.ref?e.push(new Ee(u,s.ref,"ref cannot reference another ref layer")):x=Gt(C.type):e.push(new Ee(u,s.ref,`ref layer "${T}" not found`))}else if(x!=="background")if(s.source){const C=m.sources&&m.sources[s.source],M=C&&Gt(C.type);C?M==="vector"&&x==="raster"?e.push(new Ee(u,s.source,`layer "${s.id}" requires a raster source`)):M==="raster"&&x!=="raster"?e.push(new Ee(u,s.source,`layer "${s.id}" requires a vector source`)):M!=="vector"||s["source-layer"]?M==="raster-dem"&&x!=="hillshade"?e.push(new Ee(u,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!s.paint||!s.paint["line-gradient"]||M==="geojson"&&C.lineMetrics||e.push(new Ee(u,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ee(u,s,`layer "${s.id}" must specify a "source-layer"`)):e.push(new Ee(u,s.source,`source "${s.source}" not found`))}else e.push(new Ee(u,s,'missing required property "source"'));return e=e.concat(Dr({key:u,value:s,valueSpec:y.layer,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ar({key:`${u}.type`,value:s.type,valueSpec:y.layer.type,style:r.style,styleSpec:r.styleSpec,object:s,objectKey:"type"}),filter:Ns,layout:C=>Dr({layer:s,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":M=>Bc(sn({layerType:x},M))}}),paint:C=>Dr({layer:s,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":M=>Rc(sn({layerType:x},M))}})}})),e}function ms(r){const e=r.value,s=r.key,u=Ci(e);return u!=="string"?[new Ee(s,e,`string expected, ${u} found`)]:[]}const Oc={promoteId:function({key:r,value:e}){if(Ci(e)==="string")return ms({key:r,value:e});{const s=[];for(const u in e)s.push(...ms({key:`${r}.${u}`,value:e[u]}));return s}}};function Vs(r){const e=r.value,s=r.key,u=r.styleSpec,m=r.style;if(!e.type)return[new Ee(s,e,'"type" is required')];const y=Gt(e.type);let x;switch(y){case"vector":case"raster":case"raster-dem":return x=Dr({key:s,value:e,valueSpec:u[`source_${y.replace("-","_")}`],style:r.style,styleSpec:u,objectElementValidators:Oc}),x;case"geojson":if(x=Dr({key:s,value:e,valueSpec:u.source_geojson,style:m,styleSpec:u,objectElementValidators:Oc}),e.cluster)for(const T in e.clusterProperties){const[C,M]=e.clusterProperties[T],R=typeof C=="string"?[C,["accumulated"],["get",T]]:C;x.push(...Ua({key:`${s}.${T}.map`,value:M,expressionContext:"cluster-map"})),x.push(...Ua({key:`${s}.${T}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return x;case"video":return Dr({key:s,value:e,valueSpec:u.source_video,style:m,styleSpec:u});case"image":return Dr({key:s,value:e,valueSpec:u.source_image,style:m,styleSpec:u});case"canvas":return[new Ee(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Fs({key:`${s}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:m,styleSpec:u})}}function qs(r){const e=r.value,s=r.styleSpec,u=s.light,m=r.style;let y=[];const x=Ci(e);if(e===void 0)return y;if(x!=="object")return y=y.concat([new Ee("light",e,`object expected, ${x} found`)]),y;for(const T in e){const C=T.match(/^(.*)-transition$/);y=y.concat(C&&u[C[1]]&&u[C[1]].transition?ar({key:T,value:e[T],valueSpec:s.transition,style:m,styleSpec:s}):u[T]?ar({key:T,value:e[T],valueSpec:u[T],style:m,styleSpec:s}):[new Ee(T,e[T],`unknown property "${T}"`)])}return y}function rr(r){const e=r.value,s=r.styleSpec,u=s.terrain,m=r.style;let y=[];const x=Ci(e);if(e===void 0)return y;if(x!=="object")return y=y.concat([new Ee("terrain",e,`object expected, ${x} found`)]),y;for(const T in e)y=y.concat(u[T]?ar({key:T,value:e[T],valueSpec:u[T],style:m,styleSpec:s}):[new Ee(T,e[T],`unknown property "${T}"`)]);return y}const Gs={"*":()=>[],array:Mc,boolean:function(r){const e=r.value,s=r.key,u=Ci(e);return u!=="boolean"?[new Ee(s,e,`boolean expected, ${u} found`)]:[]},number:_l,color:function(r){const e=r.key,s=r.value,u=Ci(s);return u!=="string"?[new Ee(e,s,`color expected, ${u} found`)]:ki(s)===null?[new Ee(e,s,`color expected, "${s}" found`)]:[]},constants:nn,enum:Fs,filter:Ns,function:Pc,layer:Fc,object:Dr,source:Vs,light:qs,terrain:rr,string:ms,formatted:function(r){return ms(r).length===0?[]:Ua(r)},resolvedImage:function(r){return ms(r).length===0?[]:Ua(r)},padding:function(r){const e=r.key,s=r.value;if(Ci(s)==="array"){if(s.length<1||s.length>4)return[new Ee(e,s,`padding requires 1 to 4 values; ${s.length} values found`)];const u={type:"number"};let m=[];for(let y=0;y<s.length;y++)m=m.concat(ar({key:`${e}[${y}]`,value:s[y],valueSpec:u}));return m}return _l({key:e,value:s,valueSpec:{}})}};function ar(r){const e=r.value,s=r.valueSpec,u=r.styleSpec;return s.expression&&Bi(Gt(e))?Pc(r):s.expression&&Ls(Ni(e))?Ua(r):s.type&&Gs[s.type]?Gs[s.type](r):Dr(sn({},r,{valueSpec:s.type?u[s.type]:s}))}function xh(r){const e=r.value,s=r.key,u=ms(r);return u.length||(e.indexOf("{fontstack}")===-1&&u.push(new Ee(s,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&u.push(new Ee(s,e,'"glyphs" url must include a "{range}" token'))),u}function _a(r,e=Oe){let s=[];return s=s.concat(ar({key:"",value:r,valueSpec:e.$root,styleSpec:e,style:r,objectElementValidators:{glyphs:xh,"*":()=>[]}})),r.constants&&(s=s.concat(nn({key:"constants",value:r.constants,style:r,styleSpec:e}))),Uc(s)}function Uc(r){return[].concat(r).sort((e,s)=>e.line-s.line)}function na(r){return function(...e){return Uc(r.apply(this,e))}}_a.source=na(Vs),_a.light=na(qs),_a.terrain=na(rr),_a.layer=na(Fc),_a.filter=na(Ns),_a.paintProperty=na(Rc),_a.layoutProperty=na(Bc);const Zs=_a,vl=Zs.light,bh=Zs.paintProperty,wh=Zs.layoutProperty;function Mo(r,e){let s=!1;if(e&&e.length)for(const u of e)r.fire(new Ui(new Error(u.message))),s=!0;return s}class Hs{constructor(e,s,u){const m=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const x=new Int32Array(this.arrayBuffer);e=x[0],this.d=(s=x[1])+2*(u=x[2]);for(let C=0;C<this.d*this.d;C++){const M=x[3+C],R=x[3+C+1];m.push(M===R?null:x.subarray(M,R))}const T=x[3+m.length+1];this.keys=x.subarray(x[3+m.length],T),this.bboxes=x.subarray(T),this.insert=this._insertReadonly}else{this.d=s+2*u;for(let x=0;x<this.d*this.d;x++)m.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=e,this.padding=u,this.scale=s/e,this.uid=0;const y=u/s*e;this.min=-y,this.max=e+y}insert(e,s,u,m,y){this._forEachCell(s,u,m,y,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(s),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(y)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,s,u,m,y,x){this.cells[y].push(x)}query(e,s,u,m,y){const x=this.min,T=this.max;if(e<=x&&s<=x&&T<=u&&T<=m&&!y)return Array.prototype.slice.call(this.keys);{const C=[];return this._forEachCell(e,s,u,m,this._queryCell,C,{},y),C}}_queryCell(e,s,u,m,y,x,T,C){const M=this.cells[y];if(M!==null){const R=this.keys,F=this.bboxes;for(let V=0;V<M.length;V++){const Z=M[V];if(T[Z]===void 0){const H=4*Z;(C?C(F[H+0],F[H+1],F[H+2],F[H+3]):e<=F[H+2]&&s<=F[H+3]&&u>=F[H+0]&&m>=F[H+1])?(T[Z]=!0,x.push(R[Z])):T[Z]=!1}}}}_forEachCell(e,s,u,m,y,x,T,C){const M=this._convertToCellCoord(e),R=this._convertToCellCoord(s),F=this._convertToCellCoord(u),V=this._convertToCellCoord(m);for(let Z=M;Z<=F;Z++)for(let H=R;H<=V;H++){const oe=this.d*H+Z;if((!C||C(this._convertFromCellCoord(Z),this._convertFromCellCoord(H),this._convertFromCellCoord(Z+1),this._convertFromCellCoord(H+1)))&&y.call(this,e,s,u,m,oe,x,T,C))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,s=3+this.cells.length+1+1;let u=0;for(let x=0;x<this.cells.length;x++)u+=this.cells[x].length;const m=new Int32Array(s+u+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;let y=s;for(let x=0;x<e.length;x++){const T=e[x];m[3+x]=y,m.set(T,y),y+=T.length}return m[3+e.length]=y,m.set(this.keys,y),y+=this.keys.length,m[3+e.length+1]=y,m.set(this.bboxes,y),y+=this.bboxes.length,m.buffer}static serialize(e,s){const u=e.toArrayBuffer();return s&&s.push(u),{buffer:u}}static deserialize(e){return new Hs(e.buffer)}}const ra={};function Et(r,e,s={}){if(ra[r])throw new Error(`${r} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:r,writeable:!1}),ra[r]={klass:e,omit:s.omit||[],shallow:s.shallow||[]}}Et("Object",Object),Et("TransferableGridIndex",Hs),Et("Color",X),Et("Error",Error),Et("AJAXError",At),Et("ResolvedImage",ye),Et("StylePropertyFunction",Eo),Et("StyleExpression",So,{omit:["_evaluator"]}),Et("ZoomDependentExpression",gl),Et("ZoomConstantExpression",Bs),Et("CompoundExpression",wi,{omit:["_evaluate"]});for(const r in us)us[r]._classRegistryKey||Et(`Expression_${r}`,us[r]);function Nc(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function Na(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob)return r;if(Nc(r)||We(r))return e&&e.push(r),r;if(ArrayBuffer.isView(r)){const s=r;return e&&e.push(s.buffer),s}if(r instanceof ImageData)return e&&e.push(r.data.buffer),r;if(Array.isArray(r)){const s=[];for(const u of r)s.push(Na(u,e));return s}if(typeof r=="object"){const s=r.constructor,u=s._classRegistryKey;if(!u)throw new Error("can't serialize object of unregistered class");if(!ra[u])throw new Error(`${u} is not registered.`);const m=s.serialize?s.serialize(r,e):{};if(s.serialize){if(e&&m===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const y in r){if(!r.hasOwnProperty(y)||ra[u].omit.indexOf(y)>=0)continue;const x=r[y];m[y]=ra[u].shallow.indexOf(y)>=0?x:Na(x,e)}r instanceof Error&&(m.message=r.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(m.$name=u),m}throw new Error("can't serialize object of type "+typeof r)}function ya(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||Nc(r)||We(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(ya);if(typeof r=="object"){const e=r.$name||"Object";if(!ra[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:s}=ra[e];if(!s)throw new Error(`can't deserialize unregistered class ${e}`);if(s.deserialize)return s.deserialize(r);const u=Object.create(s.prototype);for(const m of Object.keys(r)){if(m==="$name")continue;const y=r[m];u[m]=ra[e].shallow.indexOf(m)>=0?y:ya(y)}return u}throw new Error("can't deserialize object of type "+typeof r)}class xl{constructor(){this.first=!0}update(e,s){const u=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=s),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=u,!0))}}const gt={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function Po(r){for(const e of r)if(wl(e.charCodeAt(0)))return!0;return!1}function Th(r){for(const e of r)if(!bl(e.charCodeAt(0)))return!1;return!0}function bl(r){return!(gt.Arabic(r)||gt["Arabic Supplement"](r)||gt["Arabic Extended-A"](r)||gt["Arabic Presentation Forms-A"](r)||gt["Arabic Presentation Forms-B"](r))}function wl(r){return!(r!==746&&r!==747&&(r<4352||!(gt["Bopomofo Extended"](r)||gt.Bopomofo(r)||gt["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||gt["CJK Compatibility Ideographs"](r)||gt["CJK Compatibility"](r)||gt["CJK Radicals Supplement"](r)||gt["CJK Strokes"](r)||!(!gt["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||gt["CJK Unified Ideographs Extension A"](r)||gt["CJK Unified Ideographs"](r)||gt["Enclosed CJK Letters and Months"](r)||gt["Hangul Compatibility Jamo"](r)||gt["Hangul Jamo Extended-A"](r)||gt["Hangul Jamo Extended-B"](r)||gt["Hangul Jamo"](r)||gt["Hangul Syllables"](r)||gt.Hiragana(r)||gt["Ideographic Description Characters"](r)||gt.Kanbun(r)||gt["Kangxi Radicals"](r)||gt["Katakana Phonetic Extensions"](r)||gt.Katakana(r)&&r!==12540||!(!gt["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!gt["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||gt["Unified Canadian Aboriginal Syllabics"](r)||gt["Unified Canadian Aboriginal Syllabics Extended"](r)||gt["Vertical Forms"](r)||gt["Yijing Hexagram Symbols"](r)||gt["Yi Syllables"](r)||gt["Yi Radicals"](r))))}function jc(r){return!(wl(r)||function(e){return!!(gt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||gt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||gt["Letterlike Symbols"](e)||gt["Number Forms"](e)||gt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||gt["Control Pictures"](e)&&e!==9251||gt["Optical Character Recognition"](e)||gt["Enclosed Alphanumerics"](e)||gt["Geometric Shapes"](e)||gt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||gt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||gt["CJK Symbols and Punctuation"](e)||gt.Katakana(e)||gt["Private Use Area"](e)||gt["CJK Compatibility Forms"](e)||gt["Small Form Variants"](e)||gt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function Vc(r){return r>=1424&&r<=2303||gt["Arabic Presentation Forms-A"](r)||gt["Arabic Presentation Forms-B"](r)}function kh(r,e){return!(!e&&Vc(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||gt.Khmer(r))}function qc(r){for(const e of r)if(Vc(e.charCodeAt(0)))return!0;return!1}const Tl="deferred",kl="loading",Sl="loaded";let El=null,Wn="unavailable",va=null;const Gc=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(Wn="error"),El&&El(r)};function gs(){Cl.fire(new si("pluginStateChange",{pluginStatus:Wn,pluginURL:va}))}const Cl=new Qi,Ws=function(){return Wn},Zc=function(){if(Wn!==Tl||!va)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Wn=kl,gs(),va&&Nt({url:va},r=>{r?Gc(r):(Wn=Sl,gs())})},yr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Wn===Sl||yr.applyArabicShaping!=null,isLoading:()=>Wn===kl,setState(r){if(!Je())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Wn=r.pluginStatus,va=r.pluginURL},isParsed(){if(!Je())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return yr.applyArabicShaping!=null&&yr.processBidirectionalText!=null&&yr.processStyledBidirectionalText!=null},getPluginURL(){if(!Je())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return va}};class qi{constructor(e,s){this.zoom=e,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new xl,this.transition={})}isSupportedScript(e){return function(s,u){for(const m of s)if(!kh(m.charCodeAt(0),u))return!1;return!0}(e,yr.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,s=e-Math.floor(e),u=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*s}}}class Xs{constructor(e,s){this.property=e,this.value=s,this.expression=function(u,m){if(Bi(u))return new Eo(u,m);if(Ls(u)){const y=Ic(u,m);if(y.result==="error")throw new Error(y.value.map(x=>`${x.key}: ${x.message}`).join(", "));return y.value}{let y=u;return m.type==="color"&&typeof u=="string"?y=X.parse(u):m.type!=="padding"||typeof u!="number"&&!Array.isArray(u)||(y=ae.parse(u)),{kind:"constant",evaluate:()=>y}}}(s===void 0?e.specification.default:s,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,s,u){return this.property.possiblyEvaluate(this,e,s,u)}}class zo{constructor(e){this.property=e,this.value=new Xs(e,void 0)}transitioned(e,s){return new Wc(this.property,this.value,s,j({},e.transition,this.transition),e.now)}untransitioned(){return new Wc(this.property,this.value,null,{},0)}}class Hc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return _e(this._values[e].value.value)}setValue(e,s){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new zo(this._values[e].property)),this._values[e].value=new Xs(this._values[e].property,s===null?void 0:_e(s))}getTransition(e){return _e(this._values[e].transition)}setTransition(e,s){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new zo(this._values[e].property)),this._values[e].transition=_e(s)||void 0}serialize(){const e={};for(const s of Object.keys(this._values)){const u=this.getValue(s);u!==void 0&&(e[s]=u);const m=this.getTransition(s);m!==void 0&&(e[`${s}-transition`]=m)}return e}transitioned(e,s){const u=new Xc(this._properties);for(const m of Object.keys(this._values))u._values[m]=this._values[m].transitioned(e,s._values[m]);return u}untransitioned(){const e=new Xc(this._properties);for(const s of Object.keys(this._values))e._values[s]=this._values[s].untransitioned();return e}}class Wc{constructor(e,s,u,m,y){this.property=e,this.value=s,this.begin=y+m.delay||0,this.end=this.begin+m.duration||0,e.specification.transition&&(m.delay||m.duration)&&(this.prior=u)}possiblyEvaluate(e,s,u){const m=e.now||0,y=this.value.possiblyEvaluate(e,s,u),x=this.prior;if(x){if(m>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(m<this.begin)return x.possiblyEvaluate(e,s,u);{const T=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(e,s,u),y,function(C){if(C<=0)return 0;if(C>=1)return 1;const M=C*C,R=M*C;return 4*(C<.5?R:3*(C-M)+R-.75)}(T))}}return y}}class Xc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,s,u){const m=new Ks(this._properties);for(const y of Object.keys(this._values))m._values[y]=this._values[y].possiblyEvaluate(e,s,u);return m}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Sh{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return _e(this._values[e].value)}setValue(e,s){this._values[e]=new Xs(this._values[e].property,s===null?void 0:_e(s))}serialize(){const e={};for(const s of Object.keys(this._values)){const u=this.getValue(s);u!==void 0&&(e[s]=u)}return e}possiblyEvaluate(e,s,u){const m=new Ks(this._properties);for(const y of Object.keys(this._values))m._values[y]=this._values[y].possiblyEvaluate(e,s,u);return m}}class Vr{constructor(e,s,u){this.property=e,this.value=s,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,s,u,m){return this.property.evaluate(this.value,this.parameters,e,s,u,m)}}class Ks{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Pt{constructor(e){this.specification=e}possiblyEvaluate(e,s){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(s)}interpolate(e,s,u){const m=ia[this.specification.type];return m?m(e,s,u):e}}class Ot{constructor(e,s){this.specification=e,this.overrides=s}possiblyEvaluate(e,s,u,m){return new Vr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(s,null,{},u,m)}:e.expression,s)}interpolate(e,s,u){if(e.value.kind!=="constant"||s.value.kind!=="constant")return e;if(e.value.value===void 0||s.value.value===void 0)return new Vr(this,{kind:"constant",value:void 0},e.parameters);const m=ia[this.specification.type];return m?new Vr(this,{kind:"constant",value:m(e.value.value,s.value.value,u)},e.parameters):e}evaluate(e,s,u,m,y,x){return e.kind==="constant"?e.value:e.evaluate(s,u,m,y,x)}}class _s extends Ot{possiblyEvaluate(e,s,u,m){if(e.value===void 0)return new Vr(this,{kind:"constant",value:void 0},s);if(e.expression.kind==="constant"){const y=e.expression.evaluate(s,null,{},u,m),x=e.property.specification.type==="resolvedImage"&&typeof y!="string"?y.name:y,T=this._calculate(x,x,x,s);return new Vr(this,{kind:"constant",value:T},s)}if(e.expression.kind==="camera"){const y=this._calculate(e.expression.evaluate({zoom:s.zoom-1}),e.expression.evaluate({zoom:s.zoom}),e.expression.evaluate({zoom:s.zoom+1}),s);return new Vr(this,{kind:"constant",value:y},s)}return new Vr(this,e.expression,s)}evaluate(e,s,u,m,y,x){if(e.kind==="source"){const T=e.evaluate(s,u,m,y,x);return this._calculate(T,T,T,s)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(s.zoom)-1},u,m),e.evaluate({zoom:Math.floor(s.zoom)},u,m),e.evaluate({zoom:Math.floor(s.zoom)+1},u,m),s):e.value}_calculate(e,s,u,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:e,to:s}:{from:u,to:s}}interpolate(e){return e}}class Al{constructor(e){this.specification=e}possiblyEvaluate(e,s,u,m){if(e.value!==void 0){if(e.expression.kind==="constant"){const y=e.expression.evaluate(s,null,{},u,m);return this._calculate(y,y,y,s)}return this._calculate(e.expression.evaluate(new qi(Math.floor(s.zoom-1),s)),e.expression.evaluate(new qi(Math.floor(s.zoom),s)),e.expression.evaluate(new qi(Math.floor(s.zoom+1),s)),s)}}_calculate(e,s,u,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:e,to:s}:{from:u,to:s}}interpolate(e){return e}}class xa{constructor(e){this.specification=e}possiblyEvaluate(e,s,u,m){return!!e.expression.evaluate(s,null,{},u,m)}interpolate(){return!1}}class En{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in e){const u=e[s];u.specification.overridable&&this.overridableProperties.push(s);const m=this.defaultPropertyValues[s]=new Xs(u,void 0),y=this.defaultTransitionablePropertyValues[s]=new zo(u);this.defaultTransitioningPropertyValues[s]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=m.possiblyEvaluate({})}}}Et("DataDrivenProperty",Ot),Et("DataConstantProperty",Pt),Et("CrossFadedDataDrivenProperty",_s),Et("CrossFadedProperty",Al),Et("ColorRampProperty",xa);const ba="-transition";class qr extends Qi{constructor(e,s){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),s.layout&&(this._unevaluatedLayout=new Sh(s.layout)),s.paint)){this._transitionablePaint=new Hc(s.paint);for(const u in e.paint)this.setPaintProperty(u,e.paint[u],{validate:!1});for(const u in e.layout)this.setLayoutProperty(u,e.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ks(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,s,u={}){s!=null&&this._validate(wh,`layers.${this.id}.layout.${e}`,e,s,u)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,s):this.visibility=s)}getPaintProperty(e){return e.endsWith(ba)?this._transitionablePaint.getTransition(e.slice(0,-ba.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,s,u={}){if(s!=null&&this._validate(bh,`layers.${this.id}.paint.${e}`,e,s,u))return!1;if(e.endsWith(ba))return this._transitionablePaint.setTransition(e.slice(0,-ba.length),s||void 0),!1;{const m=this._transitionablePaint._values[e],y=m.property.specification["property-type"]==="cross-faded-data-driven",x=m.value.isDataDriven(),T=m.value;this._transitionablePaint.setValue(e,s),this._handleSpecialPaintPropertyUpdate(e);const C=this._transitionablePaint._values[e].value;return C.isDataDriven()||x||y||this._handleOverridablePaintPropertyUpdate(e,T,C)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,s,u){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,s){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,s)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),ge(e,(s,u)=>!(s===void 0||u==="layout"&&!Object.keys(s).length||u==="paint"&&!Object.keys(s).length))}_validate(e,s,u,m,y={}){return(!y||y.validate!==!1)&&Mo(this,e.call(Zs,{key:s,layerType:this.type,objectKey:u,value:m,styleSpec:Oe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const s=this.paint.get(e);if(s instanceof Vr&&Fi(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}}const Kc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class wa{constructor(e,s){this._structArray=e,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class en{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,s){return e._trim(),s&&(e.isTransferred=!0,s.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const s=Object.create(this.prototype);return s.arrayBuffer=e.arrayBuffer,s.length=e.length,s.capacity=e.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function cn(r,e=1){let s=0,u=0;return{members:r.map(m=>{const y=Kc[m.type].BYTES_PER_ELEMENT,x=s=Il(s,Math.max(e,y)),T=m.components||1;return u=Math.max(u,y),s+=y*T,{name:m.name,type:m.type,components:T,offset:x}}),size:Il(s,Math.max(u,e)),alignment:e}}function Il(r,e){return Math.ceil(r/e)*e}class ja extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,s)}emplace(e,s,u){const m=2*e;return this.int16[m+0]=s,this.int16[m+1]=u,e}}ja.prototype.bytesPerElement=4,Et("StructArrayLayout2i4",ja);class d extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,u,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,s,u,m)}emplace(e,s,u,m,y){const x=4*e;return this.int16[x+0]=s,this.int16[x+1]=u,this.int16[x+2]=m,this.int16[x+3]=y,e}}d.prototype.bytesPerElement=8,Et("StructArrayLayout4i8",d);class i extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,u,m,y,x){const T=this.length;return this.resize(T+1),this.emplace(T,e,s,u,m,y,x)}emplace(e,s,u,m,y,x,T){const C=6*e;return this.int16[C+0]=s,this.int16[C+1]=u,this.int16[C+2]=m,this.int16[C+3]=y,this.int16[C+4]=x,this.int16[C+5]=T,e}}i.prototype.bytesPerElement=12,Et("StructArrayLayout2i4i12",i);class l extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,u,m,y,x){const T=this.length;return this.resize(T+1),this.emplace(T,e,s,u,m,y,x)}emplace(e,s,u,m,y,x,T){const C=4*e,M=8*e;return this.int16[C+0]=s,this.int16[C+1]=u,this.uint8[M+4]=m,this.uint8[M+5]=y,this.uint8[M+6]=x,this.uint8[M+7]=T,e}}l.prototype.bytesPerElement=8,Et("StructArrayLayout2i4ub8",l);class f extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,s)}emplace(e,s,u){const m=2*e;return this.float32[m+0]=s,this.float32[m+1]=u,e}}f.prototype.bytesPerElement=8,Et("StructArrayLayout2f8",f);class g extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,u,m,y,x,T,C,M,R){const F=this.length;return this.resize(F+1),this.emplace(F,e,s,u,m,y,x,T,C,M,R)}emplace(e,s,u,m,y,x,T,C,M,R,F){const V=10*e;return this.uint16[V+0]=s,this.uint16[V+1]=u,this.uint16[V+2]=m,this.uint16[V+3]=y,this.uint16[V+4]=x,this.uint16[V+5]=T,this.uint16[V+6]=C,this.uint16[V+7]=M,this.uint16[V+8]=R,this.uint16[V+9]=F,e}}g.prototype.bytesPerElement=20,Et("StructArrayLayout10ui20",g);class v extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,u,m,y,x,T,C,M,R,F,V){const Z=this.length;return this.resize(Z+1),this.emplace(Z,e,s,u,m,y,x,T,C,M,R,F,V)}emplace(e,s,u,m,y,x,T,C,M,R,F,V,Z){const H=12*e;return this.int16[H+0]=s,this.int16[H+1]=u,this.int16[H+2]=m,this.int16[H+3]=y,this.uint16[H+4]=x,this.uint16[H+5]=T,this.uint16[H+6]=C,this.uint16[H+7]=M,this.int16[H+8]=R,this.int16[H+9]=F,this.int16[H+10]=V,this.int16[H+11]=Z,e}}v.prototype.bytesPerElement=24,Et("StructArrayLayout4i4ui4i24",v);class w extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,s,u)}emplace(e,s,u,m){const y=3*e;return this.float32[y+0]=s,this.float32[y+1]=u,this.float32[y+2]=m,e}}w.prototype.bytesPerElement=12,Et("StructArrayLayout3f12",w);class A extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint32[1*e+0]=s,e}}A.prototype.bytesPerElement=4,Et("StructArrayLayout1ul4",A);class I extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,u,m,y,x,T,C,M){const R=this.length;return this.resize(R+1),this.emplace(R,e,s,u,m,y,x,T,C,M)}emplace(e,s,u,m,y,x,T,C,M,R){const F=10*e,V=5*e;return this.int16[F+0]=s,this.int16[F+1]=u,this.int16[F+2]=m,this.int16[F+3]=y,this.int16[F+4]=x,this.int16[F+5]=T,this.uint32[V+3]=C,this.uint16[F+8]=M,this.uint16[F+9]=R,e}}I.prototype.bytesPerElement=20,Et("StructArrayLayout6i1ul2ui20",I);class z extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,u,m,y,x){const T=this.length;return this.resize(T+1),this.emplace(T,e,s,u,m,y,x)}emplace(e,s,u,m,y,x,T){const C=6*e;return this.int16[C+0]=s,this.int16[C+1]=u,this.int16[C+2]=m,this.int16[C+3]=y,this.int16[C+4]=x,this.int16[C+5]=T,e}}z.prototype.bytesPerElement=12,Et("StructArrayLayout2i2i2i12",z);class B extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,u,m,y){const x=this.length;return this.resize(x+1),this.emplace(x,e,s,u,m,y)}emplace(e,s,u,m,y,x){const T=4*e,C=8*e;return this.float32[T+0]=s,this.float32[T+1]=u,this.float32[T+2]=m,this.int16[C+6]=y,this.int16[C+7]=x,e}}B.prototype.bytesPerElement=16,Et("StructArrayLayout2f1f2i16",B);class N extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,s,u,m)}emplace(e,s,u,m,y){const x=12*e,T=3*e;return this.uint8[x+0]=s,this.uint8[x+1]=u,this.float32[T+1]=m,this.float32[T+2]=y,e}}N.prototype.bytesPerElement=12,Et("StructArrayLayout2ub2f12",N);class G extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,s,u)}emplace(e,s,u,m){const y=3*e;return this.uint16[y+0]=s,this.uint16[y+1]=u,this.uint16[y+2]=m,e}}G.prototype.bytesPerElement=6,Et("StructArrayLayout3ui6",G);class te extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,m,y,x,T,C,M,R,F,V,Z,H,oe,re,Se){const De=this.length;return this.resize(De+1),this.emplace(De,e,s,u,m,y,x,T,C,M,R,F,V,Z,H,oe,re,Se)}emplace(e,s,u,m,y,x,T,C,M,R,F,V,Z,H,oe,re,Se,De){const we=24*e,Pe=12*e,Ke=48*e;return this.int16[we+0]=s,this.int16[we+1]=u,this.uint16[we+2]=m,this.uint16[we+3]=y,this.uint32[Pe+2]=x,this.uint32[Pe+3]=T,this.uint32[Pe+4]=C,this.uint16[we+10]=M,this.uint16[we+11]=R,this.uint16[we+12]=F,this.float32[Pe+7]=V,this.float32[Pe+8]=Z,this.uint8[Ke+36]=H,this.uint8[Ke+37]=oe,this.uint8[Ke+38]=re,this.uint32[Pe+10]=Se,this.int16[we+22]=De,e}}te.prototype.bytesPerElement=48,Et("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",te);class Q extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,m,y,x,T,C,M,R,F,V,Z,H,oe,re,Se,De,we,Pe,Ke,Xe,bt,Ct,_t,pt,lt,yt){const dt=this.length;return this.resize(dt+1),this.emplace(dt,e,s,u,m,y,x,T,C,M,R,F,V,Z,H,oe,re,Se,De,we,Pe,Ke,Xe,bt,Ct,_t,pt,lt,yt)}emplace(e,s,u,m,y,x,T,C,M,R,F,V,Z,H,oe,re,Se,De,we,Pe,Ke,Xe,bt,Ct,_t,pt,lt,yt,dt){const at=34*e,Rt=17*e;return this.int16[at+0]=s,this.int16[at+1]=u,this.int16[at+2]=m,this.int16[at+3]=y,this.int16[at+4]=x,this.int16[at+5]=T,this.int16[at+6]=C,this.int16[at+7]=M,this.uint16[at+8]=R,this.uint16[at+9]=F,this.uint16[at+10]=V,this.uint16[at+11]=Z,this.uint16[at+12]=H,this.uint16[at+13]=oe,this.uint16[at+14]=re,this.uint16[at+15]=Se,this.uint16[at+16]=De,this.uint16[at+17]=we,this.uint16[at+18]=Pe,this.uint16[at+19]=Ke,this.uint16[at+20]=Xe,this.uint16[at+21]=bt,this.uint16[at+22]=Ct,this.uint32[Rt+12]=_t,this.float32[Rt+13]=pt,this.float32[Rt+14]=lt,this.float32[Rt+15]=yt,this.float32[Rt+16]=dt,e}}Q.prototype.bytesPerElement=68,Et("StructArrayLayout8i15ui1ul4f68",Q);class $ extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.float32[1*e+0]=s,e}}$.prototype.bytesPerElement=4,Et("StructArrayLayout1f4",$);class de extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,s,u)}emplace(e,s,u,m){const y=3*e;return this.int16[y+0]=s,this.int16[y+1]=u,this.int16[y+2]=m,e}}de.prototype.bytesPerElement=6,Et("StructArrayLayout3i6",de);class be extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,s,u)}emplace(e,s,u,m){const y=4*e;return this.uint32[2*e+0]=s,this.uint16[y+2]=u,this.uint16[y+3]=m,e}}be.prototype.bytesPerElement=8,Et("StructArrayLayout1ul2ui8",be);class Ce extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,s)}emplace(e,s,u){const m=2*e;return this.uint16[m+0]=s,this.uint16[m+1]=u,e}}Ce.prototype.bytesPerElement=4,Et("StructArrayLayout2ui4",Ce);class ne extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint16[1*e+0]=s,e}}ne.prototype.bytesPerElement=2,Et("StructArrayLayout1ui2",ne);class ze extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,s,u,m)}emplace(e,s,u,m,y){const x=4*e;return this.float32[x+0]=s,this.float32[x+1]=u,this.float32[x+2]=m,this.float32[x+3]=y,e}}ze.prototype.bytesPerElement=16,Et("StructArrayLayout4f16",ze);class Me extends wa{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new xe(this.anchorPointX,this.anchorPointY)}}Me.prototype.size=20;class Ve extends I{get(e){return new Me(this,e)}}Et("CollisionBoxArray",Ve);class qe extends wa{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}qe.prototype.size=48;class it extends te{get(e){return new qe(this,e)}}Et("PlacedSymbolArray",it);class je extends wa{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}je.prototype.size=68;class vt extends Q{get(e){return new je(this,e)}}Et("SymbolInstanceArray",vt);class ft extends ${getoffsetX(e){return this.float32[1*e+0]}}Et("GlyphOffsetArray",ft);class xt extends de{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Et("SymbolLineVertexArray",xt);class Yt extends wa{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Yt.prototype.size=8;class ii extends be{get(e){return new Yt(this,e)}}Et("FeatureIndexArray",ii);class Lt extends ja{}class Mi extends ja{}class Pi extends ja{}class yi extends i{}class xi extends l{}class zi extends f{}class yn extends g{}class Gr extends v{}class Lr extends w{}class Zr extends A{}class Ta extends z{}class vr extends N{}class Xn extends G{}class aa extends Ce{}const Do=cn([{name:"a_pos",components:2,type:"Int16"}],4),{members:pn}=Do;class oi{constructor(e=[]){this.segments=e}prepareSegment(e,s,u,m){let y=this.segments[this.segments.length-1];return e>oi.MAX_VERTEX_ARRAY_LENGTH&&le(`Max vertices per segment is ${oi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!y||y.vertexLength+e>oi.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==m)&&(y={vertexOffset:s.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},m!==void 0&&(y.sortKey=m),this.segments.push(y)),y}get(){return this.segments}destroy(){for(const e of this.segments)for(const s in e.vaos)e.vaos[s].destroy()}static simpleSegment(e,s,u,m){return new oi([{vertexOffset:e,primitiveOffset:s,vertexLength:u,primitiveLength:m,vaos:{},sortKey:0}])}}function Ai(r,e){return 256*(r=k(Math.floor(r),0,255))+k(Math.floor(e),0,255)}oi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Et("SegmentVector",oi);const vn=cn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var xn={exports:{}},Gi={exports:{}};Gi.exports=function(r,e){var s,u,m,y,x,T,C,M;for(u=r.length-(s=3&r.length),m=e,x=3432918353,T=461845907,M=0;M<u;)C=255&r.charCodeAt(M)|(255&r.charCodeAt(++M))<<8|(255&r.charCodeAt(++M))<<16|(255&r.charCodeAt(++M))<<24,++M,m=27492+(65535&(y=5*(65535&(m=(m^=C=(65535&(C=(C=(65535&C)*x+(((C>>>16)*x&65535)<<16)&4294967295)<<15|C>>>17))*T+(((C>>>16)*T&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(C=0,s){case 3:C^=(255&r.charCodeAt(M+2))<<16;case 2:C^=(255&r.charCodeAt(M+1))<<8;case 1:m^=C=(65535&(C=(C=(65535&(C^=255&r.charCodeAt(M)))*x+(((C>>>16)*x&65535)<<16)&4294967295)<<15|C>>>17))*T+(((C>>>16)*T&65535)<<16)&4294967295}return m^=r.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0};var xr={exports:{}};xr.exports=function(r,e){for(var s,u=r.length,m=e^u,y=0;u>=4;)s=1540483477*(65535&(s=255&r.charCodeAt(y)|(255&r.charCodeAt(++y))<<8|(255&r.charCodeAt(++y))<<16|(255&r.charCodeAt(++y))<<24))+((1540483477*(s>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),u-=4,++y;switch(u){case 3:m^=(255&r.charCodeAt(y+2))<<16;case 2:m^=(255&r.charCodeAt(y+1))<<8;case 1:m=1540483477*(65535&(m^=255&r.charCodeAt(y)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0};var Va=Gi.exports,Ml=xr.exports;xn.exports=Va,xn.exports.murmur3=Va,xn.exports.murmur2=Ml;class ys{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,s,u,m){this.ids.push(Jc(e)),this.positions.push(s,u,m)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const s=Jc(e);let u=0,m=this.ids.length-1;for(;u<m;){const x=u+m>>1;this.ids[x]>=s?m=x:u=x+1}const y=[];for(;this.ids[u]===s;)y.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return y}static serialize(e,s){const u=new Float64Array(e.ids),m=new Uint32Array(e.positions);return Pl(u,m,0,u.length-1),s&&s.push(u.buffer,m.buffer),{ids:u,positions:m}}static deserialize(e){const s=new ys;return s.ids=e.ids,s.positions=e.positions,s.indexed=!0,s}}function Jc(r){const e=+r;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:xn.exports(String(r))}function Pl(r,e,s,u){for(;s<u;){const m=r[s+u>>1];let y=s-1,x=u+1;for(;;){do y++;while(r[y]<m);do x--;while(r[x]>m);if(y>=x)break;ka(r,y,x),ka(e,3*y,3*x),ka(e,3*y+1,3*x+1),ka(e,3*y+2,3*x+2)}x-s<u-x?(Pl(r,e,s,x),s=x+1):(Pl(r,e,x+1,u),u=x)}}function ka(r,e,s){const u=r[e];r[e]=r[s],r[s]=u}Et("FeaturePositionMap",ys);class qa{constructor(e,s){this.gl=e.gl,this.location=s}}class Ga extends qa{constructor(e,s){super(e,s),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Lo extends qa{constructor(e,s){super(e,s),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class vp extends qa{constructor(e,s){super(e,s),this.current=X.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const yy=new Float32Array(16);function Eh(r){return[Ai(255*r.r,255*r.g),Ai(255*r.b,255*r.a)]}class zl{constructor(e,s,u){this.value=e,this.uniformNames=s.map(m=>`u_${m}`),this.type=u}setUniform(e,s,u){e.set(u.constantOr(this.value))}getBinding(e,s,u){return this.type==="color"?new vp(e,s):new Ga(e,s)}}class Ro{constructor(e,s){this.uniformNames=s.map(u=>`u_${u}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=e.tlbr}setUniform(e,s,u,m){const y=m==="u_pattern_to"?this.patternTo:m==="u_pattern_from"?this.patternFrom:m==="u_pixel_ratio_to"?this.pixelRatioTo:m==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&e.set(y)}getBinding(e,s,u){return u.substr(0,9)==="u_pattern"?new Lo(e,s):new Ga(e,s)}}class Za{constructor(e,s,u,m){this.expression=e,this.type=u,this.maxValue=0,this.paintVertexAttributes=s.map(y=>({name:`a_${y}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,s,u,m,y){const x=this.paintVertexArray.length,T=this.expression.evaluate(new qi(0),s,{},m,[],y);this.paintVertexArray.resize(e),this._setPaintValue(x,e,T)}updatePaintArray(e,s,u,m){const y=this.expression.evaluate({zoom:0},u,m);this._setPaintValue(e,s,y)}_setPaintValue(e,s,u){if(this.type==="color"){const m=Eh(u);for(let y=e;y<s;y++)this.paintVertexArray.emplace(y,m[0],m[1])}else{for(let m=e;m<s;m++)this.paintVertexArray.emplace(m,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class sa{constructor(e,s,u,m,y,x){this.expression=e,this.uniformNames=s.map(T=>`u_${T}_t`),this.type=u,this.useIntegerZoom=m,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=s.map(T=>({name:`a_${T}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(e,s,u,m,y){const x=this.expression.evaluate(new qi(this.zoom),s,{},m,[],y),T=this.expression.evaluate(new qi(this.zoom+1),s,{},m,[],y),C=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(C,e,x,T)}updatePaintArray(e,s,u,m){const y=this.expression.evaluate({zoom:this.zoom},u,m),x=this.expression.evaluate({zoom:this.zoom+1},u,m);this._setPaintValue(e,s,y,x)}_setPaintValue(e,s,u,m){if(this.type==="color"){const y=Eh(u),x=Eh(m);for(let T=e;T<s;T++)this.paintVertexArray.emplace(T,y[0],y[1],x[0],x[1])}else{for(let y=e;y<s;y++)this.paintVertexArray.emplace(y,u,m);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(m))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,s){const u=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,m=k(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);e.set(m)}getBinding(e,s,u){return new Ga(e,s)}}class vs{constructor(e,s,u,m,y,x){this.expression=e,this.type=s,this.useIntegerZoom=u,this.zoom=m,this.layerId=x,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(e,s,u){const m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(m,e,s.patterns&&s.patterns[this.layerId],u)}updatePaintArray(e,s,u,m,y){this._setPaintValues(e,s,u.patterns&&u.patterns[this.layerId],y)}_setPaintValues(e,s,u,m){if(!m||!u)return;const{min:y,mid:x,max:T}=u,C=m[y],M=m[x],R=m[T];if(C&&M&&R)for(let F=e;F<s;F++)this.zoomInPaintVertexArray.emplace(F,M.tl[0],M.tl[1],M.br[0],M.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],M.pixelRatio,C.pixelRatio),this.zoomOutPaintVertexArray.emplace(F,M.tl[0],M.tl[1],M.br[0],M.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],M.pixelRatio,R.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,vn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,vn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class xp{constructor(e,s,u){this.binders={},this._buffers=[];const m=[];for(const y in e.paint._values){if(!u(y))continue;const x=e.paint.get(y);if(!(x instanceof Vr&&Fi(x.property.specification)))continue;const T=vy(y,e.type),C=x.value,M=x.property.specification.type,R=x.property.useIntegerZoom,F=x.property.specification["property-type"],V=F==="cross-faded"||F==="cross-faded-data-driven";if(C.kind==="constant")this.binders[y]=V?new Ro(C.value,T):new zl(C.value,T,M),m.push(`/u_${y}`);else if(C.kind==="source"||V){const Z=bp(y,M,"source");this.binders[y]=V?new vs(C,M,R,s,Z,e.id):new Za(C,T,M,Z),m.push(`/a_${y}`)}else{const Z=bp(y,M,"composite");this.binders[y]=new sa(C,T,M,R,s,Z),m.push(`/z_${y}`)}}this.cacheKey=m.sort().join("")}getMaxValue(e){const s=this.binders[e];return s instanceof Za||s instanceof sa?s.maxValue:0}populatePaintArrays(e,s,u,m,y){for(const x in this.binders){const T=this.binders[x];(T instanceof Za||T instanceof sa||T instanceof vs)&&T.populatePaintArray(e,s,u,m,y)}}setConstantPatternPositions(e,s){for(const u in this.binders){const m=this.binders[u];m instanceof Ro&&m.setConstantPatternPositions(e,s)}}updatePaintArrays(e,s,u,m,y){let x=!1;for(const T in e){const C=s.getPositions(T);for(const M of C){const R=u.feature(M.index);for(const F in this.binders){const V=this.binders[F];if((V instanceof Za||V instanceof sa||V instanceof vs)&&V.expression.isStateDependent===!0){const Z=m.paint.get(F);V.expression=Z.value,V.updatePaintArray(M.start,M.end,R,e[T],y),x=!0}}}}return x}defines(){const e=[];for(const s in this.binders){const u=this.binders[s];(u instanceof zl||u instanceof Ro)&&e.push(...u.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return e}getBinderAttributes(){const e=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof Za||u instanceof sa)for(let m=0;m<u.paintVertexAttributes.length;m++)e.push(u.paintVertexAttributes[m].name);else if(u instanceof vs)for(let m=0;m<vn.members.length;m++)e.push(vn.members[m].name)}return e}getBinderUniforms(){const e=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof zl||u instanceof Ro||u instanceof sa)for(const m of u.uniformNames)e.push(m)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,s){const u=[];for(const m in this.binders){const y=this.binders[m];if(y instanceof zl||y instanceof Ro||y instanceof sa){for(const x of y.uniformNames)if(s[x]){const T=y.getBinding(e,s[x],x);u.push({name:x,property:m,binding:T})}}}return u}setUniforms(e,s,u,m){for(const{name:y,property:x,binding:T}of s)this.binders[x].setUniform(T,m,u.get(x),y)}updatePaintBuffers(e){this._buffers=[];for(const s in this.binders){const u=this.binders[s];if(e&&u instanceof vs){const m=e.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(u instanceof Za||u instanceof sa)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(e){for(const s in this.binders){const u=this.binders[s];(u instanceof Za||u instanceof sa||u instanceof vs)&&u.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const s=this.binders[e];(s instanceof Za||s instanceof sa||s instanceof vs)&&s.destroy()}}}class Js{constructor(e,s,u=()=>!0){this.programConfigurations={};for(const m of e)this.programConfigurations[m.id]=new xp(m,s,u);this.needsUpload=!1,this._featureMap=new ys,this._bufferOffset=0}populatePaintArrays(e,s,u,m,y,x){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(e,s,m,y,x);s.id!==void 0&&this._featureMap.add(s.id,u,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,s,u,m){for(const y of u)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(e,this._featureMap,s,y,m)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function vy(r,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}function bp(r,e,s){const u={color:{source:f,composite:ze},number:{source:$,composite:f}},m=function(y){return{"line-pattern":{source:yn,composite:yn},"fill-pattern":{source:yn,composite:yn},"fill-extrusion-pattern":{source:yn,composite:yn}}[y]}(r);return m&&m[s]||u[e][s]}Et("ConstantBinder",zl),Et("CrossFadedConstantBinder",Ro),Et("SourceExpressionBinder",Za),Et("CrossFadedCompositeBinder",vs),Et("CompositeExpressionBinder",sa),Et("ProgramConfiguration",xp,{omit:["_buffers"]}),Et("ProgramConfigurationSet",Js);var dn=8192;const Ch=Math.pow(2,14)-1,wp=-Ch-1;function Ys(r){const e=dn/r.extent,s=r.loadGeometry();for(let u=0;u<s.length;u++){const m=s[u];for(let y=0;y<m.length;y++){const x=m[y],T=Math.round(x.x*e),C=Math.round(x.y*e);x.x=k(T,wp,Ch),x.y=k(C,wp,Ch),(T<x.x||T>x.x+1||C<x.y||C>x.y+1)&&le("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function Qs(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?Ys(r):[]}}function Yc(r,e,s,u,m){r.emplaceBack(2*e+(u+1)/2,2*s+(m+1)/2)}class Ah{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Mi,this.indexArray=new Xn,this.segments=new oi,this.programConfigurations=new Js(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,u){const m=this.layers[0],y=[];let x=null,T=!1;m.type==="circle"&&(x=m.layout.get("circle-sort-key"),T=!x.isConstant());for(const{feature:C,id:M,index:R,sourceLayerIndex:F}of e){const V=this.layers[0]._featureFilter.needGeometry,Z=Qs(C,V);if(!this.layers[0]._featureFilter.filter(new qi(this.zoom),Z,u))continue;const H=T?x.evaluate(Z,{},u):void 0,oe={id:M,properties:C.properties,type:C.type,sourceLayerIndex:F,index:R,geometry:V?Z.geometry:Ys(C),patterns:{},sortKey:H};y.push(oe)}T&&y.sort((C,M)=>C.sortKey-M.sortKey);for(const C of y){const{geometry:M,index:R,sourceLayerIndex:F}=C,V=e[R].feature;this.addFeature(C,M,R,u),s.featureIndex.insert(V,M,R,F,this.index)}}update(e,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,pn),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,s,u,m){for(const y of s)for(const x of y){const T=x.x,C=x.y;if(T<0||T>=dn||C<0||C>=dn)continue;const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),R=M.vertexLength;Yc(this.layoutVertexArray,T,C,-1,-1),Yc(this.layoutVertexArray,T,C,1,-1),Yc(this.layoutVertexArray,T,C,1,1),Yc(this.layoutVertexArray,T,C,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+3,R+2),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,{},m)}}function Tp(r,e){for(let s=0;s<r.length;s++)if(Bo(e,r[s]))return!0;for(let s=0;s<e.length;s++)if(Bo(r,e[s]))return!0;return!!Ih(r,e)}function xy(r,e,s){return!!Bo(r,e)||!!Mh(e,r,s)}function kp(r,e){if(r.length===1)return Ep(e,r[0]);for(let s=0;s<e.length;s++){const u=e[s];for(let m=0;m<u.length;m++)if(Bo(r,u[m]))return!0}for(let s=0;s<r.length;s++)if(Ep(e,r[s]))return!0;for(let s=0;s<e.length;s++)if(Ih(r,e[s]))return!0;return!1}function by(r,e,s){if(r.length>1){if(Ih(r,e))return!0;for(let u=0;u<e.length;u++)if(Mh(e[u],r,s))return!0}for(let u=0;u<r.length;u++)if(Mh(r[u],e,s))return!0;return!1}function Ih(r,e){if(r.length===0||e.length===0)return!1;for(let s=0;s<r.length-1;s++){const u=r[s],m=r[s+1];for(let y=0;y<e.length-1;y++)if(wy(u,m,e[y],e[y+1]))return!0}return!1}function wy(r,e,s,u){return ie(r,s,u)!==ie(e,s,u)&&ie(r,e,s)!==ie(r,e,u)}function Mh(r,e,s){const u=s*s;if(e.length===1)return r.distSqr(e[0])<u;for(let m=1;m<e.length;m++)if(Sp(r,e[m-1],e[m])<u)return!0;return!1}function Sp(r,e,s){const u=e.distSqr(s);if(u===0)return r.distSqr(e);const m=((r.x-e.x)*(s.x-e.x)+(r.y-e.y)*(s.y-e.y))/u;return r.distSqr(m<0?e:m>1?s:s.sub(e)._mult(m)._add(e))}function Ep(r,e){let s,u,m,y=!1;for(let x=0;x<r.length;x++){s=r[x];for(let T=0,C=s.length-1;T<s.length;C=T++)u=s[T],m=s[C],u.y>e.y!=m.y>e.y&&e.x<(m.x-u.x)*(e.y-u.y)/(m.y-u.y)+u.x&&(y=!y)}return y}function Bo(r,e){let s=!1;for(let u=0,m=r.length-1;u<r.length;m=u++){const y=r[u],x=r[m];y.y>e.y!=x.y>e.y&&e.x<(x.x-y.x)*(e.y-y.y)/(x.y-y.y)+y.x&&(s=!s)}return s}function Ty(r,e,s){const u=s[0],m=s[2];if(r.x<u.x&&e.x<u.x||r.x>m.x&&e.x>m.x||r.y<u.y&&e.y<u.y||r.y>m.y&&e.y>m.y)return!1;const y=ie(r,e,s[0]);return y!==ie(r,e,s[1])||y!==ie(r,e,s[2])||y!==ie(r,e,s[3])}function Dl(r,e,s){const u=e.paint.get(r).value;return u.kind==="constant"?u.value:s.programConfigurations.get(e.id).getMaxValue(r)}function Qc(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function $c(r,e,s,u,m){if(!e[0]&&!e[1])return r;const y=xe.convert(e)._mult(m);s==="viewport"&&y._rotate(-u);const x=[];for(let T=0;T<r.length;T++)x.push(r[T].sub(y));return x}Et("CircleBucket",Ah,{omit:["layers"]});const ky=new En({"circle-sort-key":new Ot(Oe.layout_circle["circle-sort-key"])});var Sy={paint:new En({"circle-radius":new Ot(Oe.paint_circle["circle-radius"]),"circle-color":new Ot(Oe.paint_circle["circle-color"]),"circle-blur":new Ot(Oe.paint_circle["circle-blur"]),"circle-opacity":new Ot(Oe.paint_circle["circle-opacity"]),"circle-translate":new Pt(Oe.paint_circle["circle-translate"]),"circle-translate-anchor":new Pt(Oe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Pt(Oe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Pt(Oe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ot(Oe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ot(Oe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ot(Oe.paint_circle["circle-stroke-opacity"])}),layout:ky},Kn=1e-6,Jn=typeof Float32Array<"u"?Float32Array:Array;function Cp(){var r=new Jn(9);return Jn!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function Ph(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Ap(r,e,s){var u=e[0],m=e[1],y=e[2],x=e[3],T=e[4],C=e[5],M=e[6],R=e[7],F=e[8],V=e[9],Z=e[10],H=e[11],oe=e[12],re=e[13],Se=e[14],De=e[15],we=s[0],Pe=s[1],Ke=s[2],Xe=s[3];return r[0]=we*u+Pe*T+Ke*F+Xe*oe,r[1]=we*m+Pe*C+Ke*V+Xe*re,r[2]=we*y+Pe*M+Ke*Z+Xe*Se,r[3]=we*x+Pe*R+Ke*H+Xe*De,r[4]=(we=s[4])*u+(Pe=s[5])*T+(Ke=s[6])*F+(Xe=s[7])*oe,r[5]=we*m+Pe*C+Ke*V+Xe*re,r[6]=we*y+Pe*M+Ke*Z+Xe*Se,r[7]=we*x+Pe*R+Ke*H+Xe*De,r[8]=(we=s[8])*u+(Pe=s[9])*T+(Ke=s[10])*F+(Xe=s[11])*oe,r[9]=we*m+Pe*C+Ke*V+Xe*re,r[10]=we*y+Pe*M+Ke*Z+Xe*Se,r[11]=we*x+Pe*R+Ke*H+Xe*De,r[12]=(we=s[12])*u+(Pe=s[13])*T+(Ke=s[14])*F+(Xe=s[15])*oe,r[13]=we*m+Pe*C+Ke*V+Xe*re,r[14]=we*y+Pe*M+Ke*Z+Xe*Se,r[15]=we*x+Pe*R+Ke*H+Xe*De,r}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var Ll,Ey=Ap;function Ip(){var r=new Jn(3);return Jn!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Mp(r,e,s){var u=new Jn(3);return u[0]=r,u[1]=e,u[2]=s,u}function eu(r,e,s){var u=e[0],m=e[1],y=e[2],x=e[3];return r[0]=s[0]*u+s[4]*m+s[8]*y+s[12]*x,r[1]=s[1]*u+s[5]*m+s[9]*y+s[13]*x,r[2]=s[2]*u+s[6]*m+s[10]*y+s[14]*x,r[3]=s[3]*u+s[7]*m+s[11]*y+s[15]*x,r}function Pp(){var r=new Jn(4);return Jn!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function zp(r,e){const s=eu([],[r.x,r.y,0,1],e);return new xe(s[0]/s[3],s[1]/s[3])}Ip(),Ll=new Jn(4),Jn!=Float32Array&&(Ll[0]=0,Ll[1]=0,Ll[2]=0,Ll[3]=0),Ip(),Mp(1,0,0),Mp(0,1,0),Pp(),Pp(),Cp(),function(){var r;r=new Jn(2),Jn!=Float32Array&&(r[0]=0,r[1]=0)}();class Dp extends Ah{}Et("HeatmapBucket",Dp,{omit:["layers"]});var Cy={paint:new En({"heatmap-radius":new Ot(Oe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ot(Oe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Pt(Oe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xa(Oe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Pt(Oe.paint_heatmap["heatmap-opacity"])})};function zh(r,{width:e,height:s},u,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==e*s*u)throw new RangeError(`mismatched image size. expected: ${m.length} but got: ${e*s*u}`)}else m=new Uint8Array(e*s*u);return r.width=e,r.height=s,r.data=m,r}function Lp(r,{width:e,height:s},u){if(e===r.width&&s===r.height)return;const m=zh({},{width:e,height:s},u);Dh(r,m,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,e),height:Math.min(r.height,s)},u),r.width=e,r.height=s,r.data=m.data}function Dh(r,e,s,u,m,y){if(m.width===0||m.height===0)return e;if(m.width>r.width||m.height>r.height||s.x>r.width-m.width||s.y>r.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>e.width||m.height>e.height||u.x>e.width-m.width||u.y>e.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const x=r.data,T=e.data;if(x===T)throw new Error("srcData equals dstData, so image is already copied");for(let C=0;C<m.height;C++){const M=((s.y+C)*r.width+s.x)*y,R=((u.y+C)*e.width+u.x)*y;for(let F=0;F<m.width*y;F++)T[R+F]=x[M+F]}return e}class Rl{constructor(e,s){zh(this,e,1,s)}resize(e){Lp(this,e,1)}clone(){return new Rl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,u,m,y){Dh(e,s,u,m,y,1)}}class Rr{constructor(e,s){zh(this,e,4,s)}resize(e){Lp(this,e,4)}replace(e,s){s?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Rr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,u,m,y){Dh(e,s,u,m,y,4)}}function Rp(r){const e={},s=r.resolution||256,u=r.clips?r.clips.length:1,m=r.image||new Rr({width:s,height:u});if(Math.log(s)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${s}`);const y=(x,T,C)=>{e[r.evaluationKey]=C;const M=r.expression.evaluate(e);m.data[x+T+0]=Math.floor(255*M.r/M.a),m.data[x+T+1]=Math.floor(255*M.g/M.a),m.data[x+T+2]=Math.floor(255*M.b/M.a),m.data[x+T+3]=Math.floor(255*M.a)};if(r.clips)for(let x=0,T=0;x<u;++x,T+=4*s)for(let C=0,M=0;C<s;C++,M+=4){const R=C/(s-1),{start:F,end:V}=r.clips[x];y(T,M,F*(1-R)+V*R)}else for(let x=0,T=0;x<s;x++,T+=4)y(0,T,x/(s-1));return m}Et("AlphaImage",Rl),Et("RGBAImage",Rr);var Ay={paint:new En({"hillshade-illumination-direction":new Pt(Oe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Pt(Oe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Pt(Oe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Pt(Oe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Pt(Oe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Pt(Oe.paint_hillshade["hillshade-accent-color"])})};const Iy=cn([{name:"a_pos",components:2,type:"Int16"}],4),{members:My}=Iy;var tu={exports:{}};function iu(r,e,s){s=s||2;var u,m,y,x,T,C,M,R=e&&e.length,F=R?e[0]*s:r.length,V=Bp(r,0,F,s,!0),Z=[];if(!V||V.next===V.prev)return Z;if(R&&(V=function(oe,re,Se,De){var we,Pe,Ke,Xe=[];for(we=0,Pe=re.length;we<Pe;we++)(Ke=Bp(oe,re[we]*De,we<Pe-1?re[we+1]*De:oe.length,De,!1))===Ke.next&&(Ke.steiner=!0),Xe.push(Oy(Ke));for(Xe.sort(Ry),we=0;we<Xe.length;we++)Se=By(Xe[we],Se);return Se}(r,e,V,s)),r.length>80*s){u=y=r[0],m=x=r[1];for(var H=s;H<F;H+=s)(T=r[H])<u&&(u=T),(C=r[H+1])<m&&(m=C),T>y&&(y=T),C>x&&(x=C);M=(M=Math.max(y-u,x-m))!==0?32767/M:0}return Bl(V,Z,s,u,m,M,0),Z}function Bp(r,e,s,u,m){var y,x;if(m===Bh(r,e,s,u)>0)for(y=e;y<s;y+=u)x=Up(y,r[y],r[y+1],x);else for(y=s-u;y>=e;y-=u)x=Up(y,r[y],r[y+1],x);return x&&nu(x,x.next)&&(Ol(x),x=x.next),x}function $s(r,e){if(!r)return r;e||(e=r);var s,u=r;do if(s=!1,u.steiner||!nu(u,u.next)&&rn(u.prev,u,u.next)!==0)u=u.next;else{if(Ol(u),(u=e=u.prev)===u.next)break;s=!0}while(s||u!==e);return e}function Bl(r,e,s,u,m,y,x){if(r){!x&&y&&function(R,F,V,Z){var H=R;do H.z===0&&(H.z=Lh(H.x,H.y,F,V,Z)),H.prevZ=H.prev,H.nextZ=H.next,H=H.next;while(H!==R);H.prevZ.nextZ=null,H.prevZ=null,function(oe){var re,Se,De,we,Pe,Ke,Xe,bt,Ct=1;do{for(Se=oe,oe=null,Pe=null,Ke=0;Se;){for(Ke++,De=Se,Xe=0,re=0;re<Ct&&(Xe++,De=De.nextZ);re++);for(bt=Ct;Xe>0||bt>0&&De;)Xe!==0&&(bt===0||!De||Se.z<=De.z)?(we=Se,Se=Se.nextZ,Xe--):(we=De,De=De.nextZ,bt--),Pe?Pe.nextZ=we:oe=we,we.prevZ=Pe,Pe=we;Se=De}Pe.nextZ=null,Ct*=2}while(Ke>1)}(H)}(r,u,m,y);for(var T,C,M=r;r.prev!==r.next;)if(T=r.prev,C=r.next,y?zy(r,u,m,y):Py(r))e.push(T.i/s|0),e.push(r.i/s|0),e.push(C.i/s|0),Ol(r),r=C.next,M=C.next;else if((r=C)===M){x?x===1?Bl(r=Dy($s(r),e,s),e,s,u,m,y,2):x===2&&Ly(r,e,s,u,m,y):Bl($s(r),e,s,u,m,y,1);break}}}function Py(r){var e=r.prev,s=r,u=r.next;if(rn(e,s,u)>=0)return!1;for(var m=e.x,y=s.x,x=u.x,T=e.y,C=s.y,M=u.y,R=m<y?m<x?m:x:y<x?y:x,F=T<C?T<M?T:M:C<M?C:M,V=m>y?m>x?m:x:y>x?y:x,Z=T>C?T>M?T:M:C>M?C:M,H=u.next;H!==e;){if(H.x>=R&&H.x<=V&&H.y>=F&&H.y<=Z&&Fo(m,T,y,C,x,M,H.x,H.y)&&rn(H.prev,H,H.next)>=0)return!1;H=H.next}return!0}function zy(r,e,s,u){var m=r.prev,y=r,x=r.next;if(rn(m,y,x)>=0)return!1;for(var T=m.x,C=y.x,M=x.x,R=m.y,F=y.y,V=x.y,Z=T<C?T<M?T:M:C<M?C:M,H=R<F?R<V?R:V:F<V?F:V,oe=T>C?T>M?T:M:C>M?C:M,re=R>F?R>V?R:V:F>V?F:V,Se=Lh(Z,H,e,s,u),De=Lh(oe,re,e,s,u),we=r.prevZ,Pe=r.nextZ;we&&we.z>=Se&&Pe&&Pe.z<=De;){if(we.x>=Z&&we.x<=oe&&we.y>=H&&we.y<=re&&we!==m&&we!==x&&Fo(T,R,C,F,M,V,we.x,we.y)&&rn(we.prev,we,we.next)>=0||(we=we.prevZ,Pe.x>=Z&&Pe.x<=oe&&Pe.y>=H&&Pe.y<=re&&Pe!==m&&Pe!==x&&Fo(T,R,C,F,M,V,Pe.x,Pe.y)&&rn(Pe.prev,Pe,Pe.next)>=0))return!1;Pe=Pe.nextZ}for(;we&&we.z>=Se;){if(we.x>=Z&&we.x<=oe&&we.y>=H&&we.y<=re&&we!==m&&we!==x&&Fo(T,R,C,F,M,V,we.x,we.y)&&rn(we.prev,we,we.next)>=0)return!1;we=we.prevZ}for(;Pe&&Pe.z<=De;){if(Pe.x>=Z&&Pe.x<=oe&&Pe.y>=H&&Pe.y<=re&&Pe!==m&&Pe!==x&&Fo(T,R,C,F,M,V,Pe.x,Pe.y)&&rn(Pe.prev,Pe,Pe.next)>=0)return!1;Pe=Pe.nextZ}return!0}function Dy(r,e,s){var u=r;do{var m=u.prev,y=u.next.next;!nu(m,y)&&Fp(m,u,u.next,y)&&Fl(m,y)&&Fl(y,m)&&(e.push(m.i/s|0),e.push(u.i/s|0),e.push(y.i/s|0),Ol(u),Ol(u.next),u=r=y),u=u.next}while(u!==r);return $s(u)}function Ly(r,e,s,u,m,y){var x=r;do{for(var T=x.next.next;T!==x.prev;){if(x.i!==T.i&&Uy(x,T)){var C=Op(x,T);return x=$s(x,x.next),C=$s(C,C.next),Bl(x,e,s,u,m,y,0),void Bl(C,e,s,u,m,y,0)}T=T.next}x=x.next}while(x!==r)}function Ry(r,e){return r.x-e.x}function By(r,e){var s=function(m,y){var x,T=y,C=m.x,M=m.y,R=-1/0;do{if(M<=T.y&&M>=T.next.y&&T.next.y!==T.y){var F=T.x+(M-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(F<=C&&F>R&&(R=F,x=T.x<T.next.x?T:T.next,F===C))return x}T=T.next}while(T!==y);if(!x)return null;var V,Z=x,H=x.x,oe=x.y,re=1/0;T=x;do C>=T.x&&T.x>=H&&C!==T.x&&Fo(M<oe?C:R,M,H,oe,M<oe?R:C,M,T.x,T.y)&&(V=Math.abs(M-T.y)/(C-T.x),Fl(T,m)&&(V<re||V===re&&(T.x>x.x||T.x===x.x&&Fy(x,T)))&&(x=T,re=V)),T=T.next;while(T!==Z);return x}(r,e);if(!s)return e;var u=Op(s,r);return $s(u,u.next),$s(s,s.next)}function Fy(r,e){return rn(r.prev,r,e.prev)<0&&rn(e.next,r,r.next)<0}function Lh(r,e,s,u,m){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-s)*m|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-u)*m|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Oy(r){var e=r,s=r;do(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next;while(e!==r);return s}function Fo(r,e,s,u,m,y,x,T){return(m-x)*(e-T)>=(r-x)*(y-T)&&(r-x)*(u-T)>=(s-x)*(e-T)&&(s-x)*(y-T)>=(m-x)*(u-T)}function Uy(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(s,u){var m=s;do{if(m.i!==s.i&&m.next.i!==s.i&&m.i!==u.i&&m.next.i!==u.i&&Fp(m,m.next,s,u))return!0;m=m.next}while(m!==s);return!1}(r,e)&&(Fl(r,e)&&Fl(e,r)&&function(s,u){var m=s,y=!1,x=(s.x+u.x)/2,T=(s.y+u.y)/2;do m.y>T!=m.next.y>T&&m.next.y!==m.y&&x<(m.next.x-m.x)*(T-m.y)/(m.next.y-m.y)+m.x&&(y=!y),m=m.next;while(m!==s);return y}(r,e)&&(rn(r.prev,r,e.prev)||rn(r,e.prev,e))||nu(r,e)&&rn(r.prev,r,r.next)>0&&rn(e.prev,e,e.next)>0)}function rn(r,e,s){return(e.y-r.y)*(s.x-e.x)-(e.x-r.x)*(s.y-e.y)}function nu(r,e){return r.x===e.x&&r.y===e.y}function Fp(r,e,s,u){var m=au(rn(r,e,s)),y=au(rn(r,e,u)),x=au(rn(s,u,r)),T=au(rn(s,u,e));return m!==y&&x!==T||!(m!==0||!ru(r,s,e))||!(y!==0||!ru(r,u,e))||!(x!==0||!ru(s,r,u))||!(T!==0||!ru(s,e,u))}function ru(r,e,s){return e.x<=Math.max(r.x,s.x)&&e.x>=Math.min(r.x,s.x)&&e.y<=Math.max(r.y,s.y)&&e.y>=Math.min(r.y,s.y)}function au(r){return r>0?1:r<0?-1:0}function Fl(r,e){return rn(r.prev,r,r.next)<0?rn(r,e,r.next)>=0&&rn(r,r.prev,e)>=0:rn(r,e,r.prev)<0||rn(r,r.next,e)<0}function Op(r,e){var s=new Rh(r.i,r.x,r.y),u=new Rh(e.i,e.x,e.y),m=r.next,y=e.prev;return r.next=e,e.prev=r,s.next=m,m.prev=s,u.next=s,s.prev=u,y.next=u,u.prev=y,u}function Up(r,e,s,u){var m=new Rh(r,e,s);return u?(m.next=u.next,m.prev=u,u.next.prev=m,u.next=m):(m.prev=m,m.next=m),m}function Ol(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Rh(r,e,s){this.i=r,this.x=e,this.y=s,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Bh(r,e,s,u){for(var m=0,y=e,x=s-u;y<s;y+=u)m+=(r[x]-r[y])*(r[y+1]+r[x+1]),x=y;return m}function Ny(r,e,s,u,m){Np(r,e,s||0,u||r.length-1,m||jy)}function Np(r,e,s,u,m){for(;u>s;){if(u-s>600){var y=u-s+1,x=e-s+1,T=Math.log(y),C=.5*Math.exp(2*T/3),M=.5*Math.sqrt(T*C*(y-C)/y)*(x-y/2<0?-1:1);Np(r,e,Math.max(s,Math.floor(e-x*C/y+M)),Math.min(u,Math.floor(e+(y-x)*C/y+M)),m)}var R=r[e],F=s,V=u;for(Ul(r,s,e),m(r[u],R)>0&&Ul(r,s,u);F<V;){for(Ul(r,F,V),F++,V--;m(r[F],R)<0;)F++;for(;m(r[V],R)>0;)V--}m(r[s],R)===0?Ul(r,s,V):Ul(r,++V,u),V<=e&&(s=V+1),e<=V&&(u=V-1)}}function Ul(r,e,s){var u=r[e];r[e]=r[s],r[s]=u}function jy(r,e){return r<e?-1:r>e?1:0}function Fh(r,e){const s=r.length;if(s<=1)return[r];const u=[];let m,y;for(let x=0;x<s;x++){const T=ke(r[x]);T!==0&&(r[x].area=Math.abs(T),y===void 0&&(y=T<0),y===T<0?(m&&u.push(m),m=[r[x]]):m.push(r[x]))}if(m&&u.push(m),e>1)for(let x=0;x<u.length;x++)u[x].length<=e||(Ny(u[x],e,1,u[x].length-1,Vy),u[x]=u[x].slice(0,e));return u}function Vy(r,e){return e.area-r.area}function Oh(r,e,s){const u=s.patternDependencies;let m=!1;for(const y of e){const x=y.paint.get(`${r}-pattern`);x.isConstant()||(m=!0);const T=x.constantOr(null);T&&(m=!0,u[T.to]=!0,u[T.from]=!0)}return m}function Uh(r,e,s,u,m){const y=m.patternDependencies;for(const x of e){const T=x.paint.get(`${r}-pattern`).value;if(T.kind!=="constant"){let C=T.evaluate({zoom:u-1},s,{},m.availableImages),M=T.evaluate({zoom:u},s,{},m.availableImages),R=T.evaluate({zoom:u+1},s,{},m.availableImages);C=C&&C.name?C.name:C,M=M&&M.name?M.name:M,R=R&&R.name?R.name:R,y[C]=!0,y[M]=!0,y[R]=!0,s.patterns[x.id]={min:C,mid:M,max:R}}}return s}tu.exports=iu,tu.exports.default=iu,iu.deviation=function(r,e,s,u){var m=e&&e.length,y=Math.abs(Bh(r,0,m?e[0]*s:r.length,s));if(m)for(var x=0,T=e.length;x<T;x++)y-=Math.abs(Bh(r,e[x]*s,x<T-1?e[x+1]*s:r.length,s));var C=0;for(x=0;x<u.length;x+=3){var M=u[x]*s,R=u[x+1]*s,F=u[x+2]*s;C+=Math.abs((r[M]-r[F])*(r[R+1]-r[M+1])-(r[M]-r[R])*(r[F+1]-r[M+1]))}return y===0&&C===0?0:Math.abs((C-y)/y)},iu.flatten=function(r){for(var e=r[0][0].length,s={vertices:[],holes:[],dimensions:e},u=0,m=0;m<r.length;m++){for(var y=0;y<r[m].length;y++)for(var x=0;x<e;x++)s.vertices.push(r[m][y][x]);m>0&&s.holes.push(u+=r[m-1].length)}return s};class Nh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Pi,this.indexArray=new Xn,this.indexArray2=new aa,this.programConfigurations=new Js(e.layers,e.zoom),this.segments=new oi,this.segments2=new oi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,u){this.hasPattern=Oh("fill",this.layers,s);const m=this.layers[0].layout.get("fill-sort-key"),y=!m.isConstant(),x=[];for(const{feature:T,id:C,index:M,sourceLayerIndex:R}of e){const F=this.layers[0]._featureFilter.needGeometry,V=Qs(T,F);if(!this.layers[0]._featureFilter.filter(new qi(this.zoom),V,u))continue;const Z=y?m.evaluate(V,{},u,s.availableImages):void 0,H={id:C,properties:T.properties,type:T.type,sourceLayerIndex:R,index:M,geometry:F?V.geometry:Ys(T),patterns:{},sortKey:Z};x.push(H)}y&&x.sort((T,C)=>T.sortKey-C.sortKey);for(const T of x){const{geometry:C,index:M,sourceLayerIndex:R}=T;if(this.hasPattern){const F=Uh("fill",this.layers,T,this.zoom,s);this.patternFeatures.push(F)}else this.addFeature(T,C,M,u,{});s.featureIndex.insert(e[M].feature,C,M,R,this.index)}}update(e,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,u)}addFeatures(e,s,u){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,s,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,My),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,s,u,m,y){for(const x of Fh(s,500)){let T=0;for(const Z of x)T+=Z.length;const C=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),M=C.vertexLength,R=[],F=[];for(const Z of x){if(Z.length===0)continue;Z!==x[0]&&F.push(R.length/2);const H=this.segments2.prepareSegment(Z.length,this.layoutVertexArray,this.indexArray2),oe=H.vertexLength;this.layoutVertexArray.emplaceBack(Z[0].x,Z[0].y),this.indexArray2.emplaceBack(oe+Z.length-1,oe),R.push(Z[0].x),R.push(Z[0].y);for(let re=1;re<Z.length;re++)this.layoutVertexArray.emplaceBack(Z[re].x,Z[re].y),this.indexArray2.emplaceBack(oe+re-1,oe+re),R.push(Z[re].x),R.push(Z[re].y);H.vertexLength+=Z.length,H.primitiveLength+=Z.length}const V=tu.exports(R,F);for(let Z=0;Z<V.length;Z+=3)this.indexArray.emplaceBack(M+V[Z],M+V[Z+1],M+V[Z+2]);C.vertexLength+=T,C.primitiveLength+=V.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,y,m)}}Et("FillBucket",Nh,{omit:["layers","patternFeatures"]});const qy=new En({"fill-sort-key":new Ot(Oe.layout_fill["fill-sort-key"])});var Gy={paint:new En({"fill-antialias":new Pt(Oe.paint_fill["fill-antialias"]),"fill-opacity":new Ot(Oe.paint_fill["fill-opacity"]),"fill-color":new Ot(Oe.paint_fill["fill-color"]),"fill-outline-color":new Ot(Oe.paint_fill["fill-outline-color"]),"fill-translate":new Pt(Oe.paint_fill["fill-translate"]),"fill-translate-anchor":new Pt(Oe.paint_fill["fill-translate-anchor"]),"fill-pattern":new _s(Oe.paint_fill["fill-pattern"])}),layout:qy};const Zy=cn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Hy=cn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Wy}=Zy;var xs={},Xy=xe,jp=Oo;function Oo(r,e,s,u,m){this.properties={},this.extent=s,this.type=0,this._pbf=r,this._geometry=-1,this._keys=u,this._values=m,r.readFields(Ky,this,e)}function Ky(r,e,s){r==1?e.id=s.readVarint():r==2?function(u,m){for(var y=u.readVarint()+u.pos;u.pos<y;){var x=m._keys[u.readVarint()],T=m._values[u.readVarint()];m.properties[x]=T}}(s,e):r==3?e.type=s.readVarint():r==4&&(e._geometry=s.pos)}function Jy(r){for(var e,s,u=0,m=0,y=r.length,x=y-1;m<y;x=m++)u+=((s=r[x]).x-(e=r[m]).x)*(e.y+s.y);return u}Oo.types=["Unknown","Point","LineString","Polygon"],Oo.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var e,s=r.readVarint()+r.pos,u=1,m=0,y=0,x=0,T=[];r.pos<s;){if(m<=0){var C=r.readVarint();u=7&C,m=C>>3}if(m--,u===1||u===2)y+=r.readSVarint(),x+=r.readSVarint(),u===1&&(e&&T.push(e),e=[]),e.push(new Xy(y,x));else{if(u!==7)throw new Error("unknown command "+u);e&&e.push(e[0].clone())}}return e&&T.push(e),T},Oo.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var e=r.readVarint()+r.pos,s=1,u=0,m=0,y=0,x=1/0,T=-1/0,C=1/0,M=-1/0;r.pos<e;){if(u<=0){var R=r.readVarint();s=7&R,u=R>>3}if(u--,s===1||s===2)(m+=r.readSVarint())<x&&(x=m),m>T&&(T=m),(y+=r.readSVarint())<C&&(C=y),y>M&&(M=y);else if(s!==7)throw new Error("unknown command "+s)}return[x,C,T,M]},Oo.prototype.toGeoJSON=function(r,e,s){var u,m,y=this.extent*Math.pow(2,s),x=this.extent*r,T=this.extent*e,C=this.loadGeometry(),M=Oo.types[this.type];function R(Z){for(var H=0;H<Z.length;H++){var oe=Z[H];Z[H]=[360*(oe.x+x)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(oe.y+T)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var F=[];for(u=0;u<C.length;u++)F[u]=C[u][0];R(C=F);break;case 2:for(u=0;u<C.length;u++)R(C[u]);break;case 3:for(C=function(Z){var H=Z.length;if(H<=1)return[Z];for(var oe,re,Se=[],De=0;De<H;De++){var we=Jy(Z[De]);we!==0&&(re===void 0&&(re=we<0),re===we<0?(oe&&Se.push(oe),oe=[Z[De]]):oe.push(Z[De]))}return oe&&Se.push(oe),Se}(C),u=0;u<C.length;u++)for(m=0;m<C[u].length;m++)R(C[u][m])}C.length===1?C=C[0]:M="Multi"+M;var V={type:"Feature",geometry:{type:M,coordinates:C},properties:this.properties};return"id"in this&&(V.id=this.id),V};var Yy=jp,Vp=qp;function qp(r,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(Qy,this,e),this.length=this._features.length}function Qy(r,e,s){r===15?e.version=s.readVarint():r===1?e.name=s.readString():r===5?e.extent=s.readVarint():r===2?e._features.push(s.pos):r===3?e._keys.push(s.readString()):r===4&&e._values.push(function(u){for(var m=null,y=u.readVarint()+u.pos;u.pos<y;){var x=u.readVarint()>>3;m=x===1?u.readString():x===2?u.readFloat():x===3?u.readDouble():x===4?u.readVarint64():x===5?u.readVarint():x===6?u.readSVarint():x===7?u.readBoolean():null}return m}(s))}qp.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var e=this._pbf.readVarint()+this._pbf.pos;return new Yy(this._pbf,e,this.extent,this._keys,this._values)};var $y=Vp;function e0(r,e,s){if(r===3){var u=new $y(s,s.readVarint()+s.pos);u.length&&(e[u.name]=u)}}xs.VectorTile=function(r,e){this.layers=r.readFields(e0,{},e)},xs.VectorTileFeature=jp,xs.VectorTileLayer=Vp;const t0=xs.VectorTileFeature.types,jh=Math.pow(2,13);function Nl(r,e,s,u,m,y,x,T){r.emplaceBack(e,s,2*Math.floor(u*jh)+x,m*jh*2,y*jh*2,Math.round(T))}class Vh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new yi,this.centroidVertexArray=new Lt,this.indexArray=new Xn,this.programConfigurations=new Js(e.layers,e.zoom),this.segments=new oi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,u){this.features=[],this.hasPattern=Oh("fill-extrusion",this.layers,s);for(const{feature:m,id:y,index:x,sourceLayerIndex:T}of e){const C=this.layers[0]._featureFilter.needGeometry,M=Qs(m,C);if(!this.layers[0]._featureFilter.filter(new qi(this.zoom),M,u))continue;const R={id:y,sourceLayerIndex:T,index:x,geometry:C?M.geometry:Ys(m),properties:m.properties,type:m.type,patterns:{}};this.hasPattern?this.features.push(Uh("fill-extrusion",this.layers,R,this.zoom,s)):this.addFeature(R,R.geometry,x,u,{}),s.featureIndex.insert(m,R.geometry,x,T,this.index,!0)}}addFeatures(e,s,u){for(const m of this.features){const{geometry:y}=m;this.addFeature(m,y,m.index,s,u)}}update(e,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,u)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Wy),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Hy.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,s,u,m,y){const x={x:0,y:0,vertexCount:0};for(const T of Fh(s,500)){let C=0;for(const H of T)C+=H.length;let M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const H of T){if(H.length===0||n0(H))continue;let oe=0;for(let re=0;re<H.length;re++){const Se=H[re];if(re>=1){const De=H[re-1];if(!i0(Se,De)){M.vertexLength+4>oi.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const we=Se.sub(De)._perp()._unit(),Pe=De.dist(Se);oe+Pe>32768&&(oe=0),Nl(this.layoutVertexArray,Se.x,Se.y,we.x,we.y,0,0,oe),Nl(this.layoutVertexArray,Se.x,Se.y,we.x,we.y,0,1,oe),x.x+=2*Se.x,x.y+=2*Se.y,x.vertexCount+=2,oe+=Pe,Nl(this.layoutVertexArray,De.x,De.y,we.x,we.y,0,0,oe),Nl(this.layoutVertexArray,De.x,De.y,we.x,we.y,0,1,oe),x.x+=2*De.x,x.y+=2*De.y,x.vertexCount+=2;const Ke=M.vertexLength;this.indexArray.emplaceBack(Ke,Ke+2,Ke+1),this.indexArray.emplaceBack(Ke+1,Ke+2,Ke+3),M.vertexLength+=4,M.primitiveLength+=2}}}}if(M.vertexLength+C>oi.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(C,this.layoutVertexArray,this.indexArray)),t0[e.type]!=="Polygon")continue;const R=[],F=[],V=M.vertexLength;for(const H of T)if(H.length!==0){H!==T[0]&&F.push(R.length/2);for(let oe=0;oe<H.length;oe++){const re=H[oe];Nl(this.layoutVertexArray,re.x,re.y,0,0,1,1,0),x.x+=re.x,x.y+=re.y,x.vertexCount+=1,R.push(re.x),R.push(re.y)}}const Z=tu.exports(R,F);for(let H=0;H<Z.length;H+=3)this.indexArray.emplaceBack(V+Z[H],V+Z[H+2],V+Z[H+1]);M.primitiveLength+=Z.length/3,M.vertexLength+=C}for(let T=0;T<x.vertexCount;T++)this.centroidVertexArray.emplaceBack(Math.floor(x.x/x.vertexCount),Math.floor(x.y/x.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,y,m)}}function i0(r,e){return r.x===e.x&&(r.x<0||r.x>dn)||r.y===e.y&&(r.y<0||r.y>dn)}function n0(r){return r.every(e=>e.x<0)||r.every(e=>e.x>dn)||r.every(e=>e.y<0)||r.every(e=>e.y>dn)}Et("FillExtrusionBucket",Vh,{omit:["layers","features"]});var r0={paint:new En({"fill-extrusion-opacity":new Pt(Oe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ot(Oe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Pt(Oe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Pt(Oe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new _s(Oe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ot(Oe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ot(Oe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Pt(Oe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function jl(r,e){return r.x*e.x+r.y*e.y}function Gp(r,e){if(r.length===1){let s=0;const u=e[s++];let m;for(;!m||u.equals(m);)if(m=e[s++],!m)return 1/0;for(;s<e.length;s++){const y=e[s],x=r[0],T=m.sub(u),C=y.sub(u),M=x.sub(u),R=jl(T,T),F=jl(T,C),V=jl(C,C),Z=jl(M,T),H=jl(M,C),oe=R*V-F*F,re=(V*Z-F*H)/oe,Se=(R*H-F*Z)/oe,De=u.z*(1-re-Se)+m.z*re+y.z*Se;if(isFinite(De))return De}return 1/0}{let s=1/0;for(const u of e)s=Math.min(s,u.z);return s}}const a0=cn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:s0}=a0,o0=cn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:l0}=o0,c0=xs.VectorTileFeature.types,u0=Math.cos(Math.PI/180*37.5),Zp=Math.pow(2,14)/.5;class qh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new xi,this.layoutVertexArray2=new zi,this.indexArray=new Xn,this.programConfigurations=new Js(e.layers,e.zoom),this.segments=new oi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,u){this.hasPattern=Oh("line",this.layers,s);const m=this.layers[0].layout.get("line-sort-key"),y=!m.isConstant(),x=[];for(const{feature:T,id:C,index:M,sourceLayerIndex:R}of e){const F=this.layers[0]._featureFilter.needGeometry,V=Qs(T,F);if(!this.layers[0]._featureFilter.filter(new qi(this.zoom),V,u))continue;const Z=y?m.evaluate(V,{},u):void 0,H={id:C,properties:T.properties,type:T.type,sourceLayerIndex:R,index:M,geometry:F?V.geometry:Ys(T),patterns:{},sortKey:Z};x.push(H)}y&&x.sort((T,C)=>T.sortKey-C.sortKey);for(const T of x){const{geometry:C,index:M,sourceLayerIndex:R}=T;if(this.hasPattern){const F=Uh("line",this.layers,T,this.zoom,s);this.patternFeatures.push(F)}else this.addFeature(T,C,M,u,{});s.featureIndex.insert(e[M].feature,C,M,R,this.index)}}update(e,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,u)}addFeatures(e,s,u){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,s,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,l0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,s0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,s,u,m,y){const x=this.layers[0].layout,T=x.get("line-join").evaluate(e,{}),C=x.get("line-cap"),M=x.get("line-miter-limit"),R=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const F of s)this.addLine(F,e,T,C,M,R);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,y,m)}addLine(e,s,u,m,y,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Se=0;Se<e.length-1;Se++)this.totalDistance+=e[Se].dist(e[Se+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=c0[s.type]==="Polygon";let C=e.length;for(;C>=2&&e[C-1].equals(e[C-2]);)C--;let M=0;for(;M<C-1&&e[M].equals(e[M+1]);)M++;if(C<(T?3:2))return;u==="bevel"&&(y=1.05);const R=this.overscaling<=16?122880/(512*this.overscaling):0,F=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let V,Z,H,oe,re;this.e1=this.e2=-1,T&&(V=e[C-2],re=e[M].sub(V)._unit()._perp());for(let Se=M;Se<C;Se++){if(H=Se===C-1?T?e[M+1]:void 0:e[Se+1],H&&e[Se].equals(H))continue;re&&(oe=re),V&&(Z=V),V=e[Se],re=H?H.sub(V)._unit()._perp():oe,oe=oe||re;let De=oe.add(re);De.x===0&&De.y===0||De._unit();const we=oe.x*re.x+oe.y*re.y,Pe=De.x*re.x+De.y*re.y,Ke=Pe!==0?1/Pe:1/0,Xe=2*Math.sqrt(2-2*Pe),bt=Pe<u0&&Z&&H,Ct=oe.x*re.y-oe.y*re.x>0;if(bt&&Se>M){const lt=V.dist(Z);if(lt>2*R){const yt=V.sub(V.sub(Z)._mult(R/lt)._round());this.updateDistance(Z,yt),this.addCurrentVertex(yt,oe,0,0,F),Z=yt}}const _t=Z&&H;let pt=_t?u:T?"butt":m;if(_t&&pt==="round"&&(Ke<x?pt="miter":Ke<=2&&(pt="fakeround")),pt==="miter"&&Ke>y&&(pt="bevel"),pt==="bevel"&&(Ke>2&&(pt="flipbevel"),Ke<y&&(pt="miter")),Z&&this.updateDistance(Z,V),pt==="miter")De._mult(Ke),this.addCurrentVertex(V,De,0,0,F);else if(pt==="flipbevel"){if(Ke>100)De=re.mult(-1);else{const lt=Ke*oe.add(re).mag()/oe.sub(re).mag();De._perp()._mult(lt*(Ct?-1:1))}this.addCurrentVertex(V,De,0,0,F),this.addCurrentVertex(V,De.mult(-1),0,0,F)}else if(pt==="bevel"||pt==="fakeround"){const lt=-Math.sqrt(Ke*Ke-1),yt=Ct?lt:0,dt=Ct?0:lt;if(Z&&this.addCurrentVertex(V,oe,yt,dt,F),pt==="fakeround"){const at=Math.round(180*Xe/Math.PI/20);for(let Rt=1;Rt<at;Rt++){let zt=Rt/at;if(zt!==.5){const Oi=zt-.5;zt+=zt*Oi*(zt-1)*((1.0904+we*(we*(3.55645-1.43519*we)-3.2452))*Oi*Oi+(.848013+we*(.215638*we-1.06021)))}const ni=re.sub(oe)._mult(zt)._add(oe)._unit()._mult(Ct?-1:1);this.addHalfVertex(V,ni.x,ni.y,!1,Ct,0,F)}}H&&this.addCurrentVertex(V,re,-yt,-dt,F)}else if(pt==="butt")this.addCurrentVertex(V,De,0,0,F);else if(pt==="square"){const lt=Z?1:-1;this.addCurrentVertex(V,De,lt,lt,F)}else pt==="round"&&(Z&&(this.addCurrentVertex(V,oe,0,0,F),this.addCurrentVertex(V,oe,1,1,F,!0)),H&&(this.addCurrentVertex(V,re,-1,-1,F,!0),this.addCurrentVertex(V,re,0,0,F)));if(bt&&Se<C-1){const lt=V.dist(H);if(lt>2*R){const yt=V.add(H.sub(V)._mult(R/lt)._round());this.updateDistance(V,yt),this.addCurrentVertex(yt,re,0,0,F),V=yt}}}}addCurrentVertex(e,s,u,m,y,x=!1){const T=s.y*m-s.x,C=-s.y-s.x*m;this.addHalfVertex(e,s.x+s.y*u,s.y-s.x*u,x,!1,u,y),this.addHalfVertex(e,T,C,x,!0,-m,y),this.distance>Zp/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,s,u,m,y,x))}addHalfVertex({x:e,y:s},u,m,y,x,T,C){const M=.5*(this.lineClips?this.scaledDistance*(Zp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(y?1:0),(s<<1)+(x?1:0),Math.round(63*u)+128,Math.round(63*m)+128,1+(T===0?0:T<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const R=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,R),C.primitiveLength++),x?this.e2=R:this.e1=R}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,s){this.distance+=e.dist(s),this.updateScaledDistance()}}Et("LineBucket",qh,{omit:["layers","patternFeatures"]});const h0=new En({"line-cap":new Pt(Oe.layout_line["line-cap"]),"line-join":new Ot(Oe.layout_line["line-join"]),"line-miter-limit":new Pt(Oe.layout_line["line-miter-limit"]),"line-round-limit":new Pt(Oe.layout_line["line-round-limit"]),"line-sort-key":new Ot(Oe.layout_line["line-sort-key"])});var Hp={paint:new En({"line-opacity":new Ot(Oe.paint_line["line-opacity"]),"line-color":new Ot(Oe.paint_line["line-color"]),"line-translate":new Pt(Oe.paint_line["line-translate"]),"line-translate-anchor":new Pt(Oe.paint_line["line-translate-anchor"]),"line-width":new Ot(Oe.paint_line["line-width"]),"line-gap-width":new Ot(Oe.paint_line["line-gap-width"]),"line-offset":new Ot(Oe.paint_line["line-offset"]),"line-blur":new Ot(Oe.paint_line["line-blur"]),"line-dasharray":new Al(Oe.paint_line["line-dasharray"]),"line-pattern":new _s(Oe.paint_line["line-pattern"]),"line-gradient":new xa(Oe.paint_line["line-gradient"])}),layout:h0};const Wp=new class extends Ot{possiblyEvaluate(r,e){return e=new qi(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(r,e)}evaluate(r,e,s,u){return e=j({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(r,e,s,u)}}(Hp.paint.properties["line-width"].specification);function Xp(r,e){return e>0?e+2*r:r}Wp.useIntegerZoom=!0;const f0=cn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),p0=cn([{name:"a_projected_pos",components:3,type:"Float32"}],4);cn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const d0=cn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);cn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Kp=cn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),m0=cn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function g0(r,e,s){return r.sections.forEach(u=>{u.text=function(m,y,x){const T=y.layout.get("text-transform").evaluate(x,{});return T==="uppercase"?m=m.toLocaleUpperCase():T==="lowercase"&&(m=m.toLocaleLowerCase()),yr.applyArabicShaping&&(m=yr.applyArabicShaping(m)),m}(u.text,e,s)}),r}cn([{name:"triangle",components:3,type:"Uint16"}]),cn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),cn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),cn([{type:"Float32",name:"offsetX"}]),cn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Vl={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Cn=24,Gh=Li,Jp=function(r,e,s,u,m){var y,x,T=8*m-u-1,C=(1<<T)-1,M=C>>1,R=-7,F=s?m-1:0,V=s?-1:1,Z=r[e+F];for(F+=V,y=Z&(1<<-R)-1,Z>>=-R,R+=T;R>0;y=256*y+r[e+F],F+=V,R-=8);for(x=y&(1<<-R)-1,y>>=-R,R+=u;R>0;x=256*x+r[e+F],F+=V,R-=8);if(y===0)y=1-M;else{if(y===C)return x?NaN:1/0*(Z?-1:1);x+=Math.pow(2,u),y-=M}return(Z?-1:1)*x*Math.pow(2,y-u)},Yp=function(r,e,s,u,m,y){var x,T,C,M=8*y-m-1,R=(1<<M)-1,F=R>>1,V=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,Z=u?0:y-1,H=u?1:-1,oe=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(T=isNaN(e)?1:0,x=R):(x=Math.floor(Math.log(e)/Math.LN2),e*(C=Math.pow(2,-x))<1&&(x--,C*=2),(e+=x+F>=1?V/C:V*Math.pow(2,1-F))*C>=2&&(x++,C/=2),x+F>=R?(T=0,x=R):x+F>=1?(T=(e*C-1)*Math.pow(2,m),x+=F):(T=e*Math.pow(2,F-1)*Math.pow(2,m),x=0));m>=8;r[s+Z]=255&T,Z+=H,T/=256,m-=8);for(x=x<<m|T,M+=m;M>0;r[s+Z]=255&x,Z+=H,x/=256,M-=8);r[s+Z-H]|=128*oe};function Li(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}Li.Varint=0,Li.Fixed64=1,Li.Bytes=2,Li.Fixed32=5;var bs,Zh=4294967296,Qp=1/Zh,$p=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ha(r){return r.type===Li.Bytes?r.readVarint()+r.pos:r.pos+1}function Uo(r,e,s){return s?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function ed(r,e,s){var u=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));s.realloc(u);for(var m=s.pos-1;m>=r;m--)s.buf[m+u]=s.buf[m]}function _0(r,e){for(var s=0;s<r.length;s++)e.writeVarint(r[s])}function y0(r,e){for(var s=0;s<r.length;s++)e.writeSVarint(r[s])}function v0(r,e){for(var s=0;s<r.length;s++)e.writeFloat(r[s])}function x0(r,e){for(var s=0;s<r.length;s++)e.writeDouble(r[s])}function b0(r,e){for(var s=0;s<r.length;s++)e.writeBoolean(r[s])}function w0(r,e){for(var s=0;s<r.length;s++)e.writeFixed32(r[s])}function T0(r,e){for(var s=0;s<r.length;s++)e.writeSFixed32(r[s])}function k0(r,e){for(var s=0;s<r.length;s++)e.writeFixed64(r[s])}function S0(r,e){for(var s=0;s<r.length;s++)e.writeSFixed64(r[s])}function su(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+16777216*r[e+3]}function No(r,e,s){r[s]=e,r[s+1]=e>>>8,r[s+2]=e>>>16,r[s+3]=e>>>24}function td(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}function E0(r,e,s){r===1&&s.readMessage(C0,e)}function C0(r,e,s){if(r===3){const{id:u,bitmap:m,width:y,height:x,left:T,top:C,advance:M}=s.readMessage(A0,{});e.push({id:u,bitmap:new Rl({width:y+6,height:x+6},m),metrics:{width:y,height:x,left:T,top:C,advance:M}})}}function A0(r,e,s){r===1?e.id=s.readVarint():r===2?e.bitmap=s.readBytes():r===3?e.width=s.readVarint():r===4?e.height=s.readVarint():r===5?e.left=s.readSVarint():r===6?e.top=s.readSVarint():r===7&&(e.advance=s.readVarint())}function id(r){let e=0,s=0;for(const x of r)e+=x.w*x.h,s=Math.max(s,x.w);r.sort((x,T)=>T.h-x.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),s),h:1/0}];let m=0,y=0;for(const x of r)for(let T=u.length-1;T>=0;T--){const C=u[T];if(!(x.w>C.w||x.h>C.h)){if(x.x=C.x,x.y=C.y,y=Math.max(y,x.y+x.h),m=Math.max(m,x.x+x.w),x.w===C.w&&x.h===C.h){const M=u.pop();T<u.length&&(u[T]=M)}else x.h===C.h?(C.x+=x.w,C.w-=x.w):x.w===C.w?(C.y+=x.h,C.h-=x.h):(u.push({x:C.x+x.w,y:C.y,w:C.w-x.w,h:x.h}),C.y+=x.h,C.h-=x.h);break}}return{w:m,h:y,fill:e/(m*y)||0}}Li.prototype={destroy:function(){this.buf=null},readFields:function(r,e,s){for(s=s||this.length;this.pos<s;){var u=this.readVarint(),m=u>>3,y=this.pos;this.type=7&u,r(m,e,this),this.pos===y&&this.skip(u)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=su(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=td(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=su(this.buf,this.pos)+su(this.buf,this.pos+4)*Zh;return this.pos+=8,r},readSFixed64:function(){var r=su(this.buf,this.pos)+td(this.buf,this.pos+4)*Zh;return this.pos+=8,r},readFloat:function(){var r=Jp(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=Jp(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e,s,u=this.buf;return e=127&(s=u[this.pos++]),s<128?e:(e|=(127&(s=u[this.pos++]))<<7,s<128?e:(e|=(127&(s=u[this.pos++]))<<14,s<128?e:(e|=(127&(s=u[this.pos++]))<<21,s<128?e:function(m,y,x){var T,C,M=x.buf;if(T=(112&(C=M[x.pos++]))>>4,C<128||(T|=(127&(C=M[x.pos++]))<<3,C<128)||(T|=(127&(C=M[x.pos++]))<<10,C<128)||(T|=(127&(C=M[x.pos++]))<<17,C<128)||(T|=(127&(C=M[x.pos++]))<<24,C<128)||(T|=(1&(C=M[x.pos++]))<<31,C<128))return Uo(m,T,y);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(s=u[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&$p?function(s,u,m){return $p.decode(s.subarray(u,m))}(this.buf,e,r):function(s,u,m){for(var y="",x=u;x<m;){var T,C,M,R=s[x],F=null,V=R>239?4:R>223?3:R>191?2:1;if(x+V>m)break;V===1?R<128&&(F=R):V===2?(192&(T=s[x+1]))==128&&(F=(31&R)<<6|63&T)<=127&&(F=null):V===3?(C=s[x+2],(192&(T=s[x+1]))==128&&(192&C)==128&&((F=(15&R)<<12|(63&T)<<6|63&C)<=2047||F>=55296&&F<=57343)&&(F=null)):V===4&&(C=s[x+2],M=s[x+3],(192&(T=s[x+1]))==128&&(192&C)==128&&(192&M)==128&&((F=(15&R)<<18|(63&T)<<12|(63&C)<<6|63&M)<=65535||F>=1114112)&&(F=null)),F===null?(F=65533,V=1):F>65535&&(F-=65536,y+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),y+=String.fromCharCode(F),x+=V}return y}(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==Li.Bytes)return r.push(this.readVarint(e));var s=Ha(this);for(r=r||[];this.pos<s;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==Li.Bytes)return r.push(this.readSVarint());var e=Ha(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==Li.Bytes)return r.push(this.readBoolean());var e=Ha(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==Li.Bytes)return r.push(this.readFloat());var e=Ha(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==Li.Bytes)return r.push(this.readDouble());var e=Ha(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==Li.Bytes)return r.push(this.readFixed32());var e=Ha(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==Li.Bytes)return r.push(this.readSFixed32());var e=Ha(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==Li.Bytes)return r.push(this.readFixed64());var e=Ha(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==Li.Bytes)return r.push(this.readSFixed64());var e=Ha(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=7&r;if(e===Li.Varint)for(;this.buf[this.pos++]>127;);else if(e===Li.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Li.Fixed32)this.pos+=4;else{if(e!==Li.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var s=new Uint8Array(e);s.set(this.buf),this.buf=s,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),No(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),No(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),No(this.buf,-1&r,this.pos),No(this.buf,Math.floor(r*Qp),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),No(this.buf,-1&r,this.pos),No(this.buf,Math.floor(r*Qp),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(e,s){var u,m;if(e>=0?(u=e%4294967296|0,m=e/4294967296|0):(m=~(-e/4294967296),4294967295^(u=~(-e%4294967296))?u=u+1|0:(u=0,m=m+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(y,x,T){T.buf[T.pos++]=127&y|128,y>>>=7,T.buf[T.pos++]=127&y|128,y>>>=7,T.buf[T.pos++]=127&y|128,y>>>=7,T.buf[T.pos++]=127&y|128,T.buf[T.pos]=127&(y>>>=7)}(u,0,s),function(y,x){var T=(7&y)<<4;x.buf[x.pos++]|=T|((y>>>=3)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y)))))}(m,s)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(Boolean(r))},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var e=this.pos;this.pos=function(u,m,y){for(var x,T,C=0;C<m.length;C++){if((x=m.charCodeAt(C))>55295&&x<57344){if(!T){x>56319||C+1===m.length?(u[y++]=239,u[y++]=191,u[y++]=189):T=x;continue}if(x<56320){u[y++]=239,u[y++]=191,u[y++]=189,T=x;continue}x=T-55296<<10|x-56320|65536,T=null}else T&&(u[y++]=239,u[y++]=191,u[y++]=189,T=null);x<128?u[y++]=x:(x<2048?u[y++]=x>>6|192:(x<65536?u[y++]=x>>12|224:(u[y++]=x>>18|240,u[y++]=x>>12&63|128),u[y++]=x>>6&63|128),u[y++]=63&x|128)}return y}(this.buf,r,this.pos);var s=this.pos-e;s>=128&&ed(e,s,this),this.pos=e-1,this.writeVarint(s),this.pos+=s},writeFloat:function(r){this.realloc(4),Yp(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),Yp(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var s=0;s<e;s++)this.buf[this.pos++]=r[s]},writeRawMessage:function(r,e){this.pos++;var s=this.pos;r(e,this);var u=this.pos-s;u>=128&&ed(s,u,this),this.pos=s-1,this.writeVarint(u),this.pos+=u},writeMessage:function(r,e,s){this.writeTag(r,Li.Bytes),this.writeRawMessage(e,s)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,_0,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,y0,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,b0,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,v0,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,x0,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,w0,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,T0,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,k0,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,S0,e)},writeBytesField:function(r,e){this.writeTag(r,Li.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,Li.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,Li.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,Li.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,Li.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,Li.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,Li.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,Li.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,Li.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,Li.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,Boolean(e))}};class Hh{constructor(e,{pixelRatio:s,version:u,stretchX:m,stretchY:y,content:x}){this.paddedRect=e,this.pixelRatio=s,this.stretchX=m,this.stretchY=y,this.content=x,this.version=u}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class nd{constructor(e,s){const u={},m={};this.haveRenderCallbacks=[];const y=[];this.addImages(e,u,y),this.addImages(s,m,y);const{w:x,h:T}=id(y),C=new Rr({width:x||1,height:T||1});for(const M in e){const R=e[M],F=u[M].paddedRect;Rr.copy(R.data,C,{x:0,y:0},{x:F.x+1,y:F.y+1},R.data)}for(const M in s){const R=s[M],F=m[M].paddedRect,V=F.x+1,Z=F.y+1,H=R.data.width,oe=R.data.height;Rr.copy(R.data,C,{x:0,y:0},{x:V,y:Z},R.data),Rr.copy(R.data,C,{x:0,y:oe-1},{x:V,y:Z-1},{width:H,height:1}),Rr.copy(R.data,C,{x:0,y:0},{x:V,y:Z+oe},{width:H,height:1}),Rr.copy(R.data,C,{x:H-1,y:0},{x:V-1,y:Z},{width:1,height:oe}),Rr.copy(R.data,C,{x:0,y:0},{x:V+H,y:Z},{width:1,height:oe})}this.image=C,this.iconPositions=u,this.patternPositions=m}addImages(e,s,u){for(const m in e){const y=e[m],x={x:0,y:0,w:y.data.width+2,h:y.data.height+2};u.push(x),s[m]=new Hh(x,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(m)}}patchUpdatedImages(e,s){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in e.updatedImages)this.patchUpdatedImage(this.iconPositions[u],e.getImage(u),s),this.patchUpdatedImage(this.patternPositions[u],e.getImage(u),s)}patchUpdatedImage(e,s,u){if(!e||!s||e.version===s.version)return;e.version=s.version;const[m,y]=e.tl;u.update(s.data,void 0,{x:m,y})}}Et("ImagePosition",Hh),Et("ImageAtlas",nd),o.WritingMode=void 0,(bs=o.WritingMode||(o.WritingMode={}))[bs.none=0]="none",bs[bs.horizontal=1]="horizontal",bs[bs.vertical=2]="vertical",bs[bs.horizontalOnly=3]="horizontalOnly";const ou=-17;class ql{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,s){const u=new ql;return u.scale=e||1,u.fontStack=s,u}static forImage(e){const s=new ql;return s.imageName=e,s}}class jo{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,s){const u=new jo;for(let m=0;m<e.sections.length;m++){const y=e.sections[m];y.image?u.addImageSection(y):u.addTextSection(y,s)}return u}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let s="";for(let u=0;u<e.length;u++){const m=e.charCodeAt(u+1)||null,y=e.charCodeAt(u-1)||null;s+=m&&jc(m)&&!Vl[e[u+1]]||y&&jc(y)&&!Vl[e[u-1]]||!Vl[e[u]]?e[u]:Vl[e[u]]}return s}(this.text)}trim(){let e=0;for(let u=0;u<this.text.length&&cu[this.text.charCodeAt(u)];u++)e++;let s=this.text.length;for(let u=this.text.length-1;u>=0&&u>=e&&cu[this.text.charCodeAt(u)];u--)s--;this.text=this.text.substring(e,s),this.sectionIndex=this.sectionIndex.slice(e,s)}substring(e,s){const u=new jo;return u.text=this.text.substring(e,s),u.sectionIndex=this.sectionIndex.slice(e,s),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,s)=>Math.max(e,this.sections[s].scale),0)}addTextSection(e,s){this.text+=e.text,this.sections.push(ql.forText(e.scale,e.fontStack||s));const u=this.sections.length-1;for(let m=0;m<e.text.length;++m)this.sectionIndex.push(u)}addImageSection(e){const s=e.image?e.image.name:"";if(s.length===0)return void le("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(ql.forImage(s)),this.sectionIndex.push(this.sections.length-1)):le("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function lu(r,e,s,u,m,y,x,T,C,M,R,F,V,Z,H,oe){const re=jo.fromFeature(r,m);let Se;F===o.WritingMode.vertical&&re.verticalizePunctuation();const{processBidirectionalText:De,processStyledBidirectionalText:we}=yr;if(De&&re.sections.length===1){Se=[];const Xe=De(re.toString(),Wh(re,M,y,e,u,Z,H));for(const bt of Xe){const Ct=new jo;Ct.text=bt,Ct.sections=re.sections;for(let _t=0;_t<bt.length;_t++)Ct.sectionIndex.push(0);Se.push(Ct)}}else if(we){Se=[];const Xe=we(re.text,re.sectionIndex,Wh(re,M,y,e,u,Z,H));for(const bt of Xe){const Ct=new jo;Ct.text=bt[0],Ct.sectionIndex=bt[1],Ct.sections=re.sections,Se.push(Ct)}}else Se=function(Xe,bt){const Ct=[],_t=Xe.text;let pt=0;for(const lt of bt)Ct.push(Xe.substring(pt,lt)),pt=lt;return pt<_t.length&&Ct.push(Xe.substring(pt,_t.length)),Ct}(re,Wh(re,M,y,e,u,Z,H));const Pe=[],Ke={positionedLines:Pe,text:re.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:F,iconsInText:!1,verticalizable:!1};return function(Xe,bt,Ct,_t,pt,lt,yt,dt,at,Rt,zt,ni){let Oi=0,Zi=ou,mn=0,Fr=0;const Pn=dt==="right"?1:dt==="left"?0:.5;let un=0;for(const hn of pt){hn.trim();const Dn=hn.getMaxScale(),Gn=(Dn-1)*Cn,Yn={positionedGlyphs:[],lineOffset:0};Xe.positionedLines[un]=Yn;const or=Yn.positionedGlyphs;let lr=0;if(!hn.length()){Zi+=lt,++un;continue}for(let wn=0;wn<hn.length();wn++){const ui=hn.getSection(wn),br=hn.getSectionIndex(wn),Ln=hn.getCharCode(wn);let Zn=0,Hr=null,oa=null,la=null,Xa=Cn;const Wr=!(at===o.WritingMode.horizontal||!zt&&!wl(Ln)||zt&&(cu[Ln]||(bn=Ln,gt.Arabic(bn)||gt["Arabic Supplement"](bn)||gt["Arabic Extended-A"](bn)||gt["Arabic Presentation Forms-A"](bn)||gt["Arabic Presentation Forms-B"](bn))));if(ui.imageName){const Or=_t[ui.imageName];if(!Or)continue;la=ui.imageName,Xe.iconsInText=Xe.iconsInText||!0,oa=Or.paddedRect;const cr=Or.displaySize;ui.scale=ui.scale*Cn/ni,Hr={width:cr[0],height:cr[1],left:1,top:-3,advance:Wr?cr[1]:cr[0]},Zn=Gn+(Cn-cr[1]*ui.scale),Xa=Hr.advance;const Ka=Wr?cr[0]*ui.scale-Cn*Dn:cr[1]*ui.scale-Cn*Dn;Ka>0&&Ka>lr&&(lr=Ka)}else{const Or=Ct[ui.fontStack],cr=Or&&Or[Ln];if(cr&&cr.rect)oa=cr.rect,Hr=cr.metrics;else{const Ka=bt[ui.fontStack],Hl=Ka&&Ka[Ln];if(!Hl)continue;Hr=Hl.metrics}Zn=(Dn-ui.scale)*Cn}Wr?(Xe.verticalizable=!0,or.push({glyph:Ln,imageName:la,x:Oi,y:Zi+Zn,vertical:Wr,scale:ui.scale,fontStack:ui.fontStack,sectionIndex:br,metrics:Hr,rect:oa}),Oi+=Xa*ui.scale+Rt):(or.push({glyph:Ln,imageName:la,x:Oi,y:Zi+Zn,vertical:Wr,scale:ui.scale,fontStack:ui.fontStack,sectionIndex:br,metrics:Hr,rect:oa}),Oi+=Hr.advance*ui.scale+Rt)}or.length!==0&&(mn=Math.max(Oi-Rt,mn),P0(or,0,or.length-1,Pn,lr)),Oi=0;const Ki=lt*Dn+lr;Yn.lineOffset=Math.max(lr,Gn),Zi+=Ki,Fr=Math.max(Ki,Fr),++un}var bn;const zn=Zi-ou,{horizontalAlign:qn,verticalAlign:sr}=Xh(yt);(function(hn,Dn,Gn,Yn,or,lr,Ki,wn,ui){const br=(Dn-Gn)*or;let Ln=0;Ln=lr!==Ki?-wn*Yn-ou:(-Yn*ui+.5)*Ki;for(const Zn of hn)for(const Hr of Zn.positionedGlyphs)Hr.x+=br,Hr.y+=Ln})(Xe.positionedLines,Pn,qn,sr,mn,Fr,lt,zn,pt.length),Xe.top+=-sr*zn,Xe.bottom=Xe.top+zn,Xe.left+=-qn*mn,Xe.right=Xe.left+mn}(Ke,e,s,u,Se,x,T,C,F,M,V,oe),!function(Xe){for(const bt of Xe)if(bt.positionedGlyphs.length!==0)return!1;return!0}(Pe)&&Ke}const cu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},I0={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function rd(r,e,s,u,m,y){if(e.imageName){const x=u[e.imageName];return x?x.displaySize[0]*e.scale*Cn/y+m:0}{const x=s[e.fontStack],T=x&&x[r];return T?T.metrics.advance*e.scale+m:0}}function ad(r,e,s,u){const m=Math.pow(r-e,2);return u?r<e?m/2:2*m:m+Math.abs(s)*s}function M0(r,e,s){let u=0;return r===10&&(u-=1e4),s&&(u+=150),r!==40&&r!==65288||(u+=50),e!==41&&e!==65289||(u+=50),u}function sd(r,e,s,u,m,y){let x=null,T=ad(e,s,m,y);for(const C of u){const M=ad(e-C.x,s,m,y)+C.badness;M<=T&&(x=C,T=M)}return{index:r,x:e,priorBreak:x,badness:T}}function od(r){return r?od(r.priorBreak).concat(r.index):[]}function Wh(r,e,s,u,m,y,x){if(y!=="point")return[];if(!r)return[];const T=[],C=function(V,Z,H,oe,re,Se){let De=0;for(let we=0;we<V.length();we++){const Pe=V.getSection(we);De+=rd(V.getCharCode(we),Pe,oe,re,Z,Se)}return De/Math.max(1,Math.ceil(De/H))}(r,e,s,u,m,x),M=r.text.indexOf("​")>=0;let R=0;for(let V=0;V<r.length();V++){const Z=r.getSection(V),H=r.getCharCode(V);if(cu[H]||(R+=rd(H,Z,u,m,e,x)),V<r.length()-1){const oe=!((F=H)<11904||!(gt["Bopomofo Extended"](F)||gt.Bopomofo(F)||gt["CJK Compatibility Forms"](F)||gt["CJK Compatibility Ideographs"](F)||gt["CJK Compatibility"](F)||gt["CJK Radicals Supplement"](F)||gt["CJK Strokes"](F)||gt["CJK Symbols and Punctuation"](F)||gt["CJK Unified Ideographs Extension A"](F)||gt["CJK Unified Ideographs"](F)||gt["Enclosed CJK Letters and Months"](F)||gt["Halfwidth and Fullwidth Forms"](F)||gt.Hiragana(F)||gt["Ideographic Description Characters"](F)||gt["Kangxi Radicals"](F)||gt["Katakana Phonetic Extensions"](F)||gt.Katakana(F)||gt["Vertical Forms"](F)||gt["Yi Radicals"](F)||gt["Yi Syllables"](F)));(I0[H]||oe||Z.imageName)&&T.push(sd(V+1,R,C,T,M0(H,r.getCharCode(V+1),oe&&M),!1))}}var F;return od(sd(r.length(),R,C,T,0,!0))}function Xh(r){let e=.5,s=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:e,verticalAlign:s}}function P0(r,e,s,u,m){if(!u&&!m)return;const y=r[s],x=(r[s].x+y.metrics.advance*y.scale)*u;for(let T=e;T<=s;T++)r[T].x-=x,r[T].y+=m}function z0(r,e,s){const{horizontalAlign:u,verticalAlign:m}=Xh(s),y=e[0]-r.displaySize[0]*u,x=e[1]-r.displaySize[1]*m;return{image:r,top:x,bottom:x+r.displaySize[1],left:y,right:y+r.displaySize[0]}}function ld(r,e,s,u,m,y){const x=r.image;let T;if(x.content){const re=x.content,Se=x.pixelRatio||1;T=[re[0]/Se,re[1]/Se,x.displaySize[0]-re[2]/Se,x.displaySize[1]-re[3]/Se]}const C=e.left*y,M=e.right*y;let R,F,V,Z;s==="width"||s==="both"?(Z=m[0]+C-u[3],F=m[0]+M+u[1]):(Z=m[0]+(C+M-x.displaySize[0])/2,F=Z+x.displaySize[0]);const H=e.top*y,oe=e.bottom*y;return s==="height"||s==="both"?(R=m[1]+H-u[0],V=m[1]+oe+u[2]):(R=m[1]+(H+oe-x.displaySize[1])/2,V=R+x.displaySize[1]),{image:x,top:R,right:F,bottom:V,left:Z,collisionPadding:T}}const Wa=128;function cd(r,e){const{expression:s}=e;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new qi(r+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:m}=s;let y=0;for(;y<u.length&&u[y]<=r;)y++;y=Math.max(0,y-1);let x=y;for(;x<u.length&&u[x]<r+1;)x++;x=Math.min(u.length-1,x);const T=u[y],C=u[x];return s.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:C,interpolationType:m}:{kind:"camera",minZoom:T,maxZoom:C,minSize:s.evaluate(new qi(T)),maxSize:s.evaluate(new qi(C)),interpolationType:m}}}class ws extends xe{constructor(e,s,u,m){super(e,s),this.angle=u,m!==void 0&&(this.segment=m)}clone(){return new ws(this.x,this.y,this.angle,this.segment)}}function ud(r,e,s,u,m){if(e.segment===void 0)return!0;let y=e,x=e.segment+1,T=0;for(;T>-s/2;){if(x--,x<0)return!1;T-=r[x].dist(y),y=r[x]}T+=r[x].dist(r[x+1]),x++;const C=[];let M=0;for(;T<s/2;){const R=r[x],F=r[x+1];if(!F)return!1;let V=r[x-1].angleTo(R)-R.angleTo(F);for(V=Math.abs((V+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:T,angleDelta:V}),M+=V;T-C[0].distance>u;)M-=C.shift().angleDelta;if(M>m)return!1;x++,T+=R.dist(F)}return!0}function hd(r){let e=0;for(let s=0;s<r.length-1;s++)e+=r[s].dist(r[s+1]);return e}function fd(r,e,s){return r?.6*e*s:0}function pd(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function D0(r,e,s,u,m,y){const x=fd(s,m,y),T=pd(s,u)*y;let C=0;const M=hd(r)/2;for(let R=0;R<r.length-1;R++){const F=r[R],V=r[R+1],Z=F.dist(V);if(C+Z>M){const H=(M-C)/Z,oe=Ri(F.x,V.x,H),re=Ri(F.y,V.y,H),Se=new ws(oe,re,V.angleTo(F),R);return Se._round(),!x||ud(r,Se,T,x,e)?Se:void 0}C+=Z}}function L0(r,e,s,u,m,y,x,T,C){const M=fd(u,y,x),R=pd(u,m),F=R*x,V=r[0].x===0||r[0].x===C||r[0].y===0||r[0].y===C;return e-F<e/4&&(e=F+e/4),dd(r,V?e/2*T%e:(R/2+2*y)*x*T%e,e,M,s,F,V,!1,C)}function dd(r,e,s,u,m,y,x,T,C){const M=y/2,R=hd(r);let F=0,V=e-s,Z=[];for(let H=0;H<r.length-1;H++){const oe=r[H],re=r[H+1],Se=oe.dist(re),De=re.angleTo(oe);for(;V+s<F+Se;){V+=s;const we=(V-F)/Se,Pe=Ri(oe.x,re.x,we),Ke=Ri(oe.y,re.y,we);if(Pe>=0&&Pe<C&&Ke>=0&&Ke<C&&V-M>=0&&V+M<=R){const Xe=new ws(Pe,Ke,De,H);Xe._round(),u&&!ud(r,Xe,y,u,m)||Z.push(Xe)}}F+=Se}return T||Z.length||x||(Z=dd(r,F/2,s,u,m,y,x,!0,C)),Z}function md(r,e,s,u,m){const y=[];for(let x=0;x<r.length;x++){const T=r[x];let C;for(let M=0;M<T.length-1;M++){let R=T[M],F=T[M+1];R.x<e&&F.x<e||(R.x<e?R=new xe(e,R.y+(e-R.x)/(F.x-R.x)*(F.y-R.y))._round():F.x<e&&(F=new xe(e,R.y+(e-R.x)/(F.x-R.x)*(F.y-R.y))._round()),R.y<s&&F.y<s||(R.y<s?R=new xe(R.x+(s-R.y)/(F.y-R.y)*(F.x-R.x),s)._round():F.y<s&&(F=new xe(R.x+(s-R.y)/(F.y-R.y)*(F.x-R.x),s)._round()),R.x>=u&&F.x>=u||(R.x>=u?R=new xe(u,R.y+(u-R.x)/(F.x-R.x)*(F.y-R.y))._round():F.x>=u&&(F=new xe(u,R.y+(u-R.x)/(F.x-R.x)*(F.y-R.y))._round()),R.y>=m&&F.y>=m||(R.y>=m?R=new xe(R.x+(m-R.y)/(F.y-R.y)*(F.x-R.x),m)._round():F.y>=m&&(F=new xe(R.x+(m-R.y)/(F.y-R.y)*(F.x-R.x),m)._round()),C&&R.equals(C[C.length-1])||(C=[R],y.push(C)),C.push(F)))))}}return y}function gd(r,e,s,u){const m=[],y=r.image,x=y.pixelRatio,T=y.paddedRect.w-2,C=y.paddedRect.h-2,M=r.right-r.left,R=r.bottom-r.top,F=y.stretchX||[[0,T]],V=y.stretchY||[[0,C]],Z=(lt,yt)=>lt+yt[1]-yt[0],H=F.reduce(Z,0),oe=V.reduce(Z,0),re=T-H,Se=C-oe;let De=0,we=H,Pe=0,Ke=oe,Xe=0,bt=re,Ct=0,_t=Se;if(y.content&&u){const lt=y.content;De=uu(F,0,lt[0]),Pe=uu(V,0,lt[1]),we=uu(F,lt[0],lt[2]),Ke=uu(V,lt[1],lt[3]),Xe=lt[0]-De,Ct=lt[1]-Pe,bt=lt[2]-lt[0]-we,_t=lt[3]-lt[1]-Ke}const pt=(lt,yt,dt,at)=>{const Rt=hu(lt.stretch-De,we,M,r.left),zt=fu(lt.fixed-Xe,bt,lt.stretch,H),ni=hu(yt.stretch-Pe,Ke,R,r.top),Oi=fu(yt.fixed-Ct,_t,yt.stretch,oe),Zi=hu(dt.stretch-De,we,M,r.left),mn=fu(dt.fixed-Xe,bt,dt.stretch,H),Fr=hu(at.stretch-Pe,Ke,R,r.top),Pn=fu(at.fixed-Ct,_t,at.stretch,oe),un=new xe(Rt,ni),bn=new xe(Zi,ni),zn=new xe(Zi,Fr),qn=new xe(Rt,Fr),sr=new xe(zt/x,Oi/x),hn=new xe(mn/x,Pn/x),Dn=e*Math.PI/180;if(Dn){const or=Math.sin(Dn),lr=Math.cos(Dn),Ki=[lr,-or,or,lr];un._matMult(Ki),bn._matMult(Ki),qn._matMult(Ki),zn._matMult(Ki)}const Gn=lt.stretch+lt.fixed,Yn=yt.stretch+yt.fixed;return{tl:un,tr:bn,bl:qn,br:zn,tex:{x:y.paddedRect.x+1+Gn,y:y.paddedRect.y+1+Yn,w:dt.stretch+dt.fixed-Gn,h:at.stretch+at.fixed-Yn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:sr,pixelOffsetBR:hn,minFontScaleX:bt/x/M,minFontScaleY:_t/x/R,isSDF:s}};if(u&&(y.stretchX||y.stretchY)){const lt=_d(F,re,H),yt=_d(V,Se,oe);for(let dt=0;dt<lt.length-1;dt++){const at=lt[dt],Rt=lt[dt+1];for(let zt=0;zt<yt.length-1;zt++)m.push(pt(at,yt[zt],Rt,yt[zt+1]))}}else m.push(pt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:C+1}));return m}function uu(r,e,s){let u=0;for(const m of r)u+=Math.max(e,Math.min(s,m[1]))-Math.max(e,Math.min(s,m[0]));return u}function _d(r,e,s){const u=[{fixed:-1,stretch:0}];for(const[m,y]of r){const x=u[u.length-1];u.push({fixed:m-x.stretch,stretch:x.stretch}),u.push({fixed:m-x.stretch,stretch:x.stretch+(y-m)})}return u.push({fixed:e+1,stretch:s}),u}function hu(r,e,s,u){return r/e*s+u}function fu(r,e,s,u){return r-e*s/u}Et("Anchor",ws);class pu{constructor(e,s,u,m,y,x,T,C,M,R){if(this.boxStartIndex=e.length,M){let F=x.top,V=x.bottom;const Z=x.collisionPadding;Z&&(F-=Z[1],V+=Z[3]);let H=V-F;H>0&&(H=Math.max(10,H),this.circleDiameter=H)}else{let F=x.top*T-C[0],V=x.bottom*T+C[2],Z=x.left*T-C[3],H=x.right*T+C[1];const oe=x.collisionPadding;if(oe&&(Z-=oe[0]*T,F-=oe[1]*T,H+=oe[2]*T,V+=oe[3]*T),R){const re=new xe(Z,F),Se=new xe(H,F),De=new xe(Z,V),we=new xe(H,V),Pe=R*Math.PI/180;re._rotate(Pe),Se._rotate(Pe),De._rotate(Pe),we._rotate(Pe),Z=Math.min(re.x,Se.x,De.x,we.x),H=Math.max(re.x,Se.x,De.x,we.x),F=Math.min(re.y,Se.y,De.y,we.y),V=Math.max(re.y,Se.y,De.y,we.y)}e.emplaceBack(s.x,s.y,Z,F,H,V,u,m,y)}this.boxEndIndex=e.length}}class R0{constructor(e=[],s=B0){if(this.data=e,this.length=this.data.length,this.compare=s,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:s,compare:u}=this,m=s[e];for(;e>0;){const y=e-1>>1,x=s[y];if(u(m,x)>=0)break;s[e]=x,e=y}s[e]=m}_down(e){const{data:s,compare:u}=this,m=this.length>>1,y=s[e];for(;e<m;){let x=1+(e<<1),T=s[x];const C=x+1;if(C<this.length&&u(s[C],T)<0&&(x=C,T=s[C]),u(T,y)>=0)break;s[e]=T,e=x}s[e]=y}}function B0(r,e){return r<e?-1:r>e?1:0}function F0(r,e=1,s=!1){let u=1/0,m=1/0,y=-1/0,x=-1/0;const T=r[0];for(let Z=0;Z<T.length;Z++){const H=T[Z];(!Z||H.x<u)&&(u=H.x),(!Z||H.y<m)&&(m=H.y),(!Z||H.x>y)&&(y=H.x),(!Z||H.y>x)&&(x=H.y)}const C=Math.min(y-u,x-m);let M=C/2;const R=new R0([],O0);if(C===0)return new xe(u,m);for(let Z=u;Z<y;Z+=C)for(let H=m;H<x;H+=C)R.push(new Vo(Z+M,H+M,M,r));let F=function(Z){let H=0,oe=0,re=0;const Se=Z[0];for(let De=0,we=Se.length,Pe=we-1;De<we;Pe=De++){const Ke=Se[De],Xe=Se[Pe],bt=Ke.x*Xe.y-Xe.x*Ke.y;oe+=(Ke.x+Xe.x)*bt,re+=(Ke.y+Xe.y)*bt,H+=3*bt}return new Vo(oe/H,re/H,0,Z)}(r),V=R.length;for(;R.length;){const Z=R.pop();(Z.d>F.d||!F.d)&&(F=Z,s&&console.log("found best %d after %d probes",Math.round(1e4*Z.d)/1e4,V)),Z.max-F.d<=e||(M=Z.h/2,R.push(new Vo(Z.p.x-M,Z.p.y-M,M,r)),R.push(new Vo(Z.p.x+M,Z.p.y-M,M,r)),R.push(new Vo(Z.p.x-M,Z.p.y+M,M,r)),R.push(new Vo(Z.p.x+M,Z.p.y+M,M,r)),V+=4)}return s&&(console.log(`num probes: ${V}`),console.log(`best distance: ${F.d}`)),F.p}function O0(r,e){return e.max-r.max}function Vo(r,e,s,u){this.p=new xe(r,e),this.h=s,this.d=function(m,y){let x=!1,T=1/0;for(let C=0;C<y.length;C++){const M=y[C];for(let R=0,F=M.length,V=F-1;R<F;V=R++){const Z=M[R],H=M[V];Z.y>m.y!=H.y>m.y&&m.x<(H.x-Z.x)*(m.y-Z.y)/(H.y-Z.y)+Z.x&&(x=!x),T=Math.min(T,Sp(m,Z,H))}}return(x?1:-1)*Math.sqrt(T)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}const Kh=Number.POSITIVE_INFINITY;function yd(r,e){return e[1]!==Kh?function(s,u,m){let y=0,x=0;switch(u=Math.abs(u),m=Math.abs(m),s){case"top-right":case"top-left":case"top":x=m-7;break;case"bottom-right":case"bottom-left":case"bottom":x=7-m}switch(s){case"top-right":case"bottom-right":case"right":y=-u;break;case"top-left":case"bottom-left":case"left":y=u}return[y,x]}(r,e[0],e[1]):function(s,u){let m=0,y=0;u<0&&(u=0);const x=u/Math.sqrt(2);switch(s){case"top-right":case"top-left":y=x-7;break;case"bottom-right":case"bottom-left":y=7-x;break;case"bottom":y=7-u;break;case"top":y=u-7}switch(s){case"top-right":case"bottom-right":m=-x;break;case"top-left":case"bottom-left":m=x;break;case"left":m=u;break;case"right":m=-u}return[m,y]}(r,e[0])}function Jh(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function U0(r,e,s,u,m,y,x,T,C,M,R){let F=y.textMaxSize.evaluate(e,{});F===void 0&&(F=x);const V=r.layers[0].layout,Z=V.get("icon-offset").evaluate(e,{},R),H=xd(s.horizontal),oe=x/24,re=r.tilePixelRatio*oe,Se=r.tilePixelRatio*F/24,De=r.tilePixelRatio*T,we=r.tilePixelRatio*V.get("symbol-spacing"),Pe=V.get("text-padding")*r.tilePixelRatio,Ke=function(at,Rt,zt,ni=1){const Oi=at.get("icon-padding").evaluate(Rt,{},zt),Zi=Oi&&Oi.values;return[Zi[0]*ni,Zi[1]*ni,Zi[2]*ni,Zi[3]*ni]}(V,e,R,r.tilePixelRatio),Xe=V.get("text-max-angle")/180*Math.PI,bt=V.get("text-rotation-alignment")!=="viewport"&&V.get("symbol-placement")!=="point",Ct=V.get("icon-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",_t=V.get("symbol-placement"),pt=we/2,lt=V.get("icon-text-fit");let yt;u&&lt!=="none"&&(r.allowVerticalPlacement&&s.vertical&&(yt=ld(u,s.vertical,lt,V.get("icon-text-fit-padding"),Z,oe)),H&&(u=ld(u,H,lt,V.get("icon-text-fit-padding"),Z,oe)));const dt=(at,Rt)=>{Rt.x<0||Rt.x>=dn||Rt.y<0||Rt.y>=dn||function(zt,ni,Oi,Zi,mn,Fr,Pn,un,bn,zn,qn,sr,hn,Dn,Gn,Yn,or,lr,Ki,wn,ui,br,Ln,Zn,Hr){const oa=zt.addToLineVertexArray(ni,Oi);let la,Xa,Wr,Or,cr=0,Ka=0,Hl=0,Bd=0,of=-1,lf=-1;const Ja={};let Fd=xn.exports(""),cf=0,uf=0;if(un._unevaluatedLayout.getValue("text-radial-offset")===void 0?[cf,uf]=un.layout.get("text-offset").evaluate(ui,{},Zn).map(ur=>ur*Cn):(cf=un.layout.get("text-radial-offset").evaluate(ui,{},Zn)*Cn,uf=Kh),zt.allowVerticalPlacement&&Zi.vertical){const ur=un.layout.get("text-rotate").evaluate(ui,{},Zn)+90;Wr=new pu(bn,ni,zn,qn,sr,Zi.vertical,hn,Dn,Gn,ur),Pn&&(Or=new pu(bn,ni,zn,qn,sr,Pn,or,lr,Gn,ur))}if(mn){const ur=un.layout.get("icon-rotate").evaluate(ui,{}),Sa=un.layout.get("icon-text-fit")!=="none",Wl=gd(mn,ur,Ln,Sa),Xl=Pn?gd(Pn,ur,Ln,Sa):void 0;Xa=new pu(bn,ni,zn,qn,sr,mn,or,lr,!1,ur),cr=4*Wl.length;const Nd=zt.iconSizeData;let to=null;Nd.kind==="source"?(to=[Wa*un.layout.get("icon-size").evaluate(ui,{})],to[0]>Ts&&le(`${zt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Nd.kind==="composite"&&(to=[Wa*br.compositeIconSizes[0].evaluate(ui,{},Zn),Wa*br.compositeIconSizes[1].evaluate(ui,{},Zn)],(to[0]>Ts||to[1]>Ts)&&le(`${zt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),zt.addSymbols(zt.icon,Wl,to,wn,Ki,ui,o.WritingMode.none,ni,oa.lineStartIndex,oa.lineLength,-1,Zn),of=zt.icon.placedSymbolArray.length-1,Xl&&(Ka=4*Xl.length,zt.addSymbols(zt.icon,Xl,to,wn,Ki,ui,o.WritingMode.vertical,ni,oa.lineStartIndex,oa.lineLength,-1,Zn),lf=zt.icon.placedSymbolArray.length-1)}const Od=Object.keys(Zi.horizontal);for(const ur of Od){const Sa=Zi.horizontal[ur];if(!la){Fd=xn.exports(Sa.text);const Xl=un.layout.get("text-rotate").evaluate(ui,{},Zn);la=new pu(bn,ni,zn,qn,sr,Sa,hn,Dn,Gn,Xl)}const Wl=Sa.positionedLines.length===1;if(Hl+=vd(zt,ni,Sa,Fr,un,Gn,ui,Yn,oa,Zi.vertical?o.WritingMode.horizontal:o.WritingMode.horizontalOnly,Wl?Od:[ur],Ja,of,br,Zn),Wl)break}Zi.vertical&&(Bd+=vd(zt,ni,Zi.vertical,Fr,un,Gn,ui,Yn,oa,o.WritingMode.vertical,["vertical"],Ja,lf,br,Zn));const Q0=la?la.boxStartIndex:zt.collisionBoxArray.length,$0=la?la.boxEndIndex:zt.collisionBoxArray.length,e1=Wr?Wr.boxStartIndex:zt.collisionBoxArray.length,t1=Wr?Wr.boxEndIndex:zt.collisionBoxArray.length,i1=Xa?Xa.boxStartIndex:zt.collisionBoxArray.length,n1=Xa?Xa.boxEndIndex:zt.collisionBoxArray.length,r1=Or?Or.boxStartIndex:zt.collisionBoxArray.length,a1=Or?Or.boxEndIndex:zt.collisionBoxArray.length;let ca=-1;const yu=(ur,Sa)=>ur&&ur.circleDiameter?Math.max(ur.circleDiameter,Sa):Sa;ca=yu(la,ca),ca=yu(Wr,ca),ca=yu(Xa,ca),ca=yu(Or,ca);const Ud=ca>-1?1:0;Ud&&(ca*=Hr/Cn),zt.glyphOffsetArray.length>=qo.MAX_GLYPHS&&le("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ui.sortKey!==void 0&&zt.addToSortKeyRanges(zt.symbolInstances.length,ui.sortKey),zt.symbolInstances.emplaceBack(ni.x,ni.y,Ja.right>=0?Ja.right:-1,Ja.center>=0?Ja.center:-1,Ja.left>=0?Ja.left:-1,Ja.vertical||-1,of,lf,Fd,Q0,$0,e1,t1,i1,n1,r1,a1,zn,Hl,Bd,cr,Ka,Ud,0,hn,cf,uf,ca)}(r,Rt,at,s,u,m,yt,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,re,[Pe,Pe,Pe,Pe],bt,C,De,Ke,Ct,Z,e,y,M,R,x)};if(_t==="line")for(const at of md(e.geometry,0,0,dn,dn)){const Rt=L0(at,we,Xe,s.vertical||H,u,24,Se,r.overscaling,dn);for(const zt of Rt){const ni=H;ni&&N0(r,ni.text,pt,zt)||dt(at,zt)}}else if(_t==="line-center"){for(const at of e.geometry)if(at.length>1){const Rt=D0(at,Xe,s.vertical||H,u,24,Se);Rt&&dt(at,Rt)}}else if(e.type==="Polygon")for(const at of Fh(e.geometry,0)){const Rt=F0(at,16);dt(at[0],new ws(Rt.x,Rt.y,0))}else if(e.type==="LineString")for(const at of e.geometry)dt(at,new ws(at[0].x,at[0].y,0));else if(e.type==="Point")for(const at of e.geometry)for(const Rt of at)dt([Rt],new ws(Rt.x,Rt.y,0))}const Ts=32640;function vd(r,e,s,u,m,y,x,T,C,M,R,F,V,Z,H){const oe=function(De,we,Pe,Ke,Xe,bt,Ct,_t){const pt=Ke.layout.get("text-rotate").evaluate(bt,{})*Math.PI/180,lt=[];for(const yt of we.positionedLines)for(const dt of yt.positionedGlyphs){if(!dt.rect)continue;const at=dt.rect||{};let Rt=4,zt=!0,ni=1,Oi=0;const Zi=(Xe||_t)&&dt.vertical,mn=dt.metrics.advance*dt.scale/2;if(_t&&we.verticalizable){const Ki=(dt.scale-1)*Cn,wn=(Cn-dt.metrics.width*dt.scale)/2;Oi=yt.lineOffset/2-(dt.imageName?-wn:Ki)}if(dt.imageName){const Ki=Ct[dt.imageName];zt=Ki.sdf,ni=Ki.pixelRatio,Rt=1/ni}const Fr=Xe?[dt.x+mn,dt.y]:[0,0];let Pn=Xe?[0,0]:[dt.x+mn+Pe[0],dt.y+Pe[1]-Oi],un=[0,0];Zi&&(un=Pn,Pn=[0,0]);const bn=(dt.metrics.left-Rt)*dt.scale-mn+Pn[0],zn=(-dt.metrics.top-Rt)*dt.scale+Pn[1],qn=bn+at.w*dt.scale/ni,sr=zn+at.h*dt.scale/ni,hn=new xe(bn,zn),Dn=new xe(qn,zn),Gn=new xe(bn,sr),Yn=new xe(qn,sr);if(Zi){const Ki=new xe(-mn,mn-ou),wn=-Math.PI/2,ui=12-mn,br=new xe(22-ui,-(dt.imageName?ui:0)),Ln=new xe(...un);hn._rotateAround(wn,Ki)._add(br)._add(Ln),Dn._rotateAround(wn,Ki)._add(br)._add(Ln),Gn._rotateAround(wn,Ki)._add(br)._add(Ln),Yn._rotateAround(wn,Ki)._add(br)._add(Ln)}if(pt){const Ki=Math.sin(pt),wn=Math.cos(pt),ui=[wn,-Ki,Ki,wn];hn._matMult(ui),Dn._matMult(ui),Gn._matMult(ui),Yn._matMult(ui)}const or=new xe(0,0),lr=new xe(0,0);lt.push({tl:hn,tr:Dn,bl:Gn,br:Yn,tex:at,writingMode:we.writingMode,glyphOffset:Fr,sectionIndex:dt.sectionIndex,isSDF:zt,pixelOffsetTL:or,pixelOffsetBR:lr,minFontScaleX:0,minFontScaleY:0})}return lt}(0,s,T,m,y,x,u,r.allowVerticalPlacement),re=r.textSizeData;let Se=null;re.kind==="source"?(Se=[Wa*m.layout.get("text-size").evaluate(x,{})],Se[0]>Ts&&le(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):re.kind==="composite"&&(Se=[Wa*Z.compositeTextSizes[0].evaluate(x,{},H),Wa*Z.compositeTextSizes[1].evaluate(x,{},H)],(Se[0]>Ts||Se[1]>Ts)&&le(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),r.addSymbols(r.text,oe,Se,T,y,x,M,e,C.lineStartIndex,C.lineLength,V,H);for(const De of R)F[De]=r.text.placedSymbolArray.length-1;return 4*oe.length}function xd(r){for(const e in r)return r[e];return null}function N0(r,e,s,u){const m=r.compareText;if(e in m){const y=m[e];for(let x=y.length-1;x>=0;x--)if(u.dist(y[x])<s)return!0}else m[e]=[];return m[e].push(u),!1}const j0=xs.VectorTileFeature.types,V0=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function du(r,e,s,u,m,y,x,T,C,M,R,F,V){const Z=T?Math.min(Ts,Math.round(T[0])):0,H=T?Math.min(Ts,Math.round(T[1])):0;r.emplaceBack(e,s,Math.round(32*u),Math.round(32*m),y,x,(Z<<1)+(C?1:0),H,16*M,16*R,256*F,256*V)}function Yh(r,e,s){r.emplaceBack(e.x,e.y,s),r.emplaceBack(e.x,e.y,s),r.emplaceBack(e.x,e.y,s),r.emplaceBack(e.x,e.y,s)}function q0(r){for(const e of r.sections)if(qc(e.text))return!0;return!1}class Qh{constructor(e){this.layoutVertexArray=new Gr,this.indexArray=new Xn,this.programConfigurations=e,this.segments=new oi,this.dynamicLayoutVertexArray=new Lr,this.opacityVertexArray=new Zr,this.placedSymbolArray=new it}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,s,u,m){this.isEmpty()||(u&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,f0.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,p0.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,V0,!0),this.opacityVertexBuffer.itemSize=1),(u||m)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Et("SymbolBuffers",Qh);class $h{constructor(e,s,u){this.layoutVertexArray=new e,this.layoutAttributes=s,this.indexArray=new u,this.segments=new oi,this.collisionVertexArray=new vr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,d0.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Et("CollisionBuffers",$h);class qo{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(x=>x.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ph([]),this.placementViewportMatrix=Ph([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=cd(this.zoom,s["text-size"]),this.iconSizeData=cd(this.zoom,s["icon-size"]);const u=this.layers[0].layout,m=u.get("symbol-sort-key"),y=u.get("symbol-z-order");this.canOverlap=tf(u,"text-overlap","text-allow-overlap")!=="never"||tf(u,"icon-overlap","icon-allow-overlap")!=="never"||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&!m.isConstant(),this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(x=>o.WritingMode[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=e.sourceID}createArrays(){this.text=new Qh(new Js(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Qh(new Js(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new ft,this.lineVertexArray=new xt,this.symbolInstances=new vt}calculateGlyphDependencies(e,s,u,m,y){for(let x=0;x<e.length;x++)if(s[e.charCodeAt(x)]=!0,(u||m)&&y){const T=Vl[e.charAt(x)];T&&(s[T.charCodeAt(0)]=!0)}}populate(e,s,u){const m=this.layers[0],y=m.layout,x=y.get("text-font"),T=y.get("text-field"),C=y.get("icon-image"),M=(T.value.kind!=="constant"||T.value.value instanceof he&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),R=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,F=y.get("symbol-sort-key");if(this.features=[],!M&&!R)return;const V=s.iconDependencies,Z=s.glyphDependencies,H=s.availableImages,oe=new qi(this.zoom);for(const{feature:re,id:Se,index:De,sourceLayerIndex:we}of e){const Pe=m._featureFilter.needGeometry,Ke=Qs(re,Pe);if(!m._featureFilter.filter(oe,Ke,u))continue;let Xe,bt;if(Pe||(Ke.geometry=Ys(re)),M){const _t=m.getValueAndResolveTokens("text-field",Ke,u,H),pt=he.factory(_t);q0(pt)&&(this.hasRTLText=!0),(!this.hasRTLText||Ws()==="unavailable"||this.hasRTLText&&yr.isParsed())&&(Xe=g0(pt,m,Ke))}if(R){const _t=m.getValueAndResolveTokens("icon-image",Ke,u,H);bt=_t instanceof ye?_t:ye.fromString(_t)}if(!Xe&&!bt)continue;const Ct=this.sortFeaturesByKey?F.evaluate(Ke,{},u):void 0;if(this.features.push({id:Se,text:Xe,icon:bt,index:De,sourceLayerIndex:we,geometry:Ke.geometry,properties:re.properties,type:j0[re.type],sortKey:Ct}),bt&&(V[bt.name]=!0),Xe){const _t=x.evaluate(Ke,{},u).join(","),pt=y.get("text-rotation-alignment")!=="viewport"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(o.WritingMode.vertical)>=0;for(const lt of Xe.sections)if(lt.image)V[lt.image.name]=!0;else{const yt=Po(Xe.toString()),dt=lt.fontStack||_t,at=Z[dt]=Z[dt]||{};this.calculateGlyphDependencies(lt.text,at,pt,this.allowVerticalPlacement,yt)}}}y.get("symbol-placement")==="line"&&(this.features=function(re){const Se={},De={},we=[];let Pe=0;function Ke(_t){we.push(re[_t]),Pe++}function Xe(_t,pt,lt){const yt=De[_t];return delete De[_t],De[pt]=yt,we[yt].geometry[0].pop(),we[yt].geometry[0]=we[yt].geometry[0].concat(lt[0]),yt}function bt(_t,pt,lt){const yt=Se[pt];return delete Se[pt],Se[_t]=yt,we[yt].geometry[0].shift(),we[yt].geometry[0]=lt[0].concat(we[yt].geometry[0]),yt}function Ct(_t,pt,lt){const yt=lt?pt[0][pt[0].length-1]:pt[0][0];return`${_t}:${yt.x}:${yt.y}`}for(let _t=0;_t<re.length;_t++){const pt=re[_t],lt=pt.geometry,yt=pt.text?pt.text.toString():null;if(!yt){Ke(_t);continue}const dt=Ct(yt,lt),at=Ct(yt,lt,!0);if(dt in De&&at in Se&&De[dt]!==Se[at]){const Rt=bt(dt,at,lt),zt=Xe(dt,at,we[Rt].geometry);delete Se[dt],delete De[at],De[Ct(yt,we[zt].geometry,!0)]=zt,we[Rt].geometry=null}else dt in De?Xe(dt,at,lt):at in Se?bt(dt,at,lt):(Ke(_t),Se[dt]=Pe-1,De[at]=Pe-1)}return we.filter(_t=>_t.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((re,Se)=>re.sortKey-Se.sortKey)}update(e,s,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,s,this.layers,u),this.icon.programConfigurations.updatePaintArrays(e,s,this.layers,u))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,s){const u=this.lineVertexArray.length;if(e.segment!==void 0){let m=e.dist(s[e.segment+1]),y=e.dist(s[e.segment]);const x={};for(let T=e.segment+1;T<s.length;T++)x[T]={x:s[T].x,y:s[T].y,tileUnitDistanceFromAnchor:m},T<s.length-1&&(m+=s[T+1].dist(s[T]));for(let T=e.segment||0;T>=0;T--)x[T]={x:s[T].x,y:s[T].y,tileUnitDistanceFromAnchor:y},T>0&&(y+=s[T-1].dist(s[T]));for(let T=0;T<s.length;T++){const C=x[T];this.lineVertexArray.emplaceBack(C.x,C.y,C.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(e,s,u,m,y,x,T,C,M,R,F,V){const Z=e.indexArray,H=e.layoutVertexArray,oe=e.segments.prepareSegment(4*s.length,H,Z,this.canOverlap?x.sortKey:void 0),re=this.glyphOffsetArray.length,Se=oe.vertexLength,De=this.allowVerticalPlacement&&T===o.WritingMode.vertical?Math.PI/2:0,we=x.text&&x.text.sections;for(let Pe=0;Pe<s.length;Pe++){const{tl:Ke,tr:Xe,bl:bt,br:Ct,tex:_t,pixelOffsetTL:pt,pixelOffsetBR:lt,minFontScaleX:yt,minFontScaleY:dt,glyphOffset:at,isSDF:Rt,sectionIndex:zt}=s[Pe],ni=oe.vertexLength,Oi=at[1];du(H,C.x,C.y,Ke.x,Oi+Ke.y,_t.x,_t.y,u,Rt,pt.x,pt.y,yt,dt),du(H,C.x,C.y,Xe.x,Oi+Xe.y,_t.x+_t.w,_t.y,u,Rt,lt.x,pt.y,yt,dt),du(H,C.x,C.y,bt.x,Oi+bt.y,_t.x,_t.y+_t.h,u,Rt,pt.x,lt.y,yt,dt),du(H,C.x,C.y,Ct.x,Oi+Ct.y,_t.x+_t.w,_t.y+_t.h,u,Rt,lt.x,lt.y,yt,dt),Yh(e.dynamicLayoutVertexArray,C,De),Z.emplaceBack(ni,ni+1,ni+2),Z.emplaceBack(ni+1,ni+2,ni+3),oe.vertexLength+=4,oe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(at[0]),Pe!==s.length-1&&zt===s[Pe+1].sectionIndex||e.programConfigurations.populatePaintArrays(H.length,x,x.index,{},V,we&&we[zt])}e.placedSymbolArray.emplaceBack(C.x,C.y,re,this.glyphOffsetArray.length-re,Se,M,R,C.segment,u?u[0]:0,u?u[1]:0,m[0],m[1],T,0,!1,0,F)}_addCollisionDebugVertex(e,s,u,m,y,x){return s.emplaceBack(0,0),e.emplaceBack(u.x,u.y,m,y,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(e,s,u,m,y,x,T){const C=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),M=C.vertexLength,R=y.layoutVertexArray,F=y.collisionVertexArray,V=T.anchorX,Z=T.anchorY;this._addCollisionDebugVertex(R,F,x,V,Z,new xe(e,s)),this._addCollisionDebugVertex(R,F,x,V,Z,new xe(u,s)),this._addCollisionDebugVertex(R,F,x,V,Z,new xe(u,m)),this._addCollisionDebugVertex(R,F,x,V,Z,new xe(e,m)),C.vertexLength+=4;const H=y.indexArray;H.emplaceBack(M,M+1),H.emplaceBack(M+1,M+2),H.emplaceBack(M+2,M+3),H.emplaceBack(M+3,M),C.primitiveLength+=4}addDebugCollisionBoxes(e,s,u,m){for(let y=e;y<s;y++){const x=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,m?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,u)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new $h(Ta,Kp.members,aa),this.iconCollisionBox=new $h(Ta,Kp.members,aa);for(let e=0;e<this.symbolInstances.length;e++){const s=this.symbolInstances.get(e);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(e,s,u,m,y,x,T,C,M){const R={};for(let F=s;F<u;F++){const V=e.get(F);R.textBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},R.textFeatureIndex=V.featureIndex;break}for(let F=m;F<y;F++){const V=e.get(F);R.verticalTextBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},R.verticalTextFeatureIndex=V.featureIndex;break}for(let F=x;F<T;F++){const V=e.get(F);R.iconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},R.iconFeatureIndex=V.featureIndex;break}for(let F=C;F<M;F++){const V=e.get(F);R.verticalIconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},R.verticalIconFeatureIndex=V.featureIndex;break}return R}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const u=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,s){const u=e.placedSymbolArray.get(s),m=u.vertexStartIndex+4*u.numGlyphs;for(let y=u.vertexStartIndex;y<m;y+=4)e.indexArray.emplaceBack(y,y+1,y+2),e.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(e),u=Math.cos(e),m=[],y=[],x=[];for(let T=0;T<this.symbolInstances.length;++T){x.push(T);const C=this.symbolInstances.get(T);m.push(0|Math.round(s*C.anchorX+u*C.anchorY)),y.push(C.featureIndex)}return x.sort((T,C)=>m[T]-m[C]||y[C]-y[T]),x}addToSortKeyRanges(e,s){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===s?u.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const u=this.symbolInstances.get(s);this.featureSortOrder.push(u.featureIndex),[u.rightJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.leftJustifiedTextSymbolIndex].forEach((m,y,x)=>{m>=0&&x.indexOf(m)===y&&this.addIndicesForPlacedSymbol(this.text,m)}),u.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,u.verticalPlacedTextSymbolIndex),u.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.placedIconSymbolIndex),u.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Et("SymbolBucket",qo,{omit:["layers","collisionBoxArray","features","compareText"]}),qo.MAX_GLYPHS=65535,qo.addDynamicAttributes=Yh;const G0=new En({"symbol-placement":new Pt(Oe.layout_symbol["symbol-placement"]),"symbol-spacing":new Pt(Oe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Pt(Oe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ot(Oe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Pt(Oe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Pt(Oe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Pt(Oe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Pt(Oe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Pt(Oe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Pt(Oe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ot(Oe.layout_symbol["icon-size"]),"icon-text-fit":new Pt(Oe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Pt(Oe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ot(Oe.layout_symbol["icon-image"]),"icon-rotate":new Ot(Oe.layout_symbol["icon-rotate"]),"icon-padding":new Ot(Oe.layout_symbol["icon-padding"]),"icon-keep-upright":new Pt(Oe.layout_symbol["icon-keep-upright"]),"icon-offset":new Ot(Oe.layout_symbol["icon-offset"]),"icon-anchor":new Ot(Oe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Pt(Oe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Pt(Oe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Pt(Oe.layout_symbol["text-rotation-alignment"]),"text-field":new Ot(Oe.layout_symbol["text-field"]),"text-font":new Ot(Oe.layout_symbol["text-font"]),"text-size":new Ot(Oe.layout_symbol["text-size"]),"text-max-width":new Ot(Oe.layout_symbol["text-max-width"]),"text-line-height":new Pt(Oe.layout_symbol["text-line-height"]),"text-letter-spacing":new Ot(Oe.layout_symbol["text-letter-spacing"]),"text-justify":new Ot(Oe.layout_symbol["text-justify"]),"text-radial-offset":new Ot(Oe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Pt(Oe.layout_symbol["text-variable-anchor"]),"text-anchor":new Ot(Oe.layout_symbol["text-anchor"]),"text-max-angle":new Pt(Oe.layout_symbol["text-max-angle"]),"text-writing-mode":new Pt(Oe.layout_symbol["text-writing-mode"]),"text-rotate":new Ot(Oe.layout_symbol["text-rotate"]),"text-padding":new Pt(Oe.layout_symbol["text-padding"]),"text-keep-upright":new Pt(Oe.layout_symbol["text-keep-upright"]),"text-transform":new Ot(Oe.layout_symbol["text-transform"]),"text-offset":new Ot(Oe.layout_symbol["text-offset"]),"text-allow-overlap":new Pt(Oe.layout_symbol["text-allow-overlap"]),"text-overlap":new Pt(Oe.layout_symbol["text-overlap"]),"text-ignore-placement":new Pt(Oe.layout_symbol["text-ignore-placement"]),"text-optional":new Pt(Oe.layout_symbol["text-optional"])});var ef={paint:new En({"icon-opacity":new Ot(Oe.paint_symbol["icon-opacity"]),"icon-color":new Ot(Oe.paint_symbol["icon-color"]),"icon-halo-color":new Ot(Oe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ot(Oe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ot(Oe.paint_symbol["icon-halo-blur"]),"icon-translate":new Pt(Oe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Pt(Oe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ot(Oe.paint_symbol["text-opacity"]),"text-color":new Ot(Oe.paint_symbol["text-color"],{runtimeType:Wi,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new Ot(Oe.paint_symbol["text-halo-color"]),"text-halo-width":new Ot(Oe.paint_symbol["text-halo-width"]),"text-halo-blur":new Ot(Oe.paint_symbol["text-halo-blur"]),"text-translate":new Pt(Oe.paint_symbol["text-translate"]),"text-translate-anchor":new Pt(Oe.paint_symbol["text-translate-anchor"])}),layout:G0};class bd{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:tr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(e.formattedSection))return s.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Et("FormatSectionOverride",bd,{omit:["defaultValue"]});class mu extends qr{constructor(e){super(e,ef)}recalculate(e,s){if(super.recalculate(e,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const u=this.layout.get("text-writing-mode");if(u){const m=[];for(const y of u)m.indexOf(y)<0&&m.push(y);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,s,u,m){const y=this.layout.get(e).evaluate(s,{},u,m),x=this._unevaluatedLayout._values[e];return x.isDataDriven()||Ls(x.value)||!y?y:function(T,C){return C.replace(/{([^{}]+)}/g,(M,R)=>R in T?String(T[R]):"")}(s.properties,y)}createBucket(e){return new qo(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of ef.paint.overridableProperties){if(!mu.hasPaintOverride(this.layout,e))continue;const s=this.paint.get(e),u=new bd(s),m=new So(u,s.property.specification);let y=null;y=s.value.kind==="constant"||s.value.kind==="source"?new Bs("source",m):new gl("composite",m,s.value.zoomStops),this.paint._values[e]=new Vr(s.property,y,s.parameters)}}_handleOverridablePaintPropertyUpdate(e,s,u){return!(!this.layout||s.isDataDriven()||u.isDataDriven())&&mu.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,s){const u=e.get("text-field"),m=ef.paint.properties[s];let y=!1;const x=T=>{for(const C of T)if(m.overrides&&m.overrides.hasOverride(C))return void(y=!0)};if(u.value.kind==="constant"&&u.value.value instanceof he)x(u.value.value.sections);else if(u.value.kind==="source"){const T=M=>{y||(M instanceof St&&Be(M.value)===Yi?x(M.value.sections):M instanceof To?x(M.sections):M.eachChild(T))},C=u.value;C._styleExpression&&T(C._styleExpression.expression)}return y}}function tf(r,e,s){let u="never";const m=r.get(e);return m?u=m:r.get(s)&&(u="always"),u}var Z0={paint:new En({"background-color":new Pt(Oe.paint_background["background-color"]),"background-pattern":new Al(Oe.paint_background["background-pattern"]),"background-opacity":new Pt(Oe.paint_background["background-opacity"])})},H0={paint:new En({"raster-opacity":new Pt(Oe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Pt(Oe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Pt(Oe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Pt(Oe.paint_raster["raster-brightness-max"]),"raster-saturation":new Pt(Oe.paint_raster["raster-saturation"]),"raster-contrast":new Pt(Oe.paint_raster["raster-contrast"]),"raster-resampling":new Pt(Oe.paint_raster["raster-resampling"]),"raster-fade-duration":new Pt(Oe.paint_raster["raster-fade-duration"])})};class W0 extends qr{constructor(e){super(e,{}),this.onAdd=s=>{this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},this.onRemove=s=>{this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const X0={circle:class extends qr{constructor(r){super(r,Sy)}createBucket(r){return new Ah(r)}queryRadius(r){const e=r;return Dl("circle-radius",this,e)+Dl("circle-stroke-width",this,e)+Qc(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,s,u,m,y,x,T){const C=$c(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,x),M=this.paint.get("circle-radius").evaluate(e,s)+this.paint.get("circle-stroke-width").evaluate(e,s),R=this.paint.get("circle-pitch-alignment")==="map",F=R?C:function(Z,H){return Z.map(oe=>zp(oe,H))}(C,T),V=R?M*x:M;for(const Z of u)for(const H of Z){const oe=R?H:zp(H,T);let re=V;const Se=eu([],[H.x,H.y,0,1],T);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?re*=Se[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(re*=y.cameraToCenterDistance/Se[3]),xy(F,oe,re))return!0}return!1}},heatmap:class extends qr{constructor(r){super(r,Cy),this._updateColorRamp()}createBucket(r){return new Dp(r)}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Rp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends qr{constructor(r){super(r,Ay)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends qr{constructor(r){super(r,Gy)}recalculate(r,e){super.recalculate(r,e);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new Nh(r)}queryRadius(){return Qc(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,s,u,m,y,x){return kp($c(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,x),u)}isTileClipped(){return!0}},"fill-extrusion":class extends qr{constructor(r){super(r,r0)}createBucket(r){return new Vh(r)}queryRadius(){return Qc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(r,e,s,u,m,y,x,T){const C=$c(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,x),M=this.paint.get("fill-extrusion-height").evaluate(e,s),R=this.paint.get("fill-extrusion-base").evaluate(e,s),F=function(Z,H,oe,re){const Se=[];for(const De of Z){const we=[De.x,De.y,0,1];eu(we,we,H),Se.push(new xe(we[0]/we[3],we[1]/we[3]))}return Se}(C,T),V=function(Z,H,oe,re){const Se=[],De=[],we=re[8]*H,Pe=re[9]*H,Ke=re[10]*H,Xe=re[11]*H,bt=re[8]*oe,Ct=re[9]*oe,_t=re[10]*oe,pt=re[11]*oe;for(const lt of Z){const yt=[],dt=[];for(const at of lt){const Rt=at.x,zt=at.y,ni=re[0]*Rt+re[4]*zt+re[12],Oi=re[1]*Rt+re[5]*zt+re[13],Zi=re[2]*Rt+re[6]*zt+re[14],mn=re[3]*Rt+re[7]*zt+re[15],Fr=Zi+Ke,Pn=mn+Xe,un=ni+bt,bn=Oi+Ct,zn=Zi+_t,qn=mn+pt,sr=new xe((ni+we)/Pn,(Oi+Pe)/Pn);sr.z=Fr/Pn,yt.push(sr);const hn=new xe(un/qn,bn/qn);hn.z=zn/qn,dt.push(hn)}Se.push(yt),De.push(dt)}return[Se,De]}(u,R,M,T);return function(Z,H,oe){let re=1/0;kp(oe,H)&&(re=Gp(oe,H[0]));for(let Se=0;Se<H.length;Se++){const De=H[Se],we=Z[Se];for(let Pe=0;Pe<De.length-1;Pe++){const Ke=De[Pe],Xe=[Ke,De[Pe+1],we[Pe+1],we[Pe],Ke];Tp(oe,Xe)&&(re=Math.min(re,Gp(oe,Xe)))}}return re!==1/0&&re}(V[0],V[1],F)}},line:class extends qr{constructor(r){super(r,Hp),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(r){r==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ta,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=Wp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new qh(r)}queryRadius(r){const e=r,s=Xp(Dl("line-width",this,e),Dl("line-gap-width",this,e)),u=Dl("line-offset",this,e);return s/2+Math.abs(u)+Qc(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,s,u,m,y,x){const T=$c(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,x),C=x/2*Xp(this.paint.get("line-width").evaluate(e,s),this.paint.get("line-gap-width").evaluate(e,s)),M=this.paint.get("line-offset").evaluate(e,s);return M&&(u=function(R,F){const V=[];for(let Z=0;Z<R.length;Z++){const H=R[Z],oe=[];for(let re=0;re<H.length;re++){const Se=H[re-1],De=H[re],we=H[re+1],Pe=re===0?new xe(0,0):De.sub(Se)._unit()._perp(),Ke=re===H.length-1?new xe(0,0):we.sub(De)._unit()._perp(),Xe=Pe._add(Ke)._unit(),bt=Xe.x*Ke.x+Xe.y*Ke.y;bt!==0&&Xe._mult(1/bt),oe.push(Xe._mult(F)._add(De))}V.push(oe)}return V}(u,M*x)),function(R,F,V){for(let Z=0;Z<F.length;Z++){const H=F[Z];if(R.length>=3){for(let oe=0;oe<H.length;oe++)if(Bo(R,H[oe]))return!0}if(by(R,H,V))return!0}return!1}(T,u,C)}isTileClipped(){return!0}},symbol:mu,background:class extends qr{constructor(r){super(r,Z0)}},raster:class extends qr{constructor(r){super(r,H0)}}};class K0{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const wd=63710088e-1;class tn{constructor(e,s){if(isNaN(e)||isNaN(s))throw new Error(`Invalid LngLat object: (${e}, ${s})`);if(this.lng=+e,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new tn(L(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const s=Math.PI/180,u=this.lat*s,m=e.lat*s,y=Math.sin(u)*Math.sin(m)+Math.cos(u)*Math.cos(m)*Math.cos((e.lng-this.lng)*s);return wd*Math.acos(Math.min(y,1))}toBounds(e=0){const s=360*e/40075017,u=s/Math.cos(Math.PI/180*this.lat);return new eo(new tn(this.lng-u,this.lat-s),new tn(this.lng+u,this.lat+s))}static convert(e){if(e instanceof tn)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new tn(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new tn(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class eo{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof tn?new tn(e.lng,e.lat):tn.convert(e),this}setSouthWest(e){return this._sw=e instanceof tn?new tn(e.lng,e.lat):tn.convert(e),this}extend(e){const s=this._sw,u=this._ne;let m,y;if(e instanceof tn)m=e,y=e;else{if(!(e instanceof eo))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(eo.convert(e)):this.extend(tn.convert(e)):this;if(m=e._sw,y=e._ne,!m||!y)return this}return s||u?(s.lng=Math.min(m.lng,s.lng),s.lat=Math.min(m.lat,s.lat),u.lng=Math.max(y.lng,u.lng),u.lat=Math.max(y.lat,u.lat)):(this._sw=new tn(m.lng,m.lat),this._ne=new tn(y.lng,y.lat)),this}getCenter(){return new tn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new tn(this.getWest(),this.getNorth())}getSouthEast(){return new tn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:u}=tn.convert(e);let m=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&m}static convert(e){return e instanceof eo?e:e&&new eo(e)}}const Td=2*Math.PI*wd;function kd(r){return Td*Math.cos(r*Math.PI/180)}function Sd(r){return(180+r)/360}function Ed(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function Cd(r,e){return r/kd(e)}function nf(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class gu{constructor(e,s,u=0){this.x=+e,this.y=+s,this.z=+u}static fromLngLat(e,s=0){const u=tn.convert(e);return new gu(Sd(u.lng),Ed(u.lat),Cd(s,u.lat))}toLngLat(){return new tn(360*this.x-180,nf(this.y))}toAltitude(){return this.z*kd(nf(this.y))}meterInMercatorCoordinateUnits(){return 1/Td*(e=nf(this.y),1/Math.cos(e*Math.PI/180));var e}}function Ad(r,e,s){var u=2*Math.PI*6378137/256/Math.pow(2,s);return[r*u-2*Math.PI*6378137/2,e*u-2*Math.PI*6378137/2]}class rf{constructor(e,s,u){if(e<0||e>25||u<0||u>=Math.pow(2,e)||s<0||s>=Math.pow(2,e))throw new Error(`x=${s}, y=${u}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=s,this.y=u,this.key=Gl(0,e,e,s,u)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,s,u){const m=(x=this.y,T=this.z,C=Ad(256*(y=this.x),256*(x=Math.pow(2,T)-x-1),T),M=Ad(256*(y+1),256*(x+1),T),C[0]+","+C[1]+","+M[0]+","+M[1]);var y,x,T,C,M;const R=function(F,V,Z){let H,oe="";for(let re=F;re>0;re--)H=1<<re-1,oe+=(V&H?1:0)+(Z&H?2:0);return oe}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,R).replace(/{bbox-epsg-3857}/g,m)}isChildOf(e){const s=this.z-e.z;return s>0&&e.x===this.x>>s&&e.y===this.y>>s}getTilePoint(e){const s=Math.pow(2,this.z);return new xe((e.x*s-this.x)*dn,(e.y*s-this.y)*dn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Id{constructor(e,s){this.wrap=e,this.canonical=s,this.key=Gl(e,s.z,s.z,s.x,s.y)}}class Br{constructor(e,s,u,m,y){if(e<u)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${u}`);this.overscaledZ=e,this.wrap=s,this.canonical=new rf(u,+m,+y),this.key=Gl(s,e,u,m,y)}clone(){return new Br(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-e;return e>this.canonical.z?new Br(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Br(e,this.wrap,e,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(e,s){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-e;return e>this.canonical.z?Gl(this.wrap*+s,e,this.canonical.z,this.canonical.x,this.canonical.y):Gl(this.wrap*+s,e,e,this.canonical.x>>u,this.canonical.y>>u)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const s=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>s&&e.canonical.y===this.canonical.y>>s}children(e){if(this.overscaledZ>=e)return[new Br(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,u=2*this.canonical.x,m=2*this.canonical.y;return[new Br(s,this.wrap,s,u,m),new Br(s,this.wrap,s,u+1,m),new Br(s,this.wrap,s,u,m+1),new Br(s,this.wrap,s,u+1,m+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Br(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Br(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Id(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new gu(e.x-this.wrap,e.y))}}function Gl(r,e,s,u,m){(r*=2)<0&&(r=-1*r-1);const y=1<<s;return(y*y*r+y*m+u).toString(36)+s.toString(36)+e.toString(36)}Et("CanonicalTileID",rf),Et("OverscaledTileID",Br,{omit:["posMatrix"]});class Md{constructor(e,s,u){if(this.uid=e,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void le(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const m=this.dim=s.height-2;this.data=new Uint32Array(s.data.buffer),this.encoding=u||"mapbox";for(let y=0;y<m;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(m,y)]=this.data[this._idx(m-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,m)]=this.data[this._idx(y,m-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(m,-1)]=this.data[this._idx(m-1,0)],this.data[this._idx(-1,m)]=this.data[this._idx(0,m-1)],this.data[this._idx(m,m)]=this.data[this._idx(m-1,m-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let y=0;y<m;y++)for(let x=0;x<m;x++){const T=this.get(y,x);T>this.max&&(this.max=T),T<this.min&&(this.min=T)}}get(e,s){const u=new Uint8Array(this.data.buffer),m=4*this._idx(e,s);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(u[m],u[m+1],u[m+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(e,s){if(e<-1||e>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(e+1)}_unpackMapbox(e,s,u){return(256*e*256+256*s+u)/10-1e4}_unpackTerrarium(e,s,u){return 256*e+s+u/256-32768}getPixels(){return new Rr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,s,u){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let m=s*this.dim,y=s*this.dim+this.dim,x=u*this.dim,T=u*this.dim+this.dim;switch(s){case-1:m=y-1;break;case 1:y=m+1}switch(u){case-1:x=T-1;break;case 1:T=x+1}const C=-s*this.dim,M=-u*this.dim;for(let R=x;R<T;R++)for(let F=m;F<y;F++)this.data[this._idx(F,R)]=e.data[this._idx(F+C,R+M)]}}Et("DEMData",Md);class Pd{constructor(e){this._stringToNumber={},this._numberToString=[];for(let s=0;s<e.length;s++){const u=e[s];this._stringToNumber[u]=s,this._numberToString[s]=u}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class zd{constructor(e,s,u,m,y){this.type="Feature",this._vectorTileFeature=e,e._z=s,e._x=u,e._y=m,this.properties=e.properties,this.id=y}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(e[s]=this[s]);return e}}class Dd{constructor(e,s){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Hs(dn,16,0),this.grid3D=new Hs(dn,16,0),this.featureIndexArray=new ii,this.promoteId=s}insert(e,s,u,m,y,x){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,m,y);const C=x?this.grid3D:this.grid;for(let M=0;M<s.length;M++){const R=s[M],F=[1/0,1/0,-1/0,-1/0];for(let V=0;V<R.length;V++){const Z=R[V];F[0]=Math.min(F[0],Z.x),F[1]=Math.min(F[1],Z.y),F[2]=Math.max(F[2],Z.x),F[3]=Math.max(F[3],Z.y)}F[0]<dn&&F[1]<dn&&F[2]>=0&&F[3]>=0&&C.insert(T,F[0],F[1],F[2],F[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new xs.VectorTile(new Gh(this.rawTileData)).layers,this.sourceLayerCoder=new Pd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,s,u,m){this.loadVTLayers();const y=e.params||{},x=dn/e.tileSize/e.scale,T=Ao(y.filter),C=e.queryGeometry,M=e.queryPadding*x,R=Rd(C),F=this.grid.query(R.minX-M,R.minY-M,R.maxX+M,R.maxY+M),V=Rd(e.cameraQueryGeometry),Z=this.grid3D.query(V.minX-M,V.minY-M,V.maxX+M,V.maxY+M,(re,Se,De,we)=>function(Pe,Ke,Xe,bt,Ct){for(const pt of Pe)if(Ke<=pt.x&&Xe<=pt.y&&bt>=pt.x&&Ct>=pt.y)return!0;const _t=[new xe(Ke,Xe),new xe(Ke,Ct),new xe(bt,Ct),new xe(bt,Xe)];if(Pe.length>2){for(const pt of _t)if(Bo(Pe,pt))return!0}for(let pt=0;pt<Pe.length-1;pt++)if(Ty(Pe[pt],Pe[pt+1],_t))return!0;return!1}(e.cameraQueryGeometry,re-M,Se-M,De+M,we+M));for(const re of Z)F.push(re);F.sort(J0);const H={};let oe;for(let re=0;re<F.length;re++){const Se=F[re];if(Se===oe)continue;oe=Se;const De=this.featureIndexArray.get(Se);let we=null;this.loadMatchingFeature(H,De.bucketIndex,De.sourceLayerIndex,De.featureIndex,T,y.layers,y.availableImages,s,u,m,(Pe,Ke,Xe)=>(we||(we=Ys(Pe)),Ke.queryIntersectsFeature(C,Pe,Xe,we,this.z,e.transform,x,e.pixelPosMatrix)))}return H}loadMatchingFeature(e,s,u,m,y,x,T,C,M,R,F){const V=this.bucketLayerIDs[s];if(x&&!function(re,Se){for(let De=0;De<re.length;De++)if(Se.indexOf(re[De])>=0)return!0;return!1}(x,V))return;const Z=this.sourceLayerCoder.decode(u),H=this.vtLayers[Z].feature(m);if(y.needGeometry){const re=Qs(H,!0);if(!y.filter(new qi(this.tileID.overscaledZ),re,this.tileID.canonical))return}else if(!y.filter(new qi(this.tileID.overscaledZ),H))return;const oe=this.getId(H,Z);for(let re=0;re<V.length;re++){const Se=V[re];if(x&&x.indexOf(Se)<0)continue;const De=C[Se];if(!De)continue;let we={};oe&&R&&(we=R.getState(De.sourceLayer||"_geojsonTileLayer",oe));const Pe=j({},M[Se]);Pe.paint=Ld(Pe.paint,De.paint,H,we,T),Pe.layout=Ld(Pe.layout,De.layout,H,we,T);const Ke=!F||F(H,De,we);if(!Ke)continue;const Xe=new zd(H,this.z,this.x,this.y,oe);Xe.layer=Pe;let bt=e[Se];bt===void 0&&(bt=e[Se]=[]),bt.push({featureIndex:m,feature:Xe,intersectionZ:Ke})}}lookupSymbolFeatures(e,s,u,m,y,x,T,C){const M={};this.loadVTLayers();const R=Ao(y);for(const F of e)this.loadMatchingFeature(M,u,m,F,R,x,T,C,s);return M}hasLayer(e){for(const s of this.bucketLayerIDs)for(const u of s)if(e===u)return!0;return!1}getId(e,s){let u=e.id;return this.promoteId&&(u=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof u=="boolean"&&(u=Number(u))),u}}function Ld(r,e,s,u,m){return ee(r,(y,x)=>{const T=e instanceof Ks?e.get(x):null;return T&&T.evaluate?T.evaluate(s,u,m):T})}function Rd(r){let e=1/0,s=1/0,u=-1/0,m=-1/0;for(const y of r)e=Math.min(e,y.x),s=Math.min(s,y.y),u=Math.max(u,y.x),m=Math.max(m,y.y);return{minX:e,minY:s,maxX:u,maxY:m}}function J0(r,e){return e-r}var af;Et("FeatureIndex",Dd,{omit:["rawTileData","sourceLayerCoder"]}),o.PerformanceMarkers=void 0,(af=o.PerformanceMarkers||(o.PerformanceMarkers={})).create="create",af.load="load",af.fullLoad="fullLoad";let _u=null,Zl=[];const sf=1e3/30,Y0={mark(r){performance.mark(r)},frame(r){const e=r;_u!=null&&Zl.push(e-_u),_u=e},clearMetrics(){_u=null,Zl=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const r in o.PerformanceMarkers)performance.clearMarks(o.PerformanceMarkers[r])},getPerformanceMetrics(){performance.measure("loadTime",o.PerformanceMarkers.create,o.PerformanceMarkers.load),performance.measure("fullLoadTime",o.PerformanceMarkers.create,o.PerformanceMarkers.fullLoad);const r=performance.getEntriesByName("loadTime")[0].duration,e=performance.getEntriesByName("fullLoadTime")[0].duration,s=Zl.length,u=1/(Zl.reduce((y,x)=>y+x,0)/s/1e3),m=Zl.filter(y=>y>sf).reduce((y,x)=>y+(x-sf)/sf,0);return{loadTime:r,fullLoadTime:e,fps:u,percentDroppedFrames:m/(s+m)*100}}};o.AJAXError=At,o.ARRAY_TYPE=Jn,o.Actor=class{constructor(r,e,s){this.target=r,this.parent=e,this.mapId=s,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},J(["receive","process"],this),this.invoker=new K0(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Je()?r:window}send(r,e,s,u,m=!1){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(this.callbacks[y]=s);const x=ct(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:r,hasCallback:!!s,targetMapId:u,mustQueue:m,sourceMapId:this.mapId,data:Na(e,x)},x),{cancel:()=>{s&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(r){const e=r.data,s=e.id;if(s&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){delete this.tasks[s];const u=this.cancelCallbacks[s];delete this.cancelCallbacks[s],u&&u()}else Je()||e.mustQueue?(this.tasks[s]=e,this.taskQueue.push(s),this.invoker.trigger()):this.processTask(s,e)}process(){if(!this.taskQueue.length)return;const r=this.taskQueue.shift(),e=this.tasks[r];delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(r,e)}processTask(r,e){if(e.type==="<response>"){const s=this.callbacks[r];delete this.callbacks[r],s&&(e.error?s(ya(e.error)):s(null,ya(e.data)))}else{let s=!1;const u=ct(this.globalScope)?void 0:[],m=e.hasCallback?(T,C)=>{s=!0,delete this.cancelCallbacks[r],this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:T?Na(T):null,data:Na(C,u)},u)}:T=>{s=!0};let y=null;const x=ya(e.data);if(this.parent[e.type])y=this.parent[e.type](e.sourceMapId,x,m);else if(this.parent.getWorkerSource){const T=e.type.split(".");y=this.parent.getWorkerSource(e.sourceMapId,T[0],x.source)[T[1]](x,m)}else m(new Error(`Could not find function ${e.type}`));!s&&y&&y.cancel&&(this.cancelCallbacks[r]=y.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.AlphaImage=Rl,o.CanonicalTileID=rf,o.CollisionBoxArray=Ve,o.CollisionCircleLayoutArray=class extends B{},o.Color=X,o.DEMData=Md,o.DataConstantProperty=Pt,o.DictionaryCoder=Pd,o.EXTENT=dn,o.ErrorEvent=Ui,o.EvaluationParameters=qi,o.Event=si,o.Evented=Qi,o.FeatureIndex=Dd,o.FillBucket=Nh,o.FillExtrusionBucket=Vh,o.GeoJSONFeature=zd,o.ImageAtlas=nd,o.ImagePosition=Hh,o.LineBucket=qh,o.LineStripIndexArray=class extends ne{},o.LngLat=tn,o.LngLatBounds=eo,o.MercatorCoordinate=gu,o.ONE_EM=Cn,o.OverscaledTileID=Br,o.PerformanceUtils=Y0,o.PosArray=Lt,o.Properties=En,o.QuadTriangleArray=class extends G{},o.RGBAImage=Rr,o.RasterBoundsArray=class extends d{},o.RequestPerformance=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},o.ResourceType=Qe,o.SegmentVector=oi,o.SymbolBucket=qo,o.Transitionable=Hc,o.TriangleIndexArray=Xn,o.Uniform1f=Ga,o.Uniform1i=class extends qa{constructor(r,e){super(r,e),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},o.Uniform2f=class extends qa{constructor(r,e){super(r,e),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},o.Uniform3f=class extends qa{constructor(r,e){super(r,e),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},o.Uniform4f=Lo,o.UniformColor=vp,o.UniformMatrix4f=class extends qa{constructor(r,e){super(r,e),this.current=yy}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let e=1;e<16;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},o.UnwrappedTileID=Id,o.ValidationError=Ee,o.ZoomHistory=xl,o.add=function(r,e,s){return r[0]=e[0]+s[0],r[1]=e[1]+s[1],r[2]=e[2]+s[2],r},o.addDynamicAttributes=Yh,o.asyncAll=function(r,e,s){if(!r.length)return s(null,[]);let u=r.length;const m=new Array(r.length);let y=null;r.forEach((x,T)=>{e(x,(C,M)=>{C&&(y=C),m[T]=M,--u==0&&s(y,m)})})},o.bezier=E,o.bindAll=J,o.cacheEntryPossiblyAdded=function(r){Jt++,Jt>Ut&&(r.getActor().send("enforceCacheSizeLimit",It),Jt=0)},o.clamp=k,o.clearTileCache=function(r){const e=caches.delete(ut);r&&e.catch(r).then(()=>r())},o.clipLine=md,o.clone=function(r){var e=new Jn(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},o.clone$1=_e,o.clone$2=function(r){var e=new Jn(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e},o.collisionCircleLayout=m0,o.config=Le,o.copy=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},o.create=function(){var r=new Jn(16);return Jn!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},o.create$1=Cp,o.createExpression=Rs,o.createFilter=Ao,o.createLayout=cn,o.createStyleLayer=function(r){return r.type==="custom"?new W0(r):new X0[r.type](r)},o.cross=function(r,e,s){var u=e[0],m=e[1],y=e[2],x=s[0],T=s[1],C=s[2];return r[0]=m*C-y*T,r[1]=y*x-u*C,r[2]=u*T-m*x,r},o.dot=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]},o.dot$1=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]},o.ease=P,o.emitValidationErrors=Mo,o.enforceCacheSizeLimit=function(r){Kt(),Ze&&Ze.then(e=>{e.keys().then(s=>{for(let u=0;u<s.length-r;u++)e.delete(s[u])})})},o.equals=function(r,e){var s=r[0],u=r[1],m=r[2],y=r[3],x=r[4],T=r[5],C=r[6],M=r[7],R=r[8],F=r[9],V=r[10],Z=r[11],H=r[12],oe=r[13],re=r[14],Se=r[15],De=e[0],we=e[1],Pe=e[2],Ke=e[3],Xe=e[4],bt=e[5],Ct=e[6],_t=e[7],pt=e[8],lt=e[9],yt=e[10],dt=e[11],at=e[12],Rt=e[13],zt=e[14],ni=e[15];return Math.abs(s-De)<=Kn*Math.max(1,Math.abs(s),Math.abs(De))&&Math.abs(u-we)<=Kn*Math.max(1,Math.abs(u),Math.abs(we))&&Math.abs(m-Pe)<=Kn*Math.max(1,Math.abs(m),Math.abs(Pe))&&Math.abs(y-Ke)<=Kn*Math.max(1,Math.abs(y),Math.abs(Ke))&&Math.abs(x-Xe)<=Kn*Math.max(1,Math.abs(x),Math.abs(Xe))&&Math.abs(T-bt)<=Kn*Math.max(1,Math.abs(T),Math.abs(bt))&&Math.abs(C-Ct)<=Kn*Math.max(1,Math.abs(C),Math.abs(Ct))&&Math.abs(M-_t)<=Kn*Math.max(1,Math.abs(M),Math.abs(_t))&&Math.abs(R-pt)<=Kn*Math.max(1,Math.abs(R),Math.abs(pt))&&Math.abs(F-lt)<=Kn*Math.max(1,Math.abs(F),Math.abs(lt))&&Math.abs(V-yt)<=Kn*Math.max(1,Math.abs(V),Math.abs(yt))&&Math.abs(Z-dt)<=Kn*Math.max(1,Math.abs(Z),Math.abs(dt))&&Math.abs(H-at)<=Kn*Math.max(1,Math.abs(H),Math.abs(at))&&Math.abs(oe-Rt)<=Kn*Math.max(1,Math.abs(oe),Math.abs(Rt))&&Math.abs(re-zt)<=Kn*Math.max(1,Math.abs(re),Math.abs(zt))&&Math.abs(Se-ni)<=Kn*Math.max(1,Math.abs(Se),Math.abs(ni))},o.evaluateSizeForFeature=function(r,{uSize:e,uSizeT:s},{lowerSize:u,upperSize:m}){return r.kind==="source"?u/Wa:r.kind==="composite"?Ri(u/Wa,m/Wa,s):e},o.evaluateSizeForZoom=function(r,e){let s=0,u=0;if(r.kind==="constant")u=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:m,minZoom:y,maxZoom:x}=r,T=m?k(Vn.interpolationFactor(m,e,y,x),0,1):0;r.kind==="camera"?u=Ri(r.minSize,r.maxSize,T):s=T}return{uSizeT:s,uSize:u}},o.evaluateVariableOffset=yd,o.evented=Cl,o.exported=mt,o.exported$1=li,o.extend=j,o.filterObject=ge,o.fromRotation=function(r,e){var s=Math.sin(e),u=Math.cos(e);return r[0]=u,r[1]=s,r[2]=0,r[3]=-s,r[4]=u,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},o.fromScaling=function(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},o.getAnchorAlignment=Xh,o.getAnchorJustification=Jh,o.getArrayBuffer=Nt,o.getImage=Sn,o.getJSON=function(r,e){return ci(j(r,{type:"json"}),e)},o.getOverlapMode=tf,o.getRTLTextPluginStatus=Ws,o.getReferrer=ei,o.getVideo=function(r,e){const s=window.document.createElement("video");s.muted=!0,s.onloadstart=function(){e(null,s)};for(let u=0;u<r.length;u++){const m=window.document.createElement("source");fi(r[u])||(s.crossOrigin="Anonymous"),m.src=r[u],s.appendChild(m)}return{cancel:()=>{}}},o.identity=Ph,o.invert=function(r,e){var s=e[0],u=e[1],m=e[2],y=e[3],x=e[4],T=e[5],C=e[6],M=e[7],R=e[8],F=e[9],V=e[10],Z=e[11],H=e[12],oe=e[13],re=e[14],Se=e[15],De=s*T-u*x,we=s*C-m*x,Pe=s*M-y*x,Ke=u*C-m*T,Xe=u*M-y*T,bt=m*M-y*C,Ct=R*oe-F*H,_t=R*re-V*H,pt=R*Se-Z*H,lt=F*re-V*oe,yt=F*Se-Z*oe,dt=V*Se-Z*re,at=De*dt-we*yt+Pe*lt+Ke*pt-Xe*_t+bt*Ct;return at?(r[0]=(T*dt-C*yt+M*lt)*(at=1/at),r[1]=(m*yt-u*dt-y*lt)*at,r[2]=(oe*bt-re*Xe+Se*Ke)*at,r[3]=(V*Xe-F*bt-Z*Ke)*at,r[4]=(C*pt-x*dt-M*_t)*at,r[5]=(s*dt-m*pt+y*_t)*at,r[6]=(re*Pe-H*bt-Se*we)*at,r[7]=(R*bt-V*Pe+Z*we)*at,r[8]=(x*yt-T*pt+M*Ct)*at,r[9]=(u*pt-s*yt-y*Ct)*at,r[10]=(H*Xe-oe*Pe+Se*De)*at,r[11]=(F*Pe-R*Xe-Z*De)*at,r[12]=(T*_t-x*lt-C*Ct)*at,r[13]=(s*lt-u*_t+m*Ct)*at,r[14]=(oe*we-H*Ke-re*De)*at,r[15]=(R*Ke-F*we+V*De)*at,r):null},o.isImageBitmap=We,o.isSafari=ct,o.isWorker=Je,o.keysDifference=function(r,e){const s=[];for(const u in r)u in e||s.push(u);return s},o.lazyLoadRTLTextPlugin=function(){yr.isLoading()||yr.isLoaded()||Ws()!=="deferred"||Zc()},o.makeRequest=ci,o.mapObject=ee,o.mercatorXfromLng=Sd,o.mercatorYfromLat=Ed,o.mercatorZfromAltitude=Cd,o.mul=Ey,o.mul$1=function(r,e,s){return r[0]=e[0]*s[0],r[1]=e[1]*s[1],r[2]=e[2]*s[2],r[3]=e[3]*s[3],r},o.multiply=Ap,o.nextPowerOfTwo=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},o.normalize=function(r,e){var s=e[0],u=e[1],m=e[2],y=s*s+u*u+m*m;return y>0&&(y=1/Math.sqrt(y)),r[0]=e[0]*y,r[1]=e[1]*y,r[2]=e[2]*y,r},o.number=Ri,o.ortho=function(r,e,s,u,m,y,x){var T=1/(e-s),C=1/(u-m),M=1/(y-x);return r[0]=-2*T,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*C,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*M,r[11]=0,r[12]=(e+s)*T,r[13]=(m+u)*C,r[14]=(x+y)*M,r[15]=1,r},o.parseCacheControl=ve,o.parseGlyphPbf=function(r){return new Gh(r).readFields(E0,[])},o.pbf=Gh,o.performSymbolLayout=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=dn/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const e=r.bucket.layers[0].layout,s=r.bucket.layers[0]._unevaluatedLayout._values,u={layoutIconSize:s["icon-size"].possiblyEvaluate(new qi(r.bucket.zoom+1),r.canonical),layoutTextSize:s["text-size"].possiblyEvaluate(new qi(r.bucket.zoom+1),r.canonical),textMaxSize:s["text-size"].possiblyEvaluate(new qi(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:C,maxZoom:M}=r.bucket.textSizeData;u.compositeTextSizes=[s["text-size"].possiblyEvaluate(new qi(C),r.canonical),s["text-size"].possiblyEvaluate(new qi(M),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:C,maxZoom:M}=r.bucket.iconSizeData;u.compositeIconSizes=[s["icon-size"].possiblyEvaluate(new qi(C),r.canonical),s["icon-size"].possiblyEvaluate(new qi(M),r.canonical)]}const m=e.get("text-line-height")*Cn,y=e.get("text-rotation-alignment")!=="viewport"&&e.get("symbol-placement")!=="point",x=e.get("text-keep-upright"),T=e.get("text-size");for(const C of r.bucket.features){const M=e.get("text-font").evaluate(C,{},r.canonical).join(","),R=T.evaluate(C,{},r.canonical),F=u.layoutTextSize.evaluate(C,{},r.canonical),V=u.layoutIconSize.evaluate(C,{},r.canonical),Z={horizontal:{},vertical:void 0},H=C.text;let oe,re=[0,0];if(H){const we=H.toString(),Pe=e.get("text-letter-spacing").evaluate(C,{},r.canonical)*Cn,Ke=Th(we)?Pe:0,Xe=e.get("text-anchor").evaluate(C,{},r.canonical),bt=e.get("text-variable-anchor");if(!bt){const yt=e.get("text-radial-offset").evaluate(C,{},r.canonical);re=yt?yd(Xe,[yt*Cn,Kh]):e.get("text-offset").evaluate(C,{},r.canonical).map(dt=>dt*Cn)}let Ct=y?"center":e.get("text-justify").evaluate(C,{},r.canonical);const _t=e.get("symbol-placement"),pt=_t==="point"?e.get("text-max-width").evaluate(C,{},r.canonical)*Cn:0,lt=()=>{r.bucket.allowVerticalPlacement&&Po(we)&&(Z.vertical=lu(H,r.glyphMap,r.glyphPositions,r.imagePositions,M,pt,m,Xe,"left",Ke,re,o.WritingMode.vertical,!0,_t,F,R))};if(!y&&bt){const yt=Ct==="auto"?bt.map(at=>Jh(at)):[Ct];let dt=!1;for(let at=0;at<yt.length;at++){const Rt=yt[at];if(!Z.horizontal[Rt])if(dt)Z.horizontal[Rt]=Z.horizontal[0];else{const zt=lu(H,r.glyphMap,r.glyphPositions,r.imagePositions,M,pt,m,"center",Rt,Ke,re,o.WritingMode.horizontal,!1,_t,F,R);zt&&(Z.horizontal[Rt]=zt,dt=zt.positionedLines.length===1)}}lt()}else{Ct==="auto"&&(Ct=Jh(Xe));const yt=lu(H,r.glyphMap,r.glyphPositions,r.imagePositions,M,pt,m,Xe,Ct,Ke,re,o.WritingMode.horizontal,!1,_t,F,R);yt&&(Z.horizontal[Ct]=yt),lt(),Po(we)&&y&&x&&(Z.vertical=lu(H,r.glyphMap,r.glyphPositions,r.imagePositions,M,pt,m,Xe,Ct,Ke,re,o.WritingMode.vertical,!1,_t,F,R))}}let Se=!1;if(C.icon&&C.icon.name){const we=r.imageMap[C.icon.name];we&&(oe=z0(r.imagePositions[C.icon.name],e.get("icon-offset").evaluate(C,{},r.canonical),e.get("icon-anchor").evaluate(C,{},r.canonical)),Se=!!we.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=Se:r.bucket.sdfIcons!==Se&&le("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(we.pixelRatio!==r.bucket.pixelRatio||e.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const De=xd(Z.horizontal)||Z.vertical;r.bucket.iconsInText=!!De&&De.iconsInText,(De||oe)&&U0(r.bucket,C,Z,oe,r.imageMap,u,F,V,re,Se,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},o.perspective=function(r,e,s,u,m){var y,x=1/Math.tan(e/2);return r[0]=x/s,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=x,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,m!=null&&m!==1/0?(r[10]=(m+u)*(y=1/(u-m)),r[14]=2*m*u*y):(r[10]=-1,r[14]=-2*u),r},o.pick=function(r,e){const s={};for(let u=0;u<e.length;u++){const m=e[u];m in r&&(s[m]=r[m])}return s},o.plugin=yr,o.pointGeometry=xe,o.polygonIntersectsPolygon=Tp,o.potpack=id,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.register=Et,o.registerForPluginStateChange=function(r){return r({pluginStatus:Wn,pluginURL:va}),Cl.on("pluginStateChange",r),r},o.renderColorRamp=Rp,o.rotateX=function(r,e,s){var u=Math.sin(s),m=Math.cos(s),y=e[4],x=e[5],T=e[6],C=e[7],M=e[8],R=e[9],F=e[10],V=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=y*m+M*u,r[5]=x*m+R*u,r[6]=T*m+F*u,r[7]=C*m+V*u,r[8]=M*m-y*u,r[9]=R*m-x*u,r[10]=F*m-T*u,r[11]=V*m-C*u,r},o.rotateZ=function(r,e,s){var u=Math.sin(s),m=Math.cos(s),y=e[0],x=e[1],T=e[2],C=e[3],M=e[4],R=e[5],F=e[6],V=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=y*m+M*u,r[1]=x*m+R*u,r[2]=T*m+F*u,r[3]=C*m+V*u,r[4]=M*m-y*u,r[5]=R*m-x*u,r[6]=F*m-T*u,r[7]=V*m-C*u,r},o.scale=function(r,e,s){var u=s[0],m=s[1],y=s[2];return r[0]=e[0]*u,r[1]=e[1]*u,r[2]=e[2]*u,r[3]=e[3]*u,r[4]=e[4]*m,r[5]=e[5]*m,r[6]=e[6]*m,r[7]=e[7]*m,r[8]=e[8]*y,r[9]=e[9]*y,r[10]=e[10]*y,r[11]=e[11]*y,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},o.scale$1=function(r,e,s){return r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r},o.setCacheLimits=function(r,e){It=r,Ut=e},o.setRTLTextPlugin=function(r,e,s=!1){if(Wn===Tl||Wn===kl||Wn===Sl)throw new Error("setRTLTextPlugin cannot be called multiple times.");va=mt.resolveURL(r),Wn=Tl,El=e,gs(),s||Zc()},o.spec=Oe,o.sphericalToCartesian=function([r,e,s]){return e+=90,e*=Math.PI/180,s*=Math.PI/180,{x:r*Math.cos(e)*Math.sin(s),y:r*Math.sin(e)*Math.sin(s),z:r*Math.cos(s)}},o.sqrLen=function(r){var e=r[0],s=r[1];return e*e+s*s},o.sub=function(r,e,s){return r[0]=e[0]-s[0],r[1]=e[1]-s[1],r[2]=e[2]-s[2],r},o.toEvaluationFeature=Qs,o.transformMat3=function(r,e,s){var u=e[0],m=e[1],y=e[2];return r[0]=u*s[0]+m*s[3]+y*s[6],r[1]=u*s[1]+m*s[4]+y*s[7],r[2]=u*s[2]+m*s[5]+y*s[8],r},o.transformMat4=eu,o.transformMat4$1=function(r,e,s){var u=e[0],m=e[1];return r[0]=s[0]*u+s[4]*m+s[12],r[1]=s[1]*u+s[5]*m+s[13],r},o.translate=function(r,e,s){var u,m,y,x,T,C,M,R,F,V,Z,H,oe=s[0],re=s[1],Se=s[2];return e===r?(r[12]=e[0]*oe+e[4]*re+e[8]*Se+e[12],r[13]=e[1]*oe+e[5]*re+e[9]*Se+e[13],r[14]=e[2]*oe+e[6]*re+e[10]*Se+e[14],r[15]=e[3]*oe+e[7]*re+e[11]*Se+e[15]):(m=e[1],y=e[2],x=e[3],T=e[4],C=e[5],M=e[6],R=e[7],F=e[8],V=e[9],Z=e[10],H=e[11],r[0]=u=e[0],r[1]=m,r[2]=y,r[3]=x,r[4]=T,r[5]=C,r[6]=M,r[7]=R,r[8]=F,r[9]=V,r[10]=Z,r[11]=H,r[12]=u*oe+T*re+F*Se+e[12],r[13]=m*oe+C*re+V*Se+e[13],r[14]=y*oe+M*re+Z*Se+e[14],r[15]=x*oe+R*re+H*Se+e[15]),r},o.triggerPluginCompletionEvent=Gc,o.unicodeBlockLookup=gt,o.uniqueId=function(){return q++},o.validateCustomStyleLayer=function(r){const e=[],s=r.id;return s===void 0&&e.push({message:`layers.${s}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${s}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),e},o.validateLight=vl,o.validateStyle=Zs,o.vectorTile=xs,o.warnOnce=le,o.wrap=L}),p(["./shared"],function(o){function b(K){const D=typeof K;if(D==="number"||D==="boolean"||D==="string"||K==null)return JSON.stringify(K);if(Array.isArray(K)){let X="[";for(const se of K)X+=`${b(se)},`;return`${X}]`}const U=Object.keys(K).sort();let W="{";for(let X=0;X<U.length;X++)W+=`${JSON.stringify(U[X])}:${b(K[U[X]])},`;return`${W}}`}function S(K){let D="";for(const U of o.refProperties)D+=`/${b(K[U])}`;return D}class E{constructor(D){this.keyCache={},D&&this.replace(D)}replace(D){this._layerConfigs={},this._layers={},this.update(D,[])}update(D,U){for(const X of D){this._layerConfigs[X.id]=X;const se=this._layers[X.id]=o.createStyleLayer(X);se._featureFilter=o.createFilter(se.filter),this.keyCache[X.id]&&delete this.keyCache[X.id]}for(const X of U)delete this.keyCache[X],delete this._layerConfigs[X],delete this._layers[X];this.familiesBySource={};const W=function(X,se){const me={};for(let ae=0;ae<X.length;ae++){const ye=se&&se[X[ae].id]||S(X[ae]);se&&(se[X[ae].id]=ye);let Ue=me[ye];Ue||(Ue=me[ye]=[]),Ue.push(X[ae])}const he=[];for(const ae in me)he.push(me[ae]);return he}(Object.values(this._layerConfigs),this.keyCache);for(const X of W){const se=X.map(Ye=>this._layers[Ye.id]),me=se[0];if(me.visibility==="none")continue;const he=me.source||"";let ae=this.familiesBySource[he];ae||(ae=this.familiesBySource[he]={});const ye=me.sourceLayer||"_geojsonTileLayer";let Ue=ae[ye];Ue||(Ue=ae[ye]=[]),Ue.push(se)}}}class P{constructor(D){const U={},W=[];for(const he in D){const ae=D[he],ye=U[he]={};for(const Ue in ae){const Ye=ae[+Ue];if(!Ye||Ye.bitmap.width===0||Ye.bitmap.height===0)continue;const Be={x:0,y:0,w:Ye.bitmap.width+2,h:Ye.bitmap.height+2};W.push(Be),ye[Ue]={rect:Be,metrics:Ye.metrics}}}const{w:X,h:se}=o.potpack(W),me=new o.AlphaImage({width:X||1,height:se||1});for(const he in D){const ae=D[he];for(const ye in ae){const Ue=ae[+ye];if(!Ue||Ue.bitmap.width===0||Ue.bitmap.height===0)continue;const Ye=U[he][ye].rect;o.AlphaImage.copy(Ue.bitmap,me,{x:0,y:0},{x:Ye.x+1,y:Ye.y+1},Ue.bitmap)}}this.image=me,this.positions=U}}o.register("GlyphAtlas",P);class k{constructor(D){this.tileID=new o.OverscaledTileID(D.tileID.overscaledZ,D.tileID.wrap,D.tileID.canonical.z,D.tileID.canonical.x,D.tileID.canonical.y),this.uid=D.uid,this.zoom=D.zoom,this.pixelRatio=D.pixelRatio,this.tileSize=D.tileSize,this.source=D.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=D.showCollisionBoxes,this.collectResourceTiming=!!D.collectResourceTiming,this.returnDependencies=!!D.returnDependencies,this.promoteId=D.promoteId}parse(D,U,W,X,se){this.status="parsing",this.data=D,this.collisionBoxArray=new o.CollisionBoxArray;const me=new o.DictionaryCoder(Object.keys(D.layers).sort()),he=new o.FeatureIndex(this.tileID,this.promoteId);he.bucketLayerIDs=[];const ae={},ye={featureIndex:he,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:W},Ue=U.familiesBySource[this.source];for(const Vt in Ue){const Wt=D.layers[Vt];if(!Wt)continue;Wt.version===1&&o.warnOnce(`Vector tile source "${this.source}" layer "${Vt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ai=me.encode(Vt),wi=[];for(let Xi=0;Xi<Wt.length;Xi++){const Ii=Wt.feature(Xi),$i=he.getId(Ii,Vt);wi.push({feature:Ii,id:$i,index:Xi,sourceLayerIndex:ai})}for(const Xi of Ue[Vt]){const Ii=Xi[0];Ii.source!==this.source&&o.warnOnce(`layer.source = ${Ii.source} does not equal this.source = ${this.source}`),Ii.minzoom&&this.zoom<Math.floor(Ii.minzoom)||Ii.maxzoom&&this.zoom>=Ii.maxzoom||Ii.visibility!=="none"&&(L(Xi,this.zoom,W),(ae[Ii.id]=Ii.createBucket({index:he.bucketLayerIDs.length,layers:Xi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ai,sourceID:this.source})).populate(wi,ye,this.tileID.canonical),he.bucketLayerIDs.push(Xi.map($i=>$i.id)))}}let Ye,Be,kt,St;const ht=o.mapObject(ye.glyphDependencies,Vt=>Object.keys(Vt).map(Number));Object.keys(ht).length?X.send("getGlyphs",{uid:this.uid,stacks:ht},(Vt,Wt)=>{Ye||(Ye=Vt,Be=Wt,ri.call(this))}):Be={};const Dt=Object.keys(ye.iconDependencies);Dt.length?X.send("getImages",{icons:Dt,source:this.source,tileID:this.tileID,type:"icons"},(Vt,Wt)=>{Ye||(Ye=Vt,kt=Wt,ri.call(this))}):kt={};const Bt=Object.keys(ye.patternDependencies);function ri(){if(Ye)return se(Ye);if(Be&&kt&&St){const Vt=new P(Be),Wt=new o.ImageAtlas(kt,St);for(const ai in ae){const wi=ae[ai];wi instanceof o.SymbolBucket?(L(wi.layers,this.zoom,W),o.performSymbolLayout({bucket:wi,glyphMap:Be,glyphPositions:Vt.positions,imageMap:kt,imagePositions:Wt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):wi.hasPattern&&(wi instanceof o.LineBucket||wi instanceof o.FillBucket||wi instanceof o.FillExtrusionBucket)&&(L(wi.layers,this.zoom,W),wi.addFeatures(ye,this.tileID.canonical,Wt.patternPositions))}this.status="done",se(null,{buckets:Object.values(ae).filter(ai=>!ai.isEmpty()),featureIndex:he,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Vt.image,imageAtlas:Wt,glyphMap:this.returnDependencies?Be:null,iconMap:this.returnDependencies?kt:null,glyphPositions:this.returnDependencies?Vt.positions:null})}}Bt.length?X.send("getImages",{icons:Bt,source:this.source,tileID:this.tileID,type:"patterns"},(Vt,Wt)=>{Ye||(Ye=Vt,St=Wt,ri.call(this))}):St={},ri.call(this)}}function L(K,D,U){const W=new o.EvaluationParameters(D);for(const X of K)X.recalculate(W,U)}function j(K,D){const U=o.getArrayBuffer(K.request,(W,X,se,me)=>{W?D(W):X&&D(null,{vectorTile:new o.vectorTile.VectorTile(new o.pbf(X)),rawData:X,cacheControl:se,expires:me})});return()=>{U.cancel(),D()}}class q{constructor(D,U,W,X){this.actor=D,this.layerIndex=U,this.availableImages=W,this.loadVectorData=X||j,this.loading={},this.loaded={}}loadTile(D,U){const W=D.uid;this.loading||(this.loading={});const X=!!(D&&D.request&&D.request.collectResourceTiming)&&new o.RequestPerformance(D.request),se=this.loading[W]=new k(D);se.abort=this.loadVectorData(D,(me,he)=>{if(delete this.loading[W],me||!he)return se.status="done",this.loaded[W]=se,U(me);const ae=he.rawData,ye={};he.expires&&(ye.expires=he.expires),he.cacheControl&&(ye.cacheControl=he.cacheControl);const Ue={};if(X){const Ye=X.finish();Ye&&(Ue.resourceTiming=JSON.parse(JSON.stringify(Ye)))}se.vectorTile=he.vectorTile,se.parse(he.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ye,Be)=>{if(Ye||!Be)return U(Ye);U(null,o.extend({rawTileData:ae.slice(0)},Be,ye,Ue))}),this.loaded=this.loaded||{},this.loaded[W]=se})}reloadTile(D,U){const W=this.loaded,X=D.uid,se=this;if(W&&W[X]){const me=W[X];me.showCollisionBoxes=D.showCollisionBoxes;const he=(ae,ye)=>{const Ue=me.reloadCallback;Ue&&(delete me.reloadCallback,me.parse(me.vectorTile,se.layerIndex,this.availableImages,se.actor,Ue)),U(ae,ye)};me.status==="parsing"?me.reloadCallback=he:me.status==="done"&&(me.vectorTile?me.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor,he):he())}}abortTile(D,U){const W=this.loading,X=D.uid;W&&W[X]&&W[X].abort&&(W[X].abort(),delete W[X]),U()}removeTile(D,U){const W=this.loaded,X=D.uid;W&&W[X]&&delete W[X],U()}}class J{constructor(){this.loaded={}}loadTile(D,U){const{uid:W,encoding:X,rawImageData:se}=D,me=o.isImageBitmap(se)?this.getImageData(se):se,he=new o.DEMData(W,me,X);this.loaded=this.loaded||{},this.loaded[W]=he,U(null,he)}getImageData(D){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(D.width,D.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=D.width,this.offscreenCanvas.height=D.height,this.offscreenCanvasContext.drawImage(D,0,0,D.width,D.height);const U=this.offscreenCanvasContext.getImageData(-1,-1,D.width+2,D.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new o.RGBAImage({width:U.width,height:U.height},U.data)}removeTile(D){const U=this.loaded,W=D.uid;U&&U[W]&&delete U[W]}}var ee=function K(D,U){var W,X=D&&D.type;if(X==="FeatureCollection")for(W=0;W<D.features.length;W++)K(D.features[W],U);else if(X==="GeometryCollection")for(W=0;W<D.geometries.length;W++)K(D.geometries[W],U);else if(X==="Feature")K(D.geometry,U);else if(X==="Polygon")ge(D.coordinates,U);else if(X==="MultiPolygon")for(W=0;W<D.coordinates.length;W++)ge(D.coordinates[W],U);return D};function ge(K,D){if(K.length!==0){_e(K[0],D);for(var U=1;U<K.length;U++)_e(K[U],!D)}}function _e(K,D){for(var U=0,W=0,X=0,se=K.length,me=se-1;X<se;me=X++){var he=(K[X][0]-K[me][0])*(K[me][1]+K[X][1]),ae=U+he;W+=Math.abs(U)>=Math.abs(he)?U-ae+he:he-ae+U,U=ae}U+W>=0!=!!D&&K.reverse()}const Y=o.vectorTile.VectorTileFeature.prototype.toGeoJSON;class le{constructor(D){this._feature=D,this.extent=o.EXTENT,this.type=D.type,this.properties=D.tags,"id"in D&&!isNaN(D.id)&&(this.id=parseInt(D.id,10))}loadGeometry(){if(this._feature.type===1){const D=[];for(const U of this._feature.geometry)D.push([new o.pointGeometry(U[0],U[1])]);return D}{const D=[];for(const U of this._feature.geometry){const W=[];for(const X of U)W.push(new o.pointGeometry(X[0],X[1]));D.push(W)}return D}}toGeoJSON(D,U,W){return Y.call(this,D,U,W)}}class ie{constructor(D){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=D.length,this._features=D}feature(D){return new le(this._features[D])}}var ke={exports:{}},Je=o.pointGeometry,ve=o.vectorTile.VectorTileFeature,pe=Fe;function Fe(K,D){this.options=D||{},this.features=K,this.length=K.length}function $e(K,D){this.id=typeof K.id=="number"?K.id:void 0,this.type=K.type,this.rawGeometry=K.type===1?[K.geometry]:K.geometry,this.properties=K.tags,this.extent=D||4096}Fe.prototype.feature=function(K){return new $e(this.features[K],this.options.extent)},$e.prototype.loadGeometry=function(){var K=this.rawGeometry;this.geometry=[];for(var D=0;D<K.length;D++){for(var U=K[D],W=[],X=0;X<U.length;X++)W.push(new Je(U[X][0],U[X][1]));this.geometry.push(W)}return this.geometry},$e.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var K=this.geometry,D=1/0,U=-1/0,W=1/0,X=-1/0,se=0;se<K.length;se++)for(var me=K[se],he=0;he<me.length;he++){var ae=me[he];D=Math.min(D,ae.x),U=Math.max(U,ae.x),W=Math.min(W,ae.y),X=Math.max(X,ae.y)}return[D,W,U,X]},$e.prototype.toGeoJSON=ve.prototype.toGeoJSON;var ct=o.pbf,We=pe;function mt(K){var D=new ct;return function(U,W){for(var X in U.layers)W.writeMessage(3,xe,U.layers[X])}(K,D),D.finish()}function xe(K,D){var U;D.writeVarintField(15,K.version||1),D.writeStringField(1,K.name||""),D.writeVarintField(5,K.extent||4096);var W={keys:[],values:[],keycache:{},valuecache:{}};for(U=0;U<K.length;U++)W.feature=K.feature(U),D.writeMessage(2,Ne,W);var X=W.keys;for(U=0;U<X.length;U++)D.writeStringField(3,X[U]);var se=W.values;for(U=0;U<se.length;U++)D.writeMessage(4,It,se[U])}function Ne(K,D){var U=K.feature;U.id!==void 0&&D.writeVarintField(1,U.id),D.writeMessage(2,Le,K),D.writeVarintField(3,U.type),D.writeMessage(4,qt,U)}function Le(K,D){var U=K.feature,W=K.keys,X=K.values,se=K.keycache,me=K.valuecache;for(var he in U.properties){var ae=U.properties[he],ye=se[he];if(ae!==null){ye===void 0&&(W.push(he),se[he]=ye=W.length-1),D.writeVarint(ye);var Ue=typeof ae;Ue!=="string"&&Ue!=="boolean"&&Ue!=="number"&&(ae=JSON.stringify(ae));var Ye=Ue+":"+ae,Be=me[Ye];Be===void 0&&(X.push(ae),me[Ye]=Be=X.length-1),D.writeVarint(Be)}}}function ut(K,D){return(D<<3)+(7&K)}function Ze(K){return K<<1^K>>31}function qt(K,D){for(var U=K.loadGeometry(),W=K.type,X=0,se=0,me=U.length,he=0;he<me;he++){var ae=U[he],ye=1;W===1&&(ye=ae.length),D.writeVarint(ut(1,ye));for(var Ue=W===3?ae.length-1:ae.length,Ye=0;Ye<Ue;Ye++){Ye===1&&W!==1&&D.writeVarint(ut(2,Ue-1));var Be=ae[Ye].x-X,kt=ae[Ye].y-se;D.writeVarint(Ze(Be)),D.writeVarint(Ze(kt)),X+=Be,se+=kt}W===3&&D.writeVarint(ut(7,1))}}function It(K,D){var U=typeof K;U==="string"?D.writeStringField(1,K):U==="boolean"?D.writeBooleanField(7,K):U==="number"&&(K%1!=0?D.writeDoubleField(3,K):K<0?D.writeSVarintField(6,K):D.writeVarintField(5,K))}function Ut(K,D,U,W,X,se){if(X-W<=U)return;const me=W+X>>1;Kt(K,D,me,W,X,se%2),Ut(K,D,U,W,me-1,se+1),Ut(K,D,U,me+1,X,se+1)}function Kt(K,D,U,W,X,se){for(;X>W;){if(X-W>600){const ye=X-W+1,Ue=U-W+1,Ye=Math.log(ye),Be=.5*Math.exp(2*Ye/3),kt=.5*Math.sqrt(Ye*Be*(ye-Be)/ye)*(Ue-ye/2<0?-1:1);Kt(K,D,U,Math.max(W,Math.floor(U-Ue*Be/ye+kt)),Math.min(X,Math.floor(U+(ye-Ue)*Be/ye+kt)),se)}const me=D[2*U+se];let he=W,ae=X;for(Jt(K,D,W,U),D[2*X+se]>me&&Jt(K,D,W,X);he<ae;){for(Jt(K,D,he,ae),he++,ae--;D[2*he+se]<me;)he++;for(;D[2*ae+se]>me;)ae--}D[2*W+se]===me?Jt(K,D,W,ae):(ae++,Jt(K,D,ae,X)),ae<=U&&(W=ae+1),U<=ae&&(X=ae-1)}}function Jt(K,D,U,W){li(K,U,W),li(D,2*U,2*W),li(D,2*U+1,2*W+1)}function li(K,D,U){const W=K[D];K[D]=K[U],K[U]=W}function mi(K,D,U,W){const X=K-U,se=D-W;return X*X+se*se}ke.exports=mt,ke.exports.fromVectorTileJs=mt,ke.exports.fromGeojsonVt=function(K,D){D=D||{};var U={};for(var W in K)U[W]=new We(K[W].features,D),U[W].name=W,U[W].version=D.version,U[W].extent=D.extent;return mt({layers:U})},ke.exports.GeoJSONWrapper=We;const Ji=K=>K[0],rt=K=>K[1];class He{constructor(D,U=Ji,W=rt,X=64,se=Float64Array){this.nodeSize=X,this.points=D;const me=D.length<65536?Uint16Array:Uint32Array,he=this.ids=new me(D.length),ae=this.coords=new se(2*D.length);for(let ye=0;ye<D.length;ye++)he[ye]=ye,ae[2*ye]=U(D[ye]),ae[2*ye+1]=W(D[ye]);Ut(he,ae,X,0,he.length-1,0)}range(D,U,W,X){return function(se,me,he,ae,ye,Ue,Ye){const Be=[0,se.length-1,0],kt=[];let St,ht;for(;Be.length;){const Dt=Be.pop(),Bt=Be.pop(),ri=Be.pop();if(Bt-ri<=Ye){for(let ai=ri;ai<=Bt;ai++)St=me[2*ai],ht=me[2*ai+1],St>=he&&St<=ye&&ht>=ae&&ht<=Ue&&kt.push(se[ai]);continue}const Vt=Math.floor((ri+Bt)/2);St=me[2*Vt],ht=me[2*Vt+1],St>=he&&St<=ye&&ht>=ae&&ht<=Ue&&kt.push(se[Vt]);const Wt=(Dt+1)%2;(Dt===0?he<=St:ae<=ht)&&(Be.push(ri),Be.push(Vt-1),Be.push(Wt)),(Dt===0?ye>=St:Ue>=ht)&&(Be.push(Vt+1),Be.push(Bt),Be.push(Wt))}return kt}(this.ids,this.coords,D,U,W,X,this.nodeSize)}within(D,U,W){return function(X,se,me,he,ae,ye){const Ue=[0,X.length-1,0],Ye=[],Be=ae*ae;for(;Ue.length;){const kt=Ue.pop(),St=Ue.pop(),ht=Ue.pop();if(St-ht<=ye){for(let Wt=ht;Wt<=St;Wt++)mi(se[2*Wt],se[2*Wt+1],me,he)<=Be&&Ye.push(X[Wt]);continue}const Dt=Math.floor((ht+St)/2),Bt=se[2*Dt],ri=se[2*Dt+1];mi(Bt,ri,me,he)<=Be&&Ye.push(X[Dt]);const Vt=(kt+1)%2;(kt===0?me-ae<=Bt:he-ae<=ri)&&(Ue.push(ht),Ue.push(Dt-1),Ue.push(Vt)),(kt===0?me+ae>=Bt:he+ae>=ri)&&(Ue.push(Dt+1),Ue.push(St),Ue.push(Vt))}return Ye}(this.ids,this.coords,D,U,W,this.nodeSize)}}const Mt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:K=>K},Qe=Math.fround||(At=new Float32Array(1),K=>(At[0]=+K,At[0]));var At;class ei{constructor(D){this.options=Sn(Object.create(Mt),D),this.trees=new Array(this.options.maxZoom+1)}load(D){const{log:U,minZoom:W,maxZoom:X,nodeSize:se}=this.options;U&&console.time("total time");const me=`prepare ${D.length} points`;U&&console.time(me),this.points=D;let he=[];for(let ae=0;ae<D.length;ae++)D[ae].geometry&&he.push(ci(D[ae],ae));this.trees[X+1]=new He(he,Hn,Tt,se,Float32Array),U&&console.timeEnd(me);for(let ae=X;ae>=W;ae--){const ye=+Date.now();he=this._cluster(he,ae),this.trees[ae]=new He(he,Hn,Tt,se,Float32Array),U&&console.log("z%d: %d clusters in %dms",ae,he.length,+Date.now()-ye)}return U&&console.timeEnd("total time"),this}getClusters(D,U){let W=((D[0]+180)%360+360)%360-180;const X=Math.max(-90,Math.min(90,D[1]));let se=D[2]===180?180:((D[2]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,D[3]));if(D[2]-D[0]>=360)W=-180,se=180;else if(W>se){const Ue=this.getClusters([W,X,180,me],U),Ye=this.getClusters([-180,X,se,me],U);return Ue.concat(Ye)}const he=this.trees[this._limitZoom(U)],ae=he.range(Qt(W),fn(me),Qt(se),fn(X)),ye=[];for(const Ue of ae){const Ye=he.points[Ue];ye.push(Ye.numPoints?Nt(Ye):this.points[Ye.index])}return ye}getChildren(D){const U=this._getOriginId(D),W=this._getOriginZoom(D),X="No cluster with the specified id.",se=this.trees[W];if(!se)throw new Error(X);const me=se.points[U];if(!me)throw new Error(X);const he=this.options.radius/(this.options.extent*Math.pow(2,W-1)),ae=se.within(me.x,me.y,he),ye=[];for(const Ue of ae){const Ye=se.points[Ue];Ye.parentId===D&&ye.push(Ye.numPoints?Nt(Ye):this.points[Ye.index])}if(ye.length===0)throw new Error(X);return ye}getLeaves(D,U,W){const X=[];return this._appendLeaves(X,D,U=U||10,W=W||0,0),X}getTile(D,U,W){const X=this.trees[this._limitZoom(D)],se=Math.pow(2,D),{extent:me,radius:he}=this.options,ae=he/me,ye=(W-ae)/se,Ue=(W+1+ae)/se,Ye={features:[]};return this._addTileFeatures(X.range((U-ae)/se,ye,(U+1+ae)/se,Ue),X.points,U,W,se,Ye),U===0&&this._addTileFeatures(X.range(1-ae/se,ye,1,Ue),X.points,se,W,se,Ye),U===se-1&&this._addTileFeatures(X.range(0,ye,ae/se,Ue),X.points,-1,W,se,Ye),Ye.features.length?Ye:null}getClusterExpansionZoom(D){let U=this._getOriginZoom(D)-1;for(;U<=this.options.maxZoom;){const W=this.getChildren(D);if(U++,W.length!==1)break;D=W[0].properties.cluster_id}return U}_appendLeaves(D,U,W,X,se){const me=this.getChildren(U);for(const he of me){const ae=he.properties;if(ae&&ae.cluster?se+ae.point_count<=X?se+=ae.point_count:se=this._appendLeaves(D,ae.cluster_id,W,X,se):se<X?se++:D.push(he),D.length===W)break}return se}_addTileFeatures(D,U,W,X,se,me){for(const he of D){const ae=U[he],ye=ae.numPoints;let Ue,Ye,Be;if(ye)Ue=fi(ae),Ye=ae.x,Be=ae.y;else{const ht=this.points[ae.index];Ue=ht.properties,Ye=Qt(ht.geometry.coordinates[0]),Be=fn(ht.geometry.coordinates[1])}const kt={type:1,geometry:[[Math.round(this.options.extent*(Ye*se-W)),Math.round(this.options.extent*(Be*se-X))]],tags:Ue};let St;ye?St=ae.id:this.options.generateId?St=ae.index:this.points[ae.index].id&&(St=this.points[ae.index].id),St!==void 0&&(kt.id=St),me.features.push(kt)}}_limitZoom(D){return Math.max(this.options.minZoom,Math.min(Math.floor(+D),this.options.maxZoom+1))}_cluster(D,U){const W=[],{radius:X,extent:se,reduce:me,minPoints:he}=this.options,ae=X/(se*Math.pow(2,U));for(let ye=0;ye<D.length;ye++){const Ue=D[ye];if(Ue.zoom<=U)continue;Ue.zoom=U;const Ye=this.trees[U+1],Be=Ye.within(Ue.x,Ue.y,ae),kt=Ue.numPoints||1;let St=kt;for(const ht of Be){const Dt=Ye.points[ht];Dt.zoom>U&&(St+=Dt.numPoints||1)}if(St>kt&&St>=he){let ht=Ue.x*kt,Dt=Ue.y*kt,Bt=me&&kt>1?this._map(Ue,!0):null;const ri=(ye<<5)+(U+1)+this.points.length;for(const Vt of Be){const Wt=Ye.points[Vt];if(Wt.zoom<=U)continue;Wt.zoom=U;const ai=Wt.numPoints||1;ht+=Wt.x*ai,Dt+=Wt.y*ai,Wt.parentId=ri,me&&(Bt||(Bt=this._map(Ue,!0)),me(Bt,this._map(Wt)))}Ue.parentId=ri,W.push(Ei(ht/St,Dt/St,ri,St,Bt))}else if(W.push(Ue),St>1)for(const ht of Be){const Dt=Ye.points[ht];Dt.zoom<=U||(Dt.zoom=U,W.push(Dt))}}return W}_getOriginId(D){return D-this.points.length>>5}_getOriginZoom(D){return(D-this.points.length)%32}_map(D,U){if(D.numPoints)return U?Sn({},D.properties):D.properties;const W=this.points[D.index].properties,X=this.options.map(W);return U&&X===W?Sn({},X):X}}function Ei(K,D,U,W,X){return{x:Qe(K),y:Qe(D),zoom:1/0,id:U,parentId:-1,numPoints:W,properties:X}}function ci(K,D){const[U,W]=K.geometry.coordinates;return{x:Qe(Qt(U)),y:Qe(fn(W)),zoom:1/0,index:D,parentId:-1}}function Nt(K){return{type:"Feature",id:K.id,properties:fi(K),geometry:{type:"Point",coordinates:[(D=K.x,360*(D-.5)),kn(K.y)]}};var D}function fi(K){const D=K.numPoints,U=D>=1e4?`${Math.round(D/1e3)}k`:D>=1e3?Math.round(D/100)/10+"k":D;return Sn(Sn({},K.properties),{cluster:!0,cluster_id:K.id,point_count:D,point_count_abbreviated:U})}function Qt(K){return K/360+.5}function fn(K){const D=Math.sin(K*Math.PI/180),U=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return U<0?0:U>1?1:U}function kn(K){const D=(180-360*K)*Math.PI/180;return 360*Math.atan(Math.exp(D))/Math.PI-90}function Sn(K,D){for(const U in D)K[U]=D[U];return K}function Hn(K){return K.x}function Tt(K){return K.y}function si(K,D,U,W){for(var X,se=W,me=U-D>>1,he=U-D,ae=K[D],ye=K[D+1],Ue=K[U],Ye=K[U+1],Be=D+3;Be<U;Be+=3){var kt=Ui(K[Be],K[Be+1],ae,ye,Ue,Ye);if(kt>se)X=Be,se=kt;else if(kt===se){var St=Math.abs(Be-me);St<he&&(X=Be,he=St)}}se>W&&(X-D>3&&si(K,D,X,W),K[X+2]=se,U-X>3&&si(K,X,U,W))}function Ui(K,D,U,W,X,se){var me=X-U,he=se-W;if(me!==0||he!==0){var ae=((K-U)*me+(D-W)*he)/(me*me+he*he);ae>1?(U=X,W=se):ae>0&&(U+=me*ae,W+=he*ae)}return(me=K-U)*me+(he=D-W)*he}function Qi(K,D,U,W){var X={id:K===void 0?null:K,type:D,geometry:U,tags:W,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(se){var me=se.geometry,he=se.type;if(he==="Point"||he==="MultiPoint"||he==="LineString")Oe(se,me);else if(he==="Polygon"||he==="MultiLineString")for(var ae=0;ae<me.length;ae++)Oe(se,me[ae]);else if(he==="MultiPolygon")for(ae=0;ae<me.length;ae++)for(var ye=0;ye<me[ae].length;ye++)Oe(se,me[ae][ye])}(X),X}function Oe(K,D){for(var U=0;U<D.length;U+=3)K.minX=Math.min(K.minX,D[U]),K.minY=Math.min(K.minY,D[U+1]),K.maxX=Math.max(K.maxX,D[U]),K.maxY=Math.max(K.maxY,D[U+1])}function Ee(K,D,U,W){if(D.geometry){var X=D.geometry.coordinates,se=D.geometry.type,me=Math.pow(U.tolerance/((1<<U.maxZoom)*U.extent),2),he=[],ae=D.id;if(U.promoteId?ae=D.properties[U.promoteId]:U.generateId&&(ae=W||0),se==="Point")nn(X,he);else if(se==="MultiPoint")for(var ye=0;ye<X.length;ye++)nn(X[ye],he);else if(se==="LineString")sn(X,he,me,!1);else if(se==="MultiLineString"){if(U.lineMetrics){for(ye=0;ye<X.length;ye++)sn(X[ye],he=[],me,!1),K.push(Qi(ae,"LineString",he,D.properties));return}Gt(X,he,me,!1)}else if(se==="Polygon")Gt(X,he,me,!0);else{if(se!=="MultiPolygon"){if(se==="GeometryCollection"){for(ye=0;ye<D.geometry.geometries.length;ye++)Ee(K,{id:ae,geometry:D.geometry.geometries[ye],properties:D.properties},U,W);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ye=0;ye<X.length;ye++){var Ue=[];Gt(X[ye],Ue,me,!0),he.push(Ue)}}K.push(Qi(ae,se,he,D.properties))}}function nn(K,D){D.push(Ni(K[0])),D.push(gn(K[1])),D.push(0)}function sn(K,D,U,W){for(var X,se,me=0,he=0;he<K.length;he++){var ae=Ni(K[he][0]),ye=gn(K[he][1]);D.push(ae),D.push(ye),D.push(0),he>0&&(me+=W?(X*ye-ae*se)/2:Math.sqrt(Math.pow(ae-X,2)+Math.pow(ye-se,2))),X=ae,se=ye}var Ue=D.length-3;D[2]=1,si(D,0,Ue,U),D[Ue+2]=1,D.size=Math.abs(me),D.start=0,D.end=D.size}function Gt(K,D,U,W){for(var X=0;X<K.length;X++){var se=[];sn(K[X],se,U,W),D.push(se)}}function Ni(K){return K/360+.5}function gn(K){var D=Math.sin(K*Math.PI/180),U=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return U<0?0:U>1?1:U}function _n(K,D,U,W,X,se,me,he){if(W/=D,se>=(U/=D)&&me<W)return K;if(me<U||se>=W)return null;for(var ae=[],ye=0;ye<K.length;ye++){var Ue=K[ye],Ye=Ue.geometry,Be=Ue.type,kt=X===0?Ue.minX:Ue.minY,St=X===0?Ue.maxX:Ue.maxY;if(kt>=U&&St<W)ae.push(Ue);else if(!(St<U||kt>=W)){var ht=[];if(Be==="Point"||Be==="MultiPoint")tr(Ye,ht,U,W,X);else if(Be==="LineString")ot(Ye,ht,U,W,X,!1,he.lineMetrics);else if(Be==="MultiLineString")Zt(Ye,ht,U,W,X,!1);else if(Be==="Polygon")Zt(Ye,ht,U,W,X,!0);else if(Be==="MultiPolygon")for(var Dt=0;Dt<Ye.length;Dt++){var Bt=[];Zt(Ye[Dt],Bt,U,W,X,!0),Bt.length&&ht.push(Bt)}if(ht.length){if(he.lineMetrics&&Be==="LineString"){for(Dt=0;Dt<ht.length;Dt++)ae.push(Qi(Ue.id,Be,ht[Dt],Ue.tags));continue}Be!=="LineString"&&Be!=="MultiLineString"||(ht.length===1?(Be="LineString",ht=ht[0]):Be="MultiLineString"),Be!=="Point"&&Be!=="MultiPoint"||(Be=ht.length===3?"Point":"MultiPoint"),ae.push(Qi(Ue.id,Be,ht,Ue.tags))}}}return ae.length?ae:null}function tr(K,D,U,W,X){for(var se=0;se<K.length;se+=3){var me=K[se+X];me>=U&&me<=W&&(D.push(K[se]),D.push(K[se+1]),D.push(K[se+2]))}}function ot(K,D,U,W,X,se,me){for(var he,ae,ye=Xt(K),Ue=X===0?Un:jt,Ye=K.start,Be=0;Be<K.length-3;Be+=3){var kt=K[Be],St=K[Be+1],ht=K[Be+2],Dt=K[Be+3],Bt=K[Be+4],ri=X===0?kt:St,Vt=X===0?Dt:Bt,Wt=!1;me&&(he=Math.sqrt(Math.pow(kt-Dt,2)+Math.pow(St-Bt,2))),ri<U?Vt>U&&(ae=Ue(ye,kt,St,Dt,Bt,U),me&&(ye.start=Ye+he*ae)):ri>W?Vt<W&&(ae=Ue(ye,kt,St,Dt,Bt,W),me&&(ye.start=Ye+he*ae)):Wi(ye,kt,St,ht),Vt<U&&ri>=U&&(ae=Ue(ye,kt,St,Dt,Bt,U),Wt=!0),Vt>W&&ri<=W&&(ae=Ue(ye,kt,St,Dt,Bt,W),Wt=!0),!se&&Wt&&(me&&(ye.end=Ye+he*ae),D.push(ye),ye=Xt(K)),me&&(Ye+=he)}var ai=K.length-3;kt=K[ai],St=K[ai+1],ht=K[ai+2],(ri=X===0?kt:St)>=U&&ri<=W&&Wi(ye,kt,St,ht),ai=ye.length-3,se&&ai>=3&&(ye[ai]!==ye[0]||ye[ai+1]!==ye[1])&&Wi(ye,ye[0],ye[1],ye[2]),ye.length&&D.push(ye)}function Xt(K){var D=[];return D.size=K.size,D.start=K.start,D.end=K.end,D}function Zt(K,D,U,W,X,se){for(var me=0;me<K.length;me++)ot(K[me],D,U,W,X,se,!1)}function Wi(K,D,U,W){K.push(D),K.push(U),K.push(W)}function Un(K,D,U,W,X,se){var me=(se-D)/(W-D);return K.push(se),K.push(U+(X-U)*me),K.push(1),me}function jt(K,D,U,W,X,se){var me=(se-U)/(X-U);return K.push(D+(W-D)*me),K.push(se),K.push(1),me}function An(K,D){for(var U=[],W=0;W<K.length;W++){var X,se=K[W],me=se.type;if(me==="Point"||me==="MultiPoint"||me==="LineString")X=Yi(se.geometry,D);else if(me==="MultiLineString"||me==="Polygon"){X=[];for(var he=0;he<se.geometry.length;he++)X.push(Yi(se.geometry[he],D))}else if(me==="MultiPolygon")for(X=[],he=0;he<se.geometry.length;he++){for(var ae=[],ye=0;ye<se.geometry[he].length;ye++)ae.push(Yi(se.geometry[he][ye],D));X.push(ae)}U.push(Qi(se.id,me,X,se.tags))}return U}function Yi(K,D){var U=[];U.size=K.size,K.start!==void 0&&(U.start=K.start,U.end=K.end);for(var W=0;W<K.length;W+=3)U.push(K[W]+D,K[W+1],K[W+2]);return U}function Ar(K,D){if(K.transformed)return K;var U,W,X,se=1<<K.z,me=K.x,he=K.y;for(U=0;U<K.features.length;U++){var ae=K.features[U],ye=ae.geometry,Ue=ae.type;if(ae.geometry=[],Ue===1)for(W=0;W<ye.length;W+=2)ae.geometry.push(ji(ye[W],ye[W+1],D,se,me,he));else for(W=0;W<ye.length;W++){var Ye=[];for(X=0;X<ye[W].length;X+=2)Ye.push(ji(ye[W][X],ye[W][X+1],D,se,me,he));ae.geometry.push(Ye)}}return K.transformed=!0,K}function ji(K,D,U,W,X,se){return[Math.round(U*(K*W-X)),Math.round(U*(D*W-se))]}function on(K,D,U,W,X){for(var se=D===X.maxZoom?0:X.tolerance/((1<<D)*X.extent),me={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:U,y:W,z:D,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},he=0;he<K.length;he++){me.numFeatures++,bi(me,K[he],se,X);var ae=K[he].minX,ye=K[he].minY,Ue=K[he].maxX,Ye=K[he].maxY;ae<me.minX&&(me.minX=ae),ye<me.minY&&(me.minY=ye),Ue>me.maxX&&(me.maxX=Ue),Ye>me.maxY&&(me.maxY=Ye)}return me}function bi(K,D,U,W){var X=D.geometry,se=D.type,me=[];if(se==="Point"||se==="MultiPoint")for(var he=0;he<X.length;he+=3)me.push(X[he]),me.push(X[he+1]),K.numPoints++,K.numSimplified++;else if(se==="LineString")Ir(me,X,K,U,!1,!1);else if(se==="MultiLineString"||se==="Polygon")for(he=0;he<X.length;he++)Ir(me,X[he],K,U,se==="Polygon",he===0);else if(se==="MultiPolygon")for(var ae=0;ae<X.length;ae++){var ye=X[ae];for(he=0;he<ye.length;he++)Ir(me,ye[he],K,U,!0,he===0)}if(me.length){var Ue=D.tags||null;if(se==="LineString"&&W.lineMetrics){for(var Ye in Ue={},D.tags)Ue[Ye]=D.tags[Ye];Ue.mapbox_clip_start=X.start/X.size,Ue.mapbox_clip_end=X.end/X.size}var Be={geometry:me,type:se==="Polygon"||se==="MultiPolygon"?3:se==="LineString"||se==="MultiLineString"?2:1,tags:Ue};D.id!==null&&(Be.id=D.id),K.features.push(Be)}}function Ir(K,D,U,W,X,se){var me=W*W;if(W>0&&D.size<(X?me:W))U.numPoints+=D.length/3;else{for(var he=[],ae=0;ae<D.length;ae+=3)(W===0||D[ae+2]>me)&&(U.numSimplified++,he.push(D[ae]),he.push(D[ae+1])),U.numPoints++;X&&function(ye,Ue){for(var Ye=0,Be=0,kt=ye.length,St=kt-2;Be<kt;St=Be,Be+=2)Ye+=(ye[Be]-ye[St])*(ye[Be+1]+ye[St+1]);if(Ye>0===Ue)for(Be=0,kt=ye.length;Be<kt/2;Be+=2){var ht=ye[Be],Dt=ye[Be+1];ye[Be]=ye[kt-2-Be],ye[Be+1]=ye[kt-1-Be],ye[kt-2-Be]=ht,ye[kt-1-Be]=Dt}}(he,se),K.push(he)}}function Nn(K,D){var U=(D=this.options=function(X,se){for(var me in se)X[me]=se[me];return X}(Object.create(this.options),D)).debug;if(U&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");var W=function(X,se){var me=[];if(X.type==="FeatureCollection")for(var he=0;he<X.features.length;he++)Ee(me,X.features[he],se,he);else Ee(me,X.type==="Feature"?X:{geometry:X},se);return me}(K,D);this.tiles={},this.tileCoords=[],U&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),W=function(X,se){var me=se.buffer/se.extent,he=X,ae=_n(X,1,-1-me,me,0,-1,2,se),ye=_n(X,1,1-me,2+me,0,-1,2,se);return(ae||ye)&&(he=_n(X,1,-me,1+me,0,-1,2,se)||[],ae&&(he=An(ae,1).concat(he)),ye&&(he=he.concat(An(ye,-1)))),he}(W,D),W.length&&this.splitTile(W,0,0,0),U&&(W.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function _r(K,D,U){return 32*((1<<K)*U+D)+K}function Mr(K,D){const U=K.tileID.canonical;if(!this._geoJSONIndex)return D(null,null);const W=this._geoJSONIndex.getTile(U.z,U.x,U.y);if(!W)return D(null,null);const X=new ie(W.features);let se=ke.exports(X);se.byteOffset===0&&se.byteLength===se.buffer.byteLength||(se=new Uint8Array(se)),D(null,{vectorTile:X,rawData:se.buffer})}Nn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Nn.prototype.splitTile=function(K,D,U,W,X,se,me){for(var he=[K,D,U,W],ae=this.options,ye=ae.debug;he.length;){W=he.pop(),U=he.pop(),D=he.pop(),K=he.pop();var Ue=1<<D,Ye=_r(D,U,W),Be=this.tiles[Ye];if(!Be&&(ye>1&&console.time("creation"),Be=this.tiles[Ye]=on(K,D,U,W,ae),this.tileCoords.push({z:D,x:U,y:W}),ye)){ye>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,U,W,Be.numFeatures,Be.numPoints,Be.numSimplified),console.timeEnd("creation"));var kt="z"+D;this.stats[kt]=(this.stats[kt]||0)+1,this.total++}if(Be.source=K,X){if(D===ae.maxZoom||D===X)continue;var St=1<<X-D;if(U!==Math.floor(se/St)||W!==Math.floor(me/St))continue}else if(D===ae.indexMaxZoom||Be.numPoints<=ae.indexMaxPoints)continue;if(Be.source=null,K.length!==0){ye>1&&console.time("clipping");var ht,Dt,Bt,ri,Vt,Wt,ai=.5*ae.buffer/ae.extent,wi=.5-ai,Xi=.5+ai,Ii=1+ai;ht=Dt=Bt=ri=null,Vt=_n(K,Ue,U-ai,U+Xi,0,Be.minX,Be.maxX,ae),Wt=_n(K,Ue,U+wi,U+Ii,0,Be.minX,Be.maxX,ae),K=null,Vt&&(ht=_n(Vt,Ue,W-ai,W+Xi,1,Be.minY,Be.maxY,ae),Dt=_n(Vt,Ue,W+wi,W+Ii,1,Be.minY,Be.maxY,ae),Vt=null),Wt&&(Bt=_n(Wt,Ue,W-ai,W+Xi,1,Be.minY,Be.maxY,ae),ri=_n(Wt,Ue,W+wi,W+Ii,1,Be.minY,Be.maxY,ae),Wt=null),ye>1&&console.timeEnd("clipping"),he.push(ht||[],D+1,2*U,2*W),he.push(Dt||[],D+1,2*U,2*W+1),he.push(Bt||[],D+1,2*U+1,2*W),he.push(ri||[],D+1,2*U+1,2*W+1)}}},Nn.prototype.getTile=function(K,D,U){var W=this.options,X=W.extent,se=W.debug;if(K<0||K>24)return null;var me=1<<K,he=_r(K,D=(D%me+me)%me,U);if(this.tiles[he])return Ar(this.tiles[he],X);se>1&&console.log("drilling down to z%d-%d-%d",K,D,U);for(var ae,ye=K,Ue=D,Ye=U;!ae&&ye>0;)ye--,Ue=Math.floor(Ue/2),Ye=Math.floor(Ye/2),ae=this.tiles[_r(ye,Ue,Ye)];return ae&&ae.source?(se>1&&console.log("found parent tile z%d-%d-%d",ye,Ue,Ye),se>1&&console.time("drilling down"),this.splitTile(ae.source,ye,Ue,Ye,K,D,U),se>1&&console.timeEnd("drilling down"),this.tiles[he]?Ar(this.tiles[he],X):null):null};class ki extends q{constructor(D,U,W,X){super(D,U,W,Mr),X&&(this.loadGeoJSON=X)}loadData(D,U){var W;(W=this._pendingRequest)===null||W===void 0||W.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const X=!!(D&&D.request&&D.request.collectResourceTiming)&&new o.RequestPerformance(D.request);this._pendingCallback=U,this._pendingRequest=this.loadGeoJSON(D,(se,me)=>{if(delete this._pendingCallback,delete this._pendingRequest,se||!me)return U(se);if(typeof me!="object")return U(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`));{ee(me,!0);try{if(D.filter){const ae=o.createExpression(D.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ae.result==="error")throw new Error(ae.value.map(Ue=>`${Ue.key}: ${Ue.message}`).join(", "));me={type:"FeatureCollection",features:me.features.filter(Ue=>ae.value.evaluate({zoom:0},Ue))}}this._geoJSONIndex=D.cluster?new ei(function({superclusterOptions:ae,clusterProperties:ye}){if(!ye||!ae)return ae;const Ue={},Ye={},Be={accumulated:null,zoom:0},kt={properties:null},St=Object.keys(ye);for(const ht of St){const[Dt,Bt]=ye[ht],ri=o.createExpression(Bt),Vt=o.createExpression(typeof Dt=="string"?[Dt,["accumulated"],["get",ht]]:Dt);Ue[ht]=ri.value,Ye[ht]=Vt.value}return ae.map=ht=>{kt.properties=ht;const Dt={};for(const Bt of St)Dt[Bt]=Ue[Bt].evaluate(Be,kt);return Dt},ae.reduce=(ht,Dt)=>{kt.properties=Dt;for(const Bt of St)Be.accumulated=ht[Bt],ht[Bt]=Ye[Bt].evaluate(Be,kt)},ae}(D)).load(me.features):function(ae,ye){return new Nn(ae,ye)}(me,D.geojsonVtOptions)}catch(ae){return U(ae)}this.loaded={};const he={};if(X){const ae=X.finish();ae&&(he.resourceTiming={},he.resourceTiming[D.source]=JSON.parse(JSON.stringify(ae)))}U(null,he)}})}reloadTile(D,U){const W=this.loaded;return W&&W[D.uid]?super.reloadTile(D,U):this.loadTile(D,U)}loadGeoJSON(D,U){if(D.request)return o.getJSON(D.request,U);if(typeof D.data=="string")try{U(null,JSON.parse(D.data))}catch{U(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`))}else U(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(D,U){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),U()}getClusterExpansionZoom(D,U){try{U(null,this._geoJSONIndex.getClusterExpansionZoom(D.clusterId))}catch(W){U(W)}}getClusterChildren(D,U){try{U(null,this._geoJSONIndex.getChildren(D.clusterId))}catch(W){U(W)}}getClusterLeaves(D,U){try{U(null,this._geoJSONIndex.getLeaves(D.clusterId,D.limit,D.offset))}catch(W){U(W)}}}class In{constructor(D){this.self=D,this.actor=new o.Actor(D,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:q,geojson:ki},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(U,W)=>{if(this.workerSourceTypes[U])throw new Error(`Worker source with name "${U}" already registered.`);this.workerSourceTypes[U]=W},this.self.registerRTLTextPlugin=U=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=U.applyArabicShaping,o.plugin.processBidirectionalText=U.processBidirectionalText,o.plugin.processStyledBidirectionalText=U.processStyledBidirectionalText}}setReferrer(D,U){this.referrer=U}setImages(D,U,W){this.availableImages[D]=U;for(const X in this.workerSources[D]){const se=this.workerSources[D][X];for(const me in se)se[me].availableImages=U}W()}setLayers(D,U,W){this.getLayerIndex(D).replace(U),W()}updateLayers(D,U,W){this.getLayerIndex(D).update(U.layers,U.removedIds),W()}loadTile(D,U,W){this.getWorkerSource(D,U.type,U.source).loadTile(U,W)}loadDEMTile(D,U,W){this.getDEMWorkerSource(D,U.source).loadTile(U,W)}reloadTile(D,U,W){this.getWorkerSource(D,U.type,U.source).reloadTile(U,W)}abortTile(D,U,W){this.getWorkerSource(D,U.type,U.source).abortTile(U,W)}removeTile(D,U,W){this.getWorkerSource(D,U.type,U.source).removeTile(U,W)}removeDEMTile(D,U){this.getDEMWorkerSource(D,U.source).removeTile(U)}removeSource(D,U,W){if(!this.workerSources[D]||!this.workerSources[D][U.type]||!this.workerSources[D][U.type][U.source])return;const X=this.workerSources[D][U.type][U.source];delete this.workerSources[D][U.type][U.source],X.removeSource!==void 0?X.removeSource(U,W):W()}loadWorkerSource(D,U,W){try{this.self.importScripts(U.url),W()}catch(X){W(X.toString())}}syncRTLPluginState(D,U,W){try{o.plugin.setState(U);const X=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&X!=null){this.self.importScripts(X);const se=o.plugin.isParsed();W(se?void 0:new Error(`RTL Text Plugin failed to import scripts from ${X}`),se)}}catch(X){W(X.toString())}}getAvailableImages(D){let U=this.availableImages[D];return U||(U=[]),U}getLayerIndex(D){let U=this.layerIndexes[D];return U||(U=this.layerIndexes[D]=new E),U}getWorkerSource(D,U,W){if(this.workerSources[D]||(this.workerSources[D]={}),this.workerSources[D][U]||(this.workerSources[D][U]={}),!this.workerSources[D][U][W]){const X={send:(se,me,he)=>{this.actor.send(se,me,he,D)}};this.workerSources[D][U][W]=new this.workerSourceTypes[U](X,this.getLayerIndex(D),this.getAvailableImages(D))}return this.workerSources[D][U][W]}getDEMWorkerSource(D,U){return this.demWorkerSources[D]||(this.demWorkerSources[D]={}),this.demWorkerSources[D][U]||(this.demWorkerSources[D][U]=new J),this.demWorkerSources[D][U]}enforceCacheSizeLimit(D,U){o.enforceCacheSizeLimit(U)}}return o.isWorker()&&(self.worker=new In(self)),In}),p(["./shared"],function(o){var b=S;function S(d){return!function(i){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var f,g,v=new Blob([""],{type:"text/javascript"}),w=URL.createObjectURL(v);try{g=new Worker(w),f=!0}catch{f=!1}return g&&g.terminate(),URL.revokeObjectURL(w),f}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var f=document.createElement("canvas");f.width=f.height=1;var g=f.getContext("2d");if(!g)return!1;var v=g.getImageData(0,0,1,1);return v&&v.width===f.width}()?(E[l=i&&i.failIfMajorPerformanceCaveat]===void 0&&(E[l]=function(f){var g,v=function(w){var A=document.createElement("canvas"),I=Object.create(S.webGLContextAttributes);return I.failIfMajorPerformanceCaveat=w,A.getContext("webgl",I)||A.getContext("experimental-webgl",I)}(f);if(!v)return!1;try{g=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!g||v.isContextLost())&&(v.shaderSource(g,"void main() {}"),v.compileShader(g),v.getShaderParameter(g,v.COMPILE_STATUS)===!0)}(l)),E[l]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var l}(d)}var E={};function P(d,i){if(Array.isArray(d)){if(!Array.isArray(i)||d.length!==i.length)return!1;for(let l=0;l<d.length;l++)if(!P(d[l],i[l]))return!1;return!0}if(typeof d=="object"&&d!==null&&i!==null){if(typeof i!="object"||Object.keys(d).length!==Object.keys(i).length)return!1;for(const l in d)if(!P(d[l],i[l]))return!1;return!0}return d===i}S.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class k{static testProp(i){if(!k.docStyle)return i[0];for(let l=0;l<i.length;l++)if(i[l]in k.docStyle)return i[l];return i[0]}static create(i,l,f){const g=window.document.createElement(i);return l!==void 0&&(g.className=l),f&&f.appendChild(g),g}static createNS(i,l){return window.document.createElementNS(i,l)}static disableDrag(){k.docStyle&&k.selectProp&&(k.userSelect=k.docStyle[k.selectProp],k.docStyle[k.selectProp]="none")}static enableDrag(){k.docStyle&&k.selectProp&&(k.docStyle[k.selectProp]=k.userSelect)}static setTransform(i,l){i.style[k.transformProp]=l}static addEventListener(i,l,f,g={}){i.addEventListener(l,f,"passive"in g?g:g.capture)}static removeEventListener(i,l,f,g={}){i.removeEventListener(l,f,"passive"in g?g:g.capture)}static suppressClickInternal(i){i.preventDefault(),i.stopPropagation(),window.removeEventListener("click",k.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",k.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",k.suppressClickInternal,!0)},0)}static mousePos(i,l){const f=i.getBoundingClientRect();return new o.pointGeometry(l.clientX-f.left-i.clientLeft,l.clientY-f.top-i.clientTop)}static touchPos(i,l){const f=i.getBoundingClientRect(),g=[];for(let v=0;v<l.length;v++)g.push(new o.pointGeometry(l[v].clientX-f.left-i.clientLeft,l[v].clientY-f.top-i.clientTop));return g}static mouseButton(i){return i.button}static remove(i){i.parentNode&&i.parentNode.removeChild(i)}}k.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,k.selectProp=k.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),k.transformProp=k.testProp(["transform","WebkitTransform"]);class L{constructor(i){this._transformRequestFn=i}transformRequest(i,l){return this._transformRequestFn&&this._transformRequestFn(i,l)||{url:i}}normalizeSpriteURL(i,l,f){const g=function(v){const w=v.match(j);if(!w)throw new Error(`Unable to parse URL "${v}"`);return{protocol:w[1],authority:w[2],path:w[3]||"/",params:w[4]?w[4].split("&"):[]}}(i);return g.path+=`${l}${f}`,function(v){const w=v.params.length?`?${v.params.join("&")}`:"";return`${v.protocol}://${v.authority}${v.path}${w}`}(g)}setTransformRequest(i){this._transformRequestFn=i}}const j=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class q{constructor(i,l,f,g){this.context=i,this.format=f,this.texture=i.gl.createTexture(),this.update(l,g)}update(i,l,f){const{width:g,height:v}=i,w=!(this.size&&this.size[0]===g&&this.size[1]===v||f),{context:A}=this,{gl:I}=A;if(this.useMipmap=Boolean(l&&l.useMipmap),I.bindTexture(I.TEXTURE_2D,this.texture),A.pixelStoreUnpackFlipY.set(!1),A.pixelStoreUnpack.set(1),A.pixelStoreUnpackPremultiplyAlpha.set(this.format===I.RGBA&&(!l||l.premultiply!==!1)),w)this.size=[g,v],i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||o.isImageBitmap(i)?I.texImage2D(I.TEXTURE_2D,0,this.format,this.format,I.UNSIGNED_BYTE,i):I.texImage2D(I.TEXTURE_2D,0,this.format,g,v,0,this.format,I.UNSIGNED_BYTE,i.data);else{const{x:z,y:B}=f||{x:0,y:0};i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||o.isImageBitmap(i)?I.texSubImage2D(I.TEXTURE_2D,0,z,B,I.RGBA,I.UNSIGNED_BYTE,i):I.texSubImage2D(I.TEXTURE_2D,0,z,B,g,v,I.RGBA,I.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&I.generateMipmap(I.TEXTURE_2D)}bind(i,l,f){const{context:g}=this,{gl:v}=g;v.bindTexture(v.TEXTURE_2D,this.texture),f!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(f=v.LINEAR),i!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,i),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,f||i),this.filter=i),l!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,l),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}function J(d){const{userImage:i}=d;return!!(i&&i.render&&i.render())&&(d.data.replace(new Uint8Array(i.data.buffer)),!0)}class ee extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:l,callback:f}of this.requestors)this._notify(l,f);this.requestors=[]}}getImage(i){return this.images[i]}addImage(i,l){if(this.images[i])throw new Error(`Image id ${i} already exist, use updateImage instead`);this._validate(i,l)&&(this.images[i]=l)}_validate(i,l){let f=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${i}" has invalid "stretchX" value`))),f=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${i}" has invalid "stretchY" value`))),f=!1),this._validateContent(l.content,l)||(this.fire(new o.ErrorEvent(new Error(`Image "${i}" has invalid "content" value`))),f=!1),f}_validateStretch(i,l){if(!i)return!0;let f=0;for(const g of i){if(g[0]<f||g[1]<g[0]||l<g[1])return!1;f=g[1]}return!0}_validateContent(i,l){return!(i&&(i.length!==4||i[0]<0||l.data.width<i[0]||i[1]<0||l.data.height<i[1]||i[2]<0||l.data.width<i[2]||i[3]<0||l.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,l){const f=this.images[i];if(f.data.width!==l.data.width||f.data.height!==l.data.height)throw new Error(`size mismatch between old image (${f.data.width}x${f.data.height}) and new image (${l.data.width}x${l.data.height}).`);l.version=f.version+1,this.images[i]=l,this.updatedImages[i]=!0}removeImage(i){const l=this.images[i];delete this.images[i],delete this.patterns[i],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i,l){let f=!0;if(!this.isLoaded())for(const g of i)this.images[g]||(f=!1);this.isLoaded()||f?this._notify(i,l):this.requestors.push({ids:i,callback:l})}_notify(i,l){const f={};for(const g of i){this.images[g]||this.fire(new o.Event("styleimagemissing",{id:g}));const v=this.images[g];v?f[g]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:Boolean(v.userImage&&v.userImage.render)}:o.warnOnce(`Image "${g}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,f)}getPixelSize(){const{width:i,height:l}=this.atlasImage;return{width:i,height:l}}getPattern(i){const l=this.patterns[i],f=this.getImage(i);if(!f)return null;if(l&&l.position.version===f.version)return l.position;if(l)l.position.version=f.version;else{const g={w:f.data.width+2,h:f.data.height+2,x:0,y:0},v=new o.ImagePosition(g,f);this.patterns[i]={bin:g,position:v}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const l=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new q(i,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const v in this.patterns)i.push(this.patterns[v].bin);const{w:l,h:f}=o.potpack(i),g=this.atlasImage;g.resize({width:l||1,height:f||1});for(const v in this.patterns){const{bin:w}=this.patterns[v],A=w.x+1,I=w.y+1,z=this.images[v].data,B=z.width,N=z.height;o.RGBAImage.copy(z,g,{x:0,y:0},{x:A,y:I},{width:B,height:N}),o.RGBAImage.copy(z,g,{x:0,y:N-1},{x:A,y:I-1},{width:B,height:1}),o.RGBAImage.copy(z,g,{x:0,y:0},{x:A,y:I+N},{width:B,height:1}),o.RGBAImage.copy(z,g,{x:B-1,y:0},{x:A-1,y:I},{width:1,height:N}),o.RGBAImage.copy(z,g,{x:0,y:0},{x:A+B,y:I},{width:1,height:N})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const l of i){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const f=this.images[l];f||o.warnOnce(`Image with ID: "${l}" was not found`),J(f)&&this.updateImage(l,f)}}}const ge=1e20;function _e(d,i,l,f,g,v,w,A,I){for(let z=i;z<i+f;z++)Y(d,l*v+z,v,g,w,A,I);for(let z=l;z<l+g;z++)Y(d,z*v+i,1,f,w,A,I)}function Y(d,i,l,f,g,v,w){v[0]=0,w[0]=-ge,w[1]=ge,g[0]=d[i];for(let A=1,I=0,z=0;A<f;A++){g[A]=d[i+A*l];const B=A*A;do{const N=v[I];z=(g[A]-g[N]+B-N*N)/(A-N)/2}while(z<=w[I]&&--I>-1);I++,v[I]=A,w[I]=z,w[I+1]=ge}for(let A=0,I=0;A<f;A++){for(;w[I+1]<A;)I++;const z=v[I],B=A-z;d[i+A*l]=g[z]+B*B}}class le{constructor(i,l){this.requestManager=i,this.localIdeographFontFamily=l,this.entries={}}setURL(i){this.url=i}getGlyphs(i,l){const f=[];for(const g in i)for(const v of i[g])f.push({stack:g,id:v});o.asyncAll(f,({stack:g,id:v},w)=>{let A=this.entries[g];A||(A=this.entries[g]={glyphs:{},requests:{},ranges:{}});let I=A.glyphs[v];if(I!==void 0)return void w(null,{stack:g,id:v,glyph:I});if(I=this._tinySDF(A,g,v),I)return A.glyphs[v]=I,void w(null,{stack:g,id:v,glyph:I});const z=Math.floor(v/256);if(256*z>65535)return void w(new Error("glyphs > 65535 not supported"));if(A.ranges[z])return void w(null,{stack:g,id:v,glyph:I});let B=A.requests[z];B||(B=A.requests[z]=[],le.loadGlyphRange(g,z,this.url,this.requestManager,(N,G)=>{if(G){for(const te in G)this._doesCharSupportLocalGlyph(+te)||(A.glyphs[+te]=G[+te]);A.ranges[z]=!0}for(const te of B)te(N,G);delete A.requests[z]})),B.push((N,G)=>{N?w(N):G&&w(null,{stack:g,id:v,glyph:G[v]||null})})},(g,v)=>{if(g)l(g);else if(v){const w={};for(const{stack:A,id:I,glyph:z}of v)(w[A]||(w[A]={}))[I]=z&&{id:z.id,bitmap:z.bitmap.clone(),metrics:z.metrics};l(null,w)}})}_doesCharSupportLocalGlyph(i){return!!this.localIdeographFontFamily&&(o.unicodeBlockLookup["CJK Unified Ideographs"](i)||o.unicodeBlockLookup["Hangul Syllables"](i)||o.unicodeBlockLookup.Hiragana(i)||o.unicodeBlockLookup.Katakana(i))}_tinySDF(i,l,f){const g=this.localIdeographFontFamily;if(!g||!this._doesCharSupportLocalGlyph(f))return;let v=i.tinySDF;if(!v){let A="400";/bold/i.test(l)?A="900":/medium/i.test(l)?A="500":/light/i.test(l)&&(A="200"),v=i.tinySDF=new le.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:g,fontWeight:A})}const w=v.draw(String.fromCharCode(f));return{id:f,bitmap:new o.AlphaImage({width:w.width||30,height:w.height||30},w.data),metrics:{width:w.glyphWidth||24,height:w.glyphHeight||24,left:w.glyphLeft||0,top:w.glyphTop-27||-8,advance:w.glyphAdvance||24}}}}le.loadGlyphRange=function(d,i,l,f,g){const v=256*i,w=v+255,A=f.transformRequest(l.replace("{fontstack}",d).replace("{range}",`${v}-${w}`),o.ResourceType.Glyphs);o.getArrayBuffer(A,(I,z)=>{if(I)g(I);else if(z){const B={};for(const N of o.parseGlyphPbf(z))B[N.id]=N;g(null,B)}})},le.TinySDF=class{constructor({fontSize:d=24,buffer:i=3,radius:l=8,cutoff:f=.25,fontFamily:g="sans-serif",fontWeight:v="normal",fontStyle:w="normal"}={}){this.buffer=i,this.cutoff=f,this.radius=l;const A=this.size=d+4*i,I=this._createCanvas(A),z=this.ctx=I.getContext("2d",{willReadFrequently:!0});z.font=`${w} ${v} ${d}px ${g}`,z.textBaseline="alphabetic",z.textAlign="left",z.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(d){const i=document.createElement("canvas");return i.width=i.height=d,i}draw(d){const{width:i,actualBoundingBoxAscent:l,actualBoundingBoxDescent:f,actualBoundingBoxLeft:g,actualBoundingBoxRight:v}=this.ctx.measureText(d),w=Math.ceil(l),A=Math.min(this.size-this.buffer,Math.ceil(v-g)),I=Math.min(this.size-this.buffer,w+Math.ceil(f)),z=A+2*this.buffer,B=I+2*this.buffer,N=Math.max(z*B,0),G=new Uint8ClampedArray(N),te={data:G,width:z,height:B,glyphWidth:A,glyphHeight:I,glyphTop:w,glyphLeft:0,glyphAdvance:i};if(A===0||I===0)return te;const{ctx:Q,buffer:$,gridInner:de,gridOuter:be}=this;Q.clearRect($,$,A,I),Q.fillText(d,$,$+w);const Ce=Q.getImageData($,$,A,I);be.fill(ge,0,N),de.fill(0,0,N);for(let ne=0;ne<I;ne++)for(let ze=0;ze<A;ze++){const Me=Ce.data[4*(ne*A+ze)+3]/255;if(Me===0)continue;const Ve=(ne+$)*z+ze+$;if(Me===1)be[Ve]=0,de[Ve]=ge;else{const qe=.5-Me;be[Ve]=qe>0?qe*qe:0,de[Ve]=qe<0?qe*qe:0}}_e(be,0,0,z,B,z,this.f,this.v,this.z),_e(de,$,$,A,I,z,this.f,this.v,this.z);for(let ne=0;ne<N;ne++){const ze=Math.sqrt(be[ne])-Math.sqrt(de[ne]);G[ne]=Math.round(255-255*(ze/this.radius+this.cutoff))}return te}};const ie=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(d,i){return o.sphericalToCartesian(d.expression.evaluate(i))}interpolate(d,i,l){return{x:o.number(d.x,i.x,l),y:o.number(d.y,i.y,l),z:o.number(d.z,i.z,l)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),ke="-transition";class Je extends o.Evented{constructor(i){super(),this._transitionable=new o.Transitionable(ie),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,l={}){if(!this._validate(o.validateLight,i,l))for(const f in i){const g=i[f];f.endsWith(ke)?this._transitionable.setTransition(f.slice(0,-ke.length),g):this._transitionable.setValue(f,g)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,l,f){return(!f||f.validate!==!1)&&o.emitValidationErrors(this,i.call(o.validateStyle,o.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class ve{constructor(i,l){this.width=i,this.height=l,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(i,l){const f=i.join(",")+String(l);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(i,l)),this.dashEntry[f]}getDashRanges(i,l,f){const g=[];let v=i.length%2==1?-i[i.length-1]*f:0,w=i[0]*f,A=!0;g.push({left:v,right:w,isDash:A,zeroLength:i[0]===0});let I=i[0];for(let z=1;z<i.length;z++){A=!A;const B=i[z];v=I*f,I+=B,w=I*f,g.push({left:v,right:w,isDash:A,zeroLength:B===0})}return g}addRoundDash(i,l,f){const g=l/2;for(let v=-f;v<=f;v++){const w=this.width*(this.nextRow+f+v);let A=0,I=i[A];for(let z=0;z<this.width;z++){z/I.right>1&&(I=i[++A]);const B=Math.abs(z-I.left),N=Math.abs(z-I.right),G=Math.min(B,N);let te;const Q=v/f*(g+1);if(I.isDash){const $=g-Math.abs(Q);te=Math.sqrt(G*G+$*$)}else te=g-Math.sqrt(G*G+Q*Q);this.data[w+z]=Math.max(0,Math.min(255,te+128))}}}addRegularDash(i){for(let A=i.length-1;A>=0;--A){const I=i[A],z=i[A+1];I.zeroLength?i.splice(A,1):z&&z.isDash===I.isDash&&(z.left=I.left,i.splice(A,1))}const l=i[0],f=i[i.length-1];l.isDash===f.isDash&&(l.left=f.left-this.width,f.right=l.right+this.width);const g=this.width*this.nextRow;let v=0,w=i[v];for(let A=0;A<this.width;A++){A/w.right>1&&(w=i[++v]);const I=Math.abs(A-w.left),z=Math.abs(A-w.right),B=Math.min(I,z);this.data[g+A]=Math.max(0,Math.min(255,(w.isDash?B:-B)+128))}}addDash(i,l){const f=l?7:0,g=2*f+1;if(this.nextRow+g>this.height)return o.warnOnce("LineAtlas out of space"),null;let v=0;for(let A=0;A<i.length;A++)v+=i[A];if(v!==0){const A=this.width/v,I=this.getDashRanges(i,this.width,A);l?this.addRoundDash(I,A,f):this.addRegularDash(I)}const w={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:v};return this.nextRow+=g,this.dirty=!0,w}bind(i){const l=i.gl;this.texture?(l.bindTexture(l.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,l.texSubImage2D(l.TEXTURE_2D,0,0,0,this.width,this.height,l.ALPHA,l.UNSIGNED_BYTE,this.data))):(this.texture=l.createTexture(),l.bindTexture(l.TEXTURE_2D,this.texture),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.LINEAR),l.texImage2D(l.TEXTURE_2D,0,l.ALPHA,this.width,this.height,0,l.ALPHA,l.UNSIGNED_BYTE,this.data))}}class pe{constructor(i,l){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const f=this.workerPool.acquire(this.id);for(let g=0;g<f.length;g++){const v=new pe.Actor(f[g],l,this.id);v.name=`Worker ${g}`,this.actors.push(v)}if(!this.actors.length)throw new Error("No actors found")}broadcast(i,l,f){o.asyncAll(this.actors,(g,v)=>{g.send(i,l,v)},f=f||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Fe(d,i,l){const f=function(g,v){if(g)return l(g);if(v){const w=o.pick(o.extend(v,d),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);v.vector_layers&&(w.vectorLayers=v.vector_layers,w.vectorLayerIds=w.vectorLayers.map(A=>A.id)),l(null,w)}};return d.url?o.getJSON(i.transformRequest(d.url,o.ResourceType.Source),f):o.exported.frame(()=>f(null,d))}pe.Actor=o.Actor;class $e{constructor(i,l,f){this.bounds=o.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=l||0,this.maxzoom=f||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const l=Math.pow(2,i.z),f=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*l),g=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*l),v=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*l),w=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*l);return i.x>=f&&i.x<v&&i.y>=g&&i.y<w}}class ct extends o.Evented{constructor(i,l,f,g){if(super(),this.id=i,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(l,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},l),this._collectResourceTiming=l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g)}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Fe(this._options,this.map._requestManager,(i,l)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),i?this.fire(new o.ErrorEvent(i)):l&&(o.extend(this,l),l.bounds&&(this.tileBounds=new $e(l.bounds,this.minzoom,this.maxzoom)),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}setSourceProperty(i){this._tileJSONRequest&&this._tileJSONRequest.cancel(),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}loadTile(i,l){const f=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g={request:this.map._requestManager.transformRequest(f,o.ResourceType.Tile),uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function v(w,A){return delete i.request,i.aborted?l(null):w&&w.status!==404?l(w):(A&&A.resourceTiming&&(i.resourceTiming=A.resourceTiming),this.map._refreshExpiredTiles&&A&&i.setExpiryData(A),i.loadVectorData(A,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),l(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}g.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired"?i.state==="loading"?i.reloadCallback=l:i.request=i.actor.send("reloadTile",g,v.bind(this)):(i.actor=this.dispatcher.getActor(),i.request=i.actor.send("loadTile",g,v.bind(this)))}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id},void 0)}unloadTile(i){i.unloadVectorData(),i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class We extends o.Evented{constructor(i,l,f,g){super(),this.id=i,this.dispatcher=f,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},l),o.extend(this,o.pick(l,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Fe(this._options,this.map._requestManager,(i,l)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new o.ErrorEvent(i)):l&&(o.extend(this,l),l.bounds&&(this.tileBounds=new $e(l.bounds,this.minzoom,this.maxzoom)),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,l){const f=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);i.request=o.getImage(this.map._requestManager.transformRequest(f,o.ResourceType.Tile),(g,v,w)=>{if(delete i.request,i.aborted)i.state="unloaded",l(null);else if(g)i.state="errored",l(g);else if(v){this.map._refreshExpiredTiles&&i.setExpiryData(w);const A=this.map.painter.context,I=A.gl;i.texture=this.map.painter.getTileTexture(v.width),i.texture?i.texture.update(v,{useMipmap:!0}):(i.texture=new q(A,v,I.RGBA,{useMipmap:!0}),i.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),A.extTextureFilterAnisotropic&&I.texParameterf(I.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax)),i.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),l(null)}})}abortTile(i,l){i.request&&(i.request.cancel(),delete i.request),l()}unloadTile(i,l){i.texture&&this.map.painter.saveTileTexture(i.texture),l()}hasTransition(){return!1}}let mt;class xe extends We{constructor(i,l,f,g){super(i,l,f,g),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(i,l){const f=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function g(v,w){v&&(i.state="errored",l(v)),w&&(i.dem=w,i.needsHillshadePrepare=!0,i.needsTerrainPrepare=!0,i.state="loaded",l(null))}i.request=o.getImage(this.map._requestManager.transformRequest(f,o.ResourceType.Tile),function(v,w){if(delete i.request,i.aborted)i.state="unloaded",l(null);else if(v)i.state="errored",l(v);else if(w){this.map._refreshExpiredTiles&&i.setExpiryData(w),delete w.cacheControl,delete w.expires;const A=o.isImageBitmap(w)&&(mt==null&&(mt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),mt)?w:o.exported.getImageData(w,1),I={uid:i.uid,coord:i.tileID,source:this.id,rawImageData:A,encoding:this.encoding};i.actor&&i.state!=="expired"||(i.actor=this.dispatcher.getActor(),i.actor.send("loadDEMTile",I,g.bind(this)))}}.bind(this)),i.neighboringTiles=this._getNeighboringTiles(i.tileID)}_getNeighboringTiles(i){const l=i.canonical,f=Math.pow(2,l.z),g=(l.x-1+f)%f,v=l.x===0?i.wrap-1:i.wrap,w=(l.x+1+f)%f,A=l.x+1===f?i.wrap+1:i.wrap,I={};return I[new o.OverscaledTileID(i.overscaledZ,v,l.z,g,l.y).key]={backfilled:!1},I[new o.OverscaledTileID(i.overscaledZ,A,l.z,w,l.y).key]={backfilled:!1},l.y>0&&(I[new o.OverscaledTileID(i.overscaledZ,v,l.z,g,l.y-1).key]={backfilled:!1},I[new o.OverscaledTileID(i.overscaledZ,i.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},I[new o.OverscaledTileID(i.overscaledZ,A,l.z,w,l.y-1).key]={backfilled:!1}),l.y+1<f&&(I[new o.OverscaledTileID(i.overscaledZ,v,l.z,g,l.y+1).key]={backfilled:!1},I[new o.OverscaledTileID(i.overscaledZ,i.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},I[new o.OverscaledTileID(i.overscaledZ,A,l.z,w,l.y+1).key]={backfilled:!1}),I}unloadTile(i){i.demTexture&&this.map.painter.saveTileTexture(i.demTexture),i.fbo&&(i.fbo.destroy(),delete i.fbo),i.dem&&delete i.dem,delete i.neighboringTiles,i.state="unloaded",i.actor&&i.actor.send("removeDEMTile",{uid:i.uid,source:this.id})}}class Ne extends o.Evented{constructor(i,l,f,g){super(),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=f.getActor(),this.setEventedParent(g),this._data=l.data,this._options=o.extend({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const v=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(l.buffer!==void 0?l.buffer:128)*v,tolerance:(l.tolerance!==void 0?l.tolerance:.375)*v,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:l.clusterMaxZoom!==void 0?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:o.EXTENT,radius:(l.clusterRadius||50)*v,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(i){this.map=i,this.load()}setData(i){return this._data=i,this._updateWorkerData("content"),this}getClusterExpansionZoom(i,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:i,source:this.id},l),this}getClusterChildren(i,l){return this.actor.send("geojson.getClusterChildren",{clusterId:i,source:this.id},l),this}getClusterLeaves(i,l,f,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:i,limit:l,offset:f},g),this}_updateWorkerData(i){const l=o.extend({},this.workerOptions),f=this._data;typeof f=="string"?(l.request=this.map._requestManager.transformRequest(o.exported.resolveURL(f),o.ResourceType.Source),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(f),this._pendingLoads++,this.fire(new o.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,l,(g,v)=>{if(this._pendingLoads--,this._removed||v&&v.abandoned)return void this.fire(new o.Event("dataabort",{dataType:"source",sourceDataType:i}));let w=null;if(v&&v.resourceTiming&&v.resourceTiming[this.id]&&(w=v.resourceTiming[this.id].slice(0)),g)return void this.fire(new o.ErrorEvent(g));const A={dataType:"source",sourceDataType:i};this._collectResourceTiming&&w&&w.length>0&&o.extend(A,{resourceTiming:w}),this.fire(new o.Event("data",A))})}loaded(){return this._pendingLoads===0}loadTile(i,l){const f=i.actor?"reloadTile":"loadTile";i.actor=this.actor;const g={type:this.type,uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};i.request=this.actor.send(f,g,(v,w)=>(delete i.request,i.unloadVectorData(),i.aborted?l(null):v?l(v):(i.loadVectorData(w,this.map.painter,f==="reloadTile"),l(null))))}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.aborted=!0}unloadTile(i){i.unloadVectorData(),this.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Le=o.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ut extends o.Evented{constructor(i,l,f,g){super(),this.id=i,this.dispatcher=f,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=l}load(i,l){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(f,g)=>{this._loaded=!0,f?this.fire(new o.ErrorEvent(f)):g&&(this.image=g,i&&(this.coordinates=i),l&&l(),this._finishLoading())})}loaded(){return this._loaded}updateImage(i){return this.image&&i.url?(this.options.url=i.url,this.load(i.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}setCoordinates(i){this.coordinates=i;const l=i.map(o.MercatorCoordinate.fromLngLat);this.tileID=function(g){let v=1/0,w=1/0,A=-1/0,I=-1/0;for(const G of g)v=Math.min(v,G.x),w=Math.min(w,G.y),A=Math.max(A,G.x),I=Math.max(I,G.y);const z=Math.max(A-v,I-w),B=Math.max(0,Math.floor(-Math.log(z)/Math.LN2)),N=Math.pow(2,B);return new o.CanonicalTileID(B,Math.floor((v+A)/2*N),Math.floor((w+I)/2*N))}(l),this.minzoom=this.maxzoom=this.tileID.z;const f=l.map(g=>this.tileID.getTilePoint(g)._round());return this._boundsArray=new o.RasterBoundsArray,this._boundsArray.emplaceBack(f[0].x,f[0].y,0,0),this._boundsArray.emplaceBack(f[1].x,f[1].y,o.EXTENT,0),this._boundsArray.emplaceBack(f[3].x,f[3].y,0,o.EXTENT),this._boundsArray.emplaceBack(f[2].x,f[2].y,o.EXTENT,o.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,l=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,Le.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new q(i,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));for(const f in this.tiles){const g=this.tiles[f];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture)}}loadTile(i,l){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},l(null)):(i.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Ze extends ut{constructor(i,l,f,g){super(i,l,f,g),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;const i=this.options;this.urls=[];for(const l of i.urls)this.urls.push(this.map._requestManager.transformRequest(l,o.ResourceType.Source).url);o.getVideo(this.urls,(l,f)=>{this._loaded=!0,l?this.fire(new o.ErrorEvent(l)):f&&(this.video=f,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(i){if(this.video){const l=this.video.seekable;i<l.start(0)||i>l.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=i}}getVideo(){return this.video}onAdd(i){this.map||(this.map=i,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const i=this.map.painter.context,l=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,Le.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new q(i,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));for(const f in this.tiles){const g=this.tiles[f];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class qt extends ut{constructor(i,l,f,g){super(i,l,f,g),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(w=>typeof w!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${i}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${i}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${i}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${i}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${i}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(i){this.map=i,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let i=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,i=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,i=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const l=this.map.painter.context,f=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,Le.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(i||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new q(l,this.canvas,f.RGBA,{premultiply:!0});for(const g in this.tiles){const v=this.tiles[g];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const i of[this.canvas.width,this.canvas.height])if(isNaN(i)||i<=0)return!0;return!1}}const It={vector:ct,raster:We,"raster-dem":xe,geojson:Ne,video:Ze,image:ut,canvas:qt};function Ut(d,i){const l=o.create();return o.translate(l,l,[1,1,0]),o.scale(l,l,[.5*d.width,.5*d.height,1]),o.multiply(l,l,d.calculatePosMatrix(i.toUnwrapped()))}function Kt(d,i,l,f,g,v){const w=function(N,G,te){if(N)for(const Q of N){const $=G[Q];if($&&$.source===te&&$.type==="fill-extrusion")return!0}else for(const Q in G){const $=G[Q];if($.source===te&&$.type==="fill-extrusion")return!0}return!1}(g&&g.layers,i,d.id),A=v.maxPitchScaleFactor(),I=d.tilesIn(f,A,w);I.sort(Jt);const z=[];for(const N of I)z.push({wrappedTileID:N.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(i,l,d._state,N.queryGeometry,N.cameraQueryGeometry,N.scale,g,v,A,Ut(d.transform,N.tileID))});const B=function(N){const G={},te={};for(const Q of N){const $=Q.queryResults,de=Q.wrappedTileID,be=te[de]=te[de]||{};for(const Ce in $){const ne=$[Ce],ze=be[Ce]=be[Ce]||{},Me=G[Ce]=G[Ce]||[];for(const Ve of ne)ze[Ve.featureIndex]||(ze[Ve.featureIndex]=!0,Me.push(Ve))}}return G}(z);for(const N in B)B[N].forEach(G=>{const te=G.feature,Q=d.getFeatureState(te.layer["source-layer"],te.id);te.source=te.layer.source,te.layer["source-layer"]&&(te.sourceLayer=te.layer["source-layer"]),te.state=Q});return B}function Jt(d,i){const l=d.tileID,f=i.tileID;return l.overscaledZ-f.overscaledZ||l.canonical.y-f.canonical.y||l.wrap-f.wrap||l.canonical.x-f.canonical.x}class li{constructor(i,l){this.tileID=i,this.uid=o.uniqueId(),this.uses=0,this.tileSize=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(i){const l=i+this.timeAdded;l<o.exported.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(i){this.demTexture&&i.saveTileTexture(this.demTexture),this.textures.forEach(l=>i.saveTileTexture(l)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(i,l,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(g,v){const w={};if(!v)return w;for(const A of g){const I=A.layerIds.map(z=>v.getLayer(z)).filter(Boolean);if(I.length!==0){A.layers=I,A.stateDependentLayerIds&&(A.stateDependentLayers=A.stateDependentLayerIds.map(z=>I.filter(B=>B.id===z)[0]));for(const z of I)w[z.id]=A}}return w}(i.buckets,l.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const v=this.buckets[g];if(v instanceof o.SymbolBucket){if(this.hasSymbolBuckets=!0,!f)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const v=this.buckets[g];if(v instanceof o.SymbolBucket&&v.hasRTLText){this.hasRTLText=!0,o.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const g in this.buckets){const v=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(g).queryRadius(v))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage)}else this.collisionBoxArray=new o.CollisionBoxArray}unloadVectorData(){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(i){return this.buckets[i.id]}upload(i){for(const f in this.buckets){const g=this.buckets[f];g.uploadPending()&&g.upload(i)}const l=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new q(i,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new q(i,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,l,f,g,v,w,A,I,z,B){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:v,scale:w,tileSize:this.tileSize,pixelPosMatrix:B,transform:I,params:A,queryPadding:this.queryPadding*z},i,l,f):{}}querySourceFeatures(i,l){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const g=f.loadVTLayers(),v=l?l.sourceLayer:"",w=g._geojsonTileLayer||g[v];if(!w)return;const A=o.createFilter(l&&l.filter),{z:I,x:z,y:B}=this.tileID.canonical,N={z:I,x:z,y:B};for(let G=0;G<w.length;G++){const te=w.feature(G);if(A.needGeometry){const de=o.toEvaluationFeature(te,!0);if(!A.filter(new o.EvaluationParameters(this.tileID.overscaledZ),de,this.tileID.canonical))continue}else if(!A.filter(new o.EvaluationParameters(this.tileID.overscaledZ),te))continue;const Q=f.getId(te,v),$=new o.GeoJSONFeature(te,I,z,B,Q);$.tile=N,i.push($)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const l=this.expirationTime;if(i.cacheControl){const f=o.parseCacheControl(i.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const f=Date.now();let g=!1;if(this.expirationTime>f)g=!1;else if(l)if(this.expirationTime<l)g=!0;else{const v=this.expirationTime-l;v?this.expirationTime=f+Math.max(v,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(i).length===0)return;const f=this.latestFeatureIndex.loadVTLayers();for(const g in this.buckets){if(!l.style.hasLayer(g))continue;const v=this.buckets[g],w=v.layers[0].sourceLayer||"_geojsonTileLayer",A=f[w],I=i[w];if(!A||!I||Object.keys(I).length===0)continue;v.update(I,A,this.imageAtlas&&this.imageAtlas.patternPositions||{});const z=l&&l.style&&l.style.getLayer(g);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=o.exported.now()+i}setDependencies(i,l){const f={};for(const g of l)f[g]=!0;this.dependencies[i]=f}hasDependency(i,l){for(const f of i){const g=this.dependencies[f];if(g){for(const v of l)if(g[v])return!0}}return!1}}class mi{constructor(i,l){this.max=i,this.onRemove=l,this.reset()}reset(){for(const i in this.data)for(const l of this.data[i])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(i,l,f){const g=i.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const v={value:l,timeout:void 0};if(f!==void 0&&(v.timeout=setTimeout(()=>{this.remove(i,v)},f)),this.data[g].push(v),this.order.push(g),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const l=this.data[i].shift();return l.timeout&&clearTimeout(l.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),l.value}getByKey(i){const l=this.data[i];return l?l[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,l){if(!this.has(i))return this;const f=i.wrapped().key,g=l===void 0?0:this.data[f].indexOf(l),v=this.data[f][g];return this.data[f].splice(g,1),v.timeout&&clearTimeout(v.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(v.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(i){const l=[];for(const f in this.data)for(const g of this.data[f])i(g.value)||l.push(g);for(const f of l)this.remove(f.value.tileID,f)}}class Ji{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,l,f){const g=String(l);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][g]=this.stateChanges[i][g]||{},o.extend(this.stateChanges[i][g],f),this.deletedStates[i]===null){this.deletedStates[i]={};for(const v in this.state[i])v!==g&&(this.deletedStates[i][v]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][g]===null){this.deletedStates[i][g]={};for(const v in this.state[i][g])f[v]||(this.deletedStates[i][g][v]=null)}else for(const v in f)this.deletedStates[i]&&this.deletedStates[i][g]&&this.deletedStates[i][g][v]===null&&delete this.deletedStates[i][g][v]}removeFeatureState(i,l,f){if(this.deletedStates[i]===null)return;const g=String(l);if(this.deletedStates[i]=this.deletedStates[i]||{},f&&l!==void 0)this.deletedStates[i][g]!==null&&(this.deletedStates[i][g]=this.deletedStates[i][g]||{},this.deletedStates[i][g][f]=null);else if(l!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][g])for(f in this.deletedStates[i][g]={},this.stateChanges[i][g])this.deletedStates[i][g][f]=null;else this.deletedStates[i][g]=null;else this.deletedStates[i]=null}getState(i,l){const f=String(l),g=o.extend({},(this.state[i]||{})[f],(this.stateChanges[i]||{})[f]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){const v=this.deletedStates[i][l];if(v===null)return{};for(const w in v)delete g[w]}return g}initializeTileState(i,l){i.setFeatureState(this.state,l)}coalesceChanges(i,l){const f={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const v={};for(const w in this.stateChanges[g])this.state[g][w]||(this.state[g][w]={}),o.extend(this.state[g][w],this.stateChanges[g][w]),v[w]=this.state[g][w];f[g]=v}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const v={};if(this.deletedStates[g]===null)for(const w in this.state[g])v[w]={},this.state[g][w]={};else for(const w in this.deletedStates[g]){if(this.deletedStates[g][w]===null)this.state[g][w]={};else for(const A of Object.keys(this.deletedStates[g][w]))delete this.state[g][w][A];v[w]=this.state[g][w]}f[g]=f[g]||{},o.extend(f[g],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const g in i)i[g].setFeatureState(f,l)}}class rt extends o.Evented{constructor(i,l,f){super(),this.id=i,this.dispatcher=f,this.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(g,v,w,A){const I=new It[v.type](g,v,w,A);if(I.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${I.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],I),I}(i,l,f,this),this._tiles={},this._cache=new mi(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ji}onAdd(i){this.map=i,this._maxTileCacheSize=i?i._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(i)}onRemove(i){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(i)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const l=this._tiles[i];if(l.state!=="loaded"&&l.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(i,l){return this._source.loadTile(i,l)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i,()=>{})}_abortTile(i){this._source.abortTile&&this._source.abortTile(i,()=>{}),this._source.fire(new o.Event("dataabort",{tile:i,coord:i.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const f=this._tiles[l];f.upload(i),f.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(i=>i.tileID).sort(He).map(i=>i.key)}getRenderableIds(i){const l=[];for(const f in this._tiles)this._isIdRenderable(f,i)&&l.push(this._tiles[f]);return i?l.sort((f,g)=>{const v=f.tileID,w=g.tileID,A=new o.pointGeometry(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),I=new o.pointGeometry(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-w.overscaledZ||I.y-A.y||I.x-A.x}).map(f=>f.tileID.key):l.map(f=>f.tileID).sort(He).map(f=>f.key)}hasRenderableParent(i){const l=this.findLoadedParent(i,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(i,l){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(l||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(i,"reloading")}}_reloadTile(i,l){const f=this._tiles[i];f&&(f.state!=="loading"&&(f.state=l),this._loadTile(f,this._tileLoaded.bind(this,f,i,l)))}_tileLoaded(i,l,f,g){if(g)return i.state="errored",void(g.status!==404?this._source.fire(new o.ErrorEvent(g,{tile:i})):this.update(this.transform,this.terrain));i.timeAdded=o.exported.now(),f==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(l,i),this.getSource().type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),i.aborted||this._source.fire(new o.Event("data",{dataType:"source",tile:i,coord:i.tileID}))}_backfillDEM(i){const l=this.getRenderableIds();for(let g=0;g<l.length;g++){const v=l[g];if(i.neighboringTiles&&i.neighboringTiles[v]){const w=this.getTileByID(v);f(i,w),f(w,i)}}function f(g,v){g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0;let w=v.tileID.canonical.x-g.tileID.canonical.x;const A=v.tileID.canonical.y-g.tileID.canonical.y,I=Math.pow(2,g.tileID.canonical.z),z=v.tileID.key;w===0&&A===0||Math.abs(A)>1||(Math.abs(w)>1&&(Math.abs(w+I)===1?w+=I:Math.abs(w-I)===1&&(w-=I)),v.dem&&g.dem&&(g.dem.backfillBorder(v.dem,w,A),g.neighboringTiles&&g.neighboringTiles[z]&&(g.neighboringTiles[z].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,l,f,g){for(const v in this._tiles){let w=this._tiles[v];if(g[v]||!w.hasData()||w.tileID.overscaledZ<=l||w.tileID.overscaledZ>f)continue;let A=w.tileID;for(;w&&w.tileID.overscaledZ>l+1;){const z=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[z.key],w&&w.hasData()&&(A=z)}let I=A;for(;I.overscaledZ>l;)if(I=I.scaledTo(I.overscaledZ-1),i[I.key]){g[A.key]=A;break}}}findLoadedParent(i,l){if(i.key in this._loadedParentTiles){const f=this._loadedParentTiles[i.key];return f&&f.tileID.overscaledZ>=l?f:null}for(let f=i.overscaledZ-1;f>=l;f--){const g=i.scaledTo(f),v=this._getLoadedTile(g);if(v)return v}}_getLoadedTile(i){const l=this._tiles[i.key];return l&&l.hasData()?l:this._cache.getByKey(i.wrapped().key)}updateCacheSize(i){const l=Math.ceil(i.width/this._source.tileSize)+1,f=Math.ceil(i.height/this._source.tileSize)+1,g=Math.floor(l*f*5),v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(v)}handleWrapJump(i){const l=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,l){const f={};for(const g in this._tiles){const v=this._tiles[g];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+l),f[v.tileID.key]=v}this._tiles=f;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(g,this._tiles[g])}}update(i,l){if(this.transform=i,this.terrain=l,!this._sourceLoaded||this._paused)return;let f;this.updateCacheSize(i),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(z=>new o.OverscaledTileID(z.canonical.z,z.wrap,z.canonical.z,z.canonical.x,z.canonical.y)):(f=i.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:l}),this._source.hasTile&&(f=f.filter(z=>this._source.hasTile(z)))):f=[];const g=i.coveringZoomLevel(this._source),v=Math.max(g-rt.maxOverzooming,this._source.minzoom),w=Math.max(g+rt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const z={};for(const B of f)if(B.canonical.z>this._source.minzoom){const N=B.scaledTo(B.canonical.z-1);z[N.key]=N;const G=B.scaledTo(Math.max(this._source.minzoom,Math.min(B.canonical.z,5)));z[G.key]=G}f=f.concat(Object.values(z))}const A=this._updateRetainedTiles(f,g);if(Mt(this._source.type)){const z={},B={},N=Object.keys(A);for(const G of N){const te=A[G],Q=this._tiles[G];if(!Q||Q.fadeEndTime&&Q.fadeEndTime<=o.exported.now())continue;const $=this.findLoadedParent(te,v);$&&(this._addTile($.tileID),z[$.tileID.key]=$.tileID),B[G]=te}this._retainLoadedChildren(B,g,w,A);for(const G in z)A[G]||(this._coveredTiles[G]=!0,A[G]=z[G]);if(l){const G={},te={};for(const Q of f)this._tiles[Q.key].hasData()?G[Q.key]=Q:te[Q.key]=Q;for(const Q in te){const $=te[Q].children(this._source.maxzoom);this._tiles[$[0].key]&&this._tiles[$[1].key]&&this._tiles[$[2].key]&&this._tiles[$[3].key]&&(G[$[0].key]=A[$[0].key]=$[0],G[$[1].key]=A[$[1].key]=$[1],G[$[2].key]=A[$[2].key]=$[2],G[$[3].key]=A[$[3].key]=$[3],delete te[Q])}for(const Q in te){const $=this.findLoadedParent(te[Q],this._source.minzoom);if($){G[$.tileID.key]=A[$.tileID.key]=$.tileID;for(const de in G)G[de].isChildOf($.tileID)&&delete G[de]}}for(const Q in this._tiles)G[Q]||(this._coveredTiles[Q]=!0)}}for(const z in A)this._tiles[z].clearFadeHold();const I=o.keysDifference(this._tiles,A);for(const z of I){const B=this._tiles[z];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(z)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(i)}_updateRetainedTiles(i,l){const f={},g={},v=Math.max(l-rt.maxOverzooming,this._source.minzoom),w=Math.max(l+rt.maxUnderzooming,this._source.minzoom),A={};for(const I of i){const z=this._addTile(I);f[I.key]=I,z.hasData()||l<this._source.maxzoom&&(A[I.key]=I)}this._retainLoadedChildren(A,l,w,f);for(const I of i){let z=this._tiles[I.key];if(z.hasData())continue;if(l+1>this._source.maxzoom){const N=I.children(this._source.maxzoom)[0],G=this.getTile(N);if(G&&G.hasData()){f[N.key]=N;continue}}else{const N=I.children(this._source.maxzoom);if(f[N[0].key]&&f[N[1].key]&&f[N[2].key]&&f[N[3].key])continue}let B=z.wasRequested();for(let N=I.overscaledZ-1;N>=v;--N){const G=I.scaledTo(N);if(g[G.key]||(g[G.key]=!0,z=this.getTile(G),!z&&B&&(z=this._addTile(G)),z&&(f[G.key]=G,B=z.wasRequested(),z.hasData())))break}}return f}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const l=[];let f,g=this._tiles[i].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){f=this._loadedParentTiles[g.key];break}l.push(g.key);const v=g.scaledTo(g.overscaledZ-1);if(f=this._getLoadedTile(v),f)break;g=v}for(const v of l)this._loadedParentTiles[v]=f}}_addTile(i){let l=this._tiles[i.key];if(l)return l;l=this._cache.getAndRemove(i),l&&(this._setTileReloadTimer(i.key,l),l.tileID=i,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,l)));const f=l;return l||(l=new li(i,this._source.tileSize*i.overscaleFactor()),this._loadTile(l,this._tileLoaded.bind(this,l,i.key,l.state))),l.uses++,this._tiles[i.key]=l,f||this._source.fire(new o.Event("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l}_setTileReloadTimer(i,l){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const f=l.getExpiryTimeout();f&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},f))}_removeTile(i){const l=this._tiles[i];l&&(l.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),l.uses>0||(l.hasData()&&l.state!=="reloading"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(i);this._cache.reset()}tilesIn(i,l,f){const g=[],v=this.transform;if(!v)return g;const w=f?v.getCameraQueryGeometry(i):i,A=i.map(Q=>v.pointCoordinate(Q,this.terrain)),I=w.map(Q=>v.pointCoordinate(Q,this.terrain)),z=this.getIds();let B=1/0,N=1/0,G=-1/0,te=-1/0;for(const Q of I)B=Math.min(B,Q.x),N=Math.min(N,Q.y),G=Math.max(G,Q.x),te=Math.max(te,Q.y);for(let Q=0;Q<z.length;Q++){const $=this._tiles[z[Q]];if($.holdingForFade())continue;const de=$.tileID,be=Math.pow(2,v.zoom-$.tileID.overscaledZ),Ce=l*$.queryPadding*o.EXTENT/$.tileSize/be,ne=[de.getTilePoint(new o.MercatorCoordinate(B,N)),de.getTilePoint(new o.MercatorCoordinate(G,te))];if(ne[0].x-Ce<o.EXTENT&&ne[0].y-Ce<o.EXTENT&&ne[1].x+Ce>=0&&ne[1].y+Ce>=0){const ze=A.map(Ve=>de.getTilePoint(Ve)),Me=I.map(Ve=>de.getTilePoint(Ve));g.push({tile:$,tileID:de,queryGeometry:ze,cameraQueryGeometry:Me,scale:be})}}return g}getVisibleCoordinates(i){const l=this.getRenderableIds(i).map(f=>this._tiles[f].tileID);for(const f of l)f.posMatrix=this.transform.calculatePosMatrix(f.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(Mt(this._source.type))for(const i in this._tiles){const l=this._tiles[i];if(l.fadeEndTime!==void 0&&l.fadeEndTime>=o.exported.now())return!0}return!1}setFeatureState(i,l,f){this._state.updateState(i=i||"_geojsonTileLayer",l,f)}removeFeatureState(i,l,f){this._state.removeFeatureState(i=i||"_geojsonTileLayer",l,f)}getFeatureState(i,l){return this._state.getState(i=i||"_geojsonTileLayer",l)}setDependencies(i,l,f){const g=this._tiles[i];g&&g.setDependencies(l,f)}reloadTilesForDependencies(i,l){for(const f in this._tiles)this._tiles[f].hasDependency(i,l)&&this._reloadTile(f,"reloading");this._cache.filter(f=>!f.hasDependency(i,l))}}function He(d,i){const l=Math.abs(2*d.wrap)-+(d.wrap<0),f=Math.abs(2*i.wrap)-+(i.wrap<0);return d.overscaledZ-i.overscaledZ||f-l||i.canonical.y-d.canonical.y||i.canonical.x-d.canonical.x}function Mt(d){return d==="raster"||d==="image"||d==="video"}rt.maxOverzooming=10,rt.maxUnderzooming=3;const Qe="mapboxgl_preloaded_worker_pool";class At{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<At.workerCount;)this.workers.push(new Worker(ja.workerUrl));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Qe]}numActive(){return Object.keys(this.active).length}}const ei=Math.floor(o.exported.hardwareConcurrency/2);let Ei;function ci(){return Ei||(Ei=new At),Ei}function Nt(d,i){const l={};for(const f in d)f!=="ref"&&(l[f]=d[f]);return o.refProperties.forEach(f=>{f in i&&(l[f]=i[f])}),l}function fi(d){d=d.slice();const i=Object.create(null);for(let l=0;l<d.length;l++)i[d[l].id]=d[l];for(let l=0;l<d.length;l++)"ref"in d[l]&&(d[l]=Nt(d[l],i[d[l].ref]));return d}At.workerCount=Math.max(Math.min(ei,6),1);const Qt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function fn(d,i,l){l.push({command:Qt.addSource,args:[d,i[d]]})}function kn(d,i,l){i.push({command:Qt.removeSource,args:[d]}),l[d]=!0}function Sn(d,i,l,f){kn(d,l,f),fn(d,i,l)}function Hn(d,i,l){let f;for(f in d[l])if(Object.prototype.hasOwnProperty.call(d[l],f)&&f!=="data"&&!P(d[l][f],i[l][f]))return!1;for(f in i[l])if(Object.prototype.hasOwnProperty.call(i[l],f)&&f!=="data"&&!P(d[l][f],i[l][f]))return!1;return!0}function Tt(d,i,l,f,g,v){let w;for(w in i=i||{},d=d||{})Object.prototype.hasOwnProperty.call(d,w)&&(P(d[w],i[w])||l.push({command:v,args:[f,w,i[w],g]}));for(w in i)Object.prototype.hasOwnProperty.call(i,w)&&!Object.prototype.hasOwnProperty.call(d,w)&&(P(d[w],i[w])||l.push({command:v,args:[f,w,i[w],g]}))}function si(d){return d.id}function Ui(d,i){return d[i.id]=i,d}class Qi{constructor(i,l){this.reset(i,l)}reset(i,l){this.points=i||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=o.clamp(i,0,1);let l=1,f=this._distances[l];const g=i*this.paddedLength+this.padding;for(;f<g&&l<this._distances.length;)f=this._distances[++l];const v=l-1,w=this._distances[v],A=f-w,I=A>0?(g-w)/A:0;return this.points[v].mult(1-I).add(this.points[l].mult(I))}}function Oe(d,i){let l=!0;return d==="always"||d!=="never"&&i!=="never"||(l=!1),l}class Ee{constructor(i,l,f){const g=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(i/f),this.yCellCount=Math.ceil(l/f);for(let w=0;w<this.xCellCount*this.yCellCount;w++)g.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=l,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,l,f,g,v){this._forEachCell(l,f,g,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(v)}insertCircle(i,l,f,g){this._forEachCell(l-g,f-g,l+g,f+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(l),this.circles.push(f),this.circles.push(g)}_insertBoxCell(i,l,f,g,v,w){this.boxCells[v].push(w)}_insertCircleCell(i,l,f,g,v,w){this.circleCells[v].push(w)}_query(i,l,f,g,v,w,A){if(f<0||i>this.width||g<0||l>this.height)return[];const I=[];if(i<=0&&l<=0&&this.width<=f&&this.height<=g){if(v)return[{key:null,x1:i,y1:l,x2:f,y2:g}];for(let z=0;z<this.boxKeys.length;z++)I.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const B=this.circles[3*z],N=this.circles[3*z+1],G=this.circles[3*z+2];I.push({key:this.circleKeys[z],x1:B-G,y1:N-G,x2:B+G,y2:N+G})}}else this._forEachCell(i,l,f,g,this._queryCell,I,{hitTest:v,overlapMode:w,seenUids:{box:{},circle:{}}},A);return I}query(i,l,f,g){return this._query(i,l,f,g,!1,null)}hitTest(i,l,f,g,v,w){return this._query(i,l,f,g,!0,v,w).length>0}hitTestCircle(i,l,f,g,v){const w=i-f,A=i+f,I=l-f,z=l+f;if(A<0||w>this.width||z<0||I>this.height)return!1;const B=[];return this._forEachCell(w,I,A,z,this._queryCellCircle,B,{hitTest:!0,overlapMode:g,circle:{x:i,y:l,radius:f},seenUids:{box:{},circle:{}}},v),B.length>0}_queryCell(i,l,f,g,v,w,A,I){const{seenUids:z,hitTest:B,overlapMode:N}=A,G=this.boxCells[v];if(G!==null){const Q=this.bboxes;for(const $ of G)if(!z.box[$]){z.box[$]=!0;const de=4*$,be=this.boxKeys[$];if(i<=Q[de+2]&&l<=Q[de+3]&&f>=Q[de+0]&&g>=Q[de+1]&&(!I||I(be))&&(!B||!Oe(N,be.overlapMode))&&(w.push({key:be,x1:Q[de],y1:Q[de+1],x2:Q[de+2],y2:Q[de+3]}),B))return!0}}const te=this.circleCells[v];if(te!==null){const Q=this.circles;for(const $ of te)if(!z.circle[$]){z.circle[$]=!0;const de=3*$,be=this.circleKeys[$];if(this._circleAndRectCollide(Q[de],Q[de+1],Q[de+2],i,l,f,g)&&(!I||I(be))&&(!B||!Oe(N,be.overlapMode))){const Ce=Q[de],ne=Q[de+1],ze=Q[de+2];if(w.push({key:be,x1:Ce-ze,y1:ne-ze,x2:Ce+ze,y2:ne+ze}),B)return!0}}}return!1}_queryCellCircle(i,l,f,g,v,w,A,I){const{circle:z,seenUids:B,overlapMode:N}=A,G=this.boxCells[v];if(G!==null){const Q=this.bboxes;for(const $ of G)if(!B.box[$]){B.box[$]=!0;const de=4*$,be=this.boxKeys[$];if(this._circleAndRectCollide(z.x,z.y,z.radius,Q[de+0],Q[de+1],Q[de+2],Q[de+3])&&(!I||I(be))&&!Oe(N,be.overlapMode))return w.push(!0),!0}}const te=this.circleCells[v];if(te!==null){const Q=this.circles;for(const $ of te)if(!B.circle[$]){B.circle[$]=!0;const de=3*$,be=this.circleKeys[$];if(this._circlesCollide(Q[de],Q[de+1],Q[de+2],z.x,z.y,z.radius)&&(!I||I(be))&&!Oe(N,be.overlapMode))return w.push(!0),!0}}}_forEachCell(i,l,f,g,v,w,A,I){const z=this._convertToXCellCoord(i),B=this._convertToYCellCoord(l),N=this._convertToXCellCoord(f),G=this._convertToYCellCoord(g);for(let te=z;te<=N;te++)for(let Q=B;Q<=G;Q++)if(v.call(this,i,l,f,g,this.xCellCount*Q+te,w,A,I))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,l,f,g,v,w){const A=g-i,I=v-l,z=f+w;return z*z>A*A+I*I}_circleAndRectCollide(i,l,f,g,v,w,A){const I=(w-g)/2,z=Math.abs(i-(g+I));if(z>I+f)return!1;const B=(A-v)/2,N=Math.abs(l-(v+B));if(N>B+f)return!1;if(z<=I||N<=B)return!0;const G=z-I,te=N-B;return G*G+te*te<=f*f}}function nn(d,i,l,f,g){const v=o.create();return i?(o.scale(v,v,[1/g,1/g,1]),l||o.rotateZ(v,v,f.angle)):o.multiply(v,f.labelPlaneMatrix,d),v}function sn(d,i,l,f,g){if(i){const v=o.clone(d);return o.scale(v,v,[g,g,1]),l||o.rotateZ(v,v,-f.angle),v}return f.glCoordMatrix}function Gt(d,i,l){let f;l?(f=[d.x,d.y,l(d.x,d.y),1],o.transformMat4(f,f,i)):(f=[d.x,d.y,0,1],An(f,f,i));const g=f[3];return{point:new o.pointGeometry(f[0]/g,f[1]/g),signedDistanceFromCamera:g}}function Ni(d,i){return .5+d/i*.5}function gn(d,i){const l=d[0]/d[3],f=d[1]/d[3];return l>=-i[0]&&l<=i[0]&&f>=-i[1]&&f<=i[1]}function _n(d,i,l,f,g,v,w,A,I,z){const B=f?d.textSizeData:d.iconSizeData,N=o.evaluateSizeForZoom(B,l.transform.zoom),G=[256/l.width*2+1,256/l.height*2+1],te=f?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;te.clear();const Q=d.lineVertexArray,$=f?d.text.placedSymbolArray:d.icon.placedSymbolArray,de=l.transform.width/l.transform.height;let be=!1;for(let Ce=0;Ce<$.length;Ce++){const ne=$.get(Ce);if(ne.hidden||ne.writingMode===o.WritingMode.vertical&&!be){jt(ne.numGlyphs,te);continue}let ze;if(be=!1,z?(ze=[ne.anchorX,ne.anchorY,z(ne.anchorX,ne.anchorY),1],o.transformMat4(ze,ze,i)):(ze=[ne.anchorX,ne.anchorY,0,1],An(ze,ze,i)),!gn(ze,G)){jt(ne.numGlyphs,te);continue}const Me=Ni(l.transform.cameraToCenterDistance,ze[3]),Ve=o.evaluateSizeForFeature(B,N,ne),qe=w?Ve/Me:Ve*Me,it=new o.pointGeometry(ne.anchorX,ne.anchorY),je=Gt(it,g,z).point,vt={},ft=Xt(ne,qe,!1,A,i,g,v,d.glyphOffsetArray,Q,te,je,it,vt,de,I,z);be=ft.useVertical,(ft.notEnoughRoom||be||ft.needsFlipping&&Xt(ne,qe,!0,A,i,g,v,d.glyphOffsetArray,Q,te,je,it,vt,de,I,z).notEnoughRoom)&&jt(ne.numGlyphs,te)}f?d.text.dynamicLayoutVertexBuffer.updateData(te):d.icon.dynamicLayoutVertexBuffer.updateData(te)}function tr(d,i,l,f,g,v,w,A,I,z,B,N,G){const te=A.glyphStartIndex+A.numGlyphs,Q=A.lineStartIndex,$=A.lineStartIndex+A.lineLength,de=i.getoffsetX(A.glyphStartIndex),be=i.getoffsetX(te-1),Ce=Wi(d*de,l,f,g,v,w,A.segment,Q,$,I,z,B,N,G);if(!Ce)return null;const ne=Wi(d*be,l,f,g,v,w,A.segment,Q,$,I,z,B,N,G);return ne?{first:Ce,last:ne}:null}function ot(d,i,l,f){return d===o.WritingMode.horizontal&&Math.abs(l.y-i.y)>Math.abs(l.x-i.x)*f?{useVertical:!0}:(d===o.WritingMode.vertical?i.y<l.y:i.x>l.x)?{needsFlipping:!0}:null}function Xt(d,i,l,f,g,v,w,A,I,z,B,N,G,te,Q,$){const de=i/24,be=d.lineOffsetX*de,Ce=d.lineOffsetY*de;let ne;if(d.numGlyphs>1){const ze=d.glyphStartIndex+d.numGlyphs,Me=d.lineStartIndex,Ve=d.lineStartIndex+d.lineLength,qe=tr(de,A,be,Ce,l,B,N,d,I,v,G,Q,$);if(!qe)return{notEnoughRoom:!0};const it=Gt(qe.first.point,w,$).point,je=Gt(qe.last.point,w,$).point;if(f&&!l){const vt=ot(d.writingMode,it,je,te);if(vt)return vt}ne=[qe.first];for(let vt=d.glyphStartIndex+1;vt<ze-1;vt++)ne.push(Wi(de*A.getoffsetX(vt),be,Ce,l,B,N,d.segment,Me,Ve,I,v,G,Q,$));ne.push(qe.last)}else{if(f&&!l){const Me=Gt(N,g,$).point,Ve=d.lineStartIndex+d.segment+1,qe=new o.pointGeometry(I.getx(Ve),I.gety(Ve)),it=Gt(qe,g,$),je=it.signedDistanceFromCamera>0?it.point:Zt(N,qe,Me,1,g,$),vt=ot(d.writingMode,Me,je,te);if(vt)return vt}const ze=Wi(de*A.getoffsetX(d.glyphStartIndex),be,Ce,l,B,N,d.segment,d.lineStartIndex,d.lineStartIndex+d.lineLength,I,v,G,Q,$);if(!ze)return{notEnoughRoom:!0};ne=[ze]}for(const ze of ne)o.addDynamicAttributes(z,ze.point,ze.angle);return{}}function Zt(d,i,l,f,g,v){const w=Gt(d.add(d.sub(i)._unit()),g,v).point,A=l.sub(w);return l.add(A._mult(f/A.mag()))}function Wi(d,i,l,f,g,v,w,A,I,z,B,N,G,te){const Q=f?d-i:d+i;let $=Q>0?1:-1,de=0;f&&($*=-1,de=Math.PI),$<0&&(de+=Math.PI);let be=$>0?A+w:A+w+1,Ce=g,ne=g,ze=0,Me=0;const Ve=Math.abs(Q),qe=[];for(;ze+Me<=Ve;){if(be+=$,be<A||be>=I)return null;if(ne=Ce,qe.push(Ce),Ce=N[be],Ce===void 0){const xt=new o.pointGeometry(z.getx(be),z.gety(be)),Yt=Gt(xt,B,te);if(Yt.signedDistanceFromCamera>0)Ce=N[be]=Yt.point;else{const ii=be-$;Ce=Zt(ze===0?v:new o.pointGeometry(z.getx(ii),z.gety(ii)),xt,ne,Ve-ze+1,B,te)}}ze+=Me,Me=ne.dist(Ce)}const it=(Ve-ze)/Me,je=Ce.sub(ne),vt=je.mult(it)._add(ne);vt._add(je._unit()._perp()._mult(l*$));const ft=de+Math.atan2(Ce.y-ne.y,Ce.x-ne.x);return qe.push(vt),{point:vt,angle:G?ft:0,path:qe}}const Un=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function jt(d,i){for(let l=0;l<d;l++){const f=i.length;i.resize(f+4),i.float32.set(Un,3*f)}}function An(d,i,l){const f=i[0],g=i[1];return d[0]=l[0]*f+l[4]*g+l[12],d[1]=l[1]*f+l[5]*g+l[13],d[3]=l[3]*f+l[7]*g+l[15],d}const Yi=100;class Ar{constructor(i,l=new Ee(i.width+200,i.height+200,25),f=new Ee(i.width+200,i.height+200,25)){this.transform=i,this.grid=l,this.ignoredGrid=f,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Yi,this.screenBottomBoundary=i.height+Yi,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(i,l,f,g,v,w){const A=this.projectAndGetPerspectiveRatio(g,i.anchorPointX,i.anchorPointY,w),I=f*A.perspectiveRatio,z=i.x1*I+A.point.x,B=i.y1*I+A.point.y,N=i.x2*I+A.point.x,G=i.y2*I+A.point.y;return!this.isInsideGrid(z,B,N,G)||l!=="always"&&this.grid.hitTest(z,B,N,G,l,v)||A.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[z,B,N,G],offscreen:this.isOffscreen(z,B,N,G)}}placeCollisionCircles(i,l,f,g,v,w,A,I,z,B,N,G,te,Q){const $=[],de=new o.pointGeometry(l.anchorX,l.anchorY),be=Gt(de,w,Q),Ce=Ni(this.transform.cameraToCenterDistance,be.signedDistanceFromCamera),ne=(B?v/Ce:v*Ce)/o.ONE_EM,ze=Gt(de,A,Q).point,Me=tr(ne,g,l.lineOffsetX*ne,l.lineOffsetY*ne,!1,ze,de,l,f,A,{},!1,Q);let Ve=!1,qe=!1,it=!0;if(Me){const je=.5*G*Ce+te,vt=new o.pointGeometry(-100,-100),ft=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),xt=new Qi,Yt=Me.first,ii=Me.last;let Lt=[];for(let yi=Yt.path.length-1;yi>=1;yi--)Lt.push(Yt.path[yi]);for(let yi=1;yi<ii.path.length;yi++)Lt.push(ii.path[yi]);const Mi=2.5*je;if(I){const yi=Lt.map(xi=>Gt(xi,I,Q));Lt=yi.some(xi=>xi.signedDistanceFromCamera<=0)?[]:yi.map(xi=>xi.point)}let Pi=[];if(Lt.length>0){const yi=Lt[0].clone(),xi=Lt[0].clone();for(let zi=1;zi<Lt.length;zi++)yi.x=Math.min(yi.x,Lt[zi].x),yi.y=Math.min(yi.y,Lt[zi].y),xi.x=Math.max(xi.x,Lt[zi].x),xi.y=Math.max(xi.y,Lt[zi].y);Pi=yi.x>=vt.x&&xi.x<=ft.x&&yi.y>=vt.y&&xi.y<=ft.y?[Lt]:xi.x<vt.x||yi.x>ft.x||xi.y<vt.y||yi.y>ft.y?[]:o.clipLine([Lt],vt.x,vt.y,ft.x,ft.y)}for(const yi of Pi){xt.reset(yi,.25*je);let xi=0;xi=xt.length<=.5*je?1:Math.ceil(xt.paddedLength/Mi)+1;for(let zi=0;zi<xi;zi++){const yn=zi/Math.max(xi-1,1),Gr=xt.lerp(yn),Lr=Gr.x+Yi,Zr=Gr.y+Yi;$.push(Lr,Zr,je,0);const Ta=Lr-je,vr=Zr-je,Xn=Lr+je,aa=Zr+je;if(it=it&&this.isOffscreen(Ta,vr,Xn,aa),qe=qe||this.isInsideGrid(Ta,vr,Xn,aa),i!=="always"&&this.grid.hitTestCircle(Lr,Zr,je,i,N)&&(Ve=!0,!z))return{circles:[],offscreen:!1,collisionDetected:Ve}}}}return{circles:!z&&Ve||!qe||Ce<this.perspectiveRatioCutoff?[]:$,offscreen:it,collisionDetected:Ve}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let f=1/0,g=1/0,v=-1/0,w=-1/0;for(const B of i){const N=new o.pointGeometry(B.x+Yi,B.y+Yi);f=Math.min(f,N.x),g=Math.min(g,N.y),v=Math.max(v,N.x),w=Math.max(w,N.y),l.push(N)}const A=this.grid.query(f,g,v,w).concat(this.ignoredGrid.query(f,g,v,w)),I={},z={};for(const B of A){const N=B.key;if(I[N.bucketInstanceId]===void 0&&(I[N.bucketInstanceId]={}),I[N.bucketInstanceId][N.featureIndex])continue;const G=[new o.pointGeometry(B.x1,B.y1),new o.pointGeometry(B.x2,B.y1),new o.pointGeometry(B.x2,B.y2),new o.pointGeometry(B.x1,B.y2)];o.polygonIntersectsPolygon(l,G)&&(I[N.bucketInstanceId][N.featureIndex]=!0,z[N.bucketInstanceId]===void 0&&(z[N.bucketInstanceId]=[]),z[N.bucketInstanceId].push(N.featureIndex))}return z}insertCollisionBox(i,l,f,g,v,w){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:w,overlapMode:l},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,l,f,g,v,w){const A=f?this.ignoredGrid:this.grid,I={bucketInstanceId:g,featureIndex:v,collisionGroupID:w,overlapMode:l};for(let z=0;z<i.length;z+=4)A.insertCircle(I,i[z],i[z+1],i[z+2])}projectAndGetPerspectiveRatio(i,l,f,g){let v;return g?(v=[l,f,g(l,f),1],o.transformMat4(v,v,i)):(v=[l,f,0,1],An(v,v,i)),{point:new o.pointGeometry((v[0]/v[3]+1)/2*this.transform.width+Yi,(-v[1]/v[3]+1)/2*this.transform.height+Yi),perspectiveRatio:.5+this.transform.cameraToCenterDistance/v[3]*.5}}isOffscreen(i,l,f,g){return f<Yi||i>=this.screenRightBoundary||g<Yi||l>this.screenBottomBoundary}isInsideGrid(i,l,f,g){return f>=0&&i<this.gridRightBoundary&&g>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const i=o.identity([]);return o.translate(i,i,[-100,-100,0]),i}}function ji(d,i,l){return i*(o.EXTENT/(d.tileSize*Math.pow(2,l-d.tileID.overscaledZ)))}class on{constructor(i,l,f,g){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?l:-l))):g&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class bi{constructor(i,l,f,g,v){this.text=new on(i?i.text:null,l,f,v),this.icon=new on(i?i.icon:null,l,g,v)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ir{constructor(i,l,f){this.text=i,this.icon=l,this.skipFade=f}}class Nn{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class _r{constructor(i,l,f,g,v){this.bucketInstanceId=i,this.featureIndex=l,this.sourceLayerIndex=f,this.bucketIndex=g,this.tileID=v}}class Mr{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const l=++this.maxGroupID;this.collisionGroups[i]={ID:l,predicate:f=>f.collisionGroupID===l}}return this.collisionGroups[i]}}function ki(d,i,l,f,g){const{horizontalAlign:v,verticalAlign:w}=o.getAnchorAlignment(d),A=-(v-.5)*i,I=-(w-.5)*l,z=o.evaluateVariableOffset(d,f);return new o.pointGeometry(A+z[0]*g,I+z[1]*g)}function In(d,i,l,f,g,v){const{x1:w,x2:A,y1:I,y2:z,anchorPointX:B,anchorPointY:N}=d,G=new o.pointGeometry(i,l);return f&&G._rotate(g?v:-v),{x1:w+G.x,y1:I+G.y,x2:A+G.x,y2:z+G.y,anchorPointX:B,anchorPointY:N}}class K{constructor(i,l,f,g,v){this.transform=i.clone(),this.terrain=l,this.collisionIndex=new Ar(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new Mr(g),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,l,f,g){const v=f.getBucket(l),w=f.latestFeatureIndex;if(!v||!w||l.id!==v.layerIds[0])return;const A=f.collisionBoxArray,I=v.layers[0].layout,z=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),B=f.tileSize/o.EXTENT,N=this.transform.calculatePosMatrix(f.tileID.toUnwrapped()),G=I.get("text-pitch-alignment")==="map",te=I.get("text-rotation-alignment")==="map",Q=ji(f,1,this.transform.zoom),$=nn(N,G,te,this.transform,Q);let de=null;if(G){const Ce=sn(N,G,te,this.transform,Q);de=o.multiply([],this.transform.labelPlaneMatrix,Ce)}this.retainedQueryData[v.bucketInstanceId]=new _r(v.bucketInstanceId,w,v.sourceLayerIndex,v.index,f.tileID);const be={bucket:v,layout:I,posMatrix:N,textLabelPlaneMatrix:$,labelToScreenMatrix:de,scale:z,textPixelRatio:B,holdingForFade:f.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(g)for(const Ce of v.sortKeyRanges){const{sortKey:ne,symbolInstanceStart:ze,symbolInstanceEnd:Me}=Ce;i.push({sortKey:ne,symbolInstanceStart:ze,symbolInstanceEnd:Me,parameters:be})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:be})}attemptAnchorPlacement(i,l,f,g,v,w,A,I,z,B,N,G,te,Q,$,de){const be=[G.textOffset0,G.textOffset1],Ce=ki(i,f,g,be,v),ne=this.collisionIndex.placeCollisionBox(In(l,Ce.x,Ce.y,w,A,this.transform.angle),N,I,z,B.predicate,de);if((!$||this.collisionIndex.placeCollisionBox(In($,Ce.x,Ce.y,w,A,this.transform.angle),N,I,z,B.predicate,de).box.length!==0)&&ne.box.length>0){let ze;if(this.prevPlacement&&this.prevPlacement.variableOffsets[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID].text&&(ze=this.prevPlacement.variableOffsets[G.crossTileID].anchor),G.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[G.crossTileID]={textOffset:be,width:f,height:g,anchor:i,textBoxScale:v,prevAnchor:ze},this.markUsedJustification(te,i,G,Q),te.allowVerticalPlacement&&(this.markUsedOrientation(te,Q,G),this.placedOrientations[G.crossTileID]=Q),{shift:Ce,placedGlyphBoxes:ne}}}placeLayerBucketPart(i,l,f){const{bucket:g,layout:v,posMatrix:w,textLabelPlaneMatrix:A,labelToScreenMatrix:I,textPixelRatio:z,holdingForFade:B,collisionBoxArray:N,partiallyEvaluatedTextSize:G,collisionGroup:te}=i.parameters,Q=v.get("text-optional"),$=v.get("icon-optional"),de=o.getOverlapMode(v,"text-overlap","text-allow-overlap"),be=de==="always",Ce=o.getOverlapMode(v,"icon-overlap","icon-allow-overlap"),ne=Ce==="always",ze=v.get("text-rotation-alignment")==="map",Me=v.get("text-pitch-alignment")==="map",Ve=v.get("icon-text-fit")!=="none",qe=v.get("symbol-z-order")==="viewport-y",it=be&&(ne||!g.hasIconData()||$),je=ne&&(be||!g.hasTextData()||Q);!g.collisionArrays&&N&&g.deserializeCollisionBoxes(N);const vt=(ft,xt)=>{if(l[ft.crossTileID])return;if(B)return void(this.placements[ft.crossTileID]=new Ir(!1,!1,!1));let Yt=!1,ii=!1,Lt=!0,Mi=null,Pi={box:null,offscreen:null},yi={box:null,offscreen:null},xi=null,zi=null,yn=null,Gr=0,Lr=0,Zr=0;xt.textFeatureIndex?Gr=xt.textFeatureIndex:ft.useRuntimeCollisionCircles&&(Gr=ft.featureIndex),xt.verticalTextFeatureIndex&&(Lr=xt.verticalTextFeatureIndex);const Ta=this.retainedQueryData[g.bucketInstanceId].tileID,vr=this.terrain?(pn,oi)=>this.terrain.getElevation(Ta,pn,oi):null;for(const pn of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const oi=xt[pn];oi&&(oi.elevation=vr?vr(oi.anchorPointX,oi.anchorPointY):0)}const Xn=xt.textBox;if(Xn){const pn=Ai=>{let vn=o.WritingMode.horizontal;if(g.allowVerticalPlacement&&!Ai&&this.prevPlacement){const xn=this.prevPlacement.placedOrientations[ft.crossTileID];xn&&(this.placedOrientations[ft.crossTileID]=xn,vn=xn,this.markUsedOrientation(g,vn,ft))}return vn},oi=(Ai,vn)=>{if(g.allowVerticalPlacement&&ft.numVerticalGlyphVertices>0&&xt.verticalTextBox){for(const xn of g.writingModes)if(xn===o.WritingMode.vertical?(Pi=vn(),yi=Pi):Pi=Ai(),Pi&&Pi.box&&Pi.box.length)break}else Pi=Ai()};if(v.get("text-variable-anchor")){let Ai=v.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ft.crossTileID]){const Gi=this.prevPlacement.variableOffsets[ft.crossTileID];Ai.indexOf(Gi.anchor)>0&&(Ai=Ai.filter(xr=>xr!==Gi.anchor),Ai.unshift(Gi.anchor))}const vn=(Gi,xr,Va)=>{const Ml=Gi.x2-Gi.x1,ys=Gi.y2-Gi.y1,Jc=ft.textBoxScale,Pl=Ve&&Ce==="never"?xr:null;let ka={box:[],offscreen:!1};const qa=de!=="never"?2*Ai.length:Ai.length;for(let Ga=0;Ga<qa;++Ga){const Lo=this.attemptAnchorPlacement(Ai[Ga%Ai.length],Gi,Ml,ys,Jc,ze,Me,z,w,te,Ga>=Ai.length?de:"never",ft,g,Va,Pl,vr);if(Lo&&(ka=Lo.placedGlyphBoxes,ka&&ka.box&&ka.box.length)){Yt=!0,Mi=Lo.shift;break}}return ka};oi(()=>vn(Xn,xt.iconBox,o.WritingMode.horizontal),()=>{const Gi=xt.verticalTextBox;return g.allowVerticalPlacement&&!(Pi&&Pi.box&&Pi.box.length)&&ft.numVerticalGlyphVertices>0&&Gi?vn(Gi,xt.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null}}),Pi&&(Yt=Pi.box,Lt=Pi.offscreen);const xn=pn(Pi&&Pi.box);if(!Yt&&this.prevPlacement){const Gi=this.prevPlacement.variableOffsets[ft.crossTileID];Gi&&(this.variableOffsets[ft.crossTileID]=Gi,this.markUsedJustification(g,Gi.anchor,ft,xn))}}else{const Ai=(vn,xn)=>{const Gi=this.collisionIndex.placeCollisionBox(vn,de,z,w,te.predicate,vr);return Gi&&Gi.box&&Gi.box.length&&(this.markUsedOrientation(g,xn,ft),this.placedOrientations[ft.crossTileID]=xn),Gi};oi(()=>Ai(Xn,o.WritingMode.horizontal),()=>{const vn=xt.verticalTextBox;return g.allowVerticalPlacement&&ft.numVerticalGlyphVertices>0&&vn?Ai(vn,o.WritingMode.vertical):{box:null,offscreen:null}}),pn(Pi&&Pi.box&&Pi.box.length)}}if(xi=Pi,Yt=xi&&xi.box&&xi.box.length>0,Lt=xi&&xi.offscreen,ft.useRuntimeCollisionCircles){const pn=g.text.placedSymbolArray.get(ft.centerJustifiedTextSymbolIndex),oi=o.evaluateSizeForFeature(g.textSizeData,G,pn),Ai=v.get("text-padding");zi=this.collisionIndex.placeCollisionCircles(de,pn,g.lineVertexArray,g.glyphOffsetArray,oi,w,A,I,f,Me,te.predicate,ft.collisionCircleDiameter,Ai,vr),zi.circles.length&&zi.collisionDetected&&!f&&o.warnOnce("Collisions detected, but collision boxes are not shown"),Yt=be||zi.circles.length>0&&!zi.collisionDetected,Lt=Lt&&zi.offscreen}if(xt.iconFeatureIndex&&(Zr=xt.iconFeatureIndex),xt.iconBox){const pn=oi=>{const Ai=Ve&&Mi?In(oi,Mi.x,Mi.y,ze,Me,this.transform.angle):oi;return this.collisionIndex.placeCollisionBox(Ai,Ce,z,w,te.predicate,vr)};yi&&yi.box&&yi.box.length&&xt.verticalIconBox?(yn=pn(xt.verticalIconBox),ii=yn.box.length>0):(yn=pn(xt.iconBox),ii=yn.box.length>0),Lt=Lt&&yn.offscreen}const aa=Q||ft.numHorizontalGlyphVertices===0&&ft.numVerticalGlyphVertices===0,Do=$||ft.numIconVertices===0;if(aa||Do?Do?aa||(ii=ii&&Yt):Yt=ii&&Yt:ii=Yt=ii&&Yt,Yt&&xi&&xi.box&&this.collisionIndex.insertCollisionBox(xi.box,de,v.get("text-ignore-placement"),g.bucketInstanceId,yi&&yi.box&&Lr?Lr:Gr,te.ID),ii&&yn&&this.collisionIndex.insertCollisionBox(yn.box,Ce,v.get("icon-ignore-placement"),g.bucketInstanceId,Zr,te.ID),zi&&(Yt&&this.collisionIndex.insertCollisionCircles(zi.circles,de,v.get("text-ignore-placement"),g.bucketInstanceId,Gr,te.ID),f)){const pn=g.bucketInstanceId;let oi=this.collisionCircleArrays[pn];oi===void 0&&(oi=this.collisionCircleArrays[pn]=new Nn);for(let Ai=0;Ai<zi.circles.length;Ai+=4)oi.circles.push(zi.circles[Ai+0]),oi.circles.push(zi.circles[Ai+1]),oi.circles.push(zi.circles[Ai+2]),oi.circles.push(zi.collisionDetected?1:0)}if(ft.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(g.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ft.crossTileID]=new Ir(Yt||it,ii||je,Lt||g.justReloaded),l[ft.crossTileID]=!0};if(qe){if(i.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const ft=g.getSortedSymbolIndexes(this.transform.angle);for(let xt=ft.length-1;xt>=0;--xt){const Yt=ft[xt];vt(g.symbolInstances.get(Yt),g.collisionArrays[Yt])}}else for(let ft=i.symbolInstanceStart;ft<i.symbolInstanceEnd;ft++)vt(g.symbolInstances.get(ft),g.collisionArrays[ft]);if(f&&g.bucketInstanceId in this.collisionCircleArrays){const ft=this.collisionCircleArrays[g.bucketInstanceId];o.invert(ft.invProjMatrix,w),ft.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}markUsedJustification(i,l,f,g){let v;v=g===o.WritingMode.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(l)];const w=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];for(const A of w)A>=0&&(i.text.placedSymbolArray.get(A).crossTileID=v>=0&&A!==v?0:f.crossTileID)}markUsedOrientation(i,l,f){const g=l===o.WritingMode.horizontal||l===o.WritingMode.horizontalOnly?l:0,v=l===o.WritingMode.vertical?l:0,w=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];for(const A of w)i.text.placedSymbolArray.get(A).placedOrientation=g;f.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let f=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const g=l?l.symbolFadeChange(i):1,v=l?l.opacities:{},w=l?l.variableOffsets:{},A=l?l.placedOrientations:{};for(const I in this.placements){const z=this.placements[I],B=v[I];B?(this.opacities[I]=new bi(B,g,z.text,z.icon),f=f||z.text!==B.text.placed||z.icon!==B.icon.placed):(this.opacities[I]=new bi(null,g,z.text,z.icon,z.skipFade),f=f||z.text||z.icon)}for(const I in v){const z=v[I];if(!this.opacities[I]){const B=new bi(z,g,!1,!1);B.isHidden()||(this.opacities[I]=B,f=f||z.text.placed||z.icon.placed)}}for(const I in w)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=w[I]);for(const I in A)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=A[I]);if(l&&l.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");f?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:i)}updateLayerOpacities(i,l){const f={};for(const g of l){const v=g.getBucket(i);v&&g.latestFeatureIndex&&i.id===v.layerIds[0]&&this.updateBucketOpacities(v,f,g.collisionBoxArray)}}updateBucketOpacities(i,l,f){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const g=i.layers[0].layout,v=new bi(null,0,!1,!1,!0),w=g.get("text-allow-overlap"),A=g.get("icon-allow-overlap"),I=g.get("text-variable-anchor"),z=g.get("text-rotation-alignment")==="map",B=g.get("text-pitch-alignment")==="map",N=g.get("icon-text-fit")!=="none",G=new bi(null,0,w&&(A||!i.hasIconData()||g.get("icon-optional")),A&&(w||!i.hasTextData()||g.get("text-optional")),!0);!i.collisionArrays&&f&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(f);const te=(Q,$,de)=>{for(let be=0;be<$/4;be++)Q.opacityVertexArray.emplaceBack(de)};for(let Q=0;Q<i.symbolInstances.length;Q++){const $=i.symbolInstances.get(Q),{numHorizontalGlyphVertices:de,numVerticalGlyphVertices:be,crossTileID:Ce}=$;let ne=this.opacities[Ce];l[Ce]?ne=v:ne||(ne=G,this.opacities[Ce]=ne),l[Ce]=!0;const ze=$.numIconVertices>0,Me=this.placedOrientations[$.crossTileID],Ve=Me===o.WritingMode.vertical,qe=Me===o.WritingMode.horizontal||Me===o.WritingMode.horizontalOnly;if(de>0||be>0){const it=ye(ne.text);te(i.text,de,Ve?Ue:it),te(i.text,be,qe?Ue:it);const je=ne.text.isHidden();[$.rightJustifiedTextSymbolIndex,$.centerJustifiedTextSymbolIndex,$.leftJustifiedTextSymbolIndex].forEach(xt=>{xt>=0&&(i.text.placedSymbolArray.get(xt).hidden=je||Ve?1:0)}),$.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get($.verticalPlacedTextSymbolIndex).hidden=je||qe?1:0);const vt=this.variableOffsets[$.crossTileID];vt&&this.markUsedJustification(i,vt.anchor,$,Me);const ft=this.placedOrientations[$.crossTileID];ft&&(this.markUsedJustification(i,"left",$,ft),this.markUsedOrientation(i,ft,$))}if(ze){const it=ye(ne.icon),je=!(N&&$.verticalPlacedIconSymbolIndex&&Ve);$.placedIconSymbolIndex>=0&&(te(i.icon,$.numIconVertices,je?it:Ue),i.icon.placedSymbolArray.get($.placedIconSymbolIndex).hidden=ne.icon.isHidden()),$.verticalPlacedIconSymbolIndex>=0&&(te(i.icon,$.numVerticalIconVertices,je?Ue:it),i.icon.placedSymbolArray.get($.verticalPlacedIconSymbolIndex).hidden=ne.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const it=i.collisionArrays[Q];if(it){let je=new o.pointGeometry(0,0);if(it.textBox||it.verticalTextBox){let ft=!0;if(I){const xt=this.variableOffsets[Ce];xt?(je=ki(xt.anchor,xt.width,xt.height,xt.textOffset,xt.textBoxScale),z&&je._rotate(B?this.transform.angle:-this.transform.angle)):ft=!1}it.textBox&&D(i.textCollisionBox.collisionVertexArray,ne.text.placed,!ft||Ve,je.x,je.y),it.verticalTextBox&&D(i.textCollisionBox.collisionVertexArray,ne.text.placed,!ft||qe,je.x,je.y)}const vt=Boolean(!qe&&it.verticalIconBox);it.iconBox&&D(i.iconCollisionBox.collisionVertexArray,ne.icon.placed,vt,N?je.x:0,N?je.y:0),it.verticalIconBox&&D(i.iconCollisionBox.collisionVertexArray,ne.icon.placed,!vt,N?je.x:0,N?je.y:0)}}}if(i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.text.opacityVertexArray.length!==i.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${i.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${i.text.layoutVertexArray.length}) / 4`);if(i.icon.opacityVertexArray.length!==i.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${i.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${i.icon.layoutVertexArray.length}) / 4`);if(i.bucketInstanceId in this.collisionCircleArrays){const Q=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=Q.invProjMatrix,i.placementViewportMatrix=Q.viewportMatrix,i.collisionCircleArray=Q.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,l){const f=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*f>i}setStale(){this.stale=!0}}function D(d,i,l,f,g){d.emplaceBack(i?1:0,l?1:0,f||0,g||0),d.emplaceBack(i?1:0,l?1:0,f||0,g||0),d.emplaceBack(i?1:0,l?1:0,f||0,g||0),d.emplaceBack(i?1:0,l?1:0,f||0,g||0)}const U=Math.pow(2,25),W=Math.pow(2,24),X=Math.pow(2,17),se=Math.pow(2,16),me=Math.pow(2,9),he=Math.pow(2,8),ae=Math.pow(2,1);function ye(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const i=d.placed?1:0,l=Math.floor(127*d.opacity);return l*U+i*W+l*X+i*se+l*me+i*he+l*ae+i}const Ue=0;class Ye{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&!i.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,l,f,g,v){const w=this._bucketParts;for(;this._currentTileIndex<i.length;)if(l.getBucketParts(w,g,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((A,I)=>A.sortKey-I.sortKey));this._currentPartIndex<w.length;)if(l.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,v())return!0;return!1}}class Be{constructor(i,l,f,g,v,w,A,I){this.placement=new K(i,l,w,A,I),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(i,l,f){const g=o.exported.now(),v=()=>{const w=o.exported.now()-g;return!this._forceFullPlacement&&w>2};for(;this._currentPlacementIndex>=0;){const w=l[i[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=A)&&(!w.maxzoom||w.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new Ye(w)),this._inProgressLayer.continuePlacement(f[w.source],this.placement,this._showCollisionBoxes,w,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const kt=512/o.EXTENT/2;class St{constructor(i,l,f){this.tileID=i,this.indexedSymbolInstances={},this.bucketInstanceId=f;for(let g=0;g<l.length;g++){const v=l.get(g),w=v.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:v.crossTileID,coord:this.getScaledCoordinates(v,i)})}}getScaledCoordinates(i,l){const f=kt/Math.pow(2,l.canonical.z-this.tileID.canonical.z);return{x:Math.floor((l.canonical.x*o.EXTENT+i.anchorX)*f),y:Math.floor((l.canonical.y*o.EXTENT+i.anchorY)*f)}}findMatches(i,l,f){const g=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let v=0;v<i.length;v++){const w=i.get(v);if(w.crossTileID)continue;const A=this.indexedSymbolInstances[w.key];if(!A)continue;const I=this.getScaledCoordinates(w,l);for(const z of A)if(Math.abs(z.coord.x-I.x)<=g&&Math.abs(z.coord.y-I.y)<=g&&!f[z.crossTileID]){f[z.crossTileID]=!0,w.crossTileID=z.crossTileID;break}}}}class ht{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Dt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const l=Math.round((i-this.lng)/360);if(l!==0)for(const f in this.indexes){const g=this.indexes[f],v={};for(const w in g){const A=g[w];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+l),v[A.tileID.key]=A}this.indexes[f]=v}this.lng=i}addBucket(i,l,f){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let v=0;v<l.symbolInstances.length;v++)l.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const g=this.usedCrossTileIDs[i.overscaledZ];for(const v in this.indexes){const w=this.indexes[v];if(Number(v)>i.overscaledZ)for(const A in w){const I=w[A];I.tileID.isChildOf(i)&&I.findMatches(l.symbolInstances,i,g)}else{const A=w[i.scaledTo(Number(v)).key];A&&A.findMatches(l.symbolInstances,i,g)}}for(let v=0;v<l.symbolInstances.length;v++){const w=l.symbolInstances.get(v);w.crossTileID||(w.crossTileID=f.generate(),g[w.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new St(i,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(i,l){for(const f in l.indexedSymbolInstances)for(const g of l.indexedSymbolInstances[f])delete this.usedCrossTileIDs[i][g.crossTileID]}removeStaleBuckets(i){let l=!1;for(const f in this.indexes){const g=this.indexes[f];for(const v in g)i[g[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,g[v]),delete g[v],l=!0)}return l}}class Bt{constructor(){this.layerIndexes={},this.crossTileIDs=new ht,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,l,f){let g=this.layerIndexes[i.id];g===void 0&&(g=this.layerIndexes[i.id]=new Dt);let v=!1;const w={};g.handleWrapJump(f);for(const A of l){const I=A.getBucket(i);I&&i.id===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(A.tileID,I,this.crossTileIDs)&&(v=!0),w[I.bucketInstanceId]=!0)}return g.removeStaleBuckets(w)&&(v=!0),v}pruneUnusedLayers(i){const l={};i.forEach(f=>{l[f]=!0});for(const f in this.layerIndexes)l[f]||delete this.layerIndexes[f]}}var ri=o.createLayout([{name:"a_pos",type:"Int16",components:2}]);class Vt extends o.Evented{constructor(i){super(),this.sourceCache=i,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=i._cache.max,i.usedForTerrain=!0,i.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const i in this._tiles){const l=this._tiles[i];l.textures.forEach(f=>f.destroy()),l.textures=[]}}update(i,l){this.sourceCache.update(i,l),this._renderableTilesKeys=[];for(const f of i.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:l}))this._renderableTilesKeys.push(f.key),this._tiles[f.key]||(f.posMatrix=new Float64Array(16),o.ortho(f.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),this._tiles[f.key]=new li(f,this.tileSize))}removeOutdated(i){const l={};this.renderHistory=this.renderHistory.filter((f,g)=>this.renderHistory.indexOf(f)===g).slice(0,this.renderHistorySize);for(const f of this._renderableTilesKeys)l[f]=!0;for(const f of this.renderHistory)l[f]=!0;for(const f in this._tiles)l[f]||(this._tiles[f].clearTextures(i),delete this._tiles[f])}getRenderableTiles(){return this._renderableTilesKeys.map(i=>this.getTileByID(i))}getTileByID(i){return this._tiles[i]}getTerrainCoords(i){const l={};for(const f of this._renderableTilesKeys){const g=this._tiles[f].tileID;if(g.canonical.equals(i.canonical)){const v=i.clone();v.posMatrix=new Float64Array(16),o.ortho(v.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),l[f]=v}else if(g.canonical.isChildOf(i.canonical)){const v=i.clone();v.posMatrix=new Float64Array(16);const w=g.canonical.z-i.canonical.z,A=g.canonical.x-(g.canonical.x>>w<<w),I=g.canonical.y-(g.canonical.y>>w<<w),z=o.EXTENT>>w;o.ortho(v.posMatrix,0,z,0,z,0,1),o.translate(v.posMatrix,v.posMatrix,[-A*z,-I*z,0]),l[f]=v}else if(i.canonical.isChildOf(g.canonical)){const v=i.clone();v.posMatrix=new Float64Array(16);const w=i.canonical.z-g.canonical.z,A=i.canonical.x-(i.canonical.x>>w<<w),I=i.canonical.y-(i.canonical.y>>w<<w),z=o.EXTENT>>w;o.ortho(v.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),o.translate(v.posMatrix,v.posMatrix,[A*z,I*z,0]),o.scale(v.posMatrix,v.posMatrix,[1/2**w,1/2**w,0]),l[f]=v}}return l}getSourceTile(i,l){const f=this.sourceCache._source;let g=i.overscaledZ-this.deltaZoom;if(g>f.maxzoom&&(g=f.maxzoom),g<f.minzoom)return null;this._sourceTileCache[i.key]||(this._sourceTileCache[i.key]=i.scaledTo(g).key);let v=this.sourceCache.getTileByID(this._sourceTileCache[i.key]);if((!v||!v.dem)&&l)for(;g>=f.minzoom&&(!v||!v.dem);)v=this.sourceCache.getTileByID(i.scaledTo(g--).key);return v}tilesAfterTime(i=Date.now()){return Object.values(this._tiles).filter(l=>l.timeLoaded>=i)}}class Wt{constructor(i,l,f){this.style=i,this.sourceCache=new Vt(l),this.options=f,this.exaggeration=typeof f.exaggeration=="number"?f.exaggeration:1,this.elevationOffset=typeof f.elevationOffset=="number"?f.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(i,l,f,g=o.EXTENT){if(!(l>=0&&l<g&&f>=0&&f<g))return this.elevationOffset;let v=0;const w=this.getTerrainData(i);if(w.tile&&w.tile.dem){const A=o.transformMat4$1([],[l/g*o.EXTENT,f/g*o.EXTENT],w.u_terrain_matrix),I=[A[0]*w.tile.dem.dim,A[1]*w.tile.dem.dim],z=[Math.floor(I[0]),Math.floor(I[1])],B=w.tile.dem.get(z[0],z[1]),N=w.tile.dem.get(z[0],z[1]+1),G=w.tile.dem.get(z[0]+1,z[1]),te=w.tile.dem.get(z[0]+1,z[1]+1);v=o.number(o.number(B,N,I[0]-z[0]),o.number(G,te,I[0]-z[0]),I[1]-z[1])}return v}rememberForRerender(i,l){for(const f in this.sourceCache._tiles){const g=this.sourceCache._tiles[f];(g.tileID.equals(l)||g.tileID.isChildOf(l))&&(i===this.sourceCache.sourceCache.id&&(g.timeLoaded=Date.now()),this._rerender[i]=this._rerender[i]||{},this._rerender[i][g.tileID.key]=!0)}}needsRerender(i,l){return this._rerender[i]&&this._rerender[i][l.key]}clearRerenderCache(){this._rerender={}}getElevation(i,l,f,g=o.EXTENT){return(this.getDEMElevation(i,l,f,g)+this.elevationOffset)*this.exaggeration}getTerrainData(i){if(!this._emptyDemTexture){const g=this.style.map.painter.context,v=new o.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new q(g,v,g.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new q(g,new o.RGBAImage({width:1,height:1}),g.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.identity([])}const l=this.sourceCache.getSourceTile(i,!0);if(l&&l.dem&&(!l.demTexture||l.needsTerrainPrepare)){const g=this.style.map.painter.context;l.demTexture=this.style.map.painter.getTileTexture(l.dem.stride),l.demTexture?l.demTexture.update(l.dem.getPixels(),{premultiply:!1}):l.demTexture=new q(g,l.dem.getPixels(),g.gl.RGBA,{premultiply:!1}),l.demTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),l.needsTerrainPrepare=!1}const f=l&&l+l.tileID.key+i.key;if(f&&!this._demMatrixCache[f]){const g=this.sourceCache.sourceCache._source.maxzoom;let v=i.canonical.z-l.tileID.canonical.z;i.overscaledZ>i.canonical.z&&(i.canonical.z>=g?v=i.canonical.z-g:o.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=i.canonical.x-(i.canonical.x>>v<<v),A=i.canonical.y-(i.canonical.y>>v<<v),I=o.fromScaling(new Float64Array(16),[1/(o.EXTENT<<v),1/(o.EXTENT<<v),0]);o.translate(I,I,[w*o.EXTENT,A*o.EXTENT,0]),this._demMatrixCache[i.key]={matrix:I,coord:i}}return{u_depth:2,u_terrain:3,u_terrain_dim:l&&l.dem&&l.dem.dim||1,u_terrain_matrix:f?this._demMatrixCache[i.key].matrix:this._emptyDemMatrix,u_terrain_unpack:l&&l.dem&&l.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(l&&l.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:l}}getRTTFramebuffer(){const i=this.style.map.painter;if(!this._rttFramebuffer){const l=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=i.context.createFramebuffer(l,l,!0),this._rttFramebuffer.depthAttachment.set(i.context.createRenderbuffer(i.context.gl.DEPTH_COMPONENT16,l,l))}return this._rttFramebuffer}getFramebuffer(i){const l=this.style.map.painter,f=l.width/devicePixelRatio,g=l.height/devicePixelRatio;return!this._fbo||this._fbo.width===f&&this._fbo.height===g||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new q(l.context,{width:f,height:g,data:null},l.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(l.context.gl.NEAREST,l.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new q(l.context,{width:f,height:g,data:null},l.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(l.context.gl.NEAREST,l.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=l.context.createFramebuffer(f,g,!0),this._fbo.depthAttachment.set(l.context.createRenderbuffer(l.context.gl.DEPTH_COMPONENT16,f,g))),this._fbo.colorAttachment.set(i==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const i=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const l=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let v=0,w=0;v<this._coordsTextureSize;v++)for(let A=0;A<this._coordsTextureSize;A++,w+=4)l[w+0]=255&A,l[w+1]=255&v,l[w+2]=A>>8<<4|v>>8,l[w+3]=0;const f=new o.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(l.buffer)),g=new q(i,f,i.gl.RGBA,{premultiply:!1});return g.bind(i.gl.NEAREST,i.gl.CLAMP_TO_EDGE),this._coordsTexture=g,g}pointCoordinate(i){const l=new Uint8Array(4),f=this.style.map.painter,g=f.context,v=g.gl;g.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),v.readPixels(i.x,f.height/devicePixelRatio-i.y-1,1,1,v.RGBA,v.UNSIGNED_BYTE,l),g.bindFramebuffer.set(null);const w=l[0]+(l[2]>>4<<8),A=l[1]+((15&l[2])<<8),I=this.coordsIndex[255-l[3]],z=I&&this.sourceCache.getTileByID(I);if(!z)return null;const B=this._coordsTextureSize,N=(1<<z.tileID.canonical.z)*B;return new o.MercatorCoordinate((z.tileID.canonical.x*B+w)/N,(z.tileID.canonical.y*B+A)/N,this.getElevation(z.tileID,w,A,B))}getTerrainMesh(){if(this._mesh)return this._mesh;const i=this.style.map.painter.context,l=new o.PosArray,f=new o.TriangleIndexArray,g=this.meshSize,v=o.EXTENT/g,w=g*g;for(let A=0;A<=g;A++)for(let I=0;I<=g;I++)l.emplaceBack(I*v,A*v);for(let A=0;A<w;A+=g+1)for(let I=0;I<g;I++)f.emplaceBack(I+A,g+I+A+1,g+I+A+2),f.emplaceBack(I+A,g+I+A+2,I+A+1);return this._mesh={indexBuffer:i.createIndexBuffer(f),vertexBuffer:i.createVertexBuffer(l,ri.members),segments:o.SegmentVector.simpleSegment(0,0,l.length,f.length)},this._mesh}getMinMaxElevation(i){const l=this.getTerrainData(i).tile,f={minElevation:null,maxElevation:null};return l&&l.dem&&(f.minElevation=(l.dem.min+this.elevationOffset)*this.exaggeration,f.maxElevation=(l.dem.max+this.elevationOffset)*this.exaggeration),f}}const ai=(d,i)=>o.emitValidationErrors(d,i&&i.filter(l=>l.identifier!=="source.canvas")),wi=o.pick(Qt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Xi=o.pick(Qt,["setCenter","setZoom","setBearing","setPitch"]),Ii=function(){const d={},i=o.spec.$version;for(const l in o.spec.$root){const f=o.spec.$root[l];if(f.required){let g=null;g=l==="version"?i:f.type==="array"?[]:{},g!=null&&(d[l]=g)}}return d}();class $i extends o.Evented{constructor(i,l={}){super(),this.map=i,this.dispatcher=new pe(ci(),this),this.imageManager=new ee,this.imageManager.setEventedParent(this),this.glyphManager=new le(i._requestManager,l.localIdeographFontFamily),this.lineAtlas=new ve(256,512),this.crossTileSymbolIndex=new Bt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const f=this;this._rtlTextPluginCallback=$i.registerForPluginStateChange(g=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(v,w)=>{if(o.triggerPluginCompletionEvent(v),w&&w.every(A=>A))for(const A in f.sourceCaches)f.sourceCaches[A].reload()})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const v=this.sourceCaches[g.sourceId];if(!v)return;const w=v.getSource();if(w&&w.vectorLayerIds)for(const A in this._layers){const I=this._layers[A];I.source===w.id&&this._validateLayer(I)}})}loadURL(i,l={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const f=typeof l.validate!="boolean"||l.validate,g=this.map._requestManager.transformRequest(i,o.ResourceType.Style);this._request=o.getJSON(g,(v,w)=>{this._request=null,v?this.fire(new o.ErrorEvent(v)):w&&this._load(w,f)})}loadJSON(i,l={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(i,l.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(Ii,!1)}_load(i,l){if(l&&ai(this,o.validateStyle(i)))return;this._loaded=!0,this.stylesheet=i;for(const g in i.sources)this.addSource(g,i.sources[g],{validate:!1});i.sprite?this._loadSprite(i.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(i.glyphs);const f=fi(this.stylesheet.layers);this._order=f.map(g=>g.id),this._layers={},this._serializedLayers={};for(let g of f)g=o.createStyleLayer(g),g.setEventedParent(this,{layer:{id:g.id}}),this._layers[g.id]=g,this._serializedLayers[g.id]=g.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Je(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}_loadSprite(i){this._spriteRequest=function(l,f,g,v){let w,A,I;const z=g>1?"@2x":"";let B=o.getJSON(f.transformRequest(f.normalizeSpriteURL(l,z,".json"),o.ResourceType.SpriteJSON),(te,Q)=>{B=null,I||(I=te,w=Q,G())}),N=o.getImage(f.transformRequest(f.normalizeSpriteURL(l,z,".png"),o.ResourceType.SpriteImage),(te,Q)=>{N=null,I||(I=te,A=Q,G())});function G(){if(I)v(I);else if(w&&A){const te=o.exported.getImageData(A),Q={};for(const $ in w){const{width:de,height:be,x:Ce,y:ne,sdf:ze,pixelRatio:Me,stretchX:Ve,stretchY:qe,content:it}=w[$],je=new o.RGBAImage({width:de,height:be});o.RGBAImage.copy(te,je,{x:Ce,y:ne},{x:0,y:0},{width:de,height:be}),Q[$]={data:je,pixelRatio:Me,sdf:ze,stretchX:Ve,stretchY:qe,content:it}}v(null,Q)}}return{cancel(){B&&(B.cancel(),B=null),N&&(N.cancel(),N=null)}}}(i,this.map._requestManager,this.map.getPixelRatio(),(l,f)=>{if(this._spriteRequest=null,l)this.fire(new o.ErrorEvent(l));else if(f)for(const g in f)this.imageManager.addImage(g,f[g]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(i){const l=this.sourceCaches[i.source];if(!l)return;const f=i.sourceLayer;if(!f)return;const g=l.getSource();(g.type==="geojson"||g.vectorLayerIds&&g.vectorLayerIds.indexOf(f)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${f}" does not exist on source "${g.id}" as specified by style layer "${i.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this.sourceCaches)if(!this.sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(i){const l=[];for(const f of i){const g=this._layers[f];g.type!=="custom"&&l.push(g.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const i in this.sourceCaches)if(this.sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(i){if(!this._loaded)return;const l=this._changed;if(this._changed){const g=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(g.length||v.length)&&this._updateWorkerLayers(g,v);for(const w in this._updatedSources){const A=this._updatedSources[w];if(A==="reload")this._reloadSource(w);else{if(A!=="clear")throw new Error(`Invalid action ${A}`);this._clearSource(w)}}this._updateTilesForChangedImages();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(i);this.light.updateTransitions(i),this._resetUpdates()}const f={};for(const g in this.sourceCaches){const v=this.sourceCaches[g];f[g]=v.used,v.used=!1}for(const g of this._order){const v=this._layers[g];v.recalculate(i,this._availableImages),!v.isHidden(i.zoom)&&v.source&&(this.sourceCaches[v.source].used=!0)}for(const g in f){const v=this.sourceCaches[g];f[g]!==v.used&&v.fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(i),this.z=i.zoom,l&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const l in this.sourceCaches)this.sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateWorkerLayers(i,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(i),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(i){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),i){const l=this.sourceCaches[i.source];if(!l)throw new Error(`cannot load terrain, because there exists no source with ID: ${i.source}`);this.terrain=new Wt(this,l,i),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=f=>{f.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=f=>{f.tile&&(f.sourceId===i.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(f.sourceId,f.tile.tileID)):f.source.type==="geojson"&&this.terrain.rememberForRerender(f.sourceId,f.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new o.Event("terrain",{terrain:i}))}setState(i){if(this._checkLoaded(),ai(this,o.validateStyle(i)))return!1;(i=o.clone$1(i)).layers=fi(i.layers);const l=function(g,v){if(!g)return[{command:Qt.setStyle,args:[v]}];let w=[];try{if(!P(g.version,v.version))return[{command:Qt.setStyle,args:[v]}];P(g.center,v.center)||w.push({command:Qt.setCenter,args:[v.center]}),P(g.zoom,v.zoom)||w.push({command:Qt.setZoom,args:[v.zoom]}),P(g.bearing,v.bearing)||w.push({command:Qt.setBearing,args:[v.bearing]}),P(g.pitch,v.pitch)||w.push({command:Qt.setPitch,args:[v.pitch]}),P(g.sprite,v.sprite)||w.push({command:Qt.setSprite,args:[v.sprite]}),P(g.glyphs,v.glyphs)||w.push({command:Qt.setGlyphs,args:[v.glyphs]}),P(g.transition,v.transition)||w.push({command:Qt.setTransition,args:[v.transition]}),P(g.light,v.light)||w.push({command:Qt.setLight,args:[v.light]});const A={},I=[];(function(B,N,G,te){let Q;for(Q in N=N||{},B=B||{})Object.prototype.hasOwnProperty.call(B,Q)&&(Object.prototype.hasOwnProperty.call(N,Q)||kn(Q,G,te));for(Q in N)Object.prototype.hasOwnProperty.call(N,Q)&&(Object.prototype.hasOwnProperty.call(B,Q)?P(B[Q],N[Q])||(B[Q].type==="geojson"&&N[Q].type==="geojson"&&Hn(B,N,Q)?G.push({command:Qt.setGeoJSONSourceData,args:[Q,N[Q].data]}):Sn(Q,N,G,te)):fn(Q,N,G))})(g.sources,v.sources,I,A);const z=[];g.layers&&g.layers.forEach(B=>{A[B.source]?w.push({command:Qt.removeLayer,args:[B.id]}):z.push(B)}),w=w.concat(I),function(B,N,G){N=N||[];const te=(B=B||[]).map(si),Q=N.map(si),$=B.reduce(Ui,{}),de=N.reduce(Ui,{}),be=te.slice(),Ce=Object.create(null);let ne,ze,Me,Ve,qe,it,je;for(ne=0,ze=0;ne<te.length;ne++)Me=te[ne],Object.prototype.hasOwnProperty.call(de,Me)?ze++:(G.push({command:Qt.removeLayer,args:[Me]}),be.splice(be.indexOf(Me,ze),1));for(ne=0,ze=0;ne<Q.length;ne++)Me=Q[Q.length-1-ne],be[be.length-1-ne]!==Me&&(Object.prototype.hasOwnProperty.call($,Me)?(G.push({command:Qt.removeLayer,args:[Me]}),be.splice(be.lastIndexOf(Me,be.length-ze),1)):ze++,it=be[be.length-ne],G.push({command:Qt.addLayer,args:[de[Me],it]}),be.splice(be.length-ne,0,Me),Ce[Me]=!0);for(ne=0;ne<Q.length;ne++)if(Me=Q[ne],Ve=$[Me],qe=de[Me],!Ce[Me]&&!P(Ve,qe))if(P(Ve.source,qe.source)&&P(Ve["source-layer"],qe["source-layer"])&&P(Ve.type,qe.type)){for(je in Tt(Ve.layout,qe.layout,G,Me,null,Qt.setLayoutProperty),Tt(Ve.paint,qe.paint,G,Me,null,Qt.setPaintProperty),P(Ve.filter,qe.filter)||G.push({command:Qt.setFilter,args:[Me,qe.filter]}),P(Ve.minzoom,qe.minzoom)&&P(Ve.maxzoom,qe.maxzoom)||G.push({command:Qt.setLayerZoomRange,args:[Me,qe.minzoom,qe.maxzoom]}),Ve)Object.prototype.hasOwnProperty.call(Ve,je)&&je!=="layout"&&je!=="paint"&&je!=="filter"&&je!=="metadata"&&je!=="minzoom"&&je!=="maxzoom"&&(je.indexOf("paint.")===0?Tt(Ve[je],qe[je],G,Me,je.slice(6),Qt.setPaintProperty):P(Ve[je],qe[je])||G.push({command:Qt.setLayerProperty,args:[Me,je,qe[je]]}));for(je in qe)Object.prototype.hasOwnProperty.call(qe,je)&&!Object.prototype.hasOwnProperty.call(Ve,je)&&je!=="layout"&&je!=="paint"&&je!=="filter"&&je!=="metadata"&&je!=="minzoom"&&je!=="maxzoom"&&(je.indexOf("paint.")===0?Tt(Ve[je],qe[je],G,Me,je.slice(6),Qt.setPaintProperty):P(Ve[je],qe[je])||G.push({command:Qt.setLayerProperty,args:[Me,je,qe[je]]}))}else G.push({command:Qt.removeLayer,args:[Me]}),it=be[be.lastIndexOf(Me)+1],G.push({command:Qt.addLayer,args:[qe,it]})}(z,v.layers,w)}catch(A){console.warn("Unable to compute style diff:",A),w=[{command:Qt.setStyle,args:[v]}]}return w}(this.serialize(),i).filter(g=>!(g.command in Xi));if(l.length===0)return!1;const f=l.filter(g=>!(g.command in wi));if(f.length>0)throw new Error(`Unimplemented: ${f.map(g=>g.command).join(", ")}.`);return l.forEach(g=>{g.command!=="setTransition"&&this[g.command].apply(this,g.args)}),this.stylesheet=i,!0}addImage(i,l){if(this.getImage(i))return this.fire(new o.ErrorEvent(new Error(`An image named "${i}" already exists.`)));this.imageManager.addImage(i,l),this._afterImageUpdated(i)}updateImage(i,l){this.imageManager.updateImage(i,l)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new o.ErrorEvent(new Error(`An image named "${i}" does not exist.`)));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(i,l,f={}){if(this._checkLoaded(),this.sourceCaches[i]!==void 0)throw new Error(`Source "${i}" already exists.`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(o.validateStyle.source,`sources.${i}`,l,null,f))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const g=this.sourceCaches[i]=new rt(i,l,this.dispatcher);g.style=this,g.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:g.serialize(),sourceId:i})),g.onAdd(this.map),this._changed=!0}removeSource(i){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===i)return this.fire(new o.ErrorEvent(new Error(`Source "${i}" cannot be removed while layer "${f}" is using it.`)));const l=this.sourceCaches[i];delete this.sourceCaches[i],delete this._updatedSources[i],l.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:i})),l.setEventedParent(null),l.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,l){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error(`There is no source with this ID=${i}`);const f=this.sourceCaches[i].getSource();if(f.type!=="geojson")throw new Error(`geojsonSource.type is ${f.type}, which is !== 'geojson`);f.setData(l),this._changed=!0}getSource(i){return this.sourceCaches[i]&&this.sourceCaches[i].getSource()}addLayer(i,l,f={}){this._checkLoaded();const g=i.id;if(this.getLayer(g))return void this.fire(new o.ErrorEvent(new Error(`Layer "${g}" already exists on this map.`)));let v;if(i.type==="custom"){if(ai(this,o.validateCustomStyleLayer(i)))return;v=o.createStyleLayer(i)}else{if(typeof i.source=="object"&&(this.addSource(g,i.source),i=o.clone$1(i),i=o.extend(i,{source:g})),this._validate(o.validateStyle.layer,`layers.${g}`,i,{arrayIndex:-1},f))return;v=o.createStyleLayer(i),this._validateLayer(v),v.setEventedParent(this,{layer:{id:g}}),this._serializedLayers[v.id]=v.serialize()}const w=l?this._order.indexOf(l):this._order.length;if(l&&w===-1)this.fire(new o.ErrorEvent(new Error(`Cannot add layer "${g}" before non-existing layer "${l}".`)));else{if(this._order.splice(w,0,g),this._layerOrderChanged=!0,this._layers[g]=v,this._removedLayers[g]&&v.source&&v.type!=="custom"){const A=this._removedLayers[g];delete this._removedLayers[g],A.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",this.sourceCaches[v.source].pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map)}}moveLayer(i,l){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new o.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===l)return;const f=this._order.indexOf(i);this._order.splice(f,1);const g=l?this._order.indexOf(l):this._order.length;l&&g===-1?this.fire(new o.ErrorEvent(new Error(`Cannot move layer "${i}" before non-existing layer "${l}".`))):(this._order.splice(g,0,i),this._layerOrderChanged=!0)}removeLayer(i){this._checkLoaded();const l=this._layers[i];if(!l)return void this.fire(new o.ErrorEvent(new Error(`Cannot remove non-existing layer "${i}".`)));l.setEventedParent(null);const f=this._order.indexOf(i);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=l,delete this._layers[i],delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],l.onRemove&&l.onRemove(this.map)}getLayer(i){return this._layers[i]}hasLayer(i){return i in this._layers}setLayerZoomRange(i,l,f){this._checkLoaded();const g=this.getLayer(i);g?g.minzoom===l&&g.maxzoom===f||(l!=null&&(g.minzoom=l),f!=null&&(g.maxzoom=f),this._updateLayer(g)):this.fire(new o.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${i}".`)))}setFilter(i,l,f={}){this._checkLoaded();const g=this.getLayer(i);if(g){if(!P(g.filter,l))return l==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(o.validateStyle.filter,`layers.${g.id}.filter`,l,null,f)||(g.filter=o.clone$1(l),this._updateLayer(g)))}else this.fire(new o.ErrorEvent(new Error(`Cannot filter non-existing layer "${i}".`)))}getFilter(i){return o.clone$1(this.getLayer(i).filter)}setLayoutProperty(i,l,f,g={}){this._checkLoaded();const v=this.getLayer(i);v?P(v.getLayoutProperty(l),f)||(v.setLayoutProperty(l,f,g),this._updateLayer(v)):this.fire(new o.ErrorEvent(new Error(`Cannot style non-existing layer "${i}".`)))}getLayoutProperty(i,l){const f=this.getLayer(i);if(f)return f.getLayoutProperty(l);this.fire(new o.ErrorEvent(new Error(`Cannot get style of non-existing layer "${i}".`)))}setPaintProperty(i,l,f,g={}){this._checkLoaded();const v=this.getLayer(i);v?P(v.getPaintProperty(l),f)||(v.setPaintProperty(l,f,g)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new o.ErrorEvent(new Error(`Cannot style non-existing layer "${i}".`)))}getPaintProperty(i,l){return this.getLayer(i).getPaintProperty(l)}setFeatureState(i,l){this._checkLoaded();const f=i.source,g=i.sourceLayer,v=this.sourceCaches[f];if(v===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const w=v.getSource().type;w==="geojson"&&g?this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||g?(i.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),v.setFeatureState(g,i.id,l)):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(i,l){this._checkLoaded();const f=i.source,g=this.sourceCaches[f];if(g===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const v=g.getSource().type,w=v==="vector"?i.sourceLayer:void 0;v!=="vector"||w?l&&typeof i.id!="string"&&typeof i.id!="number"?this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):g.removeFeatureState(w,i.id,l):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(i){this._checkLoaded();const l=i.source,f=i.sourceLayer,g=this.sourceCaches[l];if(g!==void 0)return g.getSource().type!=="vector"||f?(i.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),g.getFeatureState(f,i.id)):void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:o.mapObject(this.sourceCaches,i=>i.serialize()),layers:this._serializeLayers(this._order)},i=>i!==void 0)}_updateLayer(i){this._updatedLayers[i.id]=!0,i.source&&!this._updatedSources[i.source]&&this.sourceCaches[i.source].getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",this.sourceCaches[i.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(i){const l=w=>this._layers[w].type==="fill-extrusion",f={},g=[];for(let w=this._order.length-1;w>=0;w--){const A=this._order[w];if(l(A)){f[A]=w;for(const I of i){const z=I[A];if(z)for(const B of z)g.push(B)}}}g.sort((w,A)=>A.intersectionZ-w.intersectionZ);const v=[];for(let w=this._order.length-1;w>=0;w--){const A=this._order[w];if(l(A))for(let I=g.length-1;I>=0;I--){const z=g[I].feature;if(f[z.layer.id]<w)break;v.push(z),g.pop()}else for(const I of i){const z=I[A];if(z)for(const B of z)v.push(B.feature)}}return v}queryRenderedFeatures(i,l,f){l&&l.filter&&this._validate(o.validateStyle.filter,"queryRenderedFeatures.filter",l.filter,null,l);const g={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const w of l.layers){const A=this._layers[w];if(!A)return this.fire(new o.ErrorEvent(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];g[A.source]=!0}}const v=[];l.availableImages=this._availableImages;for(const w in this.sourceCaches)l.layers&&!g[w]||v.push(Kt(this.sourceCaches[w],this._layers,this._serializedLayers,i,l,f));return this.placement&&v.push(function(w,A,I,z,B,N,G){const te={},Q=N.queryRenderedSymbols(z),$=[];for(const de of Object.keys(Q).map(Number))$.push(G[de]);$.sort(Jt);for(const de of $){const be=de.featureIndex.lookupSymbolFeatures(Q[de.bucketInstanceId],A,de.bucketIndex,de.sourceLayerIndex,B.filter,B.layers,B.availableImages,w);for(const Ce in be){const ne=te[Ce]=te[Ce]||[],ze=be[Ce];ze.sort((Me,Ve)=>{const qe=de.featureSortOrder;if(qe){const it=qe.indexOf(Me.featureIndex);return qe.indexOf(Ve.featureIndex)-it}return Ve.featureIndex-Me.featureIndex});for(const Me of ze)ne.push(Me)}}for(const de in te)te[de].forEach(be=>{const Ce=be.feature,ne=I[w[de].source].getFeatureState(Ce.layer["source-layer"],Ce.id);Ce.source=Ce.layer.source,Ce.layer["source-layer"]&&(Ce.sourceLayer=Ce.layer["source-layer"]),Ce.state=ne});return te}(this._layers,this._serializedLayers,this.sourceCaches,i,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(i,l){l&&l.filter&&this._validate(o.validateStyle.filter,"querySourceFeatures.filter",l.filter,null,l);const f=this.sourceCaches[i];return f?function(g,v){const w=g.getRenderableIds().map(z=>g.getTileByID(z)),A=[],I={};for(let z=0;z<w.length;z++){const B=w[z],N=B.tileID.canonical.key;I[N]||(I[N]=!0,B.querySourceFeatures(A,v))}return A}(f,l):[]}addSourceType(i,l,f){return $i.getSourceType(i)?f(new Error(`A source type called "${i}" already exists.`)):($i.setSourceType(i,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:l.workerSourceURL},f):f(null,null))}getLight(){return this.light.getLight()}setLight(i,l={}){this._checkLoaded();const f=this.light.getLight();let g=!1;for(const w in i)if(!P(i[w],f[w])){g=!0;break}if(!g)return;const v={now:o.exported.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,l),this.light.updateTransitions(v)}_validate(i,l,f,g,v={}){return(!v||v.validate!==!1)&&ai(this,i.call(o.validateStyle,o.extend({key:l,style:this.serialize(),value:f,styleSpec:o.spec},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this.sourceCaches){const l=this.sourceCaches[i];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(i){this.sourceCaches[i].clearTiles()}_reloadSource(i){this.sourceCaches[i].resume(),this.sourceCaches[i].reload()}_updateSources(i){for(const l in this.sourceCaches)this.sourceCaches[l].update(i,this.terrain)}_generateCollisionBoxes(){for(const i in this.sourceCaches)this._reloadSource(i)}_updatePlacement(i,l,f,g,v=!1){let w=!1,A=!1;const I={};for(const z of this._order){const B=this._layers[z];if(B.type!=="symbol")continue;if(!I[B.source]){const G=this.sourceCaches[B.source];I[B.source]=G.getRenderableIds(!0).map(te=>G.getTileByID(te)).sort((te,Q)=>Q.tileID.overscaledZ-te.tileID.overscaledZ||(te.tileID.isLessThan(Q.tileID)?-1:1))}const N=this.crossTileSymbolIndex.addLayer(B,I[B.source],i.center.lng);w=w||N}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((v=v||this._layerOrderChanged||f===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),i.zoom))&&(this.pauseablePlacement=new Be(i,this.terrain,this._order,v,l,f,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),A=!0),w&&this.pauseablePlacement.placement.setStale()),A||w)for(const z of this._order){const B=this._layers[z];B.type==="symbol"&&this.placement.updateLayerOpacities(B,I[B.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const i in this.sourceCaches)this.sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,l,f){this.imageManager.getImages(l.icons,f),this._updateTilesForChangedImages();const g=this.sourceCaches[l.source];g&&g.setDependencies(l.tileID.key,l.type,l.icons)}getGlyphs(i,l,f){this.glyphManager.getGlyphs(l.stacks,f)}getResource(i,l,f){return o.makeRequest(l,f)}}$i.getSourceType=function(d){return It[d]},$i.setSourceType=function(d,i){It[d]=i},$i.registerForPluginStateChange=o.registerForPluginStateChange;var Pr="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const jr={prelude:Si(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Si(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Si(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Si(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Si("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Si(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Si(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Si("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Si("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Si("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Si(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Si(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Si(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Si(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Si(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Si(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Si(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Si(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Si(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Si(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Si(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Si(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Si(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Si(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Si(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Si(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Si("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Pr),terrainDepth:Si("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Pr),terrainCoords:Si("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Pr)};function Si(d,i){const l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=i.match(/attribute ([\w]+) ([\w]+)/g),g=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=v?v.concat(g):g,A={};return{fragmentSource:d=d.replace(l,(I,z,B,N,G)=>(A[G]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${G}
varying ${B} ${N} ${G};
#else
uniform ${B} ${N} u_${G};
#endif
`:`
#ifdef HAS_UNIFORM_u_${G}
    ${B} ${N} ${G} = u_${G};
#endif
`)),vertexSource:i=i.replace(l,(I,z,B,N,G)=>{const te=N==="float"?"vec2":"vec4",Q=G.match(/color/)?"color":te;return A[G]?z==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
attribute ${B} ${te} a_${G};
varying ${B} ${N} ${G};
#else
uniform ${B} ${N} u_${G};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = a_${G};
#else
    ${B} ${N} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = unpack_mix_${Q}(a_${G}, u_${G}_t);
#else
    ${B} ${N} ${G} = u_${G};
#endif
`:z==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
attribute ${B} ${te} a_${G};
#else
uniform ${B} ${N} u_${G};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${B} ${N} ${G} = a_${G};
#else
    ${B} ${N} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${B} ${N} ${G} = unpack_mix_${Q}(a_${G}, u_${G}_t);
#else
    ${B} ${N} ${G} = u_${G};
#endif
`}),staticAttributes:f,staticUniforms:w}}class pa{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,l,f,g,v,w,A,I,z){this.context=i;let B=this.boundPaintVertexBuffers.length!==g.length;for(let N=0;!B&&N<g.length;N++)this.boundPaintVertexBuffers[N]!==g[N]&&(B=!0);i.extVertexArrayObject&&this.vao&&this.boundProgram===l&&this.boundLayoutVertexBuffer===f&&!B&&this.boundIndexBuffer===v&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===A&&this.boundDynamicVertexBuffer2===I&&this.boundDynamicVertexBuffer3===z?(i.bindVertexArrayOES.set(this.vao),A&&A.bind(),v&&v.dynamicDraw&&v.bind(),I&&I.bind(),z&&z.bind()):this.freshBind(l,f,g,v,w,A,I,z)}freshBind(i,l,f,g,v,w,A,I){let z;const B=i.numAttributes,N=this.context,G=N.gl;if(N.extVertexArrayObject)this.vao&&this.destroy(),this.vao=N.extVertexArrayObject.createVertexArrayOES(),N.bindVertexArrayOES.set(this.vao),z=0,this.boundProgram=i,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=g,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=A,this.boundDynamicVertexBuffer3=I;else{z=N.currentNumAttributes||0;for(let te=B;te<z;te++)G.disableVertexAttribArray(te)}l.enableAttributes(G,i);for(const te of f)te.enableAttributes(G,i);w&&w.enableAttributes(G,i),A&&A.enableAttributes(G,i),I&&I.enableAttributes(G,i),l.bind(),l.setVertexAttribPointers(G,i,v);for(const te of f)te.bind(),te.setVertexAttribPointers(G,i,v);w&&(w.bind(),w.setVertexAttribPointers(G,i,v)),g&&g.bind(),A&&(A.bind(),A.setVertexAttribPointers(G,i,v)),I&&(I.bind(),I.setVertexAttribPointers(G,i,v)),N.currentNumAttributes=B}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Jr(d){const i=[];for(let l=0;l<d.length;l++){if(d[l]===null)continue;const f=d[l].split(" ");i.push(f.pop())}return i}class da{constructor(i,l,f,g,v,w,A){const I=i.gl;this.program=I.createProgram();const z=Jr(f.staticAttributes),B=g?g.getBinderAttributes():[],N=z.concat(B),G=jr.prelude.staticUniforms?Jr(jr.prelude.staticUniforms):[],te=f.staticUniforms?Jr(f.staticUniforms):[],Q=g?g.getBinderUniforms():[],$=G.concat(te).concat(Q),de=[];for(const qe of $)de.indexOf(qe)<0&&de.push(qe);const be=g?g.defines():[];w&&be.push("#define OVERDRAW_INSPECTOR;"),A&&be.push("#define TERRAIN3D;");const Ce=be.concat(jr.prelude.fragmentSource,f.fragmentSource).join(`
`),ne=be.concat(jr.prelude.vertexSource,f.vertexSource).join(`
`),ze=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(ze,Ce),I.compileShader(ze),I.attachShader(this.program,ze);const Me=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(Me,ne),I.compileShader(Me),I.attachShader(this.program,Me),this.attributes={};const Ve={};this.numAttributes=N.length;for(let qe=0;qe<this.numAttributes;qe++)N[qe]&&(I.bindAttribLocation(this.program,qe,N[qe]),this.attributes[N[qe]]=qe);I.linkProgram(this.program),I.deleteShader(Me),I.deleteShader(ze);for(let qe=0;qe<de.length;qe++){const it=de[qe];if(it&&!Ve[it]){const je=I.getUniformLocation(this.program,it);je&&(Ve[it]=je)}}this.fixedUniforms=v(i,Ve),this.terrainUniforms=((qe,it)=>({u_depth:new o.Uniform1i(qe,it.u_depth),u_terrain:new o.Uniform1i(qe,it.u_terrain),u_terrain_dim:new o.Uniform1f(qe,it.u_terrain_dim),u_terrain_matrix:new o.UniformMatrix4f(qe,it.u_terrain_matrix),u_terrain_unpack:new o.Uniform4f(qe,it.u_terrain_unpack),u_terrain_offset:new o.Uniform1f(qe,it.u_terrain_offset),u_terrain_exaggeration:new o.Uniform1f(qe,it.u_terrain_exaggeration)}))(i,Ve),this.binderUniforms=g?g.getUniforms(i,Ve):[]}draw(i,l,f,g,v,w,A,I,z,B,N,G,te,Q,$,de,be,Ce){const ne=i.gl;if(this.failedToCreate)return;if(i.program.set(this.program),i.setDepthMode(f),i.setStencilMode(g),i.setColorMode(v),i.setCullFace(w),I){i.activeTexture.set(ne.TEXTURE2),ne.bindTexture(ne.TEXTURE_2D,I.depthTexture),i.activeTexture.set(ne.TEXTURE3),ne.bindTexture(ne.TEXTURE_2D,I.texture);for(const Me in this.terrainUniforms)this.terrainUniforms[Me].set(I[Me])}for(const Me in this.fixedUniforms)this.fixedUniforms[Me].set(A[Me]);$&&$.setUniforms(i,this.binderUniforms,te,{zoom:Q});let ze=0;switch(l){case ne.LINES:ze=2;break;case ne.TRIANGLES:ze=3;break;case ne.LINE_STRIP:ze=1}for(const Me of G.get()){const Ve=Me.vaos||(Me.vaos={});(Ve[z]||(Ve[z]=new pa)).bind(i,this,B,$?$.getPaintVertexBuffers():[],N,Me.vertexOffset,de,be,Ce),ne.drawElements(l,Me.primitiveLength*ze,ne.UNSIGNED_SHORT,Me.primitiveOffset*ze*2)}}}function ma(d,i,l){const f=1/ji(l,1,i.transform.tileZoom),g=Math.pow(2,l.tileID.overscaledZ),v=l.tileSize*Math.pow(2,i.transform.tileZoom)/g,w=v*(l.tileID.canonical.x+l.tileID.wrap*g),A=v*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_scale:[f,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[w>>16,A>>16],u_pixel_coord_lower:[65535&w,65535&A]}}const Yr=(d,i,l,f)=>{const g=i.style.light,v=g.properties.get("position"),w=[v.x,v.y,v.z],A=o.create$1();g.properties.get("anchor")==="viewport"&&o.fromRotation(A,-i.transform.angle),o.transformMat3(w,w,A);const I=g.properties.get("color");return{u_matrix:d,u_lightpos:w,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[I.r,I.g,I.b],u_vertical_gradient:+l,u_opacity:f}},ns=(d,i,l,f,g,v,w)=>o.extend(Yr(d,i,l,f),ma(v,i,w),{u_height_factor:-Math.pow(2,g.overscaledZ)/w.tileSize/8}),Qr=d=>({u_matrix:d}),rs=(d,i,l,f)=>o.extend(Qr(d),ma(l,i,f)),As=(d,i)=>({u_matrix:d,u_world:i}),Is=(d,i,l,f,g)=>o.extend(rs(d,i,l,f),{u_world:g}),zr=(d,i,l,f)=>{const g=d.transform;let v,w;if(f.paint.get("circle-pitch-alignment")==="map"){const A=ji(l,1,g.zoom);v=!0,w=[A,A]}else v=!1,w=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(f.paint.get("circle-pitch-scale")==="map"),u_matrix:d.translatePosMatrix(i.posMatrix,l,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_pitch_with_map:+v,u_device_pixel_ratio:d.pixelRatio,u_extrude_scale:w}},Mn=(d,i,l)=>{const f=ji(l,1,i.zoom),g=Math.pow(2,i.zoom-l.tileID.overscaledZ),v=l.tileID.overscaleFactor();return{u_matrix:d,u_camera_to_center_distance:i.cameraToCenterDistance,u_pixels_to_tile_units:f,u_extrude_scale:[i.pixelsToGLUnits[0]/(f*g),i.pixelsToGLUnits[1]/(f*g)],u_overscale_factor:v}},jn=(d,i,l=1)=>({u_matrix:d,u_color:i,u_overlay:0,u_overlay_scale:l}),$r=d=>({u_matrix:d}),za=(d,i,l,f)=>({u_matrix:d,u_extrude_scale:ji(i,1,l),u_intensity:f});function Da(d,i){const l=Math.pow(2,i.canonical.z),f=i.canonical.y;return[new o.MercatorCoordinate(0,f/l).toLngLat().lat,new o.MercatorCoordinate(0,(f+1)/l).toLngLat().lat]}const ea=(d,i,l,f)=>{const g=d.transform;return{u_matrix:ia(d,i,l,f),u_ratio:1/ji(i,1,g.zoom),u_device_pixel_ratio:d.pixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},La=(d,i,l,f,g)=>o.extend(ea(d,i,l,g),{u_image:0,u_image_height:f}),as=(d,i,l,f,g)=>{const v=d.transform,w=Ri(i,v);return{u_matrix:ia(d,i,l,g),u_texsize:i.imageAtlasTexture.size,u_ratio:1/ji(i,1,v.zoom),u_device_pixel_ratio:d.pixelRatio,u_image:0,u_scale:[w,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},ta=(d,i,l,f,g,v)=>{const w=d.lineAtlas,A=Ri(i,d.transform),I=l.layout.get("line-cap")==="round",z=w.getDash(f.from,I),B=w.getDash(f.to,I),N=z.width*g.fromScale,G=B.width*g.toScale;return o.extend(ea(d,i,l,v),{u_patternscale_a:[A/N,-z.height/2],u_patternscale_b:[A/G,-B.height/2],u_sdfgamma:w.width/(256*Math.min(N,G)*d.pixelRatio)/2,u_image:0,u_tex_y_a:z.y,u_tex_y_b:B.y,u_mix:g.t})};function Ri(d,i){return 1/ji(d,1,i.tileZoom)}function ia(d,i,l,f){return d.translatePosMatrix(f?f.posMatrix:i.tileID.posMatrix,i,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}const yo=(d,i,l,f,g)=>{return{u_matrix:d,u_tl_parent:i,u_scale_parent:l,u_buffer_scale:1,u_fade_t:f.mix,u_opacity:f.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(w=g.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(v=g.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:ss(g.paint.get("raster-hue-rotate"))};var v,w};function ss(d){d*=Math.PI/180;const i=Math.sin(d),l=Math.cos(d);return[(2*l+1)/3,(-Math.sqrt(3)*i-l+1)/3,(Math.sqrt(3)*i-l+1)/3]}const Ms=(d,i,l,f,g,v,w,A,I,z)=>{const B=g.transform;return{u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:B.cameraToCenterDistance,u_pitch:B.pitch/360*2*Math.PI,u_rotate_symbol:+l,u_aspect_ratio:B.width/B.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:w,u_coord_matrix:A,u_is_text:+I,u_pitch_with_map:+f,u_texsize:z,u_texture:0}},os=(d,i,l,f,g,v,w,A,I,z,B)=>{const N=g.transform;return o.extend(Ms(d,i,l,f,g,v,w,A,I,z),{u_gamma_scale:f?Math.cos(N._pitch)*N.cameraToCenterDistance:1,u_device_pixel_ratio:g.pixelRatio,u_is_halo:+B})},vo=(d,i,l,f,g,v,w,A,I,z)=>o.extend(os(d,i,l,f,g,v,w,A,!0,I,!0),{u_texsize_icon:z,u_texture_icon:1}),ol=(d,i,l)=>({u_matrix:d,u_opacity:i,u_color:l}),ll=(d,i,l,f,g,v)=>o.extend(function(w,A,I,z){const B=I.imageManager.getPattern(w.from.toString()),N=I.imageManager.getPattern(w.to.toString()),{width:G,height:te}=I.imageManager.getPixelSize(),Q=Math.pow(2,z.tileID.overscaledZ),$=z.tileSize*Math.pow(2,I.transform.tileZoom)/Q,de=$*(z.tileID.canonical.x+z.tileID.wrap*Q),be=$*z.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:B.tl,u_pattern_br_a:B.br,u_pattern_tl_b:N.tl,u_pattern_br_b:N.br,u_texsize:[G,te],u_mix:A.t,u_pattern_size_a:B.displaySize,u_pattern_size_b:N.displaySize,u_scale_a:A.fromScale,u_scale_b:A.toScale,u_tile_units_to_pixels:1/ji(z,1,I.transform.tileZoom),u_pixel_coord_upper:[de>>16,be>>16],u_pixel_coord_lower:[65535&de,65535&be]}}(f,v,l,g),{u_matrix:d,u_opacity:i}),Ra={fillExtrusion:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_lightpos:new o.Uniform3f(d,i.u_lightpos),u_lightintensity:new o.Uniform1f(d,i.u_lightintensity),u_lightcolor:new o.Uniform3f(d,i.u_lightcolor),u_vertical_gradient:new o.Uniform1f(d,i.u_vertical_gradient),u_opacity:new o.Uniform1f(d,i.u_opacity)}),fillExtrusionPattern:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_lightpos:new o.Uniform3f(d,i.u_lightpos),u_lightintensity:new o.Uniform1f(d,i.u_lightintensity),u_lightcolor:new o.Uniform3f(d,i.u_lightcolor),u_vertical_gradient:new o.Uniform1f(d,i.u_vertical_gradient),u_height_factor:new o.Uniform1f(d,i.u_height_factor),u_image:new o.Uniform1i(d,i.u_image),u_texsize:new o.Uniform2f(d,i.u_texsize),u_pixel_coord_upper:new o.Uniform2f(d,i.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(d,i.u_pixel_coord_lower),u_scale:new o.Uniform3f(d,i.u_scale),u_fade:new o.Uniform1f(d,i.u_fade),u_opacity:new o.Uniform1f(d,i.u_opacity)}),fill:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix)}),fillPattern:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_image:new o.Uniform1i(d,i.u_image),u_texsize:new o.Uniform2f(d,i.u_texsize),u_pixel_coord_upper:new o.Uniform2f(d,i.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(d,i.u_pixel_coord_lower),u_scale:new o.Uniform3f(d,i.u_scale),u_fade:new o.Uniform1f(d,i.u_fade)}),fillOutline:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_world:new o.Uniform2f(d,i.u_world)}),fillOutlinePattern:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_world:new o.Uniform2f(d,i.u_world),u_image:new o.Uniform1i(d,i.u_image),u_texsize:new o.Uniform2f(d,i.u_texsize),u_pixel_coord_upper:new o.Uniform2f(d,i.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(d,i.u_pixel_coord_lower),u_scale:new o.Uniform3f(d,i.u_scale),u_fade:new o.Uniform1f(d,i.u_fade)}),circle:(d,i)=>({u_camera_to_center_distance:new o.Uniform1f(d,i.u_camera_to_center_distance),u_scale_with_map:new o.Uniform1i(d,i.u_scale_with_map),u_pitch_with_map:new o.Uniform1i(d,i.u_pitch_with_map),u_extrude_scale:new o.Uniform2f(d,i.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(d,i.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(d,i.u_matrix)}),collisionBox:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_camera_to_center_distance:new o.Uniform1f(d,i.u_camera_to_center_distance),u_pixels_to_tile_units:new o.Uniform1f(d,i.u_pixels_to_tile_units),u_extrude_scale:new o.Uniform2f(d,i.u_extrude_scale),u_overscale_factor:new o.Uniform1f(d,i.u_overscale_factor)}),collisionCircle:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_inv_matrix:new o.UniformMatrix4f(d,i.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(d,i.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(d,i.u_viewport_size)}),debug:(d,i)=>({u_color:new o.UniformColor(d,i.u_color),u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_overlay:new o.Uniform1i(d,i.u_overlay),u_overlay_scale:new o.Uniform1f(d,i.u_overlay_scale)}),clippingMask:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix)}),heatmap:(d,i)=>({u_extrude_scale:new o.Uniform1f(d,i.u_extrude_scale),u_intensity:new o.Uniform1f(d,i.u_intensity),u_matrix:new o.UniformMatrix4f(d,i.u_matrix)}),heatmapTexture:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_world:new o.Uniform2f(d,i.u_world),u_image:new o.Uniform1i(d,i.u_image),u_color_ramp:new o.Uniform1i(d,i.u_color_ramp),u_opacity:new o.Uniform1f(d,i.u_opacity)}),hillshade:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_image:new o.Uniform1i(d,i.u_image),u_latrange:new o.Uniform2f(d,i.u_latrange),u_light:new o.Uniform2f(d,i.u_light),u_shadow:new o.UniformColor(d,i.u_shadow),u_highlight:new o.UniformColor(d,i.u_highlight),u_accent:new o.UniformColor(d,i.u_accent)}),hillshadePrepare:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_image:new o.Uniform1i(d,i.u_image),u_dimension:new o.Uniform2f(d,i.u_dimension),u_zoom:new o.Uniform1f(d,i.u_zoom),u_unpack:new o.Uniform4f(d,i.u_unpack)}),line:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_ratio:new o.Uniform1f(d,i.u_ratio),u_device_pixel_ratio:new o.Uniform1f(d,i.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(d,i.u_units_to_pixels)}),lineGradient:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_ratio:new o.Uniform1f(d,i.u_ratio),u_device_pixel_ratio:new o.Uniform1f(d,i.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(d,i.u_units_to_pixels),u_image:new o.Uniform1i(d,i.u_image),u_image_height:new o.Uniform1f(d,i.u_image_height)}),linePattern:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_texsize:new o.Uniform2f(d,i.u_texsize),u_ratio:new o.Uniform1f(d,i.u_ratio),u_device_pixel_ratio:new o.Uniform1f(d,i.u_device_pixel_ratio),u_image:new o.Uniform1i(d,i.u_image),u_units_to_pixels:new o.Uniform2f(d,i.u_units_to_pixels),u_scale:new o.Uniform3f(d,i.u_scale),u_fade:new o.Uniform1f(d,i.u_fade)}),lineSDF:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_ratio:new o.Uniform1f(d,i.u_ratio),u_device_pixel_ratio:new o.Uniform1f(d,i.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(d,i.u_units_to_pixels),u_patternscale_a:new o.Uniform2f(d,i.u_patternscale_a),u_patternscale_b:new o.Uniform2f(d,i.u_patternscale_b),u_sdfgamma:new o.Uniform1f(d,i.u_sdfgamma),u_image:new o.Uniform1i(d,i.u_image),u_tex_y_a:new o.Uniform1f(d,i.u_tex_y_a),u_tex_y_b:new o.Uniform1f(d,i.u_tex_y_b),u_mix:new o.Uniform1f(d,i.u_mix)}),raster:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_tl_parent:new o.Uniform2f(d,i.u_tl_parent),u_scale_parent:new o.Uniform1f(d,i.u_scale_parent),u_buffer_scale:new o.Uniform1f(d,i.u_buffer_scale),u_fade_t:new o.Uniform1f(d,i.u_fade_t),u_opacity:new o.Uniform1f(d,i.u_opacity),u_image0:new o.Uniform1i(d,i.u_image0),u_image1:new o.Uniform1i(d,i.u_image1),u_brightness_low:new o.Uniform1f(d,i.u_brightness_low),u_brightness_high:new o.Uniform1f(d,i.u_brightness_high),u_saturation_factor:new o.Uniform1f(d,i.u_saturation_factor),u_contrast_factor:new o.Uniform1f(d,i.u_contrast_factor),u_spin_weights:new o.Uniform3f(d,i.u_spin_weights)}),symbolIcon:(d,i)=>({u_is_size_zoom_constant:new o.Uniform1i(d,i.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(d,i.u_is_size_feature_constant),u_size_t:new o.Uniform1f(d,i.u_size_t),u_size:new o.Uniform1f(d,i.u_size),u_camera_to_center_distance:new o.Uniform1f(d,i.u_camera_to_center_distance),u_pitch:new o.Uniform1f(d,i.u_pitch),u_rotate_symbol:new o.Uniform1i(d,i.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(d,i.u_aspect_ratio),u_fade_change:new o.Uniform1f(d,i.u_fade_change),u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(d,i.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(d,i.u_coord_matrix),u_is_text:new o.Uniform1i(d,i.u_is_text),u_pitch_with_map:new o.Uniform1i(d,i.u_pitch_with_map),u_texsize:new o.Uniform2f(d,i.u_texsize),u_texture:new o.Uniform1i(d,i.u_texture)}),symbolSDF:(d,i)=>({u_is_size_zoom_constant:new o.Uniform1i(d,i.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(d,i.u_is_size_feature_constant),u_size_t:new o.Uniform1f(d,i.u_size_t),u_size:new o.Uniform1f(d,i.u_size),u_camera_to_center_distance:new o.Uniform1f(d,i.u_camera_to_center_distance),u_pitch:new o.Uniform1f(d,i.u_pitch),u_rotate_symbol:new o.Uniform1i(d,i.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(d,i.u_aspect_ratio),u_fade_change:new o.Uniform1f(d,i.u_fade_change),u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(d,i.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(d,i.u_coord_matrix),u_is_text:new o.Uniform1i(d,i.u_is_text),u_pitch_with_map:new o.Uniform1i(d,i.u_pitch_with_map),u_texsize:new o.Uniform2f(d,i.u_texsize),u_texture:new o.Uniform1i(d,i.u_texture),u_gamma_scale:new o.Uniform1f(d,i.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(d,i.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(d,i.u_is_halo)}),symbolTextAndIcon:(d,i)=>({u_is_size_zoom_constant:new o.Uniform1i(d,i.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(d,i.u_is_size_feature_constant),u_size_t:new o.Uniform1f(d,i.u_size_t),u_size:new o.Uniform1f(d,i.u_size),u_camera_to_center_distance:new o.Uniform1f(d,i.u_camera_to_center_distance),u_pitch:new o.Uniform1f(d,i.u_pitch),u_rotate_symbol:new o.Uniform1i(d,i.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(d,i.u_aspect_ratio),u_fade_change:new o.Uniform1f(d,i.u_fade_change),u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(d,i.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(d,i.u_coord_matrix),u_is_text:new o.Uniform1i(d,i.u_is_text),u_pitch_with_map:new o.Uniform1i(d,i.u_pitch_with_map),u_texsize:new o.Uniform2f(d,i.u_texsize),u_texsize_icon:new o.Uniform2f(d,i.u_texsize_icon),u_texture:new o.Uniform1i(d,i.u_texture),u_texture_icon:new o.Uniform1i(d,i.u_texture_icon),u_gamma_scale:new o.Uniform1f(d,i.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(d,i.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(d,i.u_is_halo)}),background:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_opacity:new o.Uniform1f(d,i.u_opacity),u_color:new o.UniformColor(d,i.u_color)}),backgroundPattern:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_opacity:new o.Uniform1f(d,i.u_opacity),u_image:new o.Uniform1i(d,i.u_image),u_pattern_tl_a:new o.Uniform2f(d,i.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(d,i.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(d,i.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(d,i.u_pattern_br_b),u_texsize:new o.Uniform2f(d,i.u_texsize),u_mix:new o.Uniform1f(d,i.u_mix),u_pattern_size_a:new o.Uniform2f(d,i.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(d,i.u_pattern_size_b),u_scale_a:new o.Uniform1f(d,i.u_scale_a),u_scale_b:new o.Uniform1f(d,i.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(d,i.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(d,i.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(d,i.u_tile_units_to_pixels)}),terrain:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_texture:new o.Uniform1i(d,i.u_texture)}),terrainDepth:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix)}),terrainCoords:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_texture:new o.Uniform1i(d,i.u_texture),u_terrain_coords_id:new o.Uniform1f(d,i.u_terrain_coords_id)})};class Ps{constructor(i,l,f){this.context=i;const g=i.gl;this.buffer=g.createBuffer(),this.dynamicDraw=Boolean(f),this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const l=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const zs={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Te{constructor(i,l,f,g){this.length=l.length,this.attributes=f,this.itemSize=l.bytesPerElement,this.dynamicDraw=g,this.context=i;const v=i.gl;this.buffer=v.createBuffer(),i.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){if(i.length!==this.length)throw new Error(`Length of new data is ${i.length}, which doesn't match current length of ${this.length}`);const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,l){for(let f=0;f<this.attributes.length;f++){const g=l.attributes[this.attributes[f].name];g!==void 0&&i.enableVertexAttribArray(g)}}setVertexAttribPointers(i,l,f){for(let g=0;g<this.attributes.length;g++){const v=this.attributes[g],w=l.attributes[v.name];w!==void 0&&i.vertexAttribPointer(w,v.components,i[zs[v.type]],!1,this.itemSize,v.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ti{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ir extends ti{getDefault(){return o.Color.transparent}set(i){const l=this.current;(i.r!==l.r||i.g!==l.g||i.b!==l.b||i.a!==l.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class ln extends ti{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class nr extends ti{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Ba extends ti{getDefault(){return[!0,!0,!0,!0]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||i[3]!==l[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class xo extends ti{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Vn extends ti{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class Fa extends ti{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const l=this.current;(i.func!==l.func||i.ref!==l.ref||i.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class ls extends ti{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class ga extends ti{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=i,this.dirty=!1}}class cl extends ti{getDefault(){return[0,1]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class ul extends ti{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=i,this.dirty=!1}}class bo extends ti{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class hl extends ti{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.BLEND):l.disable(l.BLEND),this.current=i,this.dirty=!1}}class fl extends ti{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class wo extends ti{getDefault(){return o.Color.transparent}set(i){const l=this.current;(i.r!==l.r||i.g!==l.g||i.b!==l.b||i.a!==l.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class wc extends ti{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class Tc extends ti{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=i,this.dirty=!1}}class cs extends ti{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class uh extends ti{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class hh extends ti{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class fh extends ti{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class ph extends ti{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||i[3]!==l[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class dh extends ti{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class mh extends ti{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class pl extends ti{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class To extends ti{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class dl extends ti{getDefault(){return null}set(i){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class ml extends ti{constructor(i){super(i),this.vao=i.extVertexArrayObject}getDefault(){return null}set(i){this.vao&&(i!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(i),this.current=i,this.dirty=!1)}}class us extends ti{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class kc extends ti{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Sc extends ti{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class ko extends ti{constructor(i,l){super(i),this.context=i,this.parent=l}getDefault(){return null}}class Oa extends ko{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Ec extends ko{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class hs{constructor(i,l,f,g){this.context=i,this.width=l,this.height=f;const v=i.gl,w=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new Oa(i,w),g&&(this.depthAttachment=new Ec(i,w)),v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const i=this.context.gl,l=this.colorAttachment.get();if(l&&i.deleteTexture(l),this.depthAttachment){const f=this.depthAttachment.get();f&&i.deleteRenderbuffer(f)}i.deleteFramebuffer(this.framebuffer)}}class Fi{constructor(i,l,f){this.blendFunction=i,this.blendColor=l,this.mask=f}}Fi.Replace=[1,0],Fi.disabled=new Fi(Fi.Replace,o.Color.transparent,[!1,!1,!1,!1]),Fi.unblended=new Fi(Fi.Replace,o.Color.transparent,[!0,!0,!0,!0]),Fi.alphaBlended=new Fi([1,771],o.Color.transparent,[!0,!0,!0,!0]);class Cc{constructor(i){this.gl=i,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ir(this),this.clearDepth=new ln(this),this.clearStencil=new nr(this),this.colorMask=new Ba(this),this.depthMask=new xo(this),this.stencilMask=new Vn(this),this.stencilFunc=new Fa(this),this.stencilOp=new ls(this),this.stencilTest=new ga(this),this.depthRange=new cl(this),this.depthTest=new ul(this),this.depthFunc=new bo(this),this.blend=new hl(this),this.blendFunc=new fl(this),this.blendColor=new wo(this),this.blendEquation=new wc(this),this.cullFace=new Tc(this),this.cullFaceSide=new cs(this),this.frontFace=new uh(this),this.program=new hh(this),this.activeTexture=new fh(this),this.viewport=new ph(this),this.bindFramebuffer=new dh(this),this.bindRenderbuffer=new mh(this),this.bindTexture=new pl(this),this.bindVertexBuffer=new To(this),this.bindElementBuffer=new dl(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ml(this),this.pixelStoreUnpack=new us(this),this.pixelStoreUnpackPremultiplyAlpha=new kc(this),this.pixelStoreUnpackFlipY=new Sc(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=i.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(i.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,l){return new Ps(this,i,l)}createVertexBuffer(i,l,f){return new Te(this,i,l,f)}createRenderbuffer(i,l,f){const g=this.gl,v=g.createRenderbuffer();return this.bindRenderbuffer.set(v),g.renderbufferStorage(g.RENDERBUFFER,i,l,f),this.bindRenderbuffer.set(null),v}createFramebuffer(i,l,f){return new hs(this,i,l,f)}clear({color:i,depth:l}){const f=this.gl;let g=0;i&&(g|=f.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),l!==void 0&&(g|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),f.clear(g)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){P(i.blendFunction,Fi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class pi{constructor(i,l,f){this.func=i,this.mask=l,this.range=f}}pi.ReadOnly=!1,pi.ReadWrite=!0,pi.disabled=new pi(519,pi.ReadOnly,[0,1]);const Ci=7680;class Bi{constructor(i,l,f,g,v,w){this.test=i,this.ref=l,this.mask=f,this.fail=g,this.depthFail=v,this.pass=w}}Bi.disabled=new Bi({func:519,mask:0},0,0,Ci,Ci,Ci);class Vi{constructor(i,l,f){this.enable=i,this.mode=l,this.frontFace=f}}let Ds;function fs(d,i,l,f,g,v,w){const A=d.context,I=A.gl,z=d.useProgram("collisionBox"),B=[];let N=0,G=0;for(let ne=0;ne<f.length;ne++){const ze=f[ne],Me=i.getTile(ze),Ve=Me.getBucket(l);if(!Ve)continue;let qe=ze.posMatrix;g[0]===0&&g[1]===0||(qe=d.translatePosMatrix(ze.posMatrix,Me,g,v));const it=w?Ve.textCollisionBox:Ve.iconCollisionBox,je=Ve.collisionCircleArray;if(je.length>0){const vt=o.create(),ft=qe;o.mul(vt,Ve.placementInvProjMatrix,d.transform.glCoordMatrix),o.mul(vt,vt,Ve.placementViewportMatrix),B.push({circleArray:je,circleOffset:G,transform:ft,invTransform:vt,coord:ze}),N+=je.length/4,G=N}it&&z.draw(A,I.LINES,pi.disabled,Bi.disabled,d.colorModeForRenderPass(),Vi.disabled,Mn(qe,d.transform,Me),d.style.terrain&&d.style.terrain.getTerrainData(ze),l.id,it.layoutVertexBuffer,it.indexBuffer,it.segments,null,d.transform.zoom,null,null,it.collisionVertexBuffer)}if(!w||!B.length)return;const te=d.useProgram("collisionCircle"),Q=new o.CollisionCircleLayoutArray;Q.resize(4*N),Q._trim();let $=0;for(const ne of B)for(let ze=0;ze<ne.circleArray.length/4;ze++){const Me=4*ze,Ve=ne.circleArray[Me+0],qe=ne.circleArray[Me+1],it=ne.circleArray[Me+2],je=ne.circleArray[Me+3];Q.emplace($++,Ve,qe,it,je,0),Q.emplace($++,Ve,qe,it,je,1),Q.emplace($++,Ve,qe,it,je,2),Q.emplace($++,Ve,qe,it,je,3)}(!Ds||Ds.length<2*N)&&(Ds=function(ne){const ze=2*ne,Me=new o.QuadTriangleArray;Me.resize(ze),Me._trim();for(let Ve=0;Ve<ze;Ve++){const qe=6*Ve;Me.uint16[qe+0]=4*Ve+0,Me.uint16[qe+1]=4*Ve+1,Me.uint16[qe+2]=4*Ve+2,Me.uint16[qe+3]=4*Ve+2,Me.uint16[qe+4]=4*Ve+3,Me.uint16[qe+5]=4*Ve+0}return Me}(N));const de=A.createIndexBuffer(Ds,!0),be=A.createVertexBuffer(Q,o.collisionCircleLayout.members,!0);for(const ne of B){const ze={u_matrix:ne.transform,u_inv_matrix:ne.invTransform,u_camera_to_center_distance:(Ce=d.transform).cameraToCenterDistance,u_viewport_size:[Ce.width,Ce.height]};te.draw(A,I.TRIANGLES,pi.disabled,Bi.disabled,d.colorModeForRenderPass(),Vi.disabled,ze,d.style.terrain&&d.style.terrain.getTerrainData(ne.coord),l.id,be,de,o.SegmentVector.simpleSegment(0,2*ne.circleOffset,ne.circleArray.length,ne.circleArray.length/2),null,d.transform.zoom,null,null,null)}var Ce;be.destroy(),de.destroy()}Vi.disabled=new Vi(!1,1029,2305),Vi.backCCW=new Vi(!0,1029,2305);const gh=o.identity(new Float32Array(16));function _h(d,i,l,f,g,v){const{horizontalAlign:w,verticalAlign:A}=o.getAnchorAlignment(d),I=-(w-.5)*i,z=-(A-.5)*l,B=o.evaluateVariableOffset(d,f);return new o.pointGeometry((I/g+B[0])*v,(z/g+B[1])*v)}function Ac(d,i,l,f,g,v,w,A,I,z,B){const N=d.text.placedSymbolArray,G=d.text.dynamicLayoutVertexArray,te=d.icon.dynamicLayoutVertexArray,Q={};G.clear();for(let $=0;$<N.length;$++){const de=N.get($),be=d.allowVerticalPlacement&&!de.placedOrientation,Ce=de.hidden||!de.crossTileID||be?null:f[de.crossTileID];if(Ce){const ne=new o.pointGeometry(de.anchorX,de.anchorY),ze=Gt(ne,l?w:v,B),Me=Ni(g.cameraToCenterDistance,ze.signedDistanceFromCamera);let Ve=o.evaluateSizeForFeature(d.textSizeData,I,de)*Me/o.ONE_EM;l&&(Ve*=d.tilePixelRatio/A);const{width:qe,height:it,anchor:je,textOffset:vt,textBoxScale:ft}=Ce,xt=_h(je,qe,it,vt,ft,Ve),Yt=l?Gt(ne.add(xt),v,B).point:ze.point.add(i?xt.rotate(-g.angle):xt),ii=d.allowVerticalPlacement&&de.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let Lt=0;Lt<de.numGlyphs;Lt++)o.addDynamicAttributes(G,Yt,ii);z&&de.associatedIconIndex>=0&&(Q[de.associatedIconIndex]={shiftedAnchor:Yt,angle:ii})}else jt(de.numGlyphs,G)}if(z){te.clear();const $=d.icon.placedSymbolArray;for(let de=0;de<$.length;de++){const be=$.get(de);if(be.hidden)jt(be.numGlyphs,te);else{const Ce=Q[de];if(Ce)for(let ne=0;ne<be.numGlyphs;ne++)o.addDynamicAttributes(te,Ce.shiftedAnchor,Ce.angle);else jt(be.numGlyphs,te)}}d.icon.dynamicLayoutVertexBuffer.updateData(te)}d.text.dynamicLayoutVertexBuffer.updateData(G)}function yh(d,i,l){return l.iconsInText&&i?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function So(d,i,l,f,g,v,w,A,I,z,B,N){const G=d.context,te=G.gl,Q=d.transform,$=A==="map",de=I==="map",be=A!=="viewport"&&l.layout.get("symbol-placement")!=="point",Ce=$&&!de&&!be,ne=!l.layout.get("symbol-sort-key").isConstant();let ze=!1;const Me=d.depthModeForSublayer(0,pi.ReadOnly),Ve=l.layout.get("text-variable-anchor"),qe=[];for(const it of f){const je=i.getTile(it),vt=je.getBucket(l);if(!vt)continue;const ft=g?vt.text:vt.icon;if(!ft||!ft.segments.get().length)continue;const xt=ft.programConfigurations.get(l.id),Yt=g||vt.sdfIcons,ii=g?vt.textSizeData:vt.iconSizeData,Lt=de||Q.pitch!==0,Mi=d.useProgram(yh(Yt,g,vt),xt),Pi=o.evaluateSizeForZoom(ii,Q.zoom),yi=d.style.terrain&&d.style.terrain.getTerrainData(it);let xi,zi,yn,Gr,Lr=[0,0],Zr=null;if(g){if(zi=je.glyphAtlasTexture,yn=te.LINEAR,xi=je.glyphAtlasTexture.size,vt.iconsInText){Lr=je.imageAtlasTexture.size,Zr=je.imageAtlasTexture;const xr=ii.kind==="composite"||ii.kind==="camera";Gr=Lt||d.options.rotating||d.options.zooming||xr?te.LINEAR:te.NEAREST}}else{const xr=l.layout.get("icon-size").constantOr(0)!==1||vt.iconsNeedLinear;zi=je.imageAtlasTexture,yn=Yt||d.options.rotating||d.options.zooming||xr||Lt?te.LINEAR:te.NEAREST,xi=je.imageAtlasTexture.size}const Ta=ji(je,1,d.transform.zoom),vr=nn(it.posMatrix,de,$,d.transform,Ta),Xn=sn(it.posMatrix,de,$,d.transform,Ta),aa=Ve&&vt.hasTextData(),Do=l.layout.get("icon-text-fit")!=="none"&&aa&&vt.hasIconData();if(be){const xr=d.style.terrain?(Ml,ys)=>d.style.terrain.getElevation(it,Ml,ys):null,Va=l.layout.get("text-rotation-alignment")==="map";_n(vt,it.posMatrix,d,g,vr,Xn,de,z,Va,xr)}const pn=d.translatePosMatrix(it.posMatrix,je,v,w),oi=be||g&&Ve||Do?gh:vr,Ai=d.translatePosMatrix(Xn,je,v,w,!0),vn=Yt&&l.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let xn;xn=Yt?vt.iconsInText?vo(ii.kind,Pi,Ce,de,d,pn,oi,Ai,xi,Lr):os(ii.kind,Pi,Ce,de,d,pn,oi,Ai,g,xi,!0):Ms(ii.kind,Pi,Ce,de,d,pn,oi,Ai,g,xi);const Gi={program:Mi,buffers:ft,uniformValues:xn,atlasTexture:zi,atlasTextureIcon:Zr,atlasInterpolation:yn,atlasInterpolationIcon:Gr,isSDF:Yt,hasHalo:vn};if(ne&&vt.canOverlap){ze=!0;const xr=ft.segments.get();for(const Va of xr)qe.push({segments:new o.SegmentVector([Va]),sortKey:Va.sortKey,state:Gi,terrainData:yi})}else qe.push({segments:ft.segments,sortKey:0,state:Gi,terrainData:yi})}ze&&qe.sort((it,je)=>it.sortKey-je.sortKey);for(const it of qe){const je=it.state;if(G.activeTexture.set(te.TEXTURE0),je.atlasTexture.bind(je.atlasInterpolation,te.CLAMP_TO_EDGE),je.atlasTextureIcon&&(G.activeTexture.set(te.TEXTURE1),je.atlasTextureIcon&&je.atlasTextureIcon.bind(je.atlasInterpolationIcon,te.CLAMP_TO_EDGE)),je.isSDF){const vt=je.uniformValues;je.hasHalo&&(vt.u_is_halo=1,Ls(je.buffers,it.segments,l,d,je.program,Me,B,N,vt,it.terrainData)),vt.u_is_halo=0}Ls(je.buffers,it.segments,l,d,je.program,Me,B,N,je.uniformValues,it.terrainData)}}function Ls(d,i,l,f,g,v,w,A,I,z){const B=f.context;g.draw(B,B.gl.TRIANGLES,v,w,A,Vi.disabled,I,z,l.id,d.layoutVertexBuffer,d.indexBuffer,i,l.paint,f.transform.zoom,d.programConfigurations.get(l.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function Rs(d,i,l,f,g,v,w){const A=d.context.gl,I=l.paint.get("fill-pattern"),z=I&&I.constantOr(1),B=l.getCrossfadeParameters();let N,G,te,Q,$;w?(G=z&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=A.LINES):(G=z?"fillPattern":"fill",N=A.TRIANGLES);for(const de of f){const be=i.getTile(de);if(z&&!be.patternsLoaded())continue;const Ce=be.getBucket(l);if(!Ce)continue;const ne=Ce.programConfigurations.get(l.id),ze=d.useProgram(G,ne),Me=d.style.terrain&&d.style.terrain.getTerrainData(de);z&&(d.context.activeTexture.set(A.TEXTURE0),be.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),ne.updatePaintBuffers(B));const Ve=I.constantOr(null);if(Ve&&be.imageAtlas){const je=be.imageAtlas,vt=je.patternPositions[Ve.to.toString()],ft=je.patternPositions[Ve.from.toString()];vt&&ft&&ne.setConstantPatternPositions(vt,ft)}const qe=Me?de:null,it=d.translatePosMatrix(qe?qe.posMatrix:de.posMatrix,be,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(w){Q=Ce.indexBuffer2,$=Ce.segments2;const je=[A.drawingBufferWidth,A.drawingBufferHeight];te=G==="fillOutlinePattern"&&z?Is(it,d,B,be,je):As(it,je)}else Q=Ce.indexBuffer,$=Ce.segments,te=z?rs(it,d,B,be):Qr(it);ze.draw(d.context,N,g,d.stencilModeForClipping(de),v,Vi.disabled,te,Me,l.id,Ce.layoutVertexBuffer,Q,$,l.paint,d.transform.zoom,ne)}}function Bs(d,i,l,f,g,v,w){const A=d.context,I=A.gl,z=l.paint.get("fill-extrusion-pattern"),B=z.constantOr(1),N=l.getCrossfadeParameters(),G=l.paint.get("fill-extrusion-opacity");for(const te of f){const Q=i.getTile(te),$=Q.getBucket(l);if(!$)continue;const de=d.style.terrain&&d.style.terrain.getTerrainData(te),be=$.programConfigurations.get(l.id),Ce=d.useProgram(B?"fillExtrusionPattern":"fillExtrusion",be);B&&(d.context.activeTexture.set(I.TEXTURE0),Q.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),be.updatePaintBuffers(N));const ne=z.constantOr(null);if(ne&&Q.imageAtlas){const qe=Q.imageAtlas,it=qe.patternPositions[ne.to.toString()],je=qe.patternPositions[ne.from.toString()];it&&je&&be.setConstantPatternPositions(it,je)}const ze=d.translatePosMatrix(te.posMatrix,Q,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Me=l.paint.get("fill-extrusion-vertical-gradient"),Ve=B?ns(ze,d,Me,G,te,N,Q):Yr(ze,d,Me,G);Ce.draw(A,A.gl.TRIANGLES,g,v,w,Vi.backCCW,Ve,de,l.id,$.layoutVertexBuffer,$.indexBuffer,$.segments,l.paint,d.transform.zoom,be,d.style.terrain&&$.centroidVertexBuffer)}}function gl(d,i,l,f,g,v,w){const A=d.context,I=A.gl,z=l.fbo;if(!z)return;const B=d.useProgram("hillshade"),N=d.style.terrain&&d.style.terrain.getTerrainData(i);A.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,z.colorAttachment.get()),B.draw(A,I.TRIANGLES,g,v,w,Vi.disabled,((G,te,Q,$)=>{const de=Q.paint.get("hillshade-shadow-color"),be=Q.paint.get("hillshade-highlight-color"),Ce=Q.paint.get("hillshade-accent-color");let ne=Q.paint.get("hillshade-illumination-direction")*(Math.PI/180);Q.paint.get("hillshade-illumination-anchor")==="viewport"&&(ne-=G.transform.angle);const ze=!G.options.moving;return{u_matrix:$?$.posMatrix:G.transform.calculatePosMatrix(te.tileID.toUnwrapped(),ze),u_image:0,u_latrange:Da(0,te.tileID),u_light:[Q.paint.get("hillshade-exaggeration"),ne],u_shadow:de,u_highlight:be,u_accent:Ce}})(d,l,f,N?i:null),N,f.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}function Ic(d,i,l,f,g,v){const w=d.context,A=w.gl,I=i.dem;if(I&&I.data){const z=I.dim,B=I.stride,N=I.getPixels();if(w.activeTexture.set(A.TEXTURE1),w.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||d.getTileTexture(B),i.demTexture){const te=i.demTexture;te.update(N,{premultiply:!1}),te.bind(A.NEAREST,A.CLAMP_TO_EDGE)}else i.demTexture=new q(w,N,A.RGBA,{premultiply:!1}),i.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);w.activeTexture.set(A.TEXTURE0);let G=i.fbo;if(!G){const te=new q(w,{width:z,height:z,data:null},A.RGBA);te.bind(A.LINEAR,A.CLAMP_TO_EDGE),G=i.fbo=w.createFramebuffer(z,z,!0),G.colorAttachment.set(te.texture)}w.bindFramebuffer.set(G.framebuffer),w.viewport.set([0,0,z,z]),d.useProgram("hillshadePrepare").draw(w,A.TRIANGLES,f,g,v,Vi.disabled,((te,Q)=>{const $=Q.stride,de=o.create();return o.ortho(de,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(de,de,[0,-o.EXTENT,0]),{u_matrix:de,u_image:1,u_dimension:[$,$],u_zoom:te.overscaledZ,u_unpack:Q.getUnpackVector()}})(i.tileID,I),null,l.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments),i.needsHillshadePrepare=!1}}function Eo(d,i,l,f,g,v){const w=f.paint.get("raster-fade-duration");if(!v&&w>0){const A=o.exported.now(),I=(A-d.timeAdded)/w,z=i?(A-i.timeAdded)/w:-1,B=l.getSource(),N=g.coveringZoomLevel({tileSize:B.tileSize,roundZoom:B.roundZoom}),G=!i||Math.abs(i.tileID.overscaledZ-N)>Math.abs(d.tileID.overscaledZ-N),te=G&&d.refreshedUponExpiration?1:o.clamp(G?I:1-z,0,1);return d.refreshedUponExpiration&&I>=1&&(d.refreshedUponExpiration=!1),i?{opacity:1,mix:1-te}:{opacity:te,mix:0}}return{opacity:1,mix:0}}const Co=new o.Color(1,0,0,1),Dr=new o.Color(0,1,0,1),Mc=new o.Color(0,0,1,1),_l=new o.Color(1,0,1,1),Pc=new o.Color(0,1,1,1);function Ua(d,i,l,f){ps(d,0,i+l/2,d.transform.width,l,f)}function Fs(d,i,l,f){ps(d,i-l/2,0,l,d.transform.height,f)}function ps(d,i,l,f,g,v){const w=d.context,A=w.gl;A.enable(A.SCISSOR_TEST),A.scissor(i*d.pixelRatio,l*d.pixelRatio,f*d.pixelRatio,g*d.pixelRatio),w.clear({color:v}),A.disable(A.SCISSOR_TEST)}function vh(d,i,l){const f=d.context,g=f.gl,v=l.posMatrix,w=d.useProgram("debug"),A=pi.disabled,I=Bi.disabled,z=d.colorModeForRenderPass(),B="$debug",N=d.style.terrain&&d.style.terrain.getTerrainData(l);f.activeTexture.set(g.TEXTURE0),d.emptyTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE);const G=i.getTileByID(l.key).latestRawTileData,te=Math.floor((G&&G.byteLength||0)/1024),Q=i.getTile(l).tileSize,$=512/Math.min(Q,512)*(l.overscaledZ/d.transform.zoom)*.5;let de=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(de+=` => ${l.overscaledZ}`),function(be,Ce){be.initDebugOverlayCanvas();const ne=be.debugOverlayCanvas,ze=be.context.gl,Me=be.debugOverlayCanvas.getContext("2d");Me.clearRect(0,0,ne.width,ne.height),Me.shadowColor="white",Me.shadowBlur=2,Me.lineWidth=1.5,Me.strokeStyle="white",Me.textBaseline="top",Me.font="bold 36px Open Sans, sans-serif",Me.fillText(Ce,5,5),Me.strokeText(Ce,5,5),be.debugOverlayTexture.update(ne),be.debugOverlayTexture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE)}(d,`${de} ${te}kB`),w.draw(f,g.TRIANGLES,A,I,Fi.alphaBlended,Vi.disabled,jn(v,o.Color.transparent,$),null,B,d.debugBuffer,d.quadTriangleIndexBuffer,d.debugSegments),w.draw(f,g.LINE_STRIP,A,I,z,Vi.disabled,jn(v,o.Color.red),N,B,d.debugBuffer,d.tileBorderIndexBuffer,d.debugSegments)}function Ao(d,i,l){const f=d.context,g=f.gl,v=d.colorModeForRenderPass(),w=new pi(g.LEQUAL,pi.ReadWrite,d.depthRangeFor3D),A=d.useProgram("terrain"),I=i.getTerrainMesh(),z=i.getTerrainData(l.tileID);f.bindFramebuffer.set(null),f.viewport.set([0,0,d.width,d.height]),f.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,i.getRTTFramebuffer().colorAttachment.get());const B=d.transform.calculatePosMatrix(l.tileID.toUnwrapped());A.draw(f,g.TRIANGLES,w,Bi.disabled,v,Vi.backCCW,{u_matrix:B,u_texture:0},z,"terrain",I.vertexBuffer,I.indexBuffer,I.segments)}function zc(d,i,l,f){const g=d.context,v=l.tileSize*i.qualityFactor;l.textures[f]||(l.textures[f]=d.getTileTexture(v)||new q(g,{width:v,height:v,data:null},g.gl.RGBA),l.textures[f].bind(g.gl.LINEAR,g.gl.CLAMP_TO_EDGE),f===0&&i.sourceCache.renderHistory.unshift(l.tileID.key));const w=i.getRTTFramebuffer();w.colorAttachment.set(l.textures[f].texture),g.bindFramebuffer.set(w.framebuffer),g.viewport.set([0,0,v,v])}class Dc{constructor(i){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=i,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=i.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const i=this.painter.style,l=i.terrain;for(const f in i.sourceCaches){this._coordsDescendingInv[f]={};const g=i.sourceCaches[f].getVisibleCoordinates();for(const v of g){const w=l.sourceCache.getTerrainCoords(v);for(const A in w)this._coordsDescendingInv[f][A]||(this._coordsDescendingInv[f][A]=[]),this._coordsDescendingInv[f][A].push(w[A])}}for(const f of i._order){const g=i._layers[f],v=g.source;if(this._renderToTexture[g.type]&&!this._coordsDescendingInvStr[v]){this._coordsDescendingInvStr[v]={};for(const w in this._coordsDescendingInv[v])this._coordsDescendingInvStr[v][w]=this._coordsDescendingInv[v][w].map(A=>A.key).sort().join()}}return this._renderableTiles.forEach(f=>{for(const g in this._coordsDescendingInvStr){const v=this._coordsDescendingInvStr[g][f.tileID.key];v&&v!==f.textureCoords[g]&&f.clearTextures(this.painter),l.needsRerender(g,f.tileID)&&f.clearTextures(this.painter)}this._rerender[f.tileID.key]=!f.textures.length}),l.clearRerenderCache(),l.sourceCache.removeOutdated(this.painter),this}renderLayer(i){const l=i.type,f=this.painter,g=f.style._order,v=f.currentLayer,w=v+1===g.length;if(this._renderToTexture[l]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=l,this._stacks[this._stacks.length-1].push(g[v]),!w))return!0;if(this._renderToTexture[this._prevType]||l==="hillshade"||this._renderToTexture[l]&&w){this._prevType=l;const A=this._stacks.length-1,I=this._stacks[A]||[];for(const z of this._renderableTiles){if(zc(f,f.style.terrain,z,A),this._rerender[z.tileID.key]){f.context.clear({color:o.Color.transparent});for(let B=0;B<I.length;B++){const N=f.style._layers[I[B]],G=N.source?this._coordsDescendingInv[N.source][z.tileID.key]:[z.tileID];f._renderTileClippingMasks(N,G),f.renderLayer(f,f.style.sourceCaches[N.source],N,G),N.source&&(z.textureCoords[N.source]=this._coordsDescendingInvStr[N.source][z.tileID.key])}}Ao(f,f.style.terrain,z)}if(l==="hillshade"){this._stacks.push([g[v]]);for(const z of this._renderableTiles){const B=this._coordsDescendingInv[i.source][z.tileID.key];zc(f,f.style.terrain,z,this._stacks.length-1),f.context.clear({color:o.Color.transparent}),f._renderTileClippingMasks(i,B),f.renderLayer(f,f.style.sourceCaches[i.source],i,B),Ao(f,f.style.terrain,z)}return!0}return this._renderToTexture[l]}return!1}}const Os={symbol:function(d,i,l,f,g){if(d.renderPass!=="translucent")return;const v=Bi.disabled,w=d.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(A,I,z,B,N,G,te){const Q=I.transform,$=N==="map",de=G==="map";for(const be of A){const Ce=B.getTile(be),ne=Ce.getBucket(z);if(!ne||!ne.text||!ne.text.segments.get().length)continue;const ze=o.evaluateSizeForZoom(ne.textSizeData,Q.zoom),Me=ji(Ce,1,I.transform.zoom),Ve=nn(be.posMatrix,de,$,I.transform,Me),qe=z.layout.get("icon-text-fit")!=="none"&&ne.hasIconData();if(ze){const it=Math.pow(2,Q.zoom-Ce.tileID.overscaledZ);Ac(ne,$,de,te,Q,Ve,be.posMatrix,it,ze,qe,I.style.terrain?(je,vt)=>I.style.terrain.getElevation(be,je,vt):null)}}}(f,d,l,i,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),g),l.paint.get("icon-opacity").constantOr(1)!==0&&So(d,i,l,f,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),v,w),l.paint.get("text-opacity").constantOr(1)!==0&&So(d,i,l,f,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),v,w),i.map.showCollisionBoxes&&(fs(d,i,l,f,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),fs(d,i,l,f,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(d,i,l,f){if(d.renderPass!=="translucent")return;const g=l.paint.get("circle-opacity"),v=l.paint.get("circle-stroke-width"),w=l.paint.get("circle-stroke-opacity"),A=!l.layout.get("circle-sort-key").isConstant();if(g.constantOr(1)===0&&(v.constantOr(1)===0||w.constantOr(1)===0))return;const I=d.context,z=I.gl,B=d.depthModeForSublayer(0,pi.ReadOnly),N=Bi.disabled,G=d.colorModeForRenderPass(),te=[];for(let Q=0;Q<f.length;Q++){const $=f[Q],de=i.getTile($),be=de.getBucket(l);if(!be)continue;const Ce=be.programConfigurations.get(l.id),ne=d.useProgram("circle",Ce),ze=be.layoutVertexBuffer,Me=be.indexBuffer,Ve=d.style.terrain&&d.style.terrain.getTerrainData($),qe={programConfiguration:Ce,program:ne,layoutVertexBuffer:ze,indexBuffer:Me,uniformValues:zr(d,$,de,l),terrainData:Ve};if(A){const it=be.segments.get();for(const je of it)te.push({segments:new o.SegmentVector([je]),sortKey:je.sortKey,state:qe})}else te.push({segments:be.segments,sortKey:0,state:qe})}A&&te.sort((Q,$)=>Q.sortKey-$.sortKey);for(const Q of te){const{programConfiguration:$,program:de,layoutVertexBuffer:be,indexBuffer:Ce,uniformValues:ne,terrainData:ze}=Q.state;de.draw(I,z.TRIANGLES,B,N,G,Vi.disabled,ne,ze,l.id,be,Ce,Q.segments,l.paint,d.transform.zoom,$)}},heatmap:function(d,i,l,f){if(l.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const g=d.context,v=g.gl,w=Bi.disabled,A=new Fi([v.ONE,v.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(I,z,B){const N=I.gl;I.activeTexture.set(N.TEXTURE1),I.viewport.set([0,0,z.width/4,z.height/4]);let G=B.heatmapFbo;if(G)N.bindTexture(N.TEXTURE_2D,G.colorAttachment.get()),I.bindFramebuffer.set(G.framebuffer);else{const te=N.createTexture();N.bindTexture(N.TEXTURE_2D,te),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MAG_FILTER,N.LINEAR),G=B.heatmapFbo=I.createFramebuffer(z.width/4,z.height/4,!1),function(Q,$,de,be){const Ce=Q.gl;Ce.texImage2D(Ce.TEXTURE_2D,0,Ce.RGBA,$.width/4,$.height/4,0,Ce.RGBA,Q.extRenderToTextureHalfFloat?Q.extTextureHalfFloat.HALF_FLOAT_OES:Ce.UNSIGNED_BYTE,null),be.colorAttachment.set(de)}(I,z,te,G)}})(g,d,l),g.clear({color:o.Color.transparent});for(let I=0;I<f.length;I++){const z=f[I];if(i.hasRenderableParent(z))continue;const B=i.getTile(z),N=B.getBucket(l);if(!N)continue;const G=N.programConfigurations.get(l.id),te=d.useProgram("heatmap",G),{zoom:Q}=d.transform;te.draw(g,v.TRIANGLES,pi.disabled,w,A,Vi.disabled,za(z.posMatrix,B,Q,l.paint.get("heatmap-intensity")),null,l.id,N.layoutVertexBuffer,N.indexBuffer,N.segments,l.paint,d.transform.zoom,G)}g.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(g,v){const w=g.context,A=w.gl,I=v.heatmapFbo;if(!I)return;w.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,I.colorAttachment.get()),w.activeTexture.set(A.TEXTURE1);let z=v.colorRampTexture;z||(z=v.colorRampTexture=new q(w,v.colorRamp,A.RGBA)),z.bind(A.LINEAR,A.CLAMP_TO_EDGE),g.useProgram("heatmapTexture").draw(w,A.TRIANGLES,pi.disabled,Bi.disabled,g.colorModeForRenderPass(),Vi.disabled,((B,N,G,te)=>{const Q=o.create();o.ortho(Q,0,B.width,B.height,0,0,1);const $=B.context.gl;return{u_matrix:Q,u_world:[$.drawingBufferWidth,$.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}})(g,v),null,v.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,v.paint,g.transform.zoom)}(d,l))},line:function(d,i,l,f){if(d.renderPass!=="translucent")return;const g=l.paint.get("line-opacity"),v=l.paint.get("line-width");if(g.constantOr(1)===0||v.constantOr(1)===0)return;const w=d.depthModeForSublayer(0,pi.ReadOnly),A=d.colorModeForRenderPass(),I=l.paint.get("line-dasharray"),z=l.paint.get("line-pattern"),B=z.constantOr(1),N=l.paint.get("line-gradient"),G=l.getCrossfadeParameters(),te=B?"linePattern":I?"lineSDF":N?"lineGradient":"line",Q=d.context,$=Q.gl;let de=!0;for(const be of f){const Ce=i.getTile(be);if(B&&!Ce.patternsLoaded())continue;const ne=Ce.getBucket(l);if(!ne)continue;const ze=ne.programConfigurations.get(l.id),Me=d.context.program.get(),Ve=d.useProgram(te,ze),qe=de||Ve.program!==Me,it=d.style.terrain&&d.style.terrain.getTerrainData(be),je=z.constantOr(null);if(je&&Ce.imageAtlas){const xt=Ce.imageAtlas,Yt=xt.patternPositions[je.to.toString()],ii=xt.patternPositions[je.from.toString()];Yt&&ii&&ze.setConstantPatternPositions(Yt,ii)}const vt=it?be:null,ft=B?as(d,Ce,l,G,vt):I?ta(d,Ce,l,I,G,vt):N?La(d,Ce,l,ne.lineClipsArray.length,vt):ea(d,Ce,l,vt);if(B)Q.activeTexture.set($.TEXTURE0),Ce.imageAtlasTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),ze.updatePaintBuffers(G);else if(I&&(qe||d.lineAtlas.dirty))Q.activeTexture.set($.TEXTURE0),d.lineAtlas.bind(Q);else if(N){const xt=ne.gradients[l.id];let Yt=xt.texture;if(l.gradientVersion!==xt.version){let ii=256;if(l.stepInterpolant){const Lt=i.getSource().maxzoom,Mi=be.canonical.z===Lt?Math.ceil(1<<d.transform.maxZoom-be.canonical.z):1;ii=o.clamp(o.nextPowerOfTwo(ne.maxLineLength/o.EXTENT*1024*Mi),256,Q.maxTextureSize)}xt.gradient=o.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:ii,image:xt.gradient||void 0,clips:ne.lineClipsArray}),xt.texture?xt.texture.update(xt.gradient):xt.texture=new q(Q,xt.gradient,$.RGBA),xt.version=l.gradientVersion,Yt=xt.texture}Q.activeTexture.set($.TEXTURE0),Yt.bind(l.stepInterpolant?$.NEAREST:$.LINEAR,$.CLAMP_TO_EDGE)}Ve.draw(Q,$.TRIANGLES,w,d.stencilModeForClipping(be),A,Vi.disabled,ft,it,l.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,l.paint,d.transform.zoom,ze,ne.layoutVertexBuffer2),de=!1}},fill:function(d,i,l,f){const g=l.paint.get("fill-color"),v=l.paint.get("fill-opacity");if(v.constantOr(1)===0)return;const w=d.colorModeForRenderPass(),A=l.paint.get("fill-pattern"),I=d.opaquePassEnabledForLayer()&&!A.constantOr(1)&&g.constantOr(o.Color.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===I){const z=d.depthModeForSublayer(1,d.renderPass==="opaque"?pi.ReadWrite:pi.ReadOnly);Rs(d,i,l,f,z,w,!1)}if(d.renderPass==="translucent"&&l.paint.get("fill-antialias")){const z=d.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,pi.ReadOnly);Rs(d,i,l,f,z,w,!0)}},"fill-extrusion":function(d,i,l,f){const g=l.paint.get("fill-extrusion-opacity");if(g!==0&&d.renderPass==="translucent"){const v=new pi(d.context.gl.LEQUAL,pi.ReadWrite,d.depthRangeFor3D);if(g!==1||l.paint.get("fill-extrusion-pattern").constantOr(1))Bs(d,i,l,f,v,Bi.disabled,Fi.disabled),Bs(d,i,l,f,v,d.stencilModeFor3D(),d.colorModeForRenderPass());else{const w=d.colorModeForRenderPass();Bs(d,i,l,f,v,Bi.disabled,w)}}},hillshade:function(d,i,l,f){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;const g=d.context,v=d.depthModeForSublayer(0,pi.ReadOnly),w=d.colorModeForRenderPass(),[A,I]=d.renderPass==="translucent"?d.stencilConfigForOverlap(f):[{},f];for(const z of I){const B=i.getTile(z);B.needsHillshadePrepare!==void 0&&B.needsHillshadePrepare&&d.renderPass==="offscreen"?Ic(d,B,l,v,Bi.disabled,w):d.renderPass==="translucent"&&gl(d,z,B,l,v,A[z.overscaledZ],w)}g.viewport.set([0,0,d.width,d.height])},raster:function(d,i,l,f){if(d.renderPass!=="translucent"||l.paint.get("raster-opacity")===0||!f.length)return;const g=d.context,v=g.gl,w=i.getSource(),A=d.useProgram("raster"),I=d.colorModeForRenderPass(),[z,B]=w instanceof ut?[{},f]:d.stencilConfigForOverlap(f),N=B[B.length-1].overscaledZ,G=!d.options.moving;for(const te of B){const Q=d.depthModeForSublayer(te.overscaledZ-N,l.paint.get("raster-opacity")===1?pi.ReadWrite:pi.ReadOnly,v.LESS),$=i.getTile(te);$.registerFadeDuration(l.paint.get("raster-fade-duration"));const de=i.findLoadedParent(te,0),be=Eo($,de,i,l,d.transform,d.style.terrain);let Ce,ne;const ze=l.paint.get("raster-resampling")==="nearest"?v.NEAREST:v.LINEAR;g.activeTexture.set(v.TEXTURE0),$.texture.bind(ze,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST),g.activeTexture.set(v.TEXTURE1),de?(de.texture.bind(ze,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST),Ce=Math.pow(2,de.tileID.overscaledZ-$.tileID.overscaledZ),ne=[$.tileID.canonical.x*Ce%1,$.tileID.canonical.y*Ce%1]):$.texture.bind(ze,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST);const Me=d.style.terrain&&d.style.terrain.getTerrainData(te),Ve=Me?te:null,qe=Ve?Ve.posMatrix:d.transform.calculatePosMatrix(te.toUnwrapped(),G),it=yo(qe,ne||[0,0],Ce||1,be,l);w instanceof ut?A.draw(g,v.TRIANGLES,Q,Bi.disabled,I,Vi.disabled,it,Me,l.id,w.boundsBuffer,d.quadTriangleIndexBuffer,w.boundsSegments):A.draw(g,v.TRIANGLES,Q,z[te.overscaledZ],I,Vi.disabled,it,Me,l.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}},background:function(d,i,l,f){const g=l.paint.get("background-color"),v=l.paint.get("background-opacity");if(v===0)return;const w=d.context,A=w.gl,I=d.transform,z=I.tileSize,B=l.paint.get("background-pattern");if(d.isPatternMissing(B))return;const N=!B&&g.a===1&&v===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==N)return;const G=Bi.disabled,te=d.depthModeForSublayer(0,N==="opaque"?pi.ReadWrite:pi.ReadOnly),Q=d.colorModeForRenderPass(),$=d.useProgram(B?"backgroundPattern":"background"),de=f||I.coveringTiles({tileSize:z,terrain:d.style.terrain});B&&(w.activeTexture.set(A.TEXTURE0),d.imageManager.bind(d.context));const be=l.getCrossfadeParameters();for(const Ce of de){const ne=f?Ce.posMatrix:d.transform.calculatePosMatrix(Ce.toUnwrapped()),ze=B?ll(ne,v,d,B,{tileID:Ce,tileSize:z},be):ol(ne,v,g),Me=d.style.terrain&&d.style.terrain.getTerrainData(Ce);$.draw(w,A.TRIANGLES,te,G,Q,Vi.disabled,ze,Me,l.id,d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}},debug:function(d,i,l){for(let f=0;f<l.length;f++)vh(d,i,l[f])},custom:function(d,i,l){const f=d.context,g=l.implementation;if(d.renderPass==="offscreen"){const v=g.prerender;v&&(d.setCustomLayerDefaults(),f.setColorMode(d.colorModeForRenderPass()),v.call(g,f.gl,d.transform.customLayerMatrix()),f.setDirty(),d.setBaseState())}else if(d.renderPass==="translucent"){d.setCustomLayerDefaults(),f.setColorMode(d.colorModeForRenderPass()),f.setStencilMode(Bi.disabled);const v=g.renderingMode==="3d"?new pi(d.context.gl.LEQUAL,pi.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,pi.ReadOnly);f.setDepthMode(v),g.render(f.gl,d.transform.customLayerMatrix()),f.setDirty(),d.setBaseState(),f.bindFramebuffer.set(null)}}};class yl{constructor(i,l){this.context=new Cc(i),this.transform=l,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.create(),renderTime:0},this.setup(),this.numSublayers=rt.maxUnderzooming+rt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Bt,this.gpuTimers={}}resize(i,l,f){if(this.width=i*f,this.height=l*f,this.pixelRatio=f,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style._order)this.style._layers[g].resize()}setup(){const i=this.context,l=new o.PosArray;l.emplaceBack(0,0),l.emplaceBack(o.EXTENT,0),l.emplaceBack(0,o.EXTENT),l.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(l,ri.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const f=new o.PosArray;f.emplaceBack(0,0),f.emplaceBack(o.EXTENT,0),f.emplaceBack(0,o.EXTENT),f.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=i.createVertexBuffer(f,ri.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const g=new o.RasterBoundsArray;g.emplaceBack(0,0,0,0),g.emplaceBack(o.EXTENT,0,o.EXTENT,0),g.emplaceBack(0,o.EXTENT,0,o.EXTENT),g.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.rasterBoundsBuffer=i.createVertexBuffer(g,Le.members),this.rasterBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const v=new o.PosArray;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(v,ri.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const w=new o.LineStripIndexArray;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(w);const A=new o.TriangleIndexArray;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(A),this.emptyTexture=new q(i,{width:1,height:1,data:new Uint8Array([0,0,0,0])},i.gl.RGBA);const I=this.context.gl;this.stencilClearMode=new Bi({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO)}clearStencil(){const i=this.context,l=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const f=o.create();o.ortho(f,0,this.width,this.height,0,0,1),o.scale(f,f,[l.drawingBufferWidth,l.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(i,l.TRIANGLES,pi.disabled,this.stencilClearMode,Fi.disabled,Vi.disabled,$r(f),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(i,l){if(this.currentStencilSource===i.source||!i.isTileClipped()||!l||!l.length)return;this.currentStencilSource=i.source;const f=this.context,g=f.gl;this.nextStencilID+l.length>256&&this.clearStencil(),f.setColorMode(Fi.disabled),f.setDepthMode(pi.disabled);const v=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const w of l){const A=this._tileClippingMaskIDs[w.key]=this.nextStencilID++,I=this.style.terrain&&this.style.terrain.getTerrainData(w);v.draw(f,g.TRIANGLES,pi.disabled,new Bi({func:g.ALWAYS,mask:0},A,255,g.KEEP,g.KEEP,g.REPLACE),Fi.disabled,Vi.disabled,$r(w.posMatrix),I,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,l=this.context.gl;return new Bi({func:l.NOTEQUAL,mask:255},i,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(i){const l=this.context.gl;return new Bi({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(i){const l=this.context.gl,f=i.sort((w,A)=>A.overscaledZ-w.overscaledZ),g=f[f.length-1].overscaledZ,v=f[0].overscaledZ-g+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const w={};for(let A=0;A<v;A++)w[A+g]=new Bi({func:l.GEQUAL,mask:255},A+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=v,[w,f]}return[{[g]:Bi.disabled},f]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new Fi([i.CONSTANT_COLOR,i.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Fi.unblended:Fi.alphaBlended}depthModeForSublayer(i,l,f){if(!this.opaquePassEnabledForLayer())return pi.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new pi(f||this.context.gl.LEQUAL,l,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,l){this.style=i,this.options=l,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const f=this.style._order,g=this.style.sourceCaches,v=this.style.terrain&&new Dc(this);for(const z in g){const B=g[z];B.used&&B.prepare(this.context)}const w={},A={},I={};for(const z in g){const B=g[z];w[z]=B.getVisibleCoordinates(),A[z]=w[z].slice().reverse(),I[z]=B.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let z=0;z<f.length;z++)if(this.style._layers[f[z]].is3D()){this.opaquePassCutoff=z;break}if(v){this.opaquePassCutoff=0;const z=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!o.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||z.length)&&(o.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(B,N){const G=B.context,te=G.gl,Q=Fi.unblended,$=new pi(te.LEQUAL,pi.ReadWrite,[0,1]),de=N.getTerrainMesh(),be=N.sourceCache.getRenderableTiles(),Ce=B.useProgram("terrainDepth");G.bindFramebuffer.set(N.getFramebuffer("depth").framebuffer),G.viewport.set([0,0,B.width/devicePixelRatio,B.height/devicePixelRatio]),G.clear({color:o.Color.transparent,depth:1});for(const ne of be){const ze=N.getTerrainData(ne.tileID),Me=B.transform.calculatePosMatrix(ne.tileID.toUnwrapped());Ce.draw(G,te.TRIANGLES,$,Bi.disabled,Q,Vi.backCCW,{u_matrix:Me},ze,"terrain",de.vertexBuffer,de.indexBuffer,de.segments)}G.bindFramebuffer.set(null),G.viewport.set([0,0,B.width,B.height])}(this,this.style.terrain),function(B,N){const G=B.context,te=G.gl,Q=Fi.unblended,$=new pi(te.LEQUAL,pi.ReadWrite,[0,1]),de=N.getTerrainMesh(),be=N.getCoordsTexture(),Ce=N.sourceCache.getRenderableTiles(),ne=B.useProgram("terrainCoords");G.bindFramebuffer.set(N.getFramebuffer("coords").framebuffer),G.viewport.set([0,0,B.width/devicePixelRatio,B.height/devicePixelRatio]),G.clear({color:o.Color.transparent,depth:1}),N.coordsIndex=[];for(const ze of Ce){const Me=N.getTerrainData(ze.tileID);G.activeTexture.set(te.TEXTURE0),te.bindTexture(te.TEXTURE_2D,be.texture);const Ve=B.transform.calculatePosMatrix(ze.tileID.toUnwrapped());ne.draw(G,te.TRIANGLES,$,Bi.disabled,Q,Vi.backCCW,{u_matrix:Ve,u_terrain_coords_id:(255-N.coordsIndex.length)/255,u_texture:0},Me,"terrain",de.vertexBuffer,de.indexBuffer,de.segments),N.coordsIndex.push(ze.tileID.key)}G.bindFramebuffer.set(null),G.viewport.set([0,0,B.width,B.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const z of f){const B=this.style._layers[z];if(!B.hasOffscreenPass()||B.isHidden(this.transform.zoom))continue;const N=A[B.source];(B.type==="custom"||N.length)&&this.renderLayer(this,g[B.source],B,N)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:l.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],!v)for(this.renderPass="opaque",this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){const z=this.style._layers[f[this.currentLayer]],B=g[z.source],N=w[z.source];this._renderTileClippingMasks(z,N),this.renderLayer(this,B,z,N)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){const z=this.style._layers[f[this.currentLayer]],B=g[z.source];if(v&&v.renderLayer(z))continue;const N=(z.type==="symbol"?I:A)[z.source];this._renderTileClippingMasks(z,w[z.source]),this.renderLayer(this,B,z,N)}if(this.options.showTileBoundaries){let z,B;Object.values(this.style._layers).forEach(N=>{N.source&&!N.isHidden(this.transform.zoom)&&(N.source!==(B&&B.id)&&(B=this.style.sourceCaches[N.source]),(!z||z.getSource().maxzoom<B.getSource().maxzoom)&&(z=B))}),z&&Os.debug(this,z,z.getVisibleCoordinates())}this.options.showPadding&&function(z){const B=z.transform.padding;Ua(z,z.transform.height-(B.top||0),3,Co),Ua(z,B.bottom||0,3,Dr),Fs(z,B.left||0,3,Mc),Fs(z,z.transform.width-(B.right||0),3,_l);const N=z.transform.centerPoint;(function(G,te,Q,$){ps(G,te-1,Q-10,2,20,$),ps(G,te-10,Q-1,20,2,$)})(z,N.x,z.transform.height-N.y,Pc)}(this),this.context.setDefault()}renderLayer(i,l,f,g){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="custom"||(g||[]).length)&&(this.id=f.id,this.gpuTimingStart(f),Os[f.type](i,l,f,g,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let f=this.gpuTimers[i.id];f||(f=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),f.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,f.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}queryGpuTimers(i){const l={};for(const f in i){const g=i[f],v=this.context.extTimerQuery,w=v.getQueryObjectEXT(g.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(g.query),l[f]=w}return l}translatePosMatrix(i,l,f,g,v){if(!f[0]&&!f[1])return i;const w=v?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(w){const z=Math.sin(w),B=Math.cos(w);f=[f[0]*B-f[1]*z,f[0]*z+f[1]*B]}const A=[v?f[0]:ji(l,f[0],this.transform.zoom),v?f[1]:ji(l,f[1],this.transform.zoom),0],I=new Float32Array(16);return o.translate(I,i,A),I}saveTileTexture(i){const l=this._tileTextures[i.size[0]];l?l.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const l=this._tileTextures[i];return l&&l.length>0?l.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const l=this.imageManager.getPattern(i.from.toString()),f=this.imageManager.getPattern(i.to.toString());return!l||!f}useProgram(i,l){this.cache=this.cache||{};const f=i+(l?l.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[f]||(this.cache[f]=new da(this.context,i,jr[i],l,Ra[i],this._showOverdrawInspector,this.style.terrain)),this.cache[f]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new q(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class Io{constructor(i,l){this.points=i,this.planes=l}static fromInvProjectionMatrix(i,l,f){const g=Math.pow(2,f),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const I=1/(A=o.transformMat4([],A,i))[3]/l*g;return o.mul$1(A,A,[I,I,1/A[3],I])}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const I=o.sub([],v[A[0]],v[A[1]]),z=o.sub([],v[A[2]],v[A[1]]),B=o.normalize([],o.cross([],I,z)),N=-o.dot(B,v[A[1]]);return B.concat(N)});return new Io(v,w)}}class Us{constructor(i,l){this.min=i,this.max=l,this.center=o.scale$1([],o.add([],this.min,this.max),.5)}quadrant(i){const l=[i%2==0,i<2],f=o.clone$2(this.min),g=o.clone$2(this.max);for(let v=0;v<l.length;v++)f[v]=l[v]?this.min[v]:this.center[v],g[v]=l[v]?this.center[v]:this.max[v];return g[2]=this.max[2],new Us(f,g)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}intersects(i){const l=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let f=!0;for(let g=0;g<i.planes.length;g++){const v=i.planes[g];let w=0;for(let A=0;A<l.length;A++)o.dot$1(v,l[A])>=0&&w++;if(w===0)return 0;w!==l.length&&(f=!1)}if(f)return 2;for(let g=0;g<3;g++){let v=Number.MAX_VALUE,w=-Number.MAX_VALUE;for(let A=0;A<i.points.length;A++){const I=i.points[A][g]-this.min[g];v=Math.min(v,I),w=Math.max(w,I)}if(w<0||v>this.max[g]-this.min[g])return 0}return 1}}class ds{constructor(i=0,l=0,f=0,g=0){if(isNaN(i)||i<0||isNaN(l)||l<0||isNaN(f)||f<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=l,this.left=f,this.right=g}interpolate(i,l,f){return l.top!=null&&i.top!=null&&(this.top=o.number(i.top,l.top,f)),l.bottom!=null&&i.bottom!=null&&(this.bottom=o.number(i.bottom,l.bottom,f)),l.left!=null&&i.left!=null&&(this.left=o.number(i.left,l.left,f)),l.right!=null&&i.right!=null&&(this.right=o.number(i.right,l.right,f)),this}getCenter(i,l){const f=o.clamp((this.left+i-this.right)/2,0,i),g=o.clamp((this.top+l-this.bottom)/2,0,l);return new o.pointGeometry(f,g)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new ds(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Ns{constructor(i,l,f,g,v){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=v===void 0||!!v,this._minZoom=i||0,this._maxZoom=l||22,this._minPitch=f??0,this._maxPitch=g??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ds,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const i=new Ns(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.tileSize=this.tileSize,i.latRange=this.latRange,i.width=this.width,i.height=this.height,i._center=this._center,i._elevation=this._elevation,i.zoom=this.zoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._calcMatrices(),i}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(i){const l=-o.wrap(i,-180,180)*Math.PI/180;var f;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(f=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f),function(g,v,w){var A=v[0],I=v[1],z=v[2],B=v[3],N=Math.sin(w),G=Math.cos(w);g[0]=A*G+z*N,g[1]=I*G+B*N,g[2]=A*-N+z*G,g[3]=I*-N+B*G}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const l=o.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(i){const l=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(i){i!==this._elevation&&(this._elevation=i,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,l,f){this._unmodified=!1,this._edgeInsets.interpolate(i,l,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const l=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(i){const l=[new o.UnwrappedTileID(0,i)];if(this._renderWorldCopies){const f=this.pointCoordinate(new o.pointGeometry(0,0)),g=this.pointCoordinate(new o.pointGeometry(this.width,0)),v=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),w=this.pointCoordinate(new o.pointGeometry(0,this.height)),A=Math.floor(Math.min(f.x,g.x,v.x,w.x)),I=Math.floor(Math.max(f.x,g.x,v.x,w.x)),z=1;for(let B=A-z;B<=I+z;B++)B!==0&&l.push(new o.UnwrappedTileID(B,i))}return l}coveringTiles(i){var l,f;let g=this.coveringZoomLevel(i);const v=g;if(i.minzoom!==void 0&&g<i.minzoom)return[];i.maxzoom!==void 0&&g>i.maxzoom&&(g=i.maxzoom);const w=this.pointCoordinate(this.getCameraPoint()),A=o.MercatorCoordinate.fromLngLat(this.center),I=Math.pow(2,g),z=[I*w.x,I*w.y,0],B=[I*A.x,I*A.y,0],N=Io.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,g);let G=i.minzoom||0;!i.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(G=g);const te=i.terrain?2/Math.min(this.tileSize,i.tileSize)*this.tileSize:3,Q=ne=>({aabb:new Us([ne*I,0,0],[(ne+1)*I,I,0]),zoom:0,x:0,y:0,wrap:ne,fullyVisible:!1}),$=[],de=[],be=g,Ce=i.reparseOverscaled?v:g;if(this._renderWorldCopies)for(let ne=1;ne<=3;ne++)$.push(Q(-ne)),$.push(Q(ne));for($.push(Q(0));$.length>0;){const ne=$.pop(),ze=ne.x,Me=ne.y;let Ve=ne.fullyVisible;if(!Ve){const xt=ne.aabb.intersects(N);if(xt===0)continue;Ve=xt===2}const qe=i.terrain?z:B,it=ne.aabb.distanceX(qe),je=ne.aabb.distanceY(qe),vt=Math.max(Math.abs(it),Math.abs(je)),ft=te+(1<<be-ne.zoom)-2;if(ne.zoom===be||vt>ft&&ne.zoom>=G){const xt=be-ne.zoom,Yt=z[0]-.5-(ze<<xt),ii=z[1]-.5-(Me<<xt);de.push({tileID:new o.OverscaledTileID(ne.zoom===be?Ce:ne.zoom,ne.wrap,ne.zoom,ze,Me),distanceSq:o.sqrLen([B[0]-.5-ze,B[1]-.5-Me]),tileDistanceToCamera:Math.sqrt(Yt*Yt+ii*ii)})}else for(let xt=0;xt<4;xt++){const Yt=(ze<<1)+xt%2,ii=(Me<<1)+(xt>>1),Lt=ne.zoom+1;let Mi=ne.aabb.quadrant(xt);if(i.terrain){const Pi=new o.OverscaledTileID(Lt,ne.wrap,Lt,Yt,ii),yi=i.terrain.getMinMaxElevation(Pi),xi=(l=yi.minElevation)!==null&&l!==void 0?l:this.elevation,zi=(f=yi.maxElevation)!==null&&f!==void 0?f:this.elevation;Mi=new Us([Mi.min[0],Mi.min[1],xi],[Mi.max[0],Mi.max[1],zi])}$.push({aabb:Mi,zoom:Lt,x:Yt,y:ii,wrap:ne.wrap,fullyVisible:Ve})}}return de.sort((ne,ze)=>ne.distanceSq-ze.distanceSq).map(ne=>ne.tileID)}resize(i,l){this.width=i,this.height=l,this.pixelsToGLUnits=[2/i,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const l=o.clamp(i.lat,-this.maxValidLatitude,this.maxValidLatitude);return new o.pointGeometry(o.mercatorXfromLng(i.lng)*this.worldSize,o.mercatorYfromLat(l)*this.worldSize)}unproject(i){return new o.MercatorCoordinate(i.x/this.worldSize,i.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(i){this.freezeElevation||(this.elevation=i?this.getElevation(this._center,i):0)}getElevation(i,l){const f=o.MercatorCoordinate.fromLngLat(i),g=(1<<this.tileZoom)*o.EXTENT,v=f.x*g,w=f.y*g,A=Math.floor(v/o.EXTENT),I=Math.floor(w/o.EXTENT),z=new o.OverscaledTileID(this.tileZoom,0,this.tileZoom,A,I);return l.getElevation(z,v%o.EXTENT,w%o.EXTENT,o.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(i){const l=this.pointLocation(this.centerPoint,i),f=this.getElevation(l,i);if(!(this.elevation-f))return;const g=this.getCameraPosition(),v=o.MercatorCoordinate.fromLngLat(g.lngLat,g.altitude),w=o.MercatorCoordinate.fromLngLat(l,f),A=v.x-w.x,I=v.y-w.y,z=v.z-w.z,B=Math.sqrt(A*A+I*I+z*z),N=this.scaleZoom(this.cameraToCenterDistance/B/this.tileSize);this._elevation=f,this._center=l,this.zoom=N}setLocationAtPoint(i,l){const f=this.pointCoordinate(l),g=this.pointCoordinate(this.centerPoint),v=this.locationCoordinate(i),w=new o.MercatorCoordinate(v.x-(f.x-g.x),v.y-(f.y-g.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(i,l){return l?this.coordinatePoint(this.locationCoordinate(i),this.getElevation(i,l),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(i))}pointLocation(i,l){return this.coordinateLocation(this.pointCoordinate(i,l))}locationCoordinate(i){return o.MercatorCoordinate.fromLngLat(i)}coordinateLocation(i){return i&&i.toLngLat()}pointCoordinate(i,l){if(l){const G=l.pointCoordinate(i);if(G!=null)return G}const f=[i.x,i.y,0,1],g=[i.x,i.y,1,1];o.transformMat4(f,f,this.pixelMatrixInverse),o.transformMat4(g,g,this.pixelMatrixInverse);const v=f[3],w=g[3],A=f[1]/v,I=g[1]/w,z=f[2]/v,B=g[2]/w,N=z===B?0:(0-z)/(B-z);return new o.MercatorCoordinate(o.number(f[0]/v,g[0]/w,N)/this.worldSize,o.number(A,I,N)/this.worldSize)}coordinatePoint(i,l=0,f=this.pixelMatrix){const g=[i.x*this.worldSize,i.y*this.worldSize,l,1];return o.transformMat4(g,g,f),new o.pointGeometry(g[0]/g[3],g[1]/g[3])}getBounds(){const i=Math.max(0,this.height/2-this.getHorizon());return new o.LngLatBounds().extend(this.pointLocation(new o.pointGeometry(0,i))).extend(this.pointLocation(new o.pointGeometry(this.width,i))).extend(this.pointLocation(new o.pointGeometry(this.width,this.height))).extend(this.pointLocation(new o.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new o.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(i){i?(this.lngRange=[i.getWest(),i.getEast()],this.latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(i,l=!1){const f=i.key,g=l?this._alignedPosMatrixCache:this._posMatrixCache;if(g[f])return g[f];const v=i.canonical,w=this.worldSize/this.zoomScale(v.z),A=v.x+Math.pow(2,v.z)*i.wrap,I=o.identity(new Float64Array(16));return o.translate(I,I,[A*w,v.y*w,0]),o.scale(I,I,[w/o.EXTENT,w/o.EXTENT,1]),o.multiply(I,l?this.alignedProjMatrix:this.projMatrix,I),g[f]=new Float32Array(I),g[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let i,l,f,g,v=-90,w=90,A=-180,I=180;const z=this.size,B=this._unmodified;if(this.latRange){const te=this.latRange;v=o.mercatorYfromLat(te[1])*this.worldSize,w=o.mercatorYfromLat(te[0])*this.worldSize,i=w-v<z.y?z.y/(w-v):0}if(this.lngRange){const te=this.lngRange;A=o.wrap(o.mercatorXfromLng(te[0])*this.worldSize,0,this.worldSize),I=o.wrap(o.mercatorXfromLng(te[1])*this.worldSize,0,this.worldSize),I<A&&(I+=this.worldSize),l=I-A<z.x?z.x/(I-A):0}const N=this.point,G=Math.max(l||0,i||0);if(G)return this.center=this.unproject(new o.pointGeometry(l?(I+A)/2:N.x,i?(w+v)/2:N.y)),this.zoom+=this.scaleZoom(G),this._unmodified=B,void(this._constraining=!1);if(this.latRange){const te=N.y,Q=z.y/2;te-Q<v&&(g=v+Q),te+Q>w&&(g=w-Q)}if(this.lngRange){const te=(A+I)/2,Q=o.wrap(N.x,te-this.worldSize/2,te+this.worldSize/2),$=z.x/2;Q-$<A&&(f=A+$),Q+$>I&&(f=I-$)}f===void 0&&g===void 0||(this.center=this.unproject(new o.pointGeometry(f!==void 0?f:N.x,g!==void 0?g:N.y)).wrap()),this._unmodified=B,this._constraining=!1}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,l=this.point.x,f=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let g=o.identity(new Float64Array(16));o.scale(g,g,[this.width/2,-this.height/2,1]),o.translate(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=o.identity(new Float64Array(16)),o.scale(g,g,[1,-1,1]),o.translate(g,g,[-1,-1,0]),o.scale(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const v=Math.PI/2+this._pitch,w=this._fov*(.5+i.y/this.height),A=Math.sin(w)*this.cameraToSeaLevelDistance/Math.sin(o.clamp(Math.PI-v-w,.01,Math.PI-.01)),I=this.getHorizon(),z=2*Math.atan(I/this.cameraToCenterDistance)*(.5+i.y/(2*I)),B=Math.sin(z)*this.cameraToSeaLevelDistance/Math.sin(o.clamp(Math.PI-v-z,.01,Math.PI-.01)),N=Math.cos(Math.PI/2-this._pitch)*A+this.cameraToSeaLevelDistance,G=Math.cos(Math.PI/2-this._pitch)*B+this.cameraToSeaLevelDistance,te=1.01*Math.min(N,G),Q=this.height/50;g=new Float64Array(16),o.perspective(g,this._fov,this.width/this.height,Q,te),g[8]=2*-i.x/this.width,g[9]=2*i.y/this.height,o.scale(g,g,[1,-1,1]),o.translate(g,g,[0,0,-this.cameraToCenterDistance]),o.rotateX(g,g,this._pitch),o.rotateZ(g,g,this.angle),o.translate(g,g,[-l,-f,0]),this.mercatorMatrix=o.scale([],g,[this.worldSize,this.worldSize,this.worldSize]),o.scale(g,g,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,g),o.translate(g,g,[0,0,-this.elevation]),this.projMatrix=g,this.invProjMatrix=o.invert([],g),this.pixelMatrix3D=o.multiply(new Float64Array(16),this.labelPlaneMatrix,g);const $=this.width%2/2,de=this.height%2/2,be=Math.cos(this.angle),Ce=Math.sin(this.angle),ne=l-Math.round(l)+be*$+Ce*de,ze=f-Math.round(f)+be*de+Ce*$,Me=new Float64Array(g);if(o.translate(Me,Me,[ne>.5?ne-1:ne,ze>.5?ze-1:ze,0]),this.alignedProjMatrix=Me,g=o.invert(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");this.pixelMatrixInverse=g,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const i=this.pointCoordinate(new o.pointGeometry(0,0)),l=[i.x*this.worldSize,i.y*this.worldSize,0,1];return o.transformMat4(l,l,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,i))}getCameraQueryGeometry(i){const l=this.getCameraPoint();if(i.length===1)return[i[0],l];{let f=l.x,g=l.y,v=l.x,w=l.y;for(const A of i)f=Math.min(f,A.x),g=Math.min(g,A.y),v=Math.max(v,A.x),w=Math.max(w,A.y);return[new o.pointGeometry(f,g),new o.pointGeometry(v,g),new o.pointGeometry(v,w),new o.pointGeometry(f,w),new o.pointGeometry(f,g)]}}}class Lc{constructor(i){this._hashName=i&&encodeURIComponent(i),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(l,f){let g=!1,v=null;const w=()=>{v=null,g&&(l(),v=setTimeout(w,300),g=!1)};return()=>(g=!0,v||w(),v)}(this._updateHashUnthrottled.bind(this))}addTo(i){return this._map=i,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(i){const l=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,g=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,g),w=Math.round(l.lng*v)/v,A=Math.round(l.lat*v)/v,I=this._map.getBearing(),z=this._map.getPitch();let B="";if(B+=i?`/${w}/${A}/${f}`:`${f}/${A}/${w}`,(I||z)&&(B+="/"+Math.round(10*I)/10),z&&(B+=`/${Math.round(z)}`),this._hashName){const N=this._hashName;let G=!1;const te=window.location.hash.slice(1).split("&").map(Q=>{const $=Q.split("=")[0];return $===N?(G=!0,`${$}=${B}`):Q}).filter(Q=>Q);return G||te.push(`${N}=${B}`),`#${te.join("&")}`}return`#${B}`}_getCurrentHash(){const i=window.location.hash.replace("#","");if(this._hashName){let l;return i.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(l=f)}),(l&&l[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._getCurrentHash();if(i.length>=3&&!i.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:l,pitch:+(i[4]||0)}),!0}return!1}_updateHashUnthrottled(){const i=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,i)}catch{}}}const js={linearity:.3,easing:o.bezier(0,0,.3,1)},Rc=o.extend({deceleration:2500,maxSpeed:1400},js),Bc=o.extend({deceleration:20,maxSpeed:1400},js),Fc=o.extend({deceleration:1e3,maxSpeed:360},js),ms=o.extend({deceleration:1e3,maxSpeed:90},js);class Oc{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,l=o.exported.now();for(;i.length>0&&l-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)l.zoom+=v.zoomDelta||0,l.bearing+=v.bearingDelta||0,l.pitch+=v.pitchDelta||0,v.panDelta&&l.pan._add(v.panDelta),v.around&&(l.around=v.around),v.pinchAround&&(l.pinchAround=v.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(l.pan.mag()){const v=qs(l.pan.mag(),f,o.extend({},Rc,i||{}));g.offset=l.pan.mult(v.amount/l.pan.mag()),g.center=this._map.transform.center,Vs(g,v)}if(l.zoom){const v=qs(l.zoom,f,Bc);g.zoom=this._map.transform.zoom+v.amount,Vs(g,v)}if(l.bearing){const v=qs(l.bearing,f,Fc);g.bearing=this._map.transform.bearing+o.clamp(v.amount,-179,179),Vs(g,v)}if(l.pitch){const v=qs(l.pitch,f,ms);g.pitch=this._map.transform.pitch+v.amount,Vs(g,v)}if(g.zoom||g.bearing){const v=l.pinchAround===void 0?l.around:l.pinchAround;g.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),o.extend(g,{noMoveStart:!0})}}function Vs(d,i){(!d.duration||d.duration<i.duration)&&(d.duration=i.duration,d.easing=i.easing)}function qs(d,i,l){const{maxSpeed:f,linearity:g,deceleration:v}=l,w=o.clamp(d*g/(i/1e3),-f,f),A=Math.abs(w)/(v*g);return{easing:l.easing,duration:1e3*A,amount:w*(A/2)}}class rr extends o.Event{constructor(i,l,f,g={}){const v=k.mousePos(l.getCanvasContainer(),f),w=l.unproject(v);super(i,o.extend({point:v,lngLat:w,originalEvent:f},g)),this._defaultPrevented=!1,this.target=l}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Gs extends o.Event{constructor(i,l,f){const g=i==="touchend"?f.changedTouches:f.touches,v=k.touchPos(l.getCanvasContainer(),g),w=v.map(I=>l.unproject(I)),A=v.reduce((I,z,B,N)=>I.add(z.div(N.length)),new o.pointGeometry(0,0));super(i,{points:v,point:A,lngLats:w,lngLat:l.unproject(A),originalEvent:f}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class ar extends o.Event{constructor(i,l,f){super(i,{originalEvent:f}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class xh{constructor(i,l){this._map=i,this._clickTolerance=l.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new ar(i.type,this._map,i))}mousedown(i,l){return this._mousedownPos=l,this._firePreventable(new rr(i.type,this._map,i))}mouseup(i){this._map.fire(new rr(i.type,this._map,i))}click(i,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||this._map.fire(new rr(i.type,this._map,i))}dblclick(i){return this._firePreventable(new rr(i.type,this._map,i))}mouseover(i){this._map.fire(new rr(i.type,this._map,i))}mouseout(i){this._map.fire(new rr(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Gs(i.type,this._map,i))}touchmove(i){this._map.fire(new Gs(i.type,this._map,i))}touchend(i){this._map.fire(new Gs(i.type,this._map,i))}touchcancel(i){this._map.fire(new Gs(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _a{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(i){this._map.fire(new rr(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new rr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._ignoreContextMenu||this._map.fire(new rr(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Uc{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,l){this.isEnabled()&&i.shiftKey&&i.button===0&&(k.disableDrag(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(i,l){if(!this._active)return;const f=l;if(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)return;const g=this._startPos;this._lastPos=f,this._box||(this._box=k.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const v=Math.min(g.x,f.x),w=Math.max(g.x,f.x),A=Math.min(g.y,f.y),I=Math.max(g.y,f.y);k.setTransform(this._box,`translate(${v}px,${A}px)`),this._box.style.width=w-v+"px",this._box.style.height=I-A+"px"}mouseupWindow(i,l){if(!this._active||i.button!==0)return;const f=this._startPos,g=l;if(this.reset(),k.suppressClick(),f.x!==g.x||f.y!==g.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:v=>v.fitScreenCoordinates(f,g,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(k.remove(this._box),this._box=null),k.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,l){return this._map.fire(new o.Event(i,{originalEvent:l}))}}function na(d,i){if(d.length!==i.length)throw new Error(`The number of touches and points are not equal - touches ${d.length}, points ${i.length}`);const l={};for(let f=0;f<d.length;f++)l[d[f].identifier]=i[f];return l}class Zs{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,l,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),f.length===this.numTouches&&(this.centroid=function(g){const v=new o.pointGeometry(0,0);for(const w of g)v._add(w);return v.div(g.length)}(l),this.touches=na(f,l)))}touchmove(i,l,f){if(this.aborted||!this.centroid)return;const g=na(f,l);for(const v in this.touches){const w=this.touches[v],A=g[v];(!A||A.dist(w)>30)&&(this.aborted=!0)}}touchend(i,l,f){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class vl{constructor(i){this.singleTap=new Zs(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,l,f){this.singleTap.touchstart(i,l,f)}touchmove(i,l,f){this.singleTap.touchmove(i,l,f)}touchend(i,l,f){const g=this.singleTap.touchend(i,l,f);if(g){const v=i.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(g)<30;if(v&&w||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class bh{constructor(){this._zoomIn=new vl({numTouches:1,numTaps:2}),this._zoomOut=new vl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,l,f){this._zoomIn.touchstart(i,l,f),this._zoomOut.touchstart(i,l,f)}touchmove(i,l,f){this._zoomIn.touchmove(i,l,f),this._zoomOut.touchmove(i,l,f)}touchend(i,l,f){const g=this._zoomIn.touchend(i,l,f),v=this._zoomOut.touchend(i,l,f);return g?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(g)},{originalEvent:i})}):v?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(v)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const wh={0:1,2:2};class Mo{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(i,l){return!1}_move(i,l){return{}}mousedown(i,l){if(this._lastPoint)return;const f=k.mouseButton(i);this._correctButton(i,f)&&(this._lastPoint=l,this._eventButton=f)}mousemoveWindow(i,l){const f=this._lastPoint;if(f){if(i.preventDefault(),function(g,v){const w=wh[v];return g.buttons===void 0||(g.buttons&w)!==w}(i,this._eventButton))this.reset();else if(this._moved||!(l.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(f,l)}}mouseupWindow(i){this._lastPoint&&k.mouseButton(i)===this._eventButton&&(this._moved&&k.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hs extends Mo{mousedown(i,l){super.mousedown(i,l),this._lastPoint&&(this._active=!0)}_correctButton(i,l){return l===0&&!i.ctrlKey}_move(i,l){return{around:l,panDelta:l.sub(i)}}}class ra extends Mo{_correctButton(i,l){return l===0&&i.ctrlKey||l===2}_move(i,l){const f=.8*(l.x-i.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(i){i.preventDefault()}}class Et extends Mo{_correctButton(i,l){return l===0&&i.ctrlKey||l===2}_move(i,l){const f=-.5*(l.y-i.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(i){i.preventDefault()}}class Nc{constructor(i,l){this._minTouches=i.cooperativeGestures?2:1,this._clickTolerance=i.clickTolerance||1,this._map=l,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(i,l,f){return this._calculateTransform(i,l,f)}touchmove(i,l,f){if(this._map._cooperativeGestures&&(this._minTouches===2&&f.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(i,!1,f.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(f.length<this._minTouches))return i.preventDefault(),this._calculateTransform(i,l,f)}touchend(i,l,f){this._calculateTransform(i,l,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,l,f){f.length>0&&(this._active=!0);const g=na(f,l),v=new o.pointGeometry(0,0),w=new o.pointGeometry(0,0);let A=0;for(const z in g){const B=g[z],N=this._touches[z];N&&(v._add(B),w._add(B.sub(N)),A++,g[z]=B)}if(this._touches=g,A<this._minTouches||!w.mag())return;const I=w.div(A);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(A),panDelta:I}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Na{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(i){}_move(i,l,f){return{}}touchstart(i,l,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([l[0],l[1]]))}touchmove(i,l,f){if(!this._firstTwoTouches)return;i.preventDefault();const[g,v]=this._firstTwoTouches,w=ya(f,l,g),A=ya(f,l,v);if(!w||!A)return;const I=this._aroundCenter?null:w.add(A).div(2);return this._move([w,A],I,i)}touchend(i,l,f){if(!this._firstTwoTouches)return;const[g,v]=this._firstTwoTouches,w=ya(f,l,g),A=ya(f,l,v);w&&A||(this._active&&k.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ya(d,i,l){for(let f=0;f<d.length;f++)if(d[f].identifier===l)return i[f]}function xl(d,i){return Math.log(d/i)/Math.LN2}class gt extends Na{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,l){const f=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(xl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:xl(this._distance,f),pinchAround:l}}}function Po(d,i){return 180*d.angleWith(i)/Math.PI}class Th extends Na{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,l){const f=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Po(this._vector,f),pinchAround:l}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const l=25/(Math.PI*this._minDiameter)*360,f=Po(i,this._startVector);return Math.abs(f)<l}}function bl(d){return Math.abs(d.y)>Math.abs(d.x)}class wl extends Na{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(i,l,f){super.touchstart(i,l,f),this._currentTouchCount=f.length}_start(i){this._lastPoints=i,bl(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,l,f){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const g=i[0].sub(this._lastPoints[0]),v=i[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(g,v,f.timeStamp),this._valid?(this._lastPoints=i,this._active=!0,{pitchDelta:(g.y+v.y)/2*-.5}):void 0}gestureBeginsVertically(i,l,f){if(this._valid!==void 0)return this._valid;const g=i.mag()>=2,v=l.mag()>=2;if(!g&&!v)return;if(!g||!v)return this._firstMove===void 0&&(this._firstMove=f),f-this._firstMove<100&&void 0;const w=i.y>0==l.y>0;return bl(i)&&bl(l)&&w}}const jc={panStep:100,bearingStep:15,pitchStep:10};class Vc{constructor(){const i=jc;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let l=0,f=0,g=0,v=0,w=0;switch(i.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:i.shiftKey?f=-1:(i.preventDefault(),v=-1);break;case 39:i.shiftKey?f=1:(i.preventDefault(),v=1);break;case 38:i.shiftKey?g=1:(i.preventDefault(),w=-1);break;case 40:i.shiftKey?g=-1:(i.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(f=0,g=0),{cameraAnimation:A=>{const I=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:kh,zoom:l?Math.round(I)+l*(i.shiftKey?2:1):I,bearing:A.getBearing()+f*this._bearingStep,pitch:A.getPitch()+g*this._pitchStep,offset:[-v*this._panStep,-w*this._panStep],center:A.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function kh(d){return d*(2-d)}const qc=4.000244140625;class Tl{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=i&&i.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;i.preventDefault()}let l=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const f=o.exported.now(),g=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,l!==0&&l%qc==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(g*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),i.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=i,this._delta-=l,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=k.mousePos(this._el,i);this._around=o.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(l)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;if(this._delta!==0){const A=this._type==="wheel"&&Math.abs(this._delta)>qc?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&I!==0&&(I=1/I);const z=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):i.scale;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(z*I))),this._type==="wheel"&&(this._startZoom=i.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const l=typeof this._targetZoom=="number"?this._targetZoom:i.zoom,f=this._startZoom,g=this._easing;let v,w=!1;if(this._type==="wheel"&&f&&g){const A=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),I=g(A);v=o.number(f,l,I),A<1?this._frameId||(this._frameId=!0):w=!0}else v=l,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!w,zoomDelta:v-i.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let l=o.ease;if(this._prevEase){const f=this._prevEase,g=(o.exported.now()-f.start)/f.duration,v=f.easing(g+.01)-f.easing(g),w=.27/Math.sqrt(v*v+1e-4)*.01,A=Math.sqrt(.0729-w*w);l=o.bezier(w,A,.25,1)}return this._prevEase={start:o.exported.now(),duration:i,easing:l},l}reset(){this._active=!1}}class kl{constructor(i,l){this._clickZoom=i,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Sl{constructor(){this.reset()}reset(){this._active=!1}dblclick(i,l){return i.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(i.shiftKey?-1:1),around:f.unproject(l)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class El{constructor(){this._tap=new vl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(i,l,f){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=l[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(i,l,f))}touchmove(i,l,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const g=l[0],v=g.y-this._swipePoint.y;return this._swipePoint=g,i.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(i,l,f)}touchend(i,l,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(i,l,f)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wn{constructor(i,l,f){this._el=i,this._mousePan=l,this._touchPan=f}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class va{constructor(i,l,f){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=l,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Gc{constructor(i,l,f,g){this._el=i,this._touchZoom=l,this._touchRotate=f,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const gs=d=>d.zoom||d.drag||d.pitch||d.rotate;class Cl extends o.Event{}function Ws(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class Zc{constructor(i,l){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Oc(i),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(l),o.bindAll(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,v,w]of this._listeners)k.addEventListener(g,v,g===document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[i,l,f]of this._listeners)k.removeEventListener(i,l,i===document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(i){const l=this._map,f=l.getCanvasContainer();this._add("mapEvent",new xh(l,i));const g=l.boxZoom=new Uc(l,i);this._add("boxZoom",g);const v=new bh,w=new Sl;l.doubleClickZoom=new kl(w,v),this._add("tapZoom",v),this._add("clickZoom",w);const A=new El;this._add("tapDragZoom",A);const I=l.touchPitch=new wl(l);this._add("touchPitch",I);const z=new ra(i),B=new Et(i);l.dragRotate=new va(i,z,B),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]);const N=new Hs(i),G=new Nc(i,l);l.dragPan=new Wn(f,N,G),this._add("mousePan",N),this._add("touchPan",G,["touchZoom","touchRotate"]);const te=new Th,Q=new gt;l.touchZoomRotate=new Gc(f,Q,te,A),this._add("touchRotate",te,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]);const $=l.scrollZoom=new Tl(l,this);this._add("scrollZoom",$,["mousePan"]);const de=l.keyboard=new Vc;this._add("keyboard",de),this._add("blockableMapEvent",new _a(l));for(const be of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[be]&&l[be].enable(i[be])}_add(i,l,f){this._handlers.push({handlerName:i,handler:l,allowed:f}),this._handlersById[i]=l}stop(i){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(gs(this._eventsInProgress))||this.isZooming()}_blockedByActive(i,l,f){for(const g in i)if(g!==f&&(!l||l.indexOf(g)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const l=[];for(const f of i)this._el.contains(f.target)&&l.push(f);return l}handleEvent(i,l){if(i.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const f=i.type==="renderFrame"?void 0:i,g={needsRenderFrame:!1},v={},w={},A=i.touches,I=A?this._getMapTouches(A):void 0,z=I?k.touchPos(this._el,I):k.mousePos(this._el,i);for(const{handlerName:G,handler:te,allowed:Q}of this._handlers){if(!te.isEnabled())continue;let $;this._blockedByActive(w,Q,G)?te.reset():te[l||i.type]&&($=te[l||i.type](i,z,I),this.mergeHandlerResult(g,v,$,G,f),$&&$.needsRenderFrame&&this._triggerRenderFrame()),($||te.isActive())&&(w[G]=te)}const B={};for(const G in this._previousActiveHandlers)w[G]||(B[G]=f);this._previousActiveHandlers=w,(Object.keys(B).length||Ws(g))&&(this._changes.push([g,v,B]),this._triggerRenderFrame()),(Object.keys(w).length||Ws(g))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=g;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))}mergeHandlerResult(i,l,f,g,v){if(!f)return;o.extend(i,f);const w={handlerName:g,originalEvent:f.originalEvent||v};f.zoomDelta!==void 0&&(l.zoom=w),f.panDelta!==void 0&&(l.drag=w),f.pitchDelta!==void 0&&(l.pitch=w),f.bearingDelta!==void 0&&(l.rotate=w)}_applyChanges(){const i={},l={},f={};for(const[g,v,w]of this._changes)g.panDelta&&(i.panDelta=(i.panDelta||new o.pointGeometry(0,0))._add(g.panDelta)),g.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(i.around=g.around),g.pinchAround!==void 0&&(i.pinchAround=g.pinchAround),g.noInertia&&(i.noInertia=g.noInertia),o.extend(l,v),o.extend(f,w);this._updateMapTransform(i,l,f),this._changes=[]}_updateMapTransform(i,l,f){const g=this._map,v=g.transform,w=g.style&&g.style.terrain;if(!(Ws(i)||w&&this._drag))return this._fireEvents(l,f,!0);let{panDelta:A,zoomDelta:I,bearingDelta:z,pitchDelta:B,around:N,pinchAround:G}=i;G!==void 0&&(N=G),g._stop(!0),N=N||g.transform.centerPoint;const te=v.pointLocation(A?N.sub(A):N);z&&(v.bearing+=z),B&&(v.pitch+=B),I&&(v.zoom+=I),w?l.drag&&!this._drag?(this._drag={center:v.centerPoint,lngLat:v.pointLocation(N),point:N,handlerName:l.drag.handlerName},g.fire(new o.Event("freezeElevation",{freeze:!0}))):this._drag&&f[this._drag.handlerName]?(g.fire(new o.Event("freezeElevation",{freeze:!1})),this._drag=null):l.drag&&this._drag&&(v.center=v.pointLocation(v.centerPoint.sub(A))):v.setLocationAtPoint(te,N),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(l,f,!0)}_fireEvents(i,l,f){const g=gs(this._eventsInProgress),v=gs(i),w={};for(const B in i){const{originalEvent:N}=i[B];this._eventsInProgress[B]||(w[`${B}start`]=N),this._eventsInProgress[B]=i[B]}!g&&v&&this._fireEvent("movestart",v.originalEvent);for(const B in w)this._fireEvent(B,w[B]);v&&this._fireEvent("move",v.originalEvent);for(const B in i){const{originalEvent:N}=i[B];this._fireEvent(B,N)}const A={};let I;for(const B in this._eventsInProgress){const{handlerName:N,originalEvent:G}=this._eventsInProgress[B];this._handlersById[N].isActive()||(delete this._eventsInProgress[B],I=l[N]||G,A[`${B}end`]=I)}for(const B in A)this._fireEvent(B,A[B]);const z=gs(this._eventsInProgress);if(f&&(g||v)&&!z){this._updatingCamera=!0;const B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;B?(N(B.bearing||this._map.getBearing())&&(B.bearing=0),this._map.easeTo(B,{originalEvent:I})):(this._map.fire(new o.Event("moveend",{originalEvent:I})),N(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,l){this._map.fire(new o.Event(i,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{delete this._frameId,this.handleEvent(new Cl("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const yr={extend:(d,...i)=>o.extend(d,...i),run(d){d()},logToElement(d,i=!1,l="log"){const f=window.document.getElementById(l);f&&(i&&(f.innerHTML=""),f.innerHTML+=`<br>${d}`)}};class qi extends o.Evented{constructor(i,l){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=l.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(i,l){return this.jumpTo({center:i},l)}panBy(i,l,f){return i=o.pointGeometry.convert(i).mult(-1),this.panTo(this.transform.center,o.extend({offset:i},l),f)}panTo(i,l,f){return this.easeTo(o.extend({center:i},l),f)}getZoom(){return this.transform.zoom}setZoom(i,l){return this.jumpTo({zoom:i},l),this}zoomTo(i,l,f){return this.easeTo(o.extend({zoom:i},l),f)}zoomIn(i,l){return this.zoomTo(this.getZoom()+1,i,l),this}zoomOut(i,l){return this.zoomTo(this.getZoom()-1,i,l),this}getBearing(){return this.transform.bearing}setBearing(i,l){return this.jumpTo({bearing:i},l),this}getPadding(){return this.transform.padding}setPadding(i,l){return this.jumpTo({padding:i},l),this}rotateTo(i,l,f){return this.easeTo(o.extend({bearing:i},l),f)}resetNorth(i,l){return this.rotateTo(0,o.extend({duration:1e3},i),l),this}resetNorthPitch(i,l){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},i),l),this}snapToNorth(i,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,l):this}getPitch(){return this.transform.pitch}setPitch(i,l){return this.jumpTo({pitch:i},l),this}cameraForBounds(i,l){i=o.LngLatBounds.convert(i);const f=l&&l.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),f,l)}_cameraForBoxAndBearing(i,l,f,g){const v={top:0,bottom:0,right:0,left:0};if(typeof(g=o.extend({padding:v,offset:[0,0],maxZoom:this.transform.maxZoom},g)).padding=="number"){const Me=g.padding;g.padding={top:Me,bottom:Me,right:Me,left:Me}}g.padding=o.extend(v,g.padding);const w=this.transform,A=w.padding,I=w.project(o.LngLat.convert(i)),z=w.project(o.LngLat.convert(l)),B=I.rotate(-f*Math.PI/180),N=z.rotate(-f*Math.PI/180),G=new o.pointGeometry(Math.max(B.x,N.x),Math.max(B.y,N.y)),te=new o.pointGeometry(Math.min(B.x,N.x),Math.min(B.y,N.y)),Q=G.sub(te),$=(w.width-(A.left+A.right+g.padding.left+g.padding.right))/Q.x,de=(w.height-(A.top+A.bottom+g.padding.top+g.padding.bottom))/Q.y;if(de<0||$<0)return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const be=Math.min(w.scaleZoom(w.scale*Math.min($,de)),g.maxZoom),Ce=o.pointGeometry.convert(g.offset),ne=new o.pointGeometry((g.padding.left-g.padding.right)/2,(g.padding.top-g.padding.bottom)/2).rotate(f*Math.PI/180),ze=Ce.add(ne).mult(w.scale/w.zoomScale(be));return{center:w.unproject(I.add(z).div(2).sub(ze)),zoom:be,bearing:f}}fitBounds(i,l,f){return this._fitInternal(this.cameraForBounds(i,l),l,f)}fitScreenCoordinates(i,l,f,g,v){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.pointGeometry.convert(i)),this.transform.pointLocation(o.pointGeometry.convert(l)),f,g),g,v)}_fitInternal(i,l,f){return i?(delete(l=o.extend(i,l)).padding,l.linear?this.easeTo(l,f):this.flyTo(l,f)):this}jumpTo(i,l){this.stop();const f=this.transform;let g=!1,v=!1,w=!1;return"zoom"in i&&f.zoom!==+i.zoom&&(g=!0,f.zoom=+i.zoom),i.center!==void 0&&(f.center=o.LngLat.convert(i.center)),"bearing"in i&&f.bearing!==+i.bearing&&(v=!0,f.bearing=+i.bearing),"pitch"in i&&f.pitch!==+i.pitch&&(w=!0,f.pitch=+i.pitch),i.padding==null||f.isPaddingEqual(i.padding)||(f.padding=i.padding),this.fire(new o.Event("movestart",l)).fire(new o.Event("move",l)),g&&this.fire(new o.Event("zoomstart",l)).fire(new o.Event("zoom",l)).fire(new o.Event("zoomend",l)),v&&this.fire(new o.Event("rotatestart",l)).fire(new o.Event("rotate",l)).fire(new o.Event("rotateend",l)),w&&this.fire(new o.Event("pitchstart",l)).fire(new o.Event("pitch",l)).fire(new o.Event("pitchend",l)),this.fire(new o.Event("moveend",l))}calculateCameraOptionsFromTo(i,l,f,g=0){const v=o.MercatorCoordinate.fromLngLat(i,l),w=o.MercatorCoordinate.fromLngLat(f,g),A=w.x-v.x,I=w.y-v.y,z=w.z-v.z,B=Math.hypot(A,I,z);if(B===0)throw new Error("Can't calculate camera options with same From and To");const N=Math.hypot(A,I),G=this.transform.scaleZoom(this.transform.cameraToCenterDistance/B/this.transform.tileSize),te=180*Math.atan2(A,-I)/Math.PI;let Q=180*Math.acos(N/B)/Math.PI;return Q=z<0?90-Q:90+Q,{center:w.toLngLat(),zoom:G,pitch:Q,bearing:te}}easeTo(i,l){this._stop(!1,i.easeId),((i=o.extend({offset:[0,0],duration:500,easing:o.ease},i)).animate===!1||!i.essential&&o.exported.prefersReducedMotion)&&(i.duration=0);const f=this.transform,g=this.getZoom(),v=this.getBearing(),w=this.getPitch(),A=this.getPadding(),I="zoom"in i?+i.zoom:g,z="bearing"in i?this._normalizeBearing(i.bearing,v):v,B="pitch"in i?+i.pitch:w,N="padding"in i?i.padding:f.padding,G=o.pointGeometry.convert(i.offset);let te=f.centerPoint.add(G);const Q=f.pointLocation(te),$=o.LngLat.convert(i.center||Q);this._normalizeCenter($);const de=f.project(Q),be=f.project($).sub(de),Ce=f.zoomScale(I-g);let ne,ze;i.around&&(ne=o.LngLat.convert(i.around),ze=f.locationPoint(ne));const Me={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||I!==g,this._rotating=this._rotating||v!==z,this._pitching=this._pitching||B!==w,this._padding=!f.isPaddingEqual(N),this._easeId=i.easeId,this._prepareEase(l,i.noMoveStart,Me),this._ease(Ve=>{if(this._zooming&&(f.zoom=o.number(g,I,Ve)),this._rotating&&(f.bearing=o.number(v,z,Ve)),this._pitching&&(f.pitch=o.number(w,B,Ve)),this._padding&&(f.interpolatePadding(A,N,Ve),te=f.centerPoint.add(G)),ne)f.setLocationAtPoint(ne,ze);else{const qe=f.zoomScale(f.zoom-g),it=I>g?Math.min(2,Ce):Math.max(.5,Ce),je=Math.pow(it,1-Ve),vt=f.unproject(de.add(be.mult(Ve*je)).mult(qe));f.setLocationAtPoint(f.renderWorldCopies?vt.wrap():vt,te)}this._fireMoveEvents(l)},Ve=>{this._afterEase(l,Ve)},i),this}_prepareEase(i,l,f={}){this._moving=!0,this.fire(new o.Event("freezeElevation",{freeze:!0})),l||f.moving||this.fire(new o.Event("movestart",i)),this._zooming&&!f.zooming&&this.fire(new o.Event("zoomstart",i)),this._rotating&&!f.rotating&&this.fire(new o.Event("rotatestart",i)),this._pitching&&!f.pitching&&this.fire(new o.Event("pitchstart",i))}_fireMoveEvents(i){this.fire(new o.Event("move",i)),this._zooming&&this.fire(new o.Event("zoom",i)),this._rotating&&this.fire(new o.Event("rotate",i)),this._pitching&&this.fire(new o.Event("pitch",i))}_afterEase(i,l){if(this._easeId&&l&&this._easeId===l)return;delete this._easeId,this.fire(new o.Event("freezeElevation",{freeze:!1}));const f=this._zooming,g=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new o.Event("zoomend",i)),g&&this.fire(new o.Event("rotateend",i)),v&&this.fire(new o.Event("pitchend",i)),this.fire(new o.Event("moveend",i))}flyTo(i,l){if(!i.essential&&o.exported.prefersReducedMotion){const Lt=o.pick(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Lt,l)}this.stop(),i=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},i);const f=this.transform,g=this.getZoom(),v=this.getBearing(),w=this.getPitch(),A=this.getPadding(),I="zoom"in i?o.clamp(+i.zoom,f.minZoom,f.maxZoom):g,z="bearing"in i?this._normalizeBearing(i.bearing,v):v,B="pitch"in i?+i.pitch:w,N="padding"in i?i.padding:f.padding,G=f.zoomScale(I-g),te=o.pointGeometry.convert(i.offset);let Q=f.centerPoint.add(te);const $=f.pointLocation(Q),de=o.LngLat.convert(i.center||$);this._normalizeCenter(de);const be=f.project($),Ce=f.project(de).sub(be);let ne=i.curve;const ze=Math.max(f.width,f.height),Me=ze/G,Ve=Ce.mag();if("minZoom"in i){const Lt=o.clamp(Math.min(i.minZoom,g,I),f.minZoom,f.maxZoom),Mi=ze/f.zoomScale(Lt-g);ne=Math.sqrt(Mi/Ve*2)}const qe=ne*ne;function it(Lt){const Mi=(Me*Me-ze*ze+(Lt?-1:1)*qe*qe*Ve*Ve)/(2*(Lt?Me:ze)*qe*Ve);return Math.log(Math.sqrt(Mi*Mi+1)-Mi)}function je(Lt){return(Math.exp(Lt)-Math.exp(-Lt))/2}function vt(Lt){return(Math.exp(Lt)+Math.exp(-Lt))/2}const ft=it(0);let xt=function(Lt){return vt(ft)/vt(ft+ne*Lt)},Yt=function(Lt){return ze*((vt(ft)*(je(Mi=ft+ne*Lt)/vt(Mi))-je(ft))/qe)/Ve;var Mi},ii=(it(1)-ft)/ne;if(Math.abs(Ve)<1e-6||!isFinite(ii)){if(Math.abs(ze-Me)<1e-6)return this.easeTo(i,l);const Lt=Me<ze?-1:1;ii=Math.abs(Math.log(Me/ze))/ne,Yt=function(){return 0},xt=function(Mi){return Math.exp(Lt*ne*Mi)}}return i.duration="duration"in i?+i.duration:1e3*ii/("screenSpeed"in i?+i.screenSpeed/ne:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0),this._zooming=!0,this._rotating=v!==z,this._pitching=B!==w,this._padding=!f.isPaddingEqual(N),this._prepareEase(l,!1),this._ease(Lt=>{const Mi=Lt*ii,Pi=1/xt(Mi);f.zoom=Lt===1?I:g+f.scaleZoom(Pi),this._rotating&&(f.bearing=o.number(v,z,Lt)),this._pitching&&(f.pitch=o.number(w,B,Lt)),this._padding&&(f.interpolatePadding(A,N,Lt),Q=f.centerPoint.add(te));const yi=Lt===1?de:f.unproject(be.add(Ce.mult(Yt(Mi))).mult(Pi));f.setLocationAtPoint(f.renderWorldCopies?yi.wrap():yi,Q),this._fireMoveEvents(l)},()=>this._afterEase(l),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const f=this._onEaseEnd;delete this._onEaseEnd,f.call(this,l)}if(!i){const f=this.handlers;f&&f.stop(!1)}return this}_ease(i,l,f){f.animate===!1||f.duration===0?(i(1),l()):(this._easeStart=o.exported.now(),this._easeOptions=f,this._onEaseFrame=i,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,l){i=o.wrap(i,-180,180);const f=Math.abs(i-l);return Math.abs(i-360-l)<f&&(i-=360),Math.abs(i+360-l)<f&&(i+=360),i}_normalizeCenter(i){const l=this.transform;if(!l.renderWorldCopies||l.lngRange)return;const f=i.lng-l.center.lng;i.lng+=f>180?-360:f<-180?360:0}}class Xs{constructor(i={}){this.options=i,o.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){return this._map=i,this._compact=this.options&&this.options.compact,this._container=k.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=k.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=k.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){k.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(i,l){const f=this._map._getUIString(`AttributionControl.${l}`);i.title=f,i.setAttribute("aria-label",f)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"&&i.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(g=>typeof g!="string"?"":g)):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const l=this._map.style.sourceCaches;for(const g in l){const v=l[g];if(v.used||v.usedForTerrain){const w=v.getSource();w.attribution&&i.indexOf(w.attribution)<0&&i.push(w.attribution)}}i=i.filter(g=>String(g).trim()),i.sort((g,v)=>g.length-v.length),i=i.filter((g,v)=>{for(let w=v+1;w<i.length;w++)if(i[w].indexOf(g)>=0)return!1;return!0});const f=i.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,i.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class zo{constructor(i={}){this.options=i,o.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(i){this._map=i,this._compact=this.options&&this.options.compact,this._container=k.create("div","maplibregl-ctrl mapboxgl-ctrl");const l=k.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://maplibre.org/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){k.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const i=this._container.children;if(i.length){const l=i[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact","mapboxgl-compact"):l.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class Hc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const l=++this._id;return this._queue.push({callback:i,id:l,cancelled:!1}),l}remove(i){const l=this._currentlyRunning,f=l?this._queue.concat(l):this._queue;for(const g of f)if(g.id===i)return void(g.cancelled=!0)}run(i=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const l=this._currentlyRunning=this._queue;this._queue=[];for(const f of l)if(!f.cancelled&&(f.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Wc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},Xc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},Sh={showCompass:!0,showZoom:!0,visualizePitch:!1};class Vr{constructor(i,l,f=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new ra({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,f&&(this.mousePitch=new Et({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),k.addEventListener(l,"mousedown",this.mousedown),k.addEventListener(l,"touchstart",this.touchstart,{passive:!1}),k.addEventListener(l,"touchmove",this.touchmove),k.addEventListener(l,"touchend",this.touchend),k.addEventListener(l,"touchcancel",this.reset)}down(i,l){this.mouseRotate.mousedown(i,l),this.mousePitch&&this.mousePitch.mousedown(i,l),k.disableDrag()}move(i,l){const f=this.map,g=this.mouseRotate.mousemoveWindow(i,l);if(g&&g.bearingDelta&&f.setBearing(f.getBearing()+g.bearingDelta),this.mousePitch){const v=this.mousePitch.mousemoveWindow(i,l);v&&v.pitchDelta&&f.setPitch(f.getPitch()+v.pitchDelta)}}off(){const i=this.element;k.removeEventListener(i,"mousedown",this.mousedown),k.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),k.removeEventListener(i,"touchmove",this.touchmove),k.removeEventListener(i,"touchend",this.touchend),k.removeEventListener(i,"touchcancel",this.reset),this.offTemp()}offTemp(){k.enableDrag(),k.removeEventListener(window,"mousemove",this.mousemove),k.removeEventListener(window,"mouseup",this.mouseup)}mousedown(i){this.down(o.extend({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),k.mousePos(this.element,i)),k.addEventListener(window,"mousemove",this.mousemove),k.addEventListener(window,"mouseup",this.mouseup)}mousemove(i){this.move(i,k.mousePos(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=k.touchPos(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=k.touchPos(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Ks(d,i,l){if(d=new o.LngLat(d.lng,d.lat),i){const f=new o.LngLat(d.lng-360,d.lat),g=new o.LngLat(d.lng+360,d.lat),v=l.locationPoint(d).distSqr(i);l.locationPoint(f).distSqr(i)<v?d=f:l.locationPoint(g).distSqr(i)<v&&(d=g)}for(;Math.abs(d.lng-l.center.lng)>180;){const f=l.locationPoint(d);if(f.x>=0&&f.y>=0&&f.x<=l.width&&f.y<=l.height)break;d.lng>l.center.lng?d.lng-=360:d.lng+=360}return d}const Pt={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ot(d,i,l){const f=d.classList;for(const g in Pt)f.remove(`maplibregl-${l}-anchor-${g}`,`mapboxgl-${l}-anchor-${g}`);f.add(`maplibregl-${l}-anchor-${i}`,`mapboxgl-${l}-anchor-${i}`)}class _s extends o.Evented{constructor(i,l){if(super(),(i instanceof HTMLElement||l)&&(i=o.extend({element:i},l)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment!=="auto"?i.pitchAlignment:this._rotationAlignment,i&&i.element)this._element=i.element,this._offset=o.pointGeometry.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=k.create("div"),this._element.setAttribute("aria-label","Map marker");const f=k.createNS("http://www.w3.org/2000/svg","svg"),g=41,v=27;f.setAttributeNS(null,"display","block"),f.setAttributeNS(null,"height",`${g}px`),f.setAttributeNS(null,"width",`${v}px`),f.setAttributeNS(null,"viewBox",`0 0 ${v} ${g}`);const w=k.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");const A=k.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill-rule","nonzero");const I=k.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"transform","translate(3.0, 29.0)"),I.setAttributeNS(null,"fill","#000000");const z=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Ce of z){const ne=k.createNS("http://www.w3.org/2000/svg","ellipse");ne.setAttributeNS(null,"opacity","0.04"),ne.setAttributeNS(null,"cx","10.5"),ne.setAttributeNS(null,"cy","5.80029008"),ne.setAttributeNS(null,"rx",Ce.rx),ne.setAttributeNS(null,"ry",Ce.ry),I.appendChild(ne)}const B=k.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"fill",this._color);const N=k.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),B.appendChild(N);const G=k.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"opacity","0.25"),G.setAttributeNS(null,"fill","#000000");const te=k.createNS("http://www.w3.org/2000/svg","path");te.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),G.appendChild(te);const Q=k.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Q.setAttributeNS(null,"fill","#FFFFFF");const $=k.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(8.0, 8.0)");const de=k.createNS("http://www.w3.org/2000/svg","circle");de.setAttributeNS(null,"fill","#000000"),de.setAttributeNS(null,"opacity","0.25"),de.setAttributeNS(null,"cx","5.5"),de.setAttributeNS(null,"cy","5.5"),de.setAttributeNS(null,"r","5.4999962");const be=k.createNS("http://www.w3.org/2000/svg","circle");be.setAttributeNS(null,"fill","#FFFFFF"),be.setAttributeNS(null,"cx","5.5"),be.setAttributeNS(null,"cy","5.5"),be.setAttributeNS(null,"r","5.4999962"),$.appendChild(de),$.appendChild(be),A.appendChild(I),A.appendChild(B),A.appendChild(G),A.appendChild(Q),A.appendChild($),f.appendChild(A),f.setAttributeNS(null,"height",g*this._scale+"px"),f.setAttributeNS(null,"width",v*this._scale+"px"),this._element.appendChild(f),this._offset=o.pointGeometry.convert(i&&i.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",f=>{f.preventDefault()}),this._element.addEventListener("mousedown",f=>{f.preventDefault()}),Ot(this._element,this._anchor,"marker"),this._popup=null}addTo(i){return this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._update),i.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),k.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=o.LngLat.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const g=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(i){const l=i.code,f=i.charCode||i.keyCode;l!=="Space"&&l!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(i){const l=i.originalEvent.target,f=this._element;this._popup&&(l===f||f.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?i.remove():i.addTo(this._map),this):this}_update(i){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Ks(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let l="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?l=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(l=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let f="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?f="rotateX(0deg)":this._pitchAlignment==="map"&&(f=`rotateX(${this._map.getPitch()}deg)`),i&&i.type!=="moveend"||(this._pos=this._pos.round()),k.setTransform(this._element,`${Pt[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${f} ${l}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const g=this._map.unproject(this._pos),v=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=g.distanceTo(this._lngLat)>20*v?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(i){return this._offset=o.pointGeometry.convert(i),this._update(),this}_onMove(i){if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(i){this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos).add(this._offset),this._pointerdownPos=i.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&i!=="auto"?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Al={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let xa,En=0,ba=!1;const qr={maxWidth:100,unit:"metric"};function Kc(d,i,l){const f=l&&l.maxWidth||100,g=d._container.clientHeight/2,v=d.unproject([0,g]),w=d.unproject([f,g]),A=v.distanceTo(w);if(l&&l.unit==="imperial"){const I=3.2808*A;I>5280?wa(i,f,I/5280,d._getUIString("ScaleControl.Miles")):wa(i,f,I,d._getUIString("ScaleControl.Feet"))}else l&&l.unit==="nautical"?wa(i,f,A/1852,d._getUIString("ScaleControl.NauticalMiles")):A>=1e3?wa(i,f,A/1e3,d._getUIString("ScaleControl.Kilometers")):wa(i,f,A,d._getUIString("ScaleControl.Meters"))}function wa(d,i,l,f){const g=function(v){const w=Math.pow(10,`${Math.floor(v)}`.length-1);let A=v/w;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(I){const z=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*z)/z}(A),w*A}(l);d.style.width=i*(g/l)+"px",d.innerHTML=`${g}&nbsp;${f}`}const en={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},cn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Il(d){if(d){if(typeof d=="number"){const i=Math.round(Math.sqrt(.5*Math.pow(d,2)));return{center:new o.pointGeometry(0,0),top:new o.pointGeometry(0,d),"top-left":new o.pointGeometry(i,i),"top-right":new o.pointGeometry(-i,i),bottom:new o.pointGeometry(0,-d),"bottom-left":new o.pointGeometry(i,-i),"bottom-right":new o.pointGeometry(-i,-i),left:new o.pointGeometry(d,0),right:new o.pointGeometry(-d,0)}}if(d instanceof o.pointGeometry||Array.isArray(d)){const i=o.pointGeometry.convert(d);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:o.pointGeometry.convert(d.center||[0,0]),top:o.pointGeometry.convert(d.top||[0,0]),"top-left":o.pointGeometry.convert(d["top-left"]||[0,0]),"top-right":o.pointGeometry.convert(d["top-right"]||[0,0]),bottom:o.pointGeometry.convert(d.bottom||[0,0]),"bottom-left":o.pointGeometry.convert(d["bottom-left"]||[0,0]),"bottom-right":o.pointGeometry.convert(d["bottom-right"]||[0,0]),left:o.pointGeometry.convert(d.left||[0,0]),right:o.pointGeometry.convert(d.right||[0,0])}}return Il(new o.pointGeometry(0,0))}const ja={supported:b,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends qi{constructor(d){var i;if(o.PerformanceUtils.mark(o.PerformanceMarkers.create),(d=o.extend({},Xc,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Ns(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),{bearingSnap:d.bearingSnap}),this._interactive=d.interactive,this._cooperativeGestures=d.cooperativeGestures,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new Hc,this._controls=[],this._mapId=o.uniqueId(),this._locale=o.extend({},Wc,d.locale),this._clickTolerance=d.clickTolerance,this._pixelRatio=(i=d.pixelRatio)!==null&&i!==void 0?i:devicePixelRatio,this._requestManager=new L(d.transformRequest),typeof d.container=="string"){if(this._container=document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Zc(this,d),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=d.hash&&new Lc(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,o.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new Xs({customAttribution:d.customAttribution})),d.maplibreLogo&&this.addControl(new zo,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new o.Event(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new o.Event(`${l.dataType}dataloading`,l))}),this.on("dataabort",l=>{this.fire(new o.Event("sourcedataabort",l))})}_getMapId(){return this._mapId}addControl(d,i){if(i===void 0&&(i=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=d.onAdd(this);this._controls.push(d);const f=this._controlPositions[i];return i.indexOf("bottom")!==-1?f.insertBefore(l,f.firstChild):f.appendChild(l),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(d);return i>-1&&this._controls.splice(i,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}calculateCameraOptionsFromTo(d,i,l,f){return f==null&&this.style.terrain&&(f=this.transform.getElevation(l,this.style.terrain)),super.calculateCameraOptionsFromTo(d,i,l,f)}resize(d){const i=this._containerDimensions(),l=i[0],f=i[1];this._resizeCanvas(l,f,this.getPixelRatio()),this.transform.resize(l,f),this.painter.resize(l,f,this.getPixelRatio());const g=!this._moving;return g&&(this.stop(),this.fire(new o.Event("movestart",d)).fire(new o.Event("move",d))),this.fire(new o.Event("resize",d)),g&&this.fire(new o.Event("moveend",d)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(d){const[i,l]=this._containerDimensions();this._pixelRatio=d,this._resizeCanvas(i,l,d),this.painter.resize(i,l,d)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(d){return this.transform.setMaxBounds(o.LngLatBounds.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this._update()}project(d){return this.transform.locationPoint(o.LngLat.convert(d),this.style&&this.style.terrain)}unproject(d){return this.transform.pointLocation(o.pointGeometry.convert(d),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(d,i,l){if(d==="mouseenter"||d==="mouseover"){let f=!1;return{layer:i,listener:l,delegates:{mousemove:v=>{const w=this.getLayer(i)?this.queryRenderedFeatures(v.point,{layers:[i]}):[];w.length?f||(f=!0,l.call(this,new rr(d,this,v.originalEvent,{features:w}))):f=!1},mouseout:()=>{f=!1}}}}if(d==="mouseleave"||d==="mouseout"){let f=!1;return{layer:i,listener:l,delegates:{mousemove:w=>{(this.getLayer(i)?this.queryRenderedFeatures(w.point,{layers:[i]}):[]).length?f=!0:f&&(f=!1,l.call(this,new rr(d,this,w.originalEvent)))},mouseout:w=>{f&&(f=!1,l.call(this,new rr(d,this,w.originalEvent)))}}}}{const f=g=>{const v=this.getLayer(i)?this.queryRenderedFeatures(g.point,{layers:[i]}):[];v.length&&(g.features=v,l.call(this,g),delete g.features)};return{layer:i,listener:l,delegates:{[d]:f}}}}on(d,i,l){if(l===void 0)return super.on(d,i);const f=this._createDelegatedListener(d,i,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(f);for(const g in f.delegates)this.on(g,f.delegates[g]);return this}once(d,i,l){if(l===void 0)return super.once(d,i);const f=this._createDelegatedListener(d,i,l);for(const g in f.delegates)this.once(g,f.delegates[g]);return this}off(d,i,l){return l===void 0?super.off(d,i):(this._delegatedListeners&&this._delegatedListeners[d]&&(f=>{const g=this._delegatedListeners[d];for(let v=0;v<g.length;v++){const w=g[v];if(w.layer===i&&w.listener===l){for(const A in w.delegates)this.off(A,w.delegates[A]);return g.splice(v,1),this}}})(),this)}queryRenderedFeatures(d,i){if(!this.style)return[];let l;if(i!==void 0||d===void 0||d instanceof o.pointGeometry||Array.isArray(d)||(i=d,d=void 0),i=i||{},(d=d||[[0,0],[this.transform.width,this.transform.height]])instanceof o.pointGeometry||typeof d[0]=="number")l=[o.pointGeometry.convert(d)];else{const f=o.pointGeometry.convert(d[0]),g=o.pointGeometry.convert(d[1]);l=[f,new o.pointGeometry(g.x,f.y),g,new o.pointGeometry(f.x,g.y),f]}return this.style.queryRenderedFeatures(l,i,this.transform)}querySourceFeatures(d,i){return this.style.querySourceFeatures(d,i)}setStyle(d,i){return(i=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(d,i))}setTransformRequest(d){return this._requestManager.setTransformRequest(d),this}_getUIString(d){const i=this._locale[d];if(i==null)throw new Error(`Missing UI string '${d}'`);return i}_updateStyle(d,i){return this.style&&(this.style.setEventedParent(null),this.style._remove()),d?(this.style=new $i(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new $i(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,i){if(typeof d=="string"){const l=this._requestManager.transformRequest(d,o.ResourceType.Style);o.getJSON(l,(f,g)=>{f?this.fire(new o.ErrorEvent(f)):g&&this._updateDiff(g,i)})}else typeof d=="object"&&this._updateDiff(d,i)}_updateDiff(d,i){try{this.style.setState(d)&&this._update(!0)}catch(l){o.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(d,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.warnOnce("There is no style added to the map.")}addSource(d,i){return this._lazyInitEmptyStyle(),this.style.addSource(d,i),this._update(!0)}isSourceLoaded(d){const i=this.style&&this.style.sourceCaches[d];if(i!==void 0)return i.loaded();this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${d}'`)))}setTerrain(d){return this.style.setTerrain(d),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const d=this.style&&this.style.sourceCaches;for(const i in d){const l=d[i]._tiles;for(const f in l){const g=l[f];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}addSourceType(d,i,l){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,i,l)}removeSource(d){return this.style.removeSource(d),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,i,{pixelRatio:l=1,sdf:f=!1,stretchX:g,stretchY:v,content:w}={}){if(this._lazyInitEmptyStyle(),i instanceof HTMLImageElement||o.isImageBitmap(i)){const{width:A,height:I,data:z}=o.exported.getImageData(i);this.style.addImage(d,{data:new o.RGBAImage({width:A,height:I},z),pixelRatio:l,stretchX:g,stretchY:v,content:w,sdf:f,version:0})}else{if(i.width===void 0||i.height===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:I,data:z}=i,B=i;this.style.addImage(d,{data:new o.RGBAImage({width:A,height:I},new Uint8Array(z)),pixelRatio:l,stretchX:g,stretchY:v,content:w,sdf:f,version:0,userImage:B}),B.onAdd&&B.onAdd(this,d)}}}updateImage(d,i){const l=this.style.getImage(d);if(!l)return this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=i instanceof HTMLImageElement||o.isImageBitmap(i)?o.exported.getImageData(i):i,{width:g,height:v,data:w}=f;if(g===void 0||v===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==l.data.width||v!==l.data.height)return this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const A=!(i instanceof HTMLImageElement||o.isImageBitmap(i));l.data.replace(w,A),this.style.updateImage(d,l)}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,i){o.getImage(this._requestManager.transformRequest(d,o.ResourceType.Image),i)}listImages(){return this.style.listImages()}addLayer(d,i){return this._lazyInitEmptyStyle(),this.style.addLayer(d,i),this._update(!0)}moveLayer(d,i){return this.style.moveLayer(d,i),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}setLayerZoomRange(d,i,l){return this.style.setLayerZoomRange(d,i,l),this._update(!0)}setFilter(d,i,l={}){return this.style.setFilter(d,i,l),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,i,l,f={}){return this.style.setPaintProperty(d,i,l,f),this._update(!0)}getPaintProperty(d,i){return this.style.getPaintProperty(d,i)}setLayoutProperty(d,i,l,f={}){return this.style.setLayoutProperty(d,i,l,f),this._update(!0)}getLayoutProperty(d,i){return this.style.getLayoutProperty(d,i)}setLight(d,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,i),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(d,i){return this.style.setFeatureState(d,i),this._update()}removeFeatureState(d,i){return this.style.removeFeatureState(d,i),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let d=0,i=0;return this._container&&(d=this._container.clientWidth||400,i=this._container.clientHeight||300),[d,i]}_setupContainer(){const d=this._container;d.classList.add("maplibregl-map","mapboxgl-map");const i=this._canvasContainer=k.create("div","maplibregl-canvas-container mapboxgl-canvas-container",d);this._interactive&&i.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=k.create("canvas","maplibregl-canvas mapboxgl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const l=this._containerDimensions();this._resizeCanvas(l[0],l[1],this.getPixelRatio());const f=this._controlContainer=k.create("div","maplibregl-control-container mapboxgl-control-container",d),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{g[v]=k.create("div",`maplibregl-ctrl-${v} mapboxgl-ctrl-${v}`,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const d=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=k.create("div","maplibregl-cooperative-gesture-screen",d);let i="Control",l=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(l=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map",i="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${l}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",f=>{f.key===i&&(this._metaPress=!0)}),document.addEventListener("keyup",f=>{f.key===i&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",f=>{this._onCooperativeGesture(f,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(d,i,l){this._canvas.width=l*d,this._canvas.height=l*i,this._canvas.style.width=`${d}px`,this._canvas.style.height=`${i}px`}_setupPainter(){const d=o.extend({},b.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);i?(this.painter=new yl(i,this.transform),o.exported$1.testSupport(i)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(d,i,l){return!i&&l<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_render(d){let i,l=0;const f=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(i=f.createQueryEXT(),f.beginQueryEXT(f.TIME_ELAPSED_EXT,i),l=o.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._removed)return;let g=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const w=this.transform.zoom,A=o.exported.now();this.style.zoomHistory.update(w,A);const I=new o.EvaluationParameters(w,{now:A,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),z=I.crossFadingFactor();z===1&&z===this._crossFadingFactor||(g=!0,this._crossFadingFactor=z),this.style.update(I)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.PerformanceUtils.mark(o.PerformanceMarkers.load),this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||g)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const w=o.exported.now()-l;f.endQueryEXT(f.TIME_ELAPSED_EXT,i),setTimeout(()=>{const A=f.getQueryObjectEXT(i,f.QUERY_RESULT_EXT)/1e6;f.deleteQueryEXT(i),this.fire(new o.Event("gpu-timing-frame",{cpuTime:w,gpuTime:A}))},50)}if(this.listens("gpu-timing-layer")){const w=this.painter.collectGpuTimers();setTimeout(()=>{const A=this.painter.queryGpuTimers(w);this.fire(new o.Event("gpu-timing-layer",{layerTimes:A}))},50)}const v=this._sourcesDirty||this._styleDirty||this._placementDirty;return v||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.Event("idle")),!this._loaded||this._fullyLoaded||v||(this._fullyLoaded=!0,o.PerformanceUtils.mark(o.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),k.remove(this._canvasContainer),k.remove(this._controlContainer),this._cooperativeGestures&&k.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),o.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=o.exported.frame(d=>{o.PerformanceUtils.frame(d),this._frame=null,this._render(d)}))}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}_setCacheLimits(d,i){o.setCacheLimits(d,i)}get version(){return"2.4.0"}},NavigationControl:class{constructor(d){this.options=o.extend({},Sh,d),this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",i=>this._map.zoomIn({},{originalEvent:i})),k.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",i=>this._map.zoomOut({},{originalEvent:i})),k.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})}),this._compassIcon=k.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map.getZoom(),i=d===this._map.getMaxZoom(),l=d===this._map.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())}_rotateCompassArrow(){const d=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=d}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Vr(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){k.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(d,i){const l=k.create("button",d,this._container);return l.type="button",l.addEventListener("click",i),l}_setButtonTitle(d,i){const l=this._map._getUIString(`NavigationControl.${i}`);d.title=l,d.setAttribute("aria-label",l)}},GeolocateControl:class extends o.Evented{constructor(d){super(),this.options=o.extend({},Al,d),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(d){var i;return this._map=d,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),i=this._setupUI,xa!==void 0?i(xa):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(l=>{xa=l.state!=="denied",i(xa)}):(xa=!!window.navigator.geolocation,i(xa)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),k.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,En=0,ba=!1}_isOutOfMapMaxBounds(d){const i=this._map.getMaxBounds(),l=d.coords;return i&&(l.longitude<i.getWest()||l.longitude>i.getEast()||l.latitude<i.getSouth()||l.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",d)),this._finish()}}_updateCamera(d){const i=new o.LngLat(d.coords.longitude,d.coords.latitude),l=d.coords.accuracy,f=this._map.getBearing(),g=o.extend({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(l),g,{geolocateSource:!0})}_updateMarker(d){if(d){const i=new o.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map._container.clientHeight/2,i=this._map.unproject([0,d]),l=this._map.unproject([1,d]),f=i.distanceTo(l),g=Math.ceil(2*this._accuracy/f);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&ba)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=k.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),k.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=k.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new _s(this._dotElement),this._circleElement=k.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new _s({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":En--,ba=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),En++,En>1?(d={maximumAge:6e5,timeout:0},ba=!0):(d=this.options.positionOptions,ba=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Xs,LogoControl:zo,ScaleControl:class{constructor(d){this.options=o.extend({},qr,d),o.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Kc(this._map,this._container,this.options)}onAdd(d){return this._map=d,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){k.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(d){this.options.unit=d,Kc(this._map,this._container,this.options)}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=k.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){k.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=k.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);k.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.title=d}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(d){this.options=d,o.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(d){return this._map=d,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=k.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),k.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){k.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends o.Evented{constructor(d){super(),this.options=o.extend(Object.create(en),d),o.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&k.remove(this._content),this._container&&(k.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=o.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const i=document.createDocumentFragment(),l=document.createElement("body");let f;for(l.innerHTML=d;f=l.firstChild,f;)i.appendChild(f);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=k.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(d),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(d){this._container&&this._container.classList.add(d)}removeClassName(d){this._container&&this._container.classList.remove(d)}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){if(this._container)return this._container.classList.toggle(d)}_createCloseButton(){this.options.closeButton&&(this._closeButton=k.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(d){this._update(d.point)}_onMouseMove(d){this._update(d.point)}_onDrag(d){this._update(d.point)}_update(d){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=k.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=k.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(v=>this._container.classList.add(v)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ks(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!d))return;const i=this._pos=this._trackPointer&&d?d:this._map.project(this._lngLat);let l=this.options.anchor;const f=Il(this.options.offset);if(!l){const v=this._container.offsetWidth,w=this._container.offsetHeight;let A;A=i.y+f.bottom.y<w?["top"]:i.y>this._map.transform.height-w?["bottom"]:[],i.x<v/2?A.push("left"):i.x>this._map.transform.width-v/2&&A.push("right"),l=A.length===0?"bottom":A.join("-")}const g=i.add(f[l]).round();k.setTransform(this._container,`${Pt[l]} translate(${g.x}px,${g.y}px)`),Ot(this._container,l,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(cn);d&&d.focus()}_onClose(){this.remove()}},Marker:_s,Style:$i,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,Evented:o.Evented,AJAXError:o.AJAXError,config:o.config,CanvasSource:qt,GeoJSONSource:Ne,ImageSource:ut,RasterDEMTileSource:xe,RasterTileSource:We,VectorTileSource:ct,VideoSource:Ze,prewarm:function(){ci().acquire(Qe)},clearPrewarmedResources:function(){const d=Ei;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(Qe),Ei=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return At.workerCount},set workerCount(d){At.workerCount=d},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){o.config.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){o.clearTileCache(d)},workerUrl:"",addProtocol(d,i){o.config.REGISTERED_PROTOCOLS[d]=i},removeProtocol(d){delete o.config.REGISTERED_PROTOCOLS[d]}};return yr.extend(ja,{isSafari:o.isSafari,getPerformanceMetrics:o.PerformanceUtils.getPerformanceMetrics}),ja});var _=h;return _})})(iv);const no=Pf;const{document:nv}=o_;function $d(t){let n;const a=t[18].default,c=kr(a,t,t[17],null);return{c(){c&&c.c()},m(h,p){c&&c.m(h,p),n=!0},p(h,p){c&&c.p&&(!n||p&131072)&&Er(c,a,h,h[17],n?Sr(a,h[17],p,null):Cr(h[17]),null)},i(h){n||(Ie(c,h),n=!0)},o(h){Re(c,h),n=!1},d(h){c&&c.d(h)}}}function rv(t){let n,a,c,h,p=t[2]&&$d(t);return{c(){n=Ae("link"),a=Ge(),c=Ae("div"),p&&p.c(),O(n,"rel","stylesheet"),O(n,"href","https://unpkg.com/maplibre-gl@2.1.9/dist/maplibre-gl.css"),O(c,"id",t[0]),O(c,"class","map svelte-1wo1snc")},m(_,o){ue(nv.head,n),fe(_,a,o),fe(_,c,o),p&&p.m(c,null),t[19](c),h=!0},p(_,[o]){_[2]?p?(p.p(_,o),o&4&&Ie(p,1)):(p=$d(_),p.c(),Ie(p,1),p.m(c,null)):p&&(Qn(),Re(p,1,1,()=>{p=null}),$n()),(!h||o&1)&&O(c,"id",_[0])},i(_){h||(Ie(p),h=!0)},o(_){Re(p),h=!1},d(_){ce(n),_&&ce(a),_&&ce(c),p&&p.d(),t[19](null)}}}function av(t=100){return new Promise(n=>setTimeout(n,t))}function sv(t,n,a){let{$$slots:c={},$$scope:h}=n;const p=sl();let{map:_}=n,{id:o="map"}=n,{location:b={lng:15,lat:45,zoom:1}}=n,{style:S={version:8,sources:{},layers:[{id:"background",type:"background",paint:{"background-color":"lightgrey"}}]}}=n,{options:E={}}=n,{minzoom:P=0}=n,{maxzoom:k=24}=n,{controls:L=!1}=n,{tabbable:j=!1}=n,{zoom:q=null}=n,{center:J=null}=n,{pitch:ee=null}=n,{bearing:ge=null}=n,{interactive:_e=!0}=n,{attribution:Y=!0}=n,le,ie={},ke=!1;$o("map",{getMap:()=>_}),b.bounds?ie.bounds=b.bounds:b.lng&&b.lat&&(ie.center=[+b.lng,+b.lat],b.zoom&&(ie.zoom=+b.zoom),b.pitch&&(ie.pitch=+b.pitch),b.bearing&&(ie.bearing=+b.bearing)),Y||(ie.attributionControl=!1),ie={...ie,...E},Fn(()=>{a(3,_=new no.Map({container:le,style:S,minZoom:P,maxZoom:k,interactive:_e,...ie})),L&&!Array.isArray(L)?_.addControl(new no.NavigationControl({showCompass:!1})):Array.isArray(L)&&L!=["locate"]&&_.addControl(new no.NavigationControl({showCompass:L.includes("compass"),visualizePitch:L.includes("pitch")})),Array.isArray(L)&&L.includes("locate")&&_.addControl(new no.GeolocateControl),_.addControl(new no.FullscreenControl),_.on("load",pe=>{a(4,q=_.getZoom()),a(5,J=_.getCenter()),a(6,ee=_.getPitch()),a(7,ge=_.getBearing()),a(2,ke=!0),!j&&document.querySelector(`#${o} canvas`)&&(document.querySelector(`#${o} canvas`).tabIndex="-1"),p("load",{event:pe})}),_.loadImage("https://vera-insights-data-viz.s3.amazonaws.com/louisiana/diag.png",function(pe,Fe){if(pe)throw pe;_.addImage("pattern",Fe)}),_.on("moveend",()=>{a(4,q=_.getZoom()),a(5,J=_.getCenter()),a(6,ee=_.getPitch()),a(7,ge=_.getBearing())})}),th(async()=>{await av(250),_&&_.remove(),a(3,_=null)});function Je(pe){_&&_.setStyle(pe),p("style",{style:pe})}function ve(pe){Bn[pe?"unshift":"push"](()=>{le=pe,a(1,le)})}return t.$$set=pe=>{"map"in pe&&a(3,_=pe.map),"id"in pe&&a(0,o=pe.id),"location"in pe&&a(8,b=pe.location),"style"in pe&&a(9,S=pe.style),"options"in pe&&a(10,E=pe.options),"minzoom"in pe&&a(11,P=pe.minzoom),"maxzoom"in pe&&a(12,k=pe.maxzoom),"controls"in pe&&a(13,L=pe.controls),"tabbable"in pe&&a(14,j=pe.tabbable),"zoom"in pe&&a(4,q=pe.zoom),"center"in pe&&a(5,J=pe.center),"pitch"in pe&&a(6,ee=pe.pitch),"bearing"in pe&&a(7,ge=pe.bearing),"interactive"in pe&&a(15,_e=pe.interactive),"attribution"in pe&&a(16,Y=pe.attribution),"$$scope"in pe&&a(17,h=pe.$$scope)},t.$$.update=()=>{t.$$.dirty&512&&Je(S)},[o,le,ke,_,q,J,ee,ge,b,S,E,P,k,L,j,_e,Y,h,c,ve]}let ep=class extends _i{constructor(n){super(),gi(this,n,sv,rv,di,{map:3,id:0,location:8,style:9,options:10,minzoom:11,maxzoom:12,controls:13,tabbable:14,zoom:4,center:5,pitch:6,bearing:7,interactive:15,attribution:16})}};function em(t){let n;const a=t[12].default,c=kr(a,t,t[11],null);return{c(){c&&c.c()},m(h,p){c&&c.m(h,p),n=!0},p(h,p){c&&c.p&&(!n||p&2048)&&Er(c,a,h,h[11],n?Sr(a,h[11],p,null):Cr(h[11]),null)},i(h){n||(Ie(c,h),n=!0)},o(h){Re(c,h),n=!1},d(h){c&&c.d(h)}}}function ov(t){let n,a,c=t[0]&&em(t);return{c(){c&&c.c(),n=mr()},m(h,p){c&&c.m(h,p),fe(h,n,p),a=!0},p(h,[p]){h[0]?c?(c.p(h,p),p&1&&Ie(c,1)):(c=em(h),c.c(),Ie(c,1),c.m(n.parentNode,n)):c&&(Qn(),Re(c,1,1,()=>{c=null}),$n())},i(h){a||(Ie(c),a=!0)},o(h){Re(c),a=!1},d(h){c&&c.d(h),h&&ce(n)}}}function lv(t=1e3){return new Promise(n=>setTimeout(n,t))}function cv(t,n,a){let{$$slots:c={},$$scope:h}=n,{id:p}=n,{type:_}=n,{url:o=null}=n,{props:b={}}=n,{data:S=null}=n,{layer:E=null}=n,{promoteId:P=null}=n,{minzoom:k=null}=n,{maxzoom:L=null}=n,{tilesize:j=256}=n,q=!1;const{getMap:J}=fr("map"),ee=J();$o("source",{source:p,layer:E,promoteId:P}),ee.getSource(p)&&ee.removeSource(p);async function ge(){await lv(1e3),ee.isSourceLoaded(p)?a(0,q=!0):a(0,q=!1)}k&&(b.minzoom=k),L&&(b.maxzoom=L),E&&P?(b.promoteId={},b.promoteId[E]=P):P&&(b.promoteId=P);function _e(){let ke;_=="geojson"?S?ke={type:_,data:S,...b}:o&&(ke={type:_,data:o,...b}):_=="vector"?ke={type:_,tiles:[o],...b}:_=="raster"?ke={type:_,tiles:[o],tileSize:j,...b}:_=="raster-dem"&&(ke={type:_,tiles:[o],tileSize:j,...b}),ke&&(ee.addSource(p,ke),ge())}_e();function Y(ke){let Je=ee.getSource(p);Je&&Je.setData(ke)}function le(ke){let Je=ee.getSource(p);Je&&Je.setTiles([ke])}function ie(ke){ee.getSource(p).tiles=[ke],ee.style.sourceCaches[p].clearTiles(),ee.style.sourceCaches[p].update(ee.transform),ee.triggerRepaint()}return th(async()=>{ee&&ee.getSource(p)&&(ee.getStyle().layers.filter(Je=>Je.source==p).forEach(Je=>{ee.removeLayer(Je.id)}),ee.removeSource(p))}),t.$$set=ke=>{"id"in ke&&a(2,p=ke.id),"type"in ke&&a(3,_=ke.type),"url"in ke&&a(4,o=ke.url),"props"in ke&&a(1,b=ke.props),"data"in ke&&a(5,S=ke.data),"layer"in ke&&a(6,E=ke.layer),"promoteId"in ke&&a(7,P=ke.promoteId),"minzoom"in ke&&a(8,k=ke.minzoom),"maxzoom"in ke&&a(9,L=ke.maxzoom),"tilesize"in ke&&a(10,j=ke.tilesize),"$$scope"in ke&&a(11,h=ke.$$scope)},t.$$.update=()=>{t.$$.dirty&41&&_=="geojson"&&q&&Y(S),t.$$.dirty&25&&_=="vector"&&q&&le(o),t.$$.dirty&25&&_=="raster"&&q&&ie(o)},[q,b,p,_,o,S,E,P,k,L,j,h,c]}class Ur extends _i{constructor(n){super(),gi(this,n,cv,ov,di,{id:2,type:3,url:4,props:1,data:5,layer:6,promoteId:7,minzoom:8,maxzoom:9,tilesize:10})}}const Zo=[];function uv(t,n){return{subscribe:vi(t,n).subscribe}}function vi(t,n=Ft){let a;const c=new Set;function h(o){if(di(t,o)&&(t=o,a)){const b=!Zo.length;for(const S of c)S[1](),Zo.push(S,t);if(b){for(let S=0;S<Zo.length;S+=2)Zo[S][0](Zo[S+1]);Zo.length=0}}}function p(o){h(o(t))}function _(o,b=Ft){const S=[o,b];return c.add(S),c.size===1&&(a=n(h)||Ft),o(t),()=>{c.delete(S),c.size===0&&(a(),a=null)}}return{set:h,update:p,subscribe:_}}function an(t,n,a){const c=!Array.isArray(t),h=c?[t]:t,p=n.length<2;return uv(a,_=>{let o=!1;const b=[];let S=0,E=Ft;const P=()=>{if(S)return;E();const L=n(c?b[0]:b,_);p?_(L):E=eh(L)?L:Ft},k=h.map((L,j)=>r_(L,q=>{b[j]=q,S&=~(1<<j),o&&P()},()=>{S|=1<<j}));return o=!0,P(),function(){dr(k),E()}})}const hv=t=>({hovered:t[0]&1}),tm=t=>({hovered:t[0]});function fv(t){let n;const a=t[31].default,c=kr(a,t,t[30],tm);return{c(){c&&c.c()},m(h,p){c&&c.m(h,p),n=!0},p(h,p){c&&c.p&&(!n||p[0]&1073741825)&&Er(c,a,h,h[30],n?Sr(a,h[30],p,hv):Cr(h[30]),tm)},i(h){n||(Ie(c,h),n=!0)},o(h){Re(c,h),n=!1},d(h){c&&c.d(h)}}}function pv(t,n,a){let c,{$$slots:h={},$$scope:p}=n;const _=sl();let{id:o}=n,{type:b}=n,{filter:S=null}=n,{layout:E={}}=n,{paint:P={}}=n,{data:k=null}=n,{colorKey:L="color"}=n,{nameKey:j=null}=n,{outlineKey:q="outline"}=n,{valueKey:J=null}=n,{idKey:ee=null}=n,{select:ge=!1}=n,{clickIgnore:_e=!1}=n,{clickCenter:Y=!1}=n,{selected:le=null}=n,{hover:ie=!1}=n,{hovered:ke=null}=n,{highlight:Je=!1}=n,{highlightKey:ve="highlighted"}=n,{highlighted:pe=[]}=n,{order:Fe=null}=n,{maxzoom:$e=null}=n,{minzoom:ct=null}=n,{sourceLayer:We=null}=n,{visible:mt=!0}=n;const{source:xe,layer:Ne,promoteId:Le}=fr("source"),{getMap:ut}=fr("map"),Ze=ut();$o("layer",{layer:o});const qt=vi({id:null,feature:null,event:null});wt(t,qt,He=>a(33,c=He)),$o("hover",qt),ee=ee||Le,We=We||Ne;let It=null,Ut=null,Kt=[];E.visibility=mt?"visible":"none";let Jt={id:o,type:b,source:xe,paint:P,layout:E};S&&(Jt.filter=S),We&&(Jt["source-layer"]=We),$e&&(Jt.maxzoom=$e),ct&&(Jt.minzoom=ct),Ze.getLayer(o)&&Ze.removeLayer(o),Ze.addLayer(Jt,Fe);function li(He,Mt=L,Qe=q){if(j||J)for(const At of He)Ze.setFeatureState({source:xe,sourceLayer:We,id:At[ee]},{color:Mt?At[Mt]:null,name:j?At[j]:null,value:J?At[J]:null,outline:Qe?At[Qe]:null});else for(const At of He)Ze.setFeatureState({source:xe,sourceLayer:We,id:At[ee]},{color:At[Mt],outline:"pink"})}function mi(He){Ze.getLayer(o)&&Ze.setFilter(o,He)}function Ji(He){if(Ze.getLayer(o))for(const Mt in He)Ze.setPaintProperty(o,Mt,He[Mt])}function rt(He){Ze.getLayer(o)&&Ze.setLayoutProperty(o,"visibility",He?"visible":"none")}return ge&&Ze.on("click",o,He=>{if(He.features.length>0&&!_e){let Mt=He.features[0];if(a(2,le=Mt.id),_("select",{id:le,feature:Mt,event:He}),It&&Ze.setFeatureState({source:xe,sourceLayer:We,id:It},{selected:!1}),Ze.setFeatureState({source:xe,sourceLayer:We,id:le},{selected:!0}),Y){let Qe=centroid(He.features[0].toJSON().geometry);Ze.flyTo({center:Qe.geometry.coordinates})}a(27,It=le)}}),ie&&(Ze.on("mousemove",o,He=>{if(He.features.length>0){ke&&Ze.setFeatureState({source:xe,sourceLayer:We,id:ke},{hovered:!1});let Mt=He.features[0];a(0,ke=a(28,Ut=Mt.id)),qt.set({id:ke,feature:Mt,event:He}),_("hover",c),Ze.setFeatureState({source:xe,sourceLayer:We,id:ke},{hovered:!0}),Ze.getCanvas().style.cursor="pointer"}}),Ze.on("mouseleave",o,He=>{ke&&Ze.setFeatureState({source:xe,sourceLayer:We,id:ke},{hovered:!1}),a(0,ke=a(28,Ut=null)),qt.set({id:null,feature:null,event:He}),_("hover",c),Ze.getCanvas().style.cursor=""})),th(async()=>{Ze&&Ze.getLayer(o)&&Ze.removeLayer(o)}),t.$$set=He=>{"id"in He&&a(6,o=He.id),"type"in He&&a(7,b=He.type),"filter"in He&&a(8,S=He.filter),"layout"in He&&a(4,E=He.layout),"paint"in He&&a(9,P=He.paint),"data"in He&&a(10,k=He.data),"colorKey"in He&&a(11,L=He.colorKey),"nameKey"in He&&a(12,j=He.nameKey),"outlineKey"in He&&a(13,q=He.outlineKey),"valueKey"in He&&a(14,J=He.valueKey),"idKey"in He&&a(5,ee=He.idKey),"select"in He&&a(15,ge=He.select),"clickIgnore"in He&&a(16,_e=He.clickIgnore),"clickCenter"in He&&a(17,Y=He.clickCenter),"selected"in He&&a(2,le=He.selected),"hover"in He&&a(18,ie=He.hover),"hovered"in He&&a(0,ke=He.hovered),"highlight"in He&&a(19,Je=He.highlight),"highlightKey"in He&&a(20,ve=He.highlightKey),"highlighted"in He&&a(21,pe=He.highlighted),"order"in He&&a(22,Fe=He.order),"maxzoom"in He&&a(23,$e=He.maxzoom),"minzoom"in He&&a(24,ct=He.minzoom),"sourceLayer"in He&&a(3,We=He.sourceLayer),"visible"in He&&a(25,mt=He.visible),"$$scope"in He&&a(30,p=He.$$scope)},t.$$.update=()=>{if(t.$$.dirty[0]&11264&&k&&li(k,L,q),t.$$.dirty[0]&256&&mi(S),t.$$.dirty[0]&512&&Ji(P),t.$$.dirty[0]&33554432&&rt(mt),t.$$.dirty[0]&540540936&&Je&&pe!=Kt){if(Kt[0])for(const He of Kt){let Mt={};Mt[ve]=!1,Ze.setFeatureState({source:xe,sourceLayer:We,id:He},Mt)}if(a(29,Kt=pe),pe[0])for(const He of pe){let Mt={};Mt[ve]=!0,Ze.setFeatureState({source:xe,sourceLayer:We,id:He},Mt)}}t.$$.dirty[0]&134250508&&ge&&le!=It&&(It&&Ze.setFeatureState({source:xe,sourceLayer:We,id:It},{selected:!1}),le&&Ze.setFeatureState({source:xe,sourceLayer:We,id:le},{selected:!0}),a(27,It=le)),t.$$.dirty[0]&268697609&&ie&&ke!=Ut&&(Ut&&Ze.setFeatureState({source:xe,sourceLayer:We,id:Ut},{hovered:!1}),ke&&Ze.setFeatureState({source:xe,sourceLayer:We,id:ke},{hovered:!0}),a(28,Ut=ke))},[ke,qt,le,We,E,ee,o,b,S,P,k,L,j,q,J,ge,_e,Y,ie,Je,ve,pe,Fe,$e,ct,mt,li,It,Ut,Kt,p,h]}class er extends _i{constructor(n){super(),gi(this,n,pv,fv,di,{id:6,type:7,filter:8,layout:4,paint:9,data:10,colorKey:11,nameKey:12,outlineKey:13,valueKey:14,idKey:5,select:15,clickIgnore:16,clickCenter:17,selected:2,hover:18,hovered:0,highlight:19,highlightKey:20,highlighted:21,order:22,maxzoom:23,minzoom:24,sourceLayer:3,visible:25,updateColors:26},null,[-1,-1])}get updateColors(){return this.$$.ctx[26]}}function dv(t,n,a){let c,{content:h}=n;const p=new no.Popup({closeButton:!1,closeOnClick:!1}),{getMap:_}=fr("map"),o=_(),b=fr("hover");wt(t,b,E=>a(2,c=E));function S(E,P){E.id?p.setLngLat(E.event.lngLat).setHTML(P||E.code).addTo(o):p.remove()}return th(()=>p.remove()),t.$$set=E=>{"content"in E&&a(1,h=E.content)},t.$$.update=()=>{t.$$.dirty&6&&S(c,h)},[b,h,c]}class mv extends _i{constructor(n){super(),gi(this,n,dv,null,di,{content:1})}}function gv(t){let n,a,c;return{c(){n=Ae("div"),n.innerHTML=`<div id="facility_size"><div class="circlelabels svelte-j3bpv"><p class="fac-size svelte-j3bpv">Facility Size</p> 
          <ul class="svelte-j3bpv"><li class="svelte-j3bpv">More than 5,000 beds</li> 
            <li class="svelte-j3bpv">1,000 - 5,000 beds</li> 
            <li class="svelte-j3bpv">Fewer than 1,000 beds</li></ul></div> 
        <svg class="legendcircles svelte-j3bpv"><line x1="50" y1="111" x2="100" y2="103" stroke="#666" stroke-width="1px"></line><line x1="50" y1="119" x2="100" y2="119" stroke="#666" stroke-width="1px"></line><line x1="50" y1="126" x2="100" y2="133" stroke="#666" stroke-width="1px"></line><circle cx="50" cy="131" r="5" fill="none" stroke="#000" stroke-width="1px"></circle><circle cx="50" cy="128" r="9" fill="none" stroke="#000" stroke-width="1px"></circle><circle cx="50" cy="124" r="13" fill="none" stroke="#000" stroke-width="1px"></circle></svg></div>`,a=Ge(),c=Ae("div"),c.innerHTML=`<div id="facility_size"><h4 class="facilities svelte-j3bpv">Facility Size</h4> 
        <div class="leg-item svelte-j3bpv"><div class="circsymb circlethree svelte-j3bpv"></div> 
          <div class="leg-text three svelte-j3bpv">More than 5,000 beds</div></div> 
        <div class="leg-item two svelte-j3bpv"><div class="circsymb circletwo svelte-j3bpv"></div> 
          <div class="leg-text two svelte-j3bpv">1,000 - 5,000 beds</div></div> 
        <div class="leg-item one svelte-j3bpv"><div class="circsymb circleone svelte-j3bpv"></div> 
          <div class="leg-text one svelte-j3bpv">Fewer than 1,000 beds</div></div></div>`,O(n,"class","mobile svelte-j3bpv"),O(c,"class","nonmobile svelte-j3bpv")},m(h,p){fe(h,n,p),fe(h,a,p),fe(h,c,p)},d(h){h&&ce(n),h&&ce(a),h&&ce(c)}}}function _v(t){let n;return{c(){n=Ae("div"),n.innerHTML=`<div class="nonmobile svelte-j3bpv"><div id="facility_size"><h4 class="facilities svelte-j3bpv">Facility Size</h4> 
          <div class="leg-item svelte-j3bpv"><div class="circsymb circlethree svelte-j3bpv"></div> 
            <div class="leg-text three svelte-j3bpv">More than 5,000 beds</div></div> 
          <div class="leg-item two svelte-j3bpv"><div class="circsymb circletwo svelte-j3bpv"></div> 
            <div class="leg-text two svelte-j3bpv">1,000 - 5,000 beds</div></div> 
          <div class="leg-item one svelte-j3bpv"><div class="circsymb circleone svelte-j3bpv"></div> 
            <div class="leg-text one svelte-j3bpv">Fewer than 1,000 beds</div></div></div></div> 
      <div id="pretrial_rate" class="svelte-j3bpv"><h4 class="choro svelte-j3bpv">Pretrial Detention Rate (2021)</h4> 
        <div id="colors" class="svelte-j3bpv"><div class="citem svelte-j3bpv"><div class="color a svelte-j3bpv"></div> 
            <div class="rank svelte-j3bpv">Below U.S. Avg.</div> 
            <div class="title svelte-j3bpv">(0-12 per 10k)</div></div> 
          <div class="citem svelte-j3bpv"><div class="color b svelte-j3bpv"></div> 
            <div class="rank svelte-j3bpv">Above U.S. Avg.</div> 
            <div class="title svelte-j3bpv">(12 – 25 per 10k)</div></div> 
          <div class="citem svelte-j3bpv"><div class="color c svelte-j3bpv"></div> 
            <div class="rank svelte-j3bpv">More than twice U.S. Avg.</div> 
            <div class="title svelte-j3bpv">(25+ per 10k)</div></div></div></div>`,O(n,"id","multi-legend"),O(n,"class","svelte-j3bpv")},m(a,c){fe(a,n,c)},d(a){a&&ce(n)}}}function yv(t){let n;return{c(){n=Ae("div"),n.innerHTML=`<div class="nonmobile svelte-j3bpv"><div id="facility_size"><h4 class="facilities svelte-j3bpv">Facility Size</h4> 
          <div class="leg-item svelte-j3bpv"><div class="circsymb circlethree svelte-j3bpv"></div> 
            <div class="leg-text three svelte-j3bpv">More than 5,000 beds</div></div> 
          <div class="leg-item two svelte-j3bpv"><div class="circsymb circletwo svelte-j3bpv"></div> 
            <div class="leg-text two svelte-j3bpv">1,000 - 5,000 beds</div></div> 
          <div class="leg-item one svelte-j3bpv"><div class="circsymb circleone svelte-j3bpv"></div> 
            <div class="leg-text one svelte-j3bpv">Fewer than 1,000 beds</div></div></div></div> 
      <div id="type-legend" class="svelte-j3bpv"><div class="item svelte-j3bpv"><div class="swatch hold svelte-j3bpv"></div>
          Holding Cell</div> 
        <div class="item svelte-j3bpv"><div class="swatch jail svelte-j3bpv"></div>
          Jail</div> 
        <div class="item svelte-j3bpv"><div class="swatch juvenile svelte-j3bpv"></div>
          Juvenile Facility</div> 
        <div class="item svelte-j3bpv"><div class="swatch prison svelte-j3bpv"></div>
          Prison</div> 
        <div class="item svelte-j3bpv"><div class="swatch twp svelte-j3bpv"></div>
          TWP Facility</div></div>`,O(n,"id","multi-legend"),O(n,"class","svelte-j3bpv")},m(a,c){fe(a,n,c)},d(a){a&&ce(n)}}}function vv(t){let n,a,c;return{c(){n=Ae("div"),n.innerHTML=`<div id="facility_size"><h4 class="facilities svelte-j3bpv">Facility Size</h4> 
        <div class="leg-item svelte-j3bpv"><div class="circsymb circlethree svelte-j3bpv"></div> 
          <div class="leg-text three svelte-j3bpv">More than 5,000 beds</div></div> 
        <div class="leg-item two svelte-j3bpv"><div class="circsymb circletwo svelte-j3bpv"></div> 
          <div class="leg-text two svelte-j3bpv">1,000 - 5,000 beds</div></div> 
        <div class="leg-item one svelte-j3bpv"><div class="circsymb circleone svelte-j3bpv"></div> 
          <div class="leg-text one svelte-j3bpv">Fewer than 1,000 beds</div></div></div>`,a=Ge(),c=Ae("div"),c.innerHTML=`<div class="item svelte-j3bpv"><div class="color square d svelte-j3bpv"></div> 
        <div class="title svelte-j3bpv">Louisiana plantations circa 1853</div></div>`,O(n,"class","nonmobile svelte-j3bpv"),O(c,"class","plantations-legend svelte-j3bpv")},m(h,p){fe(h,n,p),fe(h,a,p),fe(h,c,p)},d(h){h&&ce(n),h&&ce(a),h&&ce(c)}}}function xv(t){let n;return{c(){n=Ae("div")},m(a,c){fe(a,n,c)},d(a){a&&ce(n)}}}function bv(t){let n;return{c(){n=Ae("div"),n.textContent="$: Estimated 2021 revenue brought into local jails from DOC",O(n,"class","financial svelte-j3bpv")},m(a,c){fe(a,n,c)},d(a){a&&ce(n)}}}function wv(t){let n;return{c(){n=Ae("div"),O(n,"id","facility_size")},m(a,c){fe(a,n,c)},d(a){a&&ce(n)}}}function Tv(t){let n;return{c(){n=Ae("div"),n.innerHTML=`<h4 class="choro svelte-j3bpv">Pretrial Detention Rate (2021)</h4> 
      <div id="colors" class="svelte-j3bpv"><div class="citem svelte-j3bpv"><div class="color a svelte-j3bpv"></div> 
          <div class="rank svelte-j3bpv">Below U.S. Avg.</div> 
          <div class="title svelte-j3bpv">(0-12 per 10k)</div></div> 
        <div class="citem svelte-j3bpv"><div class="color b svelte-j3bpv"></div> 
          <div class="rank svelte-j3bpv">Above U.S. Avg.</div> 
          <div class="title svelte-j3bpv">(12 – 25 per 10k)</div></div> 
        <div class="citem svelte-j3bpv"><div class="color c svelte-j3bpv"></div> 
          <div class="rank svelte-j3bpv">More than twice U.S. Avg.</div> 
          <div class="title svelte-j3bpv">(25+ per 10k)</div></div></div>`,O(n,"id","pretrial_rate"),O(n,"class","svelte-j3bpv")},m(a,c){fe(a,n,c)},d(a){a&&ce(n)}}}function kv(t){let n,a,c;return{c(){n=Ae("h4"),n.textContent="Prison Admission Rate (2021)",a=Ge(),c=Ae("div"),c.innerHTML=`<div class="citem svelte-j3bpv"><div class="color a svelte-j3bpv"></div> 
        <div class="rank svelte-j3bpv">Below U.S. Avg.</div> 
        <div class="title svelte-j3bpv">(0-13 per 10k)</div></div> 
      <div class="citem svelte-j3bpv"><div class="color b svelte-j3bpv"></div> 
        <div class="rank svelte-j3bpv">Above U.S. Avg.</div> 
        <div class="title svelte-j3bpv">(13 – 26 per 10k)</div></div> 
      <div class="citem svelte-j3bpv"><div class="color c svelte-j3bpv"></div> 
        <div class="rank svelte-j3bpv">More than twice U.S. Avg.</div> 
        <div class="title svelte-j3bpv">(26+ per 10k)</div></div>`,O(n,"class","choro svelte-j3bpv"),O(c,"id","colors"),O(c,"class","svelte-j3bpv")},m(h,p){fe(h,n,p),fe(h,a,p),fe(h,c,p)},d(h){h&&ce(n),h&&ce(a),h&&ce(c)}}}function Sv(t){let n;function a(p,_){return p[0]=="map01"?kv:p[0]=="map02"?Tv:p[0]=="map04"||p[0]=="map05"?wv:p[0]=="map08"?bv:p[0]=="map12"?xv:p[0]=="map13"?vv:p[0]=="map14"?yv:p[0]=="map15"?_v:gv}let c=a(t),h=c(t);return{c(){n=Ae("div"),h.c(),O(n,"id","legend"),O(n,"class","svelte-j3bpv")},m(p,_){fe(p,n,_),h.m(n,null)},p(p,[_]){c!==(c=a(p))&&(h.d(1),h=c(p),h&&(h.c(),h.m(n,null)))},i:Ft,o:Ft,d(p){p&&ce(n),h.d()}}}function Ev(t,n,a){let{lo:c}=n;return t.$$set=h=>{"lo"in h&&a(0,c=h.lo)},[c]}class Cv extends _i{constructor(n){super(),gi(this,n,Ev,Sv,di,{lo:0})}}function Av(t){let n,a,c,h,p,_,o,b,S,E,P;return{c(){n=Ae("h2"),n.textContent="Acknowledgments",a=Ge(),c=Ae("p"),c.textContent=`Vera would like to thank Families and Friends of Louisiana’s Incarcerated
  Children, Power Coalition for Equity and Justice, and Voice of the Experienced
  for sharing their advice, guidance, and time throughout the process of
  creating this tool.`,h=Ge(),p=Ae("p"),p.textContent=`Vera would like to thank the following colleagues for their support in
  providing research and invaluable advice: Connor Burruss, Sarah Omojola, Josh
  Pichon, Kimberly Dickerson, Jacob Kang-Brown, Nina Siulc, and Karen Ball.`,_=Ge(),o=Ae("p"),o.textContent=`Vera would like to thank the Ford Foundation, the Foundation for Louisiana,
  and the Huey and Angelina Wilson Foundation for their generous financial
  contributions that helped make this project possible.`,b=Ge(),S=Ae("h2"),S.textContent="Credits",E=Ge(),P=Ae("ul"),P.innerHTML=`<li>Design and development: Jill Hubley and Hao Lun Hung</li> 
  <li>Data analysis: Selina Ho, Sara Lanclos, and Christian Henrichson</li> 
  <li>Writing: Sam Raim, Will Snowden, Kim Mosby, PhD, and Christian Henrichson</li> 
  <li>Editing: Léon Digard</li>`,O(P,"class","svelte-6fbqw6")},m(k,L){fe(k,n,L),fe(k,a,L),fe(k,c,L),fe(k,h,L),fe(k,p,L),fe(k,_,L),fe(k,o,L),fe(k,b,L),fe(k,S,L),fe(k,E,L),fe(k,P,L)},p:Ft,i:Ft,o:Ft,d(k){k&&ce(n),k&&ce(a),k&&ce(c),k&&ce(h),k&&ce(p),k&&ce(_),k&&ce(o),k&&ce(b),k&&ce(S),k&&ce(E),k&&ce(P)}}}class Iv extends _i{constructor(n){super(),gi(this,n,null,Av,di,{})}}function Du(t,n){return t==null||n==null?NaN:t<n?-1:t>n?1:t>=n?0:NaN}function Mv(t,n){return t==null||n==null?NaN:n<t?-1:n>t?1:n>=t?0:NaN}function w_(t){let n,a,c;t.length!==2?(n=Du,a=(o,b)=>Du(t(o),b),c=(o,b)=>t(o)-b):(n=t===Du||t===Mv?t:Pv,a=t,c=t);function h(o,b,S=0,E=o.length){if(S<E){if(n(b,b)!==0)return E;do{const P=S+E>>>1;a(o[P],b)<0?S=P+1:E=P}while(S<E)}return S}function p(o,b,S=0,E=o.length){if(S<E){if(n(b,b)!==0)return E;do{const P=S+E>>>1;a(o[P],b)<=0?S=P+1:E=P}while(S<E)}return S}function _(o,b,S=0,E=o.length){const P=h(o,b,S,E-1);return P>S&&c(o[P-1],b)>-c(o[P],b)?P-1:P}return{left:h,center:_,right:p}}function Pv(){return 0}function zv(t){return t===null?NaN:+t}const Dv=w_(Du),Lv=Dv.right;w_(zv).center;const Rv=Lv;class zf extends Map{constructor(n,a=Ov){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:a}}),n!=null)for(const[c,h]of n)this.set(c,h)}get(n){return super.get(im(this,n))}has(n){return super.has(im(this,n))}set(n,a){return super.set(Bv(this,n),a)}delete(n){return super.delete(Fv(this,n))}}function im({_intern:t,_key:n},a){const c=n(a);return t.has(c)?t.get(c):a}function Bv({_intern:t,_key:n},a){const c=n(a);return t.has(c)?t.get(c):(t.set(c,a),a)}function Fv({_intern:t,_key:n},a){const c=n(a);return t.has(c)&&(a=t.get(c),t.delete(c)),a}function Ov(t){return t!==null&&typeof t=="object"?t.valueOf():t}function Nu(t){return t}function Uv(t,...n){return tp(t,Nu,Nu,n)}function Nv(t,...n){return tp(t,Array.from,Nu,n)}function jv(t,n){for(let a=1,c=n.length;a<c;++a)t=t.flatMap(h=>h.pop().map(([p,_])=>[...h,p,_]));return t}function Vv(t,...n){return jv(Nv(t,...n),n)}function qv(t,n,...a){return tp(t,Nu,n,a)}function tp(t,n,a,c){return function h(p,_){if(_>=c.length)return a(p);const o=new zf,b=c[_++];let S=-1;for(const E of p){const P=b(E,++S,p),k=o.get(P);k?k.push(E):o.set(P,[E])}for(const[E,P]of o)o.set(E,h(P,_));return n(o)}(t,0)}var Df=Math.sqrt(50),Lf=Math.sqrt(10),Rf=Math.sqrt(2);function Gv(t,n,a){var c,h=-1,p,_,o;if(n=+n,t=+t,a=+a,t===n&&a>0)return[t];if((c=n<t)&&(p=t,t=n,n=p),(o=T_(t,n,a))===0||!isFinite(o))return[];if(o>0){let b=Math.round(t/o),S=Math.round(n/o);for(b*o<t&&++b,S*o>n&&--S,_=new Array(p=S-b+1);++h<p;)_[h]=(b+h)*o}else{o=-o;let b=Math.round(t*o),S=Math.round(n*o);for(b/o<t&&++b,S/o>n&&--S,_=new Array(p=S-b+1);++h<p;)_[h]=(b+h)/o}return c&&_.reverse(),_}function T_(t,n,a){var c=(n-t)/Math.max(0,a),h=Math.floor(Math.log(c)/Math.LN10),p=c/Math.pow(10,h);return h>=0?(p>=Df?10:p>=Lf?5:p>=Rf?2:1)*Math.pow(10,h):-Math.pow(10,-h)/(p>=Df?10:p>=Lf?5:p>=Rf?2:1)}function Zv(t,n,a){var c=Math.abs(n-t)/Math.max(0,a),h=Math.pow(10,Math.floor(Math.log(c)/Math.LN10)),p=c/h;return p>=Df?h*=10:p>=Lf?h*=5:p>=Rf&&(h*=2),n<t?-h:h}function cc(t,n){let a;if(n===void 0)for(const c of t)c!=null&&(a<c||a===void 0&&c>=c)&&(a=c);else{let c=-1;for(let h of t)(h=n(h,++c,t))!=null&&(a<h||a===void 0&&h>=h)&&(a=h)}return a}function Hv(t,n,a){t=+t,n=+n,a=(h=arguments.length)<2?(n=t,t=0,1):h<3?1:+a;for(var c=-1,h=Math.max(0,Math.ceil((n-t)/a))|0,p=new Array(h);++c<h;)p[c]=t+c*a;return p}function Wv(t,n){let a=0;if(n===void 0)for(let c of t)(c=+c)&&(a+=c);else{let c=-1;for(let h of t)(h=+n(h,++c,t))&&(a+=h)}return a}function Xv(t){return t}var mf=1,gf=2,Bf=3,bu=4,nm=1e-6;function Kv(t){return"translate("+t+",0)"}function Jv(t){return"translate(0,"+t+")"}function Yv(t){return n=>+t(n)}function Qv(t,n){return n=Math.max(0,t.bandwidth()-n*2)/2,t.round()&&(n=Math.round(n)),a=>+t(a)+n}function $v(){return!this.__axis}function ex(t,n){var a=[],c=null,h=null,p=6,_=6,o=3,b=typeof window<"u"&&window.devicePixelRatio>1?0:.5,S=t===mf||t===bu?-1:1,E=t===bu||t===gf?"x":"y",P=t===mf||t===Bf?Kv:Jv;function k(L){var j=c??(n.ticks?n.ticks.apply(n,a):n.domain()),q=h??(n.tickFormat?n.tickFormat.apply(n,a):Xv),J=Math.max(p,0)+o,ee=n.range(),ge=+ee[0]+b,_e=+ee[ee.length-1]+b,Y=(n.bandwidth?Qv:Yv)(n.copy(),b),le=L.selection?L.selection():L,ie=le.selectAll(".domain").data([null]),ke=le.selectAll(".tick").data(j,n).order(),Je=ke.exit(),ve=ke.enter().append("g").attr("class","tick"),pe=ke.select("line"),Fe=ke.select("text");ie=ie.merge(ie.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),ke=ke.merge(ve),pe=pe.merge(ve.append("line").attr("stroke","currentColor").attr(E+"2",S*p)),Fe=Fe.merge(ve.append("text").attr("fill","currentColor").attr(E,S*J).attr("dy",t===mf?"0em":t===Bf?"0.71em":"0.32em")),L!==le&&(ie=ie.transition(L),ke=ke.transition(L),pe=pe.transition(L),Fe=Fe.transition(L),Je=Je.transition(L).attr("opacity",nm).attr("transform",function($e){return isFinite($e=Y($e))?P($e+b):this.getAttribute("transform")}),ve.attr("opacity",nm).attr("transform",function($e){var ct=this.parentNode.__axis;return P((ct&&isFinite(ct=ct($e))?ct:Y($e))+b)})),Je.remove(),ie.attr("d",t===bu||t===gf?_?"M"+S*_+","+ge+"H"+b+"V"+_e+"H"+S*_:"M"+b+","+ge+"V"+_e:_?"M"+ge+","+S*_+"V"+b+"H"+_e+"V"+S*_:"M"+ge+","+b+"H"+_e),ke.attr("opacity",1).attr("transform",function($e){return P(Y($e)+b)}),pe.attr(E+"2",S*p),Fe.attr(E,S*J).text(q),le.filter($v).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===gf?"start":t===bu?"end":"middle"),le.each(function(){this.__axis=Y})}return k.scale=function(L){return arguments.length?(n=L,k):n},k.ticks=function(){return a=Array.from(arguments),k},k.tickArguments=function(L){return arguments.length?(a=L==null?[]:Array.from(L),k):a.slice()},k.tickValues=function(L){return arguments.length?(c=L==null?null:Array.from(L),k):c&&c.slice()},k.tickFormat=function(L){return arguments.length?(h=L,k):h},k.tickSize=function(L){return arguments.length?(p=_=+L,k):p},k.tickSizeInner=function(L){return arguments.length?(p=+L,k):p},k.tickSizeOuter=function(L){return arguments.length?(_=+L,k):_},k.tickPadding=function(L){return arguments.length?(o=+L,k):o},k.offset=function(L){return arguments.length?(b=+L,k):b},k}function tx(t){return ex(Bf,t)}var ix={value:()=>{}};function k_(){for(var t=0,n=arguments.length,a={},c;t<n;++t){if(!(c=arguments[t]+"")||c in a||/[\s.]/.test(c))throw new Error("illegal type: "+c);a[c]=[]}return new Lu(a)}function Lu(t){this._=t}function nx(t,n){return t.trim().split(/^|\s+/).map(function(a){var c="",h=a.indexOf(".");if(h>=0&&(c=a.slice(h+1),a=a.slice(0,h)),a&&!n.hasOwnProperty(a))throw new Error("unknown type: "+a);return{type:a,name:c}})}Lu.prototype=k_.prototype={constructor:Lu,on:function(t,n){var a=this._,c=nx(t+"",a),h,p=-1,_=c.length;if(arguments.length<2){for(;++p<_;)if((h=(t=c[p]).type)&&(h=rx(a[h],t.name)))return h;return}if(n!=null&&typeof n!="function")throw new Error("invalid callback: "+n);for(;++p<_;)if(h=(t=c[p]).type)a[h]=rm(a[h],t.name,n);else if(n==null)for(h in a)a[h]=rm(a[h],t.name,null);return this},copy:function(){var t={},n=this._;for(var a in n)t[a]=n[a].slice();return new Lu(t)},call:function(t,n){if((h=arguments.length-2)>0)for(var a=new Array(h),c=0,h,p;c<h;++c)a[c]=arguments[c+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(p=this._[t],c=0,h=p.length;c<h;++c)p[c].value.apply(n,a)},apply:function(t,n,a){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var c=this._[t],h=0,p=c.length;h<p;++h)c[h].value.apply(n,a)}};function rx(t,n){for(var a=0,c=t.length,h;a<c;++a)if((h=t[a]).name===n)return h.value}function rm(t,n,a){for(var c=0,h=t.length;c<h;++c)if(t[c].name===n){t[c]=ix,t=t.slice(0,c).concat(t.slice(c+1));break}return a!=null&&t.push({name:n,value:a}),t}var Ff="http://www.w3.org/1999/xhtml";const am={svg:"http://www.w3.org/2000/svg",xhtml:Ff,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function rh(t){var n=t+="",a=n.indexOf(":");return a>=0&&(n=t.slice(0,a))!=="xmlns"&&(t=t.slice(a+1)),am.hasOwnProperty(n)?{space:am[n],local:t}:t}function ax(t){return function(){var n=this.ownerDocument,a=this.namespaceURI;return a===Ff&&n.documentElement.namespaceURI===Ff?n.createElement(t):n.createElementNS(a,t)}}function sx(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function S_(t){var n=rh(t);return(n.local?sx:ax)(n)}function ox(){}function ip(t){return t==null?ox:function(){return this.querySelector(t)}}function lx(t){typeof t!="function"&&(t=ip(t));for(var n=this._groups,a=n.length,c=new Array(a),h=0;h<a;++h)for(var p=n[h],_=p.length,o=c[h]=new Array(_),b,S,E=0;E<_;++E)(b=p[E])&&(S=t.call(b,b.__data__,E,p))&&("__data__"in b&&(S.__data__=b.__data__),o[E]=S);return new pr(c,this._parents)}function E_(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function cx(){return[]}function C_(t){return t==null?cx:function(){return this.querySelectorAll(t)}}function ux(t){return function(){return E_(t.apply(this,arguments))}}function hx(t){typeof t=="function"?t=ux(t):t=C_(t);for(var n=this._groups,a=n.length,c=[],h=[],p=0;p<a;++p)for(var _=n[p],o=_.length,b,S=0;S<o;++S)(b=_[S])&&(c.push(t.call(b,b.__data__,S,_)),h.push(b));return new pr(c,h)}function A_(t){return function(){return this.matches(t)}}function I_(t){return function(n){return n.matches(t)}}var fx=Array.prototype.find;function px(t){return function(){return fx.call(this.children,t)}}function dx(){return this.firstElementChild}function mx(t){return this.select(t==null?dx:px(typeof t=="function"?t:I_(t)))}var gx=Array.prototype.filter;function _x(){return Array.from(this.children)}function yx(t){return function(){return gx.call(this.children,t)}}function vx(t){return this.selectAll(t==null?_x:yx(typeof t=="function"?t:I_(t)))}function xx(t){typeof t!="function"&&(t=A_(t));for(var n=this._groups,a=n.length,c=new Array(a),h=0;h<a;++h)for(var p=n[h],_=p.length,o=c[h]=[],b,S=0;S<_;++S)(b=p[S])&&t.call(b,b.__data__,S,p)&&o.push(b);return new pr(c,this._parents)}function M_(t){return new Array(t.length)}function bx(){return new pr(this._enter||this._groups.map(M_),this._parents)}function ju(t,n){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=n}ju.prototype={constructor:ju,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,n){return this._parent.insertBefore(t,n)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function wx(t){return function(){return t}}function Tx(t,n,a,c,h,p){for(var _=0,o,b=n.length,S=p.length;_<S;++_)(o=n[_])?(o.__data__=p[_],c[_]=o):a[_]=new ju(t,p[_]);for(;_<b;++_)(o=n[_])&&(h[_]=o)}function kx(t,n,a,c,h,p,_){var o,b,S=new Map,E=n.length,P=p.length,k=new Array(E),L;for(o=0;o<E;++o)(b=n[o])&&(k[o]=L=_.call(b,b.__data__,o,n)+"",S.has(L)?h[o]=b:S.set(L,b));for(o=0;o<P;++o)L=_.call(t,p[o],o,p)+"",(b=S.get(L))?(c[o]=b,b.__data__=p[o],S.delete(L)):a[o]=new ju(t,p[o]);for(o=0;o<E;++o)(b=n[o])&&S.get(k[o])===b&&(h[o]=b)}function Sx(t){return t.__data__}function Ex(t,n){if(!arguments.length)return Array.from(this,Sx);var a=n?kx:Tx,c=this._parents,h=this._groups;typeof t!="function"&&(t=wx(t));for(var p=h.length,_=new Array(p),o=new Array(p),b=new Array(p),S=0;S<p;++S){var E=c[S],P=h[S],k=P.length,L=Cx(t.call(E,E&&E.__data__,S,c)),j=L.length,q=o[S]=new Array(j),J=_[S]=new Array(j),ee=b[S]=new Array(k);a(E,P,q,J,ee,L,n);for(var ge=0,_e=0,Y,le;ge<j;++ge)if(Y=q[ge]){for(ge>=_e&&(_e=ge+1);!(le=J[_e])&&++_e<j;);Y._next=le||null}}return _=new pr(_,c),_._enter=o,_._exit=b,_}function Cx(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Ax(){return new pr(this._exit||this._groups.map(M_),this._parents)}function Ix(t,n,a){var c=this.enter(),h=this,p=this.exit();return typeof t=="function"?(c=t(c),c&&(c=c.selection())):c=c.append(t+""),n!=null&&(h=n(h),h&&(h=h.selection())),a==null?p.remove():a(p),c&&h?c.merge(h).order():h}function Mx(t){for(var n=t.selection?t.selection():t,a=this._groups,c=n._groups,h=a.length,p=c.length,_=Math.min(h,p),o=new Array(h),b=0;b<_;++b)for(var S=a[b],E=c[b],P=S.length,k=o[b]=new Array(P),L,j=0;j<P;++j)(L=S[j]||E[j])&&(k[j]=L);for(;b<h;++b)o[b]=a[b];return new pr(o,this._parents)}function Px(){for(var t=this._groups,n=-1,a=t.length;++n<a;)for(var c=t[n],h=c.length-1,p=c[h],_;--h>=0;)(_=c[h])&&(p&&_.compareDocumentPosition(p)^4&&p.parentNode.insertBefore(_,p),p=_);return this}function zx(t){t||(t=Dx);function n(P,k){return P&&k?t(P.__data__,k.__data__):!P-!k}for(var a=this._groups,c=a.length,h=new Array(c),p=0;p<c;++p){for(var _=a[p],o=_.length,b=h[p]=new Array(o),S,E=0;E<o;++E)(S=_[E])&&(b[E]=S);b.sort(n)}return new pr(h,this._parents).order()}function Dx(t,n){return t<n?-1:t>n?1:t>=n?0:NaN}function Lx(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function Rx(){return Array.from(this)}function Bx(){for(var t=this._groups,n=0,a=t.length;n<a;++n)for(var c=t[n],h=0,p=c.length;h<p;++h){var _=c[h];if(_)return _}return null}function Fx(){let t=0;for(const n of this)++t;return t}function Ox(){return!this.node()}function Ux(t){for(var n=this._groups,a=0,c=n.length;a<c;++a)for(var h=n[a],p=0,_=h.length,o;p<_;++p)(o=h[p])&&t.call(o,o.__data__,p,h);return this}function Nx(t){return function(){this.removeAttribute(t)}}function jx(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Vx(t,n){return function(){this.setAttribute(t,n)}}function qx(t,n){return function(){this.setAttributeNS(t.space,t.local,n)}}function Gx(t,n){return function(){var a=n.apply(this,arguments);a==null?this.removeAttribute(t):this.setAttribute(t,a)}}function Zx(t,n){return function(){var a=n.apply(this,arguments);a==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,a)}}function Hx(t,n){var a=rh(t);if(arguments.length<2){var c=this.node();return a.local?c.getAttributeNS(a.space,a.local):c.getAttribute(a)}return this.each((n==null?a.local?jx:Nx:typeof n=="function"?a.local?Zx:Gx:a.local?qx:Vx)(a,n))}function P_(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Wx(t){return function(){this.style.removeProperty(t)}}function Xx(t,n,a){return function(){this.style.setProperty(t,n,a)}}function Kx(t,n,a){return function(){var c=n.apply(this,arguments);c==null?this.style.removeProperty(t):this.style.setProperty(t,c,a)}}function Jx(t,n,a){return arguments.length>1?this.each((n==null?Wx:typeof n=="function"?Kx:Xx)(t,n,a??"")):tl(this.node(),t)}function tl(t,n){return t.style.getPropertyValue(n)||P_(t).getComputedStyle(t,null).getPropertyValue(n)}function Yx(t){return function(){delete this[t]}}function Qx(t,n){return function(){this[t]=n}}function $x(t,n){return function(){var a=n.apply(this,arguments);a==null?delete this[t]:this[t]=a}}function eb(t,n){return arguments.length>1?this.each((n==null?Yx:typeof n=="function"?$x:Qx)(t,n)):this.node()[t]}function z_(t){return t.trim().split(/^|\s+/)}function np(t){return t.classList||new D_(t)}function D_(t){this._node=t,this._names=z_(t.getAttribute("class")||"")}D_.prototype={add:function(t){var n=this._names.indexOf(t);n<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var n=this._names.indexOf(t);n>=0&&(this._names.splice(n,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function L_(t,n){for(var a=np(t),c=-1,h=n.length;++c<h;)a.add(n[c])}function R_(t,n){for(var a=np(t),c=-1,h=n.length;++c<h;)a.remove(n[c])}function tb(t){return function(){L_(this,t)}}function ib(t){return function(){R_(this,t)}}function nb(t,n){return function(){(n.apply(this,arguments)?L_:R_)(this,t)}}function rb(t,n){var a=z_(t+"");if(arguments.length<2){for(var c=np(this.node()),h=-1,p=a.length;++h<p;)if(!c.contains(a[h]))return!1;return!0}return this.each((typeof n=="function"?nb:n?tb:ib)(a,n))}function ab(){this.textContent=""}function sb(t){return function(){this.textContent=t}}function ob(t){return function(){var n=t.apply(this,arguments);this.textContent=n??""}}function lb(t){return arguments.length?this.each(t==null?ab:(typeof t=="function"?ob:sb)(t)):this.node().textContent}function cb(){this.innerHTML=""}function ub(t){return function(){this.innerHTML=t}}function hb(t){return function(){var n=t.apply(this,arguments);this.innerHTML=n??""}}function fb(t){return arguments.length?this.each(t==null?cb:(typeof t=="function"?hb:ub)(t)):this.node().innerHTML}function pb(){this.nextSibling&&this.parentNode.appendChild(this)}function db(){return this.each(pb)}function mb(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function gb(){return this.each(mb)}function _b(t){var n=typeof t=="function"?t:S_(t);return this.select(function(){return this.appendChild(n.apply(this,arguments))})}function yb(){return null}function vb(t,n){var a=typeof t=="function"?t:S_(t),c=n==null?yb:typeof n=="function"?n:ip(n);return this.select(function(){return this.insertBefore(a.apply(this,arguments),c.apply(this,arguments)||null)})}function xb(){var t=this.parentNode;t&&t.removeChild(this)}function bb(){return this.each(xb)}function wb(){var t=this.cloneNode(!1),n=this.parentNode;return n?n.insertBefore(t,this.nextSibling):t}function Tb(){var t=this.cloneNode(!0),n=this.parentNode;return n?n.insertBefore(t,this.nextSibling):t}function kb(t){return this.select(t?Tb:wb)}function Sb(t){return arguments.length?this.property("__data__",t):this.node().__data__}function Eb(t){return function(n){t.call(this,n,this.__data__)}}function Cb(t){return t.trim().split(/^|\s+/).map(function(n){var a="",c=n.indexOf(".");return c>=0&&(a=n.slice(c+1),n=n.slice(0,c)),{type:n,name:a}})}function Ab(t){return function(){var n=this.__on;if(n){for(var a=0,c=-1,h=n.length,p;a<h;++a)p=n[a],(!t.type||p.type===t.type)&&p.name===t.name?this.removeEventListener(p.type,p.listener,p.options):n[++c]=p;++c?n.length=c:delete this.__on}}}function Ib(t,n,a){return function(){var c=this.__on,h,p=Eb(n);if(c){for(var _=0,o=c.length;_<o;++_)if((h=c[_]).type===t.type&&h.name===t.name){this.removeEventListener(h.type,h.listener,h.options),this.addEventListener(h.type,h.listener=p,h.options=a),h.value=n;return}}this.addEventListener(t.type,p,a),h={type:t.type,name:t.name,value:n,listener:p,options:a},c?c.push(h):this.__on=[h]}}function Mb(t,n,a){var c=Cb(t+""),h,p=c.length,_;if(arguments.length<2){var o=this.node().__on;if(o){for(var b=0,S=o.length,E;b<S;++b)for(h=0,E=o[b];h<p;++h)if((_=c[h]).type===E.type&&_.name===E.name)return E.value}return}for(o=n?Ib:Ab,h=0;h<p;++h)this.each(o(c[h],n,a));return this}function B_(t,n,a){var c=P_(t),h=c.CustomEvent;typeof h=="function"?h=new h(n,a):(h=c.document.createEvent("Event"),a?(h.initEvent(n,a.bubbles,a.cancelable),h.detail=a.detail):h.initEvent(n,!1,!1)),t.dispatchEvent(h)}function Pb(t,n){return function(){return B_(this,t,n)}}function zb(t,n){return function(){return B_(this,t,n.apply(this,arguments))}}function Db(t,n){return this.each((typeof n=="function"?zb:Pb)(t,n))}function*Lb(){for(var t=this._groups,n=0,a=t.length;n<a;++n)for(var c=t[n],h=0,p=c.length,_;h<p;++h)(_=c[h])&&(yield _)}var rp=[null];function pr(t,n){this._groups=t,this._parents=n}function vc(){return new pr([[document.documentElement]],rp)}function Rb(){return this}pr.prototype=vc.prototype={constructor:pr,select:lx,selectAll:hx,selectChild:mx,selectChildren:vx,filter:xx,data:Ex,enter:bx,exit:Ax,join:Ix,merge:Mx,selection:Rb,order:Px,sort:zx,call:Lx,nodes:Rx,node:Bx,size:Fx,empty:Ox,each:Ux,attr:Hx,style:Jx,property:eb,classed:rb,text:lb,html:fb,raise:db,lower:gb,append:_b,insert:vb,remove:bb,clone:kb,datum:Sb,on:Mb,dispatch:Db,[Symbol.iterator]:Lb};function Rn(t){return typeof t=="string"?new pr([[document.querySelector(t)]],[document.documentElement]):new pr([[t]],rp)}function F_(t){return typeof t=="string"?new pr([document.querySelectorAll(t)],[document.documentElement]):new pr([E_(t)],rp)}function ap(t,n,a){t.prototype=n.prototype=a,a.constructor=t}function O_(t,n){var a=Object.create(t.prototype);for(var c in n)a[c]=n[c];return a}function xc(){}var uc=.7,Vu=1/uc,Yo="\\s*([+-]?\\d+)\\s*",hc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Aa="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Bb=/^#([0-9a-f]{3,8})$/,Fb=new RegExp(`^rgb\\(${Yo},${Yo},${Yo}\\)$`),Ob=new RegExp(`^rgb\\(${Aa},${Aa},${Aa}\\)$`),Ub=new RegExp(`^rgba\\(${Yo},${Yo},${Yo},${hc}\\)$`),Nb=new RegExp(`^rgba\\(${Aa},${Aa},${Aa},${hc}\\)$`),jb=new RegExp(`^hsl\\(${hc},${Aa},${Aa}\\)$`),Vb=new RegExp(`^hsla\\(${hc},${Aa},${Aa},${hc}\\)$`),sm={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};ap(xc,oo,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:om,formatHex:om,formatHex8:qb,formatHsl:Gb,formatRgb:lm,toString:lm});function om(){return this.rgb().formatHex()}function qb(){return this.rgb().formatHex8()}function Gb(){return U_(this).formatHsl()}function lm(){return this.rgb().formatRgb()}function oo(t){var n,a;return t=(t+"").trim().toLowerCase(),(n=Bb.exec(t))?(a=n[1].length,n=parseInt(n[1],16),a===6?cm(n):a===3?new Tr(n>>8&15|n>>4&240,n>>4&15|n&240,(n&15)<<4|n&15,1):a===8?wu(n>>24&255,n>>16&255,n>>8&255,(n&255)/255):a===4?wu(n>>12&15|n>>8&240,n>>8&15|n>>4&240,n>>4&15|n&240,((n&15)<<4|n&15)/255):null):(n=Fb.exec(t))?new Tr(n[1],n[2],n[3],1):(n=Ob.exec(t))?new Tr(n[1]*255/100,n[2]*255/100,n[3]*255/100,1):(n=Ub.exec(t))?wu(n[1],n[2],n[3],n[4]):(n=Nb.exec(t))?wu(n[1]*255/100,n[2]*255/100,n[3]*255/100,n[4]):(n=jb.exec(t))?fm(n[1],n[2]/100,n[3]/100,1):(n=Vb.exec(t))?fm(n[1],n[2]/100,n[3]/100,n[4]):sm.hasOwnProperty(t)?cm(sm[t]):t==="transparent"?new Tr(NaN,NaN,NaN,0):null}function cm(t){return new Tr(t>>16&255,t>>8&255,t&255,1)}function wu(t,n,a,c){return c<=0&&(t=n=a=NaN),new Tr(t,n,a,c)}function Zb(t){return t instanceof xc||(t=oo(t)),t?(t=t.rgb(),new Tr(t.r,t.g,t.b,t.opacity)):new Tr}function qu(t,n,a,c){return arguments.length===1?Zb(t):new Tr(t,n,a,c??1)}function Tr(t,n,a,c){this.r=+t,this.g=+n,this.b=+a,this.opacity=+c}ap(Tr,qu,O_(xc,{brighter(t){return t=t==null?Vu:Math.pow(Vu,t),new Tr(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?uc:Math.pow(uc,t),new Tr(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Tr(so(this.r),so(this.g),so(this.b),Gu(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:um,formatHex:um,formatHex8:Hb,formatRgb:hm,toString:hm}));function um(){return`#${ao(this.r)}${ao(this.g)}${ao(this.b)}`}function Hb(){return`#${ao(this.r)}${ao(this.g)}${ao(this.b)}${ao((isNaN(this.opacity)?1:this.opacity)*255)}`}function hm(){const t=Gu(this.opacity);return`${t===1?"rgb(":"rgba("}${so(this.r)}, ${so(this.g)}, ${so(this.b)}${t===1?")":`, ${t})`}`}function Gu(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function so(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function ao(t){return t=so(t),(t<16?"0":"")+t.toString(16)}function fm(t,n,a,c){return c<=0?t=n=a=NaN:a<=0||a>=1?t=n=NaN:n<=0&&(t=NaN),new ha(t,n,a,c)}function U_(t){if(t instanceof ha)return new ha(t.h,t.s,t.l,t.opacity);if(t instanceof xc||(t=oo(t)),!t)return new ha;if(t instanceof ha)return t;t=t.rgb();var n=t.r/255,a=t.g/255,c=t.b/255,h=Math.min(n,a,c),p=Math.max(n,a,c),_=NaN,o=p-h,b=(p+h)/2;return o?(n===p?_=(a-c)/o+(a<c)*6:a===p?_=(c-n)/o+2:_=(n-a)/o+4,o/=b<.5?p+h:2-p-h,_*=60):o=b>0&&b<1?0:_,new ha(_,o,b,t.opacity)}function Wb(t,n,a,c){return arguments.length===1?U_(t):new ha(t,n,a,c??1)}function ha(t,n,a,c){this.h=+t,this.s=+n,this.l=+a,this.opacity=+c}ap(ha,Wb,O_(xc,{brighter(t){return t=t==null?Vu:Math.pow(Vu,t),new ha(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?uc:Math.pow(uc,t),new ha(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,n=isNaN(t)||isNaN(this.s)?0:this.s,a=this.l,c=a+(a<.5?a:1-a)*n,h=2*a-c;return new Tr(_f(t>=240?t-240:t+120,h,c),_f(t,h,c),_f(t<120?t+240:t-120,h,c),this.opacity)},clamp(){return new ha(pm(this.h),Tu(this.s),Tu(this.l),Gu(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Gu(this.opacity);return`${t===1?"hsl(":"hsla("}${pm(this.h)}, ${Tu(this.s)*100}%, ${Tu(this.l)*100}%${t===1?")":`, ${t})`}`}}));function pm(t){return t=(t||0)%360,t<0?t+360:t}function Tu(t){return Math.max(0,Math.min(1,t||0))}function _f(t,n,a){return(t<60?n+(a-n)*t/60:t<180?a:t<240?n+(a-n)*(240-t)/60:n)*255}const sp=t=>()=>t;function Xb(t,n){return function(a){return t+a*n}}function Kb(t,n,a){return t=Math.pow(t,a),n=Math.pow(n,a)-t,a=1/a,function(c){return Math.pow(t+c*n,a)}}function Jb(t){return(t=+t)==1?N_:function(n,a){return a-n?Kb(n,a,t):sp(isNaN(n)?a:n)}}function N_(t,n){var a=n-t;return a?Xb(t,a):sp(isNaN(t)?n:t)}const Zu=function t(n){var a=Jb(n);function c(h,p){var _=a((h=qu(h)).r,(p=qu(p)).r),o=a(h.g,p.g),b=a(h.b,p.b),S=N_(h.opacity,p.opacity);return function(E){return h.r=_(E),h.g=o(E),h.b=b(E),h.opacity=S(E),h+""}}return c.gamma=t,c}(1);function Yb(t,n){n||(n=[]);var a=t?Math.min(n.length,t.length):0,c=n.slice(),h;return function(p){for(h=0;h<a;++h)c[h]=t[h]*(1-p)+n[h]*p;return c}}function Qb(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function $b(t,n){var a=n?n.length:0,c=t?Math.min(a,t.length):0,h=new Array(c),p=new Array(a),_;for(_=0;_<c;++_)h[_]=op(t[_],n[_]);for(;_<a;++_)p[_]=n[_];return function(o){for(_=0;_<c;++_)p[_]=h[_](o);return p}}function ew(t,n){var a=new Date;return t=+t,n=+n,function(c){return a.setTime(t*(1-c)+n*c),a}}function ua(t,n){return t=+t,n=+n,function(a){return t*(1-a)+n*a}}function tw(t,n){var a={},c={},h;(t===null||typeof t!="object")&&(t={}),(n===null||typeof n!="object")&&(n={});for(h in n)h in t?a[h]=op(t[h],n[h]):c[h]=n[h];return function(p){for(h in a)c[h]=a[h](p);return c}}var Of=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,yf=new RegExp(Of.source,"g");function iw(t){return function(){return t}}function nw(t){return function(n){return t(n)+""}}function j_(t,n){var a=Of.lastIndex=yf.lastIndex=0,c,h,p,_=-1,o=[],b=[];for(t=t+"",n=n+"";(c=Of.exec(t))&&(h=yf.exec(n));)(p=h.index)>a&&(p=n.slice(a,p),o[_]?o[_]+=p:o[++_]=p),(c=c[0])===(h=h[0])?o[_]?o[_]+=h:o[++_]=h:(o[++_]=null,b.push({i:_,x:ua(c,h)})),a=yf.lastIndex;return a<n.length&&(p=n.slice(a),o[_]?o[_]+=p:o[++_]=p),o.length<2?b[0]?nw(b[0].x):iw(n):(n=b.length,function(S){for(var E=0,P;E<n;++E)o[(P=b[E]).i]=P.x(S);return o.join("")})}function op(t,n){var a=typeof n,c;return n==null||a==="boolean"?sp(n):(a==="number"?ua:a==="string"?(c=oo(n))?(n=c,Zu):j_:n instanceof oo?Zu:n instanceof Date?ew:Qb(n)?Yb:Array.isArray(n)?$b:typeof n.valueOf!="function"&&typeof n.toString!="function"||isNaN(n)?tw:ua)(t,n)}function rw(t,n){return t=+t,n=+n,function(a){return Math.round(t*(1-a)+n*a)}}var dm=180/Math.PI,Uf={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function V_(t,n,a,c,h,p){var _,o,b;return(_=Math.sqrt(t*t+n*n))&&(t/=_,n/=_),(b=t*a+n*c)&&(a-=t*b,c-=n*b),(o=Math.sqrt(a*a+c*c))&&(a/=o,c/=o,b/=o),t*c<n*a&&(t=-t,n=-n,b=-b,_=-_),{translateX:h,translateY:p,rotate:Math.atan2(n,t)*dm,skewX:Math.atan(b)*dm,scaleX:_,scaleY:o}}var ku;function aw(t){const n=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return n.isIdentity?Uf:V_(n.a,n.b,n.c,n.d,n.e,n.f)}function sw(t){return t==null||(ku||(ku=document.createElementNS("http://www.w3.org/2000/svg","g")),ku.setAttribute("transform",t),!(t=ku.transform.baseVal.consolidate()))?Uf:(t=t.matrix,V_(t.a,t.b,t.c,t.d,t.e,t.f))}function q_(t,n,a,c){function h(S){return S.length?S.pop()+" ":""}function p(S,E,P,k,L,j){if(S!==P||E!==k){var q=L.push("translate(",null,n,null,a);j.push({i:q-4,x:ua(S,P)},{i:q-2,x:ua(E,k)})}else(P||k)&&L.push("translate("+P+n+k+a)}function _(S,E,P,k){S!==E?(S-E>180?E+=360:E-S>180&&(S+=360),k.push({i:P.push(h(P)+"rotate(",null,c)-2,x:ua(S,E)})):E&&P.push(h(P)+"rotate("+E+c)}function o(S,E,P,k){S!==E?k.push({i:P.push(h(P)+"skewX(",null,c)-2,x:ua(S,E)}):E&&P.push(h(P)+"skewX("+E+c)}function b(S,E,P,k,L,j){if(S!==P||E!==k){var q=L.push(h(L)+"scale(",null,",",null,")");j.push({i:q-4,x:ua(S,P)},{i:q-2,x:ua(E,k)})}else(P!==1||k!==1)&&L.push(h(L)+"scale("+P+","+k+")")}return function(S,E){var P=[],k=[];return S=t(S),E=t(E),p(S.translateX,S.translateY,E.translateX,E.translateY,P,k),_(S.rotate,E.rotate,P,k),o(S.skewX,E.skewX,P,k),b(S.scaleX,S.scaleY,E.scaleX,E.scaleY,P,k),S=E=null,function(L){for(var j=-1,q=k.length,J;++j<q;)P[(J=k[j]).i]=J.x(L);return P.join("")}}}var ow=q_(aw,"px, ","px)","deg)"),lw=q_(sw,", ",")",")"),il=0,rc=0,Yl=0,G_=1e3,Hu,ac,Wu=0,lo=0,ah=0,fc=typeof performance=="object"&&performance.now?performance:Date,Z_=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function lp(){return lo||(Z_(cw),lo=fc.now()+ah)}function cw(){lo=0}function Xu(){this._call=this._time=this._next=null}Xu.prototype=H_.prototype={constructor:Xu,restart:function(t,n,a){if(typeof t!="function")throw new TypeError("callback is not a function");a=(a==null?lp():+a)+(n==null?0:+n),!this._next&&ac!==this&&(ac?ac._next=this:Hu=this,ac=this),this._call=t,this._time=a,Nf()},stop:function(){this._call&&(this._call=null,this._time=1/0,Nf())}};function H_(t,n,a){var c=new Xu;return c.restart(t,n,a),c}function uw(){lp(),++il;for(var t=Hu,n;t;)(n=lo-t._time)>=0&&t._call.call(void 0,n),t=t._next;--il}function mm(){lo=(Wu=fc.now())+ah,il=rc=0;try{uw()}finally{il=0,fw(),lo=0}}function hw(){var t=fc.now(),n=t-Wu;n>G_&&(ah-=n,Wu=t)}function fw(){for(var t,n=Hu,a,c=1/0;n;)n._call?(c>n._time&&(c=n._time),t=n,n=n._next):(a=n._next,n._next=null,n=t?t._next=a:Hu=a);ac=t,Nf(c)}function Nf(t){if(!il){rc&&(rc=clearTimeout(rc));var n=t-lo;n>24?(t<1/0&&(rc=setTimeout(mm,t-fc.now()-ah)),Yl&&(Yl=clearInterval(Yl))):(Yl||(Wu=fc.now(),Yl=setInterval(hw,G_)),il=1,Z_(mm))}}function gm(t,n,a){var c=new Xu;return n=n==null?0:+n,c.restart(h=>{c.stop(),t(h+n)},n,a),c}var pw=k_("start","end","cancel","interrupt"),dw=[],W_=0,_m=1,jf=2,Ru=3,ym=4,Vf=5,Bu=6;function sh(t,n,a,c,h,p){var _=t.__transition;if(!_)t.__transition={};else if(a in _)return;mw(t,a,{name:n,index:c,group:h,on:pw,tween:dw,time:p.time,delay:p.delay,duration:p.duration,ease:p.ease,timer:null,state:W_})}function cp(t,n){var a=fa(t,n);if(a.state>W_)throw new Error("too late; already scheduled");return a}function Ma(t,n){var a=fa(t,n);if(a.state>Ru)throw new Error("too late; already running");return a}function fa(t,n){var a=t.__transition;if(!a||!(a=a[n]))throw new Error("transition not found");return a}function mw(t,n,a){var c=t.__transition,h;c[n]=a,a.timer=H_(p,0,a.time);function p(S){a.state=_m,a.timer.restart(_,a.delay,a.time),a.delay<=S&&_(S-a.delay)}function _(S){var E,P,k,L;if(a.state!==_m)return b();for(E in c)if(L=c[E],L.name===a.name){if(L.state===Ru)return gm(_);L.state===ym?(L.state=Bu,L.timer.stop(),L.on.call("interrupt",t,t.__data__,L.index,L.group),delete c[E]):+E<n&&(L.state=Bu,L.timer.stop(),L.on.call("cancel",t,t.__data__,L.index,L.group),delete c[E])}if(gm(function(){a.state===Ru&&(a.state=ym,a.timer.restart(o,a.delay,a.time),o(S))}),a.state=jf,a.on.call("start",t,t.__data__,a.index,a.group),a.state===jf){for(a.state=Ru,h=new Array(k=a.tween.length),E=0,P=-1;E<k;++E)(L=a.tween[E].value.call(t,t.__data__,a.index,a.group))&&(h[++P]=L);h.length=P+1}}function o(S){for(var E=S<a.duration?a.ease.call(null,S/a.duration):(a.timer.restart(b),a.state=Vf,1),P=-1,k=h.length;++P<k;)h[P].call(t,E);a.state===Vf&&(a.on.call("end",t,t.__data__,a.index,a.group),b())}function b(){a.state=Bu,a.timer.stop(),delete c[n];for(var S in c)return;delete t.__transition}}function gw(t,n){var a=t.__transition,c,h,p=!0,_;if(a){n=n==null?null:n+"";for(_ in a){if((c=a[_]).name!==n){p=!1;continue}h=c.state>jf&&c.state<Vf,c.state=Bu,c.timer.stop(),c.on.call(h?"interrupt":"cancel",t,t.__data__,c.index,c.group),delete a[_]}p&&delete t.__transition}}function _w(t){return this.each(function(){gw(this,t)})}function yw(t,n){var a,c;return function(){var h=Ma(this,t),p=h.tween;if(p!==a){c=a=p;for(var _=0,o=c.length;_<o;++_)if(c[_].name===n){c=c.slice(),c.splice(_,1);break}}h.tween=c}}function vw(t,n,a){var c,h;if(typeof a!="function")throw new Error;return function(){var p=Ma(this,t),_=p.tween;if(_!==c){h=(c=_).slice();for(var o={name:n,value:a},b=0,S=h.length;b<S;++b)if(h[b].name===n){h[b]=o;break}b===S&&h.push(o)}p.tween=h}}function xw(t,n){var a=this._id;if(t+="",arguments.length<2){for(var c=fa(this.node(),a).tween,h=0,p=c.length,_;h<p;++h)if((_=c[h]).name===t)return _.value;return null}return this.each((n==null?yw:vw)(a,t,n))}function up(t,n,a){var c=t._id;return t.each(function(){var h=Ma(this,c);(h.value||(h.value={}))[n]=a.apply(this,arguments)}),function(h){return fa(h,c).value[n]}}function X_(t,n){var a;return(typeof n=="number"?ua:n instanceof oo?Zu:(a=oo(n))?(n=a,Zu):j_)(t,n)}function bw(t){return function(){this.removeAttribute(t)}}function ww(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Tw(t,n,a){var c,h=a+"",p;return function(){var _=this.getAttribute(t);return _===h?null:_===c?p:p=n(c=_,a)}}function kw(t,n,a){var c,h=a+"",p;return function(){var _=this.getAttributeNS(t.space,t.local);return _===h?null:_===c?p:p=n(c=_,a)}}function Sw(t,n,a){var c,h,p;return function(){var _,o=a(this),b;return o==null?void this.removeAttribute(t):(_=this.getAttribute(t),b=o+"",_===b?null:_===c&&b===h?p:(h=b,p=n(c=_,o)))}}function Ew(t,n,a){var c,h,p;return function(){var _,o=a(this),b;return o==null?void this.removeAttributeNS(t.space,t.local):(_=this.getAttributeNS(t.space,t.local),b=o+"",_===b?null:_===c&&b===h?p:(h=b,p=n(c=_,o)))}}function Cw(t,n){var a=rh(t),c=a==="transform"?lw:X_;return this.attrTween(t,typeof n=="function"?(a.local?Ew:Sw)(a,c,up(this,"attr."+t,n)):n==null?(a.local?ww:bw)(a):(a.local?kw:Tw)(a,c,n))}function Aw(t,n){return function(a){this.setAttribute(t,n.call(this,a))}}function Iw(t,n){return function(a){this.setAttributeNS(t.space,t.local,n.call(this,a))}}function Mw(t,n){var a,c;function h(){var p=n.apply(this,arguments);return p!==c&&(a=(c=p)&&Iw(t,p)),a}return h._value=n,h}function Pw(t,n){var a,c;function h(){var p=n.apply(this,arguments);return p!==c&&(a=(c=p)&&Aw(t,p)),a}return h._value=n,h}function zw(t,n){var a="attr."+t;if(arguments.length<2)return(a=this.tween(a))&&a._value;if(n==null)return this.tween(a,null);if(typeof n!="function")throw new Error;var c=rh(t);return this.tween(a,(c.local?Mw:Pw)(c,n))}function Dw(t,n){return function(){cp(this,t).delay=+n.apply(this,arguments)}}function Lw(t,n){return n=+n,function(){cp(this,t).delay=n}}function Rw(t){var n=this._id;return arguments.length?this.each((typeof t=="function"?Dw:Lw)(n,t)):fa(this.node(),n).delay}function Bw(t,n){return function(){Ma(this,t).duration=+n.apply(this,arguments)}}function Fw(t,n){return n=+n,function(){Ma(this,t).duration=n}}function Ow(t){var n=this._id;return arguments.length?this.each((typeof t=="function"?Bw:Fw)(n,t)):fa(this.node(),n).duration}function Uw(t,n){if(typeof n!="function")throw new Error;return function(){Ma(this,t).ease=n}}function Nw(t){var n=this._id;return arguments.length?this.each(Uw(n,t)):fa(this.node(),n).ease}function jw(t,n){return function(){var a=n.apply(this,arguments);if(typeof a!="function")throw new Error;Ma(this,t).ease=a}}function Vw(t){if(typeof t!="function")throw new Error;return this.each(jw(this._id,t))}function qw(t){typeof t!="function"&&(t=A_(t));for(var n=this._groups,a=n.length,c=new Array(a),h=0;h<a;++h)for(var p=n[h],_=p.length,o=c[h]=[],b,S=0;S<_;++S)(b=p[S])&&t.call(b,b.__data__,S,p)&&o.push(b);return new es(c,this._parents,this._name,this._id)}function Gw(t){if(t._id!==this._id)throw new Error;for(var n=this._groups,a=t._groups,c=n.length,h=a.length,p=Math.min(c,h),_=new Array(c),o=0;o<p;++o)for(var b=n[o],S=a[o],E=b.length,P=_[o]=new Array(E),k,L=0;L<E;++L)(k=b[L]||S[L])&&(P[L]=k);for(;o<c;++o)_[o]=n[o];return new es(_,this._parents,this._name,this._id)}function Zw(t){return(t+"").trim().split(/^|\s+/).every(function(n){var a=n.indexOf(".");return a>=0&&(n=n.slice(0,a)),!n||n==="start"})}function Hw(t,n,a){var c,h,p=Zw(n)?cp:Ma;return function(){var _=p(this,t),o=_.on;o!==c&&(h=(c=o).copy()).on(n,a),_.on=h}}function Ww(t,n){var a=this._id;return arguments.length<2?fa(this.node(),a).on.on(t):this.each(Hw(a,t,n))}function Xw(t){return function(){var n=this.parentNode;for(var a in this.__transition)if(+a!==t)return;n&&n.removeChild(this)}}function Kw(){return this.on("end.remove",Xw(this._id))}function Jw(t){var n=this._name,a=this._id;typeof t!="function"&&(t=ip(t));for(var c=this._groups,h=c.length,p=new Array(h),_=0;_<h;++_)for(var o=c[_],b=o.length,S=p[_]=new Array(b),E,P,k=0;k<b;++k)(E=o[k])&&(P=t.call(E,E.__data__,k,o))&&("__data__"in E&&(P.__data__=E.__data__),S[k]=P,sh(S[k],n,a,k,S,fa(E,a)));return new es(p,this._parents,n,a)}function Yw(t){var n=this._name,a=this._id;typeof t!="function"&&(t=C_(t));for(var c=this._groups,h=c.length,p=[],_=[],o=0;o<h;++o)for(var b=c[o],S=b.length,E,P=0;P<S;++P)if(E=b[P]){for(var k=t.call(E,E.__data__,P,b),L,j=fa(E,a),q=0,J=k.length;q<J;++q)(L=k[q])&&sh(L,n,a,q,k,j);p.push(k),_.push(E)}return new es(p,_,n,a)}var Qw=vc.prototype.constructor;function $w(){return new Qw(this._groups,this._parents)}function e2(t,n){var a,c,h;return function(){var p=tl(this,t),_=(this.style.removeProperty(t),tl(this,t));return p===_?null:p===a&&_===c?h:h=n(a=p,c=_)}}function K_(t){return function(){this.style.removeProperty(t)}}function t2(t,n,a){var c,h=a+"",p;return function(){var _=tl(this,t);return _===h?null:_===c?p:p=n(c=_,a)}}function i2(t,n,a){var c,h,p;return function(){var _=tl(this,t),o=a(this),b=o+"";return o==null&&(b=o=(this.style.removeProperty(t),tl(this,t))),_===b?null:_===c&&b===h?p:(h=b,p=n(c=_,o))}}function n2(t,n){var a,c,h,p="style."+n,_="end."+p,o;return function(){var b=Ma(this,t),S=b.on,E=b.value[p]==null?o||(o=K_(n)):void 0;(S!==a||h!==E)&&(c=(a=S).copy()).on(_,h=E),b.on=c}}function r2(t,n,a){var c=(t+="")=="transform"?ow:X_;return n==null?this.styleTween(t,e2(t,c)).on("end.style."+t,K_(t)):typeof n=="function"?this.styleTween(t,i2(t,c,up(this,"style."+t,n))).each(n2(this._id,t)):this.styleTween(t,t2(t,c,n),a).on("end.style."+t,null)}function a2(t,n,a){return function(c){this.style.setProperty(t,n.call(this,c),a)}}function s2(t,n,a){var c,h;function p(){var _=n.apply(this,arguments);return _!==h&&(c=(h=_)&&a2(t,_,a)),c}return p._value=n,p}function o2(t,n,a){var c="style."+(t+="");if(arguments.length<2)return(c=this.tween(c))&&c._value;if(n==null)return this.tween(c,null);if(typeof n!="function")throw new Error;return this.tween(c,s2(t,n,a??""))}function l2(t){return function(){this.textContent=t}}function c2(t){return function(){var n=t(this);this.textContent=n??""}}function u2(t){return this.tween("text",typeof t=="function"?c2(up(this,"text",t)):l2(t==null?"":t+""))}function h2(t){return function(n){this.textContent=t.call(this,n)}}function f2(t){var n,a;function c(){var h=t.apply(this,arguments);return h!==a&&(n=(a=h)&&h2(h)),n}return c._value=t,c}function p2(t){var n="text";if(arguments.length<1)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;return this.tween(n,f2(t))}function d2(){for(var t=this._name,n=this._id,a=J_(),c=this._groups,h=c.length,p=0;p<h;++p)for(var _=c[p],o=_.length,b,S=0;S<o;++S)if(b=_[S]){var E=fa(b,n);sh(b,t,a,S,_,{time:E.time+E.delay+E.duration,delay:0,duration:E.duration,ease:E.ease})}return new es(c,this._parents,t,a)}function m2(){var t,n,a=this,c=a._id,h=a.size();return new Promise(function(p,_){var o={value:_},b={value:function(){--h===0&&p()}};a.each(function(){var S=Ma(this,c),E=S.on;E!==t&&(n=(t=E).copy(),n._.cancel.push(o),n._.interrupt.push(o),n._.end.push(b)),S.on=n}),h===0&&p()})}var g2=0;function es(t,n,a,c){this._groups=t,this._parents=n,this._name=a,this._id=c}function J_(){return++g2}var Qa=vc.prototype;es.prototype={constructor:es,select:Jw,selectAll:Yw,selectChild:Qa.selectChild,selectChildren:Qa.selectChildren,filter:qw,merge:Gw,selection:$w,transition:d2,call:Qa.call,nodes:Qa.nodes,node:Qa.node,size:Qa.size,empty:Qa.empty,each:Qa.each,on:Ww,attr:Cw,attrTween:zw,style:r2,styleTween:o2,text:u2,textTween:p2,remove:Kw,tween:xw,delay:Rw,duration:Ow,ease:Nw,easeVarying:Vw,end:m2,[Symbol.iterator]:Qa[Symbol.iterator]};function _2(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var y2={time:null,delay:0,duration:250,ease:_2};function v2(t,n){for(var a;!(a=t.__transition)||!(a=a[n]);)if(!(t=t.parentNode))throw new Error(`transition ${n} not found`);return a}function x2(t){var n,a;t instanceof es?(n=t._id,t=t._name):(n=J_(),(a=y2).time=lp(),t=t==null?null:t+"");for(var c=this._groups,h=c.length,p=0;p<h;++p)for(var _=c[p],o=_.length,b,S=0;S<o;++S)(b=_[S])&&sh(b,t,n,S,_,a||v2(b,n));return new es(c,this._parents,t,n)}vc.prototype.interrupt=_w;vc.prototype.transition=x2;function b2(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}function w2(t,n){return fetch(t,n).then(b2)}function T2(t){return function(n,a,c){return arguments.length===2&&typeof a=="function"&&(c=a,a=void 0),w2(n,a).then(function(h){return t(h,c)})}}var Nr=T2(g_);function k2(t){const n=+this._x.call(null,t),a=+this._y.call(null,t);return Y_(this.cover(n,a),n,a,t)}function Y_(t,n,a,c){if(isNaN(n)||isNaN(a))return t;var h,p=t._root,_={data:c},o=t._x0,b=t._y0,S=t._x1,E=t._y1,P,k,L,j,q,J,ee,ge;if(!p)return t._root=_,t;for(;p.length;)if((q=n>=(P=(o+S)/2))?o=P:S=P,(J=a>=(k=(b+E)/2))?b=k:E=k,h=p,!(p=p[ee=J<<1|q]))return h[ee]=_,t;if(L=+t._x.call(null,p.data),j=+t._y.call(null,p.data),n===L&&a===j)return _.next=p,h?h[ee]=_:t._root=_,t;do h=h?h[ee]=new Array(4):t._root=new Array(4),(q=n>=(P=(o+S)/2))?o=P:S=P,(J=a>=(k=(b+E)/2))?b=k:E=k;while((ee=J<<1|q)===(ge=(j>=k)<<1|L>=P));return h[ge]=p,h[ee]=_,t}function S2(t){var n,a,c=t.length,h,p,_=new Array(c),o=new Array(c),b=1/0,S=1/0,E=-1/0,P=-1/0;for(a=0;a<c;++a)isNaN(h=+this._x.call(null,n=t[a]))||isNaN(p=+this._y.call(null,n))||(_[a]=h,o[a]=p,h<b&&(b=h),h>E&&(E=h),p<S&&(S=p),p>P&&(P=p));if(b>E||S>P)return this;for(this.cover(b,S).cover(E,P),a=0;a<c;++a)Y_(this,_[a],o[a],t[a]);return this}function E2(t,n){if(isNaN(t=+t)||isNaN(n=+n))return this;var a=this._x0,c=this._y0,h=this._x1,p=this._y1;if(isNaN(a))h=(a=Math.floor(t))+1,p=(c=Math.floor(n))+1;else{for(var _=h-a||1,o=this._root,b,S;a>t||t>=h||c>n||n>=p;)switch(S=(n<c)<<1|t<a,b=new Array(4),b[S]=o,o=b,_*=2,S){case 0:h=a+_,p=c+_;break;case 1:a=h-_,p=c+_;break;case 2:h=a+_,c=p-_;break;case 3:a=h-_,c=p-_;break}this._root&&this._root.length&&(this._root=o)}return this._x0=a,this._y0=c,this._x1=h,this._y1=p,this}function C2(){var t=[];return this.visit(function(n){if(!n.length)do t.push(n.data);while(n=n.next)}),t}function A2(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function hr(t,n,a,c,h){this.node=t,this.x0=n,this.y0=a,this.x1=c,this.y1=h}function I2(t,n,a){var c,h=this._x0,p=this._y0,_,o,b,S,E=this._x1,P=this._y1,k=[],L=this._root,j,q;for(L&&k.push(new hr(L,h,p,E,P)),a==null?a=1/0:(h=t-a,p=n-a,E=t+a,P=n+a,a*=a);j=k.pop();)if(!(!(L=j.node)||(_=j.x0)>E||(o=j.y0)>P||(b=j.x1)<h||(S=j.y1)<p))if(L.length){var J=(_+b)/2,ee=(o+S)/2;k.push(new hr(L[3],J,ee,b,S),new hr(L[2],_,ee,J,S),new hr(L[1],J,o,b,ee),new hr(L[0],_,o,J,ee)),(q=(n>=ee)<<1|t>=J)&&(j=k[k.length-1],k[k.length-1]=k[k.length-1-q],k[k.length-1-q]=j)}else{var ge=t-+this._x.call(null,L.data),_e=n-+this._y.call(null,L.data),Y=ge*ge+_e*_e;if(Y<a){var le=Math.sqrt(a=Y);h=t-le,p=n-le,E=t+le,P=n+le,c=L.data}}return c}function M2(t){if(isNaN(E=+this._x.call(null,t))||isNaN(P=+this._y.call(null,t)))return this;var n,a=this._root,c,h,p,_=this._x0,o=this._y0,b=this._x1,S=this._y1,E,P,k,L,j,q,J,ee;if(!a)return this;if(a.length)for(;;){if((j=E>=(k=(_+b)/2))?_=k:b=k,(q=P>=(L=(o+S)/2))?o=L:S=L,n=a,!(a=a[J=q<<1|j]))return this;if(!a.length)break;(n[J+1&3]||n[J+2&3]||n[J+3&3])&&(c=n,ee=J)}for(;a.data!==t;)if(h=a,!(a=a.next))return this;return(p=a.next)&&delete a.next,h?(p?h.next=p:delete h.next,this):n?(p?n[J]=p:delete n[J],(a=n[0]||n[1]||n[2]||n[3])&&a===(n[3]||n[2]||n[1]||n[0])&&!a.length&&(c?c[ee]=a:this._root=a),this):(this._root=p,this)}function P2(t){for(var n=0,a=t.length;n<a;++n)this.remove(t[n]);return this}function z2(){return this._root}function D2(){var t=0;return this.visit(function(n){if(!n.length)do++t;while(n=n.next)}),t}function L2(t){var n=[],a,c=this._root,h,p,_,o,b;for(c&&n.push(new hr(c,this._x0,this._y0,this._x1,this._y1));a=n.pop();)if(!t(c=a.node,p=a.x0,_=a.y0,o=a.x1,b=a.y1)&&c.length){var S=(p+o)/2,E=(_+b)/2;(h=c[3])&&n.push(new hr(h,S,E,o,b)),(h=c[2])&&n.push(new hr(h,p,E,S,b)),(h=c[1])&&n.push(new hr(h,S,_,o,E)),(h=c[0])&&n.push(new hr(h,p,_,S,E))}return this}function R2(t){var n=[],a=[],c;for(this._root&&n.push(new hr(this._root,this._x0,this._y0,this._x1,this._y1));c=n.pop();){var h=c.node;if(h.length){var p,_=c.x0,o=c.y0,b=c.x1,S=c.y1,E=(_+b)/2,P=(o+S)/2;(p=h[0])&&n.push(new hr(p,_,o,E,P)),(p=h[1])&&n.push(new hr(p,E,o,b,P)),(p=h[2])&&n.push(new hr(p,_,P,E,S)),(p=h[3])&&n.push(new hr(p,E,P,b,S))}a.push(c)}for(;c=a.pop();)t(c.node,c.x0,c.y0,c.x1,c.y1);return this}function B2(t){return t[0]}function F2(t){return arguments.length?(this._x=t,this):this._x}function O2(t){return t[1]}function U2(t){return arguments.length?(this._y=t,this):this._y}function Q_(t,n,a){var c=new hp(n??B2,a??O2,NaN,NaN,NaN,NaN);return t==null?c:c.addAll(t)}function hp(t,n,a,c,h,p){this._x=t,this._y=n,this._x0=a,this._y0=c,this._x1=h,this._y1=p,this._root=void 0}function vm(t){for(var n={data:t.data},a=n;t=t.next;)a=a.next={data:t.data};return n}var gr=Q_.prototype=hp.prototype;gr.copy=function(){var t=new hp(this._x,this._y,this._x0,this._y0,this._x1,this._y1),n=this._root,a,c;if(!n)return t;if(!n.length)return t._root=vm(n),t;for(a=[{source:n,target:t._root=new Array(4)}];n=a.pop();)for(var h=0;h<4;++h)(c=n.source[h])&&(c.length?a.push({source:c,target:n.target[h]=new Array(4)}):n.target[h]=vm(c));return t};gr.add=k2;gr.addAll=S2;gr.cover=E2;gr.data=C2;gr.extent=A2;gr.find=I2;gr.remove=M2;gr.removeAll=P2;gr.root=z2;gr.size=D2;gr.visit=L2;gr.visitAfter=R2;gr.x=F2;gr.y=U2;function N2(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Ku(t,n){if((a=(t=n?t.toExponential(n-1):t.toExponential()).indexOf("e"))<0)return null;var a,c=t.slice(0,a);return[c.length>1?c[0]+c.slice(2):c,+t.slice(a+1)]}function nl(t){return t=Ku(Math.abs(t)),t?t[1]:NaN}function j2(t,n){return function(a,c){for(var h=a.length,p=[],_=0,o=t[0],b=0;h>0&&o>0&&(b+o+1>c&&(o=Math.max(1,c-b)),p.push(a.substring(h-=o,h+o)),!((b+=o+1)>c));)o=t[_=(_+1)%t.length];return p.reverse().join(n)}}function V2(t){return function(n){return n.replace(/[0-9]/g,function(a){return t[+a]})}}var q2=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ju(t){if(!(n=q2.exec(t)))throw new Error("invalid format: "+t);var n;return new fp({fill:n[1],align:n[2],sign:n[3],symbol:n[4],zero:n[5],width:n[6],comma:n[7],precision:n[8]&&n[8].slice(1),trim:n[9],type:n[10]})}Ju.prototype=fp.prototype;function fp(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}fp.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function G2(t){e:for(var n=t.length,a=1,c=-1,h;a<n;++a)switch(t[a]){case".":c=h=a;break;case"0":c===0&&(c=a),h=a;break;default:if(!+t[a])break e;c>0&&(c=0);break}return c>0?t.slice(0,c)+t.slice(h+1):t}var $_;function Z2(t,n){var a=Ku(t,n);if(!a)return t+"";var c=a[0],h=a[1],p=h-($_=Math.max(-8,Math.min(8,Math.floor(h/3)))*3)+1,_=c.length;return p===_?c:p>_?c+new Array(p-_+1).join("0"):p>0?c.slice(0,p)+"."+c.slice(p):"0."+new Array(1-p).join("0")+Ku(t,Math.max(0,n+p-1))[0]}function xm(t,n){var a=Ku(t,n);if(!a)return t+"";var c=a[0],h=a[1];return h<0?"0."+new Array(-h).join("0")+c:c.length>h+1?c.slice(0,h+1)+"."+c.slice(h+1):c+new Array(h-c.length+2).join("0")}const bm={"%":(t,n)=>(t*100).toFixed(n),b:t=>Math.round(t).toString(2),c:t=>t+"",d:N2,e:(t,n)=>t.toExponential(n),f:(t,n)=>t.toFixed(n),g:(t,n)=>t.toPrecision(n),o:t=>Math.round(t).toString(8),p:(t,n)=>xm(t*100,n),r:xm,s:Z2,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function wm(t){return t}var Tm=Array.prototype.map,km=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function H2(t){var n=t.grouping===void 0||t.thousands===void 0?wm:j2(Tm.call(t.grouping,Number),t.thousands+""),a=t.currency===void 0?"":t.currency[0]+"",c=t.currency===void 0?"":t.currency[1]+"",h=t.decimal===void 0?".":t.decimal+"",p=t.numerals===void 0?wm:V2(Tm.call(t.numerals,String)),_=t.percent===void 0?"%":t.percent+"",o=t.minus===void 0?"−":t.minus+"",b=t.nan===void 0?"NaN":t.nan+"";function S(P){P=Ju(P);var k=P.fill,L=P.align,j=P.sign,q=P.symbol,J=P.zero,ee=P.width,ge=P.comma,_e=P.precision,Y=P.trim,le=P.type;le==="n"?(ge=!0,le="g"):bm[le]||(_e===void 0&&(_e=12),Y=!0,le="g"),(J||k==="0"&&L==="=")&&(J=!0,k="0",L="=");var ie=q==="$"?a:q==="#"&&/[boxX]/.test(le)?"0"+le.toLowerCase():"",ke=q==="$"?c:/[%p]/.test(le)?_:"",Je=bm[le],ve=/[defgprs%]/.test(le);_e=_e===void 0?6:/[gprs]/.test(le)?Math.max(1,Math.min(21,_e)):Math.max(0,Math.min(20,_e));function pe(Fe){var $e=ie,ct=ke,We,mt,xe;if(le==="c")ct=Je(Fe)+ct,Fe="";else{Fe=+Fe;var Ne=Fe<0||1/Fe<0;if(Fe=isNaN(Fe)?b:Je(Math.abs(Fe),_e),Y&&(Fe=G2(Fe)),Ne&&+Fe==0&&j!=="+"&&(Ne=!1),$e=(Ne?j==="("?j:o:j==="-"||j==="("?"":j)+$e,ct=(le==="s"?km[8+$_/3]:"")+ct+(Ne&&j==="("?")":""),ve){for(We=-1,mt=Fe.length;++We<mt;)if(xe=Fe.charCodeAt(We),48>xe||xe>57){ct=(xe===46?h+Fe.slice(We+1):Fe.slice(We))+ct,Fe=Fe.slice(0,We);break}}}ge&&!J&&(Fe=n(Fe,1/0));var Le=$e.length+Fe.length+ct.length,ut=Le<ee?new Array(ee-Le+1).join(k):"";switch(ge&&J&&(Fe=n(ut+Fe,ut.length?ee-ct.length:1/0),ut=""),L){case"<":Fe=$e+Fe+ct+ut;break;case"=":Fe=$e+ut+Fe+ct;break;case"^":Fe=ut.slice(0,Le=ut.length>>1)+$e+Fe+ct+ut.slice(Le);break;default:Fe=ut+$e+Fe+ct;break}return p(Fe)}return pe.toString=function(){return P+""},pe}function E(P,k){var L=S((P=Ju(P),P.type="f",P)),j=Math.max(-8,Math.min(8,Math.floor(nl(k)/3)))*3,q=Math.pow(10,-j),J=km[8+j/3];return function(ee){return L(q*ee)+J}}return{format:S,formatPrefix:E}}var Su,pp,ey;W2({thousands:",",grouping:[3],currency:["$",""]});function W2(t){return Su=H2(t),pp=Su.format,ey=Su.formatPrefix,Su}function X2(t){return Math.max(0,-nl(Math.abs(t)))}function K2(t,n){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(nl(n)/3)))*3-nl(Math.abs(t)))}function J2(t,n){return t=Math.abs(t),n=Math.abs(n)-t,Math.max(0,nl(n)-nl(t))+1}function Y2(t){var n=0,a=t.children,c=a&&a.length;if(!c)n=1;else for(;--c>=0;)n+=a[c].value;t.value=n}function Q2(){return this.eachAfter(Y2)}function $2(t,n){let a=-1;for(const c of this)t.call(n,c,++a,this);return this}function eT(t,n){for(var a=this,c=[a],h,p,_=-1;a=c.pop();)if(t.call(n,a,++_,this),h=a.children)for(p=h.length-1;p>=0;--p)c.push(h[p]);return this}function tT(t,n){for(var a=this,c=[a],h=[],p,_,o,b=-1;a=c.pop();)if(h.push(a),p=a.children)for(_=0,o=p.length;_<o;++_)c.push(p[_]);for(;a=h.pop();)t.call(n,a,++b,this);return this}function iT(t,n){let a=-1;for(const c of this)if(t.call(n,c,++a,this))return c}function nT(t){return this.eachAfter(function(n){for(var a=+t(n.data)||0,c=n.children,h=c&&c.length;--h>=0;)a+=c[h].value;n.value=a})}function rT(t){return this.eachBefore(function(n){n.children&&n.children.sort(t)})}function aT(t){for(var n=this,a=sT(n,t),c=[n];n!==a;)n=n.parent,c.push(n);for(var h=c.length;t!==a;)c.splice(h,0,t),t=t.parent;return c}function sT(t,n){if(t===n)return t;var a=t.ancestors(),c=n.ancestors(),h=null;for(t=a.pop(),n=c.pop();t===n;)h=t,t=a.pop(),n=c.pop();return h}function oT(){for(var t=this,n=[t];t=t.parent;)n.push(t);return n}function lT(){return Array.from(this)}function cT(){var t=[];return this.eachBefore(function(n){n.children||t.push(n)}),t}function uT(){var t=this,n=[];return t.each(function(a){a!==t&&n.push({source:a.parent,target:a})}),n}function*hT(){var t=this,n,a=[t],c,h,p;do for(n=a.reverse(),a=[];t=n.pop();)if(yield t,c=t.children)for(h=0,p=c.length;h<p;++h)a.push(c[h]);while(a.length)}function dp(t,n){t instanceof Map?(t=[void 0,t],n===void 0&&(n=dT)):n===void 0&&(n=pT);for(var a=new pc(t),c,h=[a],p,_,o,b;c=h.pop();)if((_=n(c.data))&&(b=(_=Array.from(_)).length))for(c.children=_,o=b-1;o>=0;--o)h.push(p=_[o]=new pc(_[o])),p.parent=c,p.depth=c.depth+1;return a.eachBefore(ty)}function fT(){return dp(this).eachBefore(mT)}function pT(t){return t.children}function dT(t){return Array.isArray(t)?t[1]:null}function mT(t){t.data.value!==void 0&&(t.value=t.data.value),t.data=t.data.data}function ty(t){var n=0;do t.height=n;while((t=t.parent)&&t.height<++n)}function pc(t){this.data=t,this.depth=this.height=0,this.parent=null}pc.prototype=dp.prototype={constructor:pc,count:Q2,each:$2,eachAfter:tT,eachBefore:eT,find:iT,sum:nT,sort:rT,path:aT,ancestors:oT,descendants:lT,leaves:cT,links:uT,copy:fT,[Symbol.iterator]:hT};function vf(t){return t==null?null:iy(t)}function iy(t){if(typeof t!="function")throw new Error;return t}function Ql(){return 0}function $l(t){return function(){return t}}function gT(t){t.x0=Math.round(t.x0),t.y0=Math.round(t.y0),t.x1=Math.round(t.x1),t.y1=Math.round(t.y1)}function _T(t,n,a,c,h){for(var p=t.children,_,o=-1,b=p.length,S=t.value&&(c-n)/t.value;++o<b;)_=p[o],_.y0=a,_.y1=h,_.x0=n,_.x1=n+=_.value*S}var yT={depth:-1},Sm={},xf={};function vT(t){return t.id}function xT(t){return t.parentId}function bT(){var t=vT,n=xT,a;function c(h){var p=Array.from(h),_=t,o=n,b,S,E,P,k,L,j,q,J=new Map;if(a!=null){const ee=p.map((Y,le)=>wT(a(Y,le,h))),ge=ee.map(Em),_e=new Set(ee).add("");for(const Y of ge)_e.has(Y)||(_e.add(Y),ee.push(Y),ge.push(Em(Y)),p.push(xf));_=(Y,le)=>ee[le],o=(Y,le)=>ge[le]}for(E=0,b=p.length;E<b;++E)S=p[E],L=p[E]=new pc(S),(j=_(S,E,h))!=null&&(j+="")&&(q=L.id=j,J.set(q,J.has(q)?Sm:L)),(j=o(S,E,h))!=null&&(j+="")&&(L.parent=j);for(E=0;E<b;++E)if(L=p[E],j=L.parent){if(k=J.get(j),!k)throw new Error("missing: "+j);if(k===Sm)throw new Error("ambiguous: "+j);k.children?k.children.push(L):k.children=[L],L.parent=k}else{if(P)throw new Error("multiple roots");P=L}if(!P)throw new Error("no root");if(a!=null){for(;P.data===xf&&P.children.length===1;)P=P.children[0],--b;for(let ee=p.length-1;ee>=0&&(L=p[ee],L.data===xf);--ee)L.data=null}if(P.parent=yT,P.eachBefore(function(ee){ee.depth=ee.parent.depth+1,--b}).eachBefore(ty),P.parent=null,b>0)throw new Error("cycle");return P}return c.id=function(h){return arguments.length?(t=vf(h),c):t},c.parentId=function(h){return arguments.length?(n=vf(h),c):n},c.path=function(h){return arguments.length?(a=vf(h),c):a},c}function wT(t){t=`${t}`;let n=t.length;return qf(t,n-1)&&!qf(t,n-2)&&(t=t.slice(0,-1)),t[0]==="/"?t:`/${t}`}function Em(t){let n=t.length;if(n<2)return"";for(;--n>1&&!qf(t,n););return t.slice(0,n)}function qf(t,n){if(t[n]==="/"){let a=0;for(;n>0&&t[--n]==="\\";)++a;if(!(a&1))return!0}return!1}function TT(t,n,a,c,h){for(var p=t.children,_,o=-1,b=p.length,S=t.value&&(h-a)/t.value;++o<b;)_=p[o],_.x0=n,_.x1=c,_.y0=a,_.y1=a+=_.value*S}var kT=(1+Math.sqrt(5))/2;function ST(t,n,a,c,h,p){for(var _=[],o=n.children,b,S,E=0,P=0,k=o.length,L,j,q=n.value,J,ee,ge,_e,Y,le,ie;E<k;){L=h-a,j=p-c;do J=o[P++].value;while(!J&&P<k);for(ee=ge=J,le=Math.max(j/L,L/j)/(q*t),ie=J*J*le,Y=Math.max(ge/ie,ie/ee);P<k;++P){if(J+=S=o[P].value,S<ee&&(ee=S),S>ge&&(ge=S),ie=J*J*le,_e=Math.max(ge/ie,ie/ee),_e>Y){J-=S;break}Y=_e}_.push(b={value:J,dice:L<j,children:o.slice(E,P)}),b.dice?_T(b,a,c,h,q?c+=j*J/q:p):TT(b,a,c,q?a+=L*J/q:h,p),q-=J,E=P}return _}const ET=function t(n){function a(c,h,p,_,o){ST(n,c,h,p,_,o)}return a.ratio=function(c){return t((c=+c)>1?c:1)},a}(kT);function Cm(){var t=ET,n=!1,a=1,c=1,h=[0],p=Ql,_=Ql,o=Ql,b=Ql,S=Ql;function E(k){return k.x0=k.y0=0,k.x1=a,k.y1=c,k.eachBefore(P),h=[0],n&&k.eachBefore(gT),k}function P(k){var L=h[k.depth],j=k.x0+L,q=k.y0+L,J=k.x1-L,ee=k.y1-L;J<j&&(j=J=(j+J)/2),ee<q&&(q=ee=(q+ee)/2),k.x0=j,k.y0=q,k.x1=J,k.y1=ee,k.children&&(L=h[k.depth+1]=p(k)/2,j+=S(k)-L,q+=_(k)-L,J-=o(k)-L,ee-=b(k)-L,J<j&&(j=J=(j+J)/2),ee<q&&(q=ee=(q+ee)/2),t(k,j,q,J,ee))}return E.round=function(k){return arguments.length?(n=!!k,E):n},E.size=function(k){return arguments.length?(a=+k[0],c=+k[1],E):[a,c]},E.tile=function(k){return arguments.length?(t=iy(k),E):t},E.padding=function(k){return arguments.length?E.paddingInner(k).paddingOuter(k):E.paddingInner()},E.paddingInner=function(k){return arguments.length?(p=typeof k=="function"?k:$l(+k),E):p},E.paddingOuter=function(k){return arguments.length?E.paddingTop(k).paddingRight(k).paddingBottom(k).paddingLeft(k):E.paddingTop()},E.paddingTop=function(k){return arguments.length?(_=typeof k=="function"?k:$l(+k),E):_},E.paddingRight=function(k){return arguments.length?(o=typeof k=="function"?k:$l(+k),E):o},E.paddingBottom=function(k){return arguments.length?(b=typeof k=="function"?k:$l(+k),E):b},E.paddingLeft=function(k){return arguments.length?(S=typeof k=="function"?k:$l(+k),E):S},E}function oh(t,n){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(n).domain(t);break}return this}const Am=Symbol("implicit");function Yu(){var t=new zf,n=[],a=[],c=Am;function h(p){let _=t.get(p);if(_===void 0){if(c!==Am)return c;t.set(p,_=n.push(p)-1)}return a[_%a.length]}return h.domain=function(p){if(!arguments.length)return n.slice();n=[],t=new zf;for(const _ of p)t.has(_)||t.set(_,n.push(_)-1);return h},h.range=function(p){return arguments.length?(a=Array.from(p),h):a.slice()},h.unknown=function(p){return arguments.length?(c=p,h):c},h.copy=function(){return Yu(n,a).unknown(c)},oh.apply(h,arguments),h}function co(){var t=Yu().unknown(void 0),n=t.domain,a=t.range,c=0,h=1,p,_,o=!1,b=0,S=0,E=.5;delete t.unknown;function P(){var k=n().length,L=h<c,j=L?h:c,q=L?c:h;p=(q-j)/Math.max(1,k-b+S*2),o&&(p=Math.floor(p)),j+=(q-j-p*(k-b))*E,_=p*(1-b),o&&(j=Math.round(j),_=Math.round(_));var J=Hv(k).map(function(ee){return j+p*ee});return a(L?J.reverse():J)}return t.domain=function(k){return arguments.length?(n(k),P()):n()},t.range=function(k){return arguments.length?([c,h]=k,c=+c,h=+h,P()):[c,h]},t.rangeRound=function(k){return[c,h]=k,c=+c,h=+h,o=!0,P()},t.bandwidth=function(){return _},t.step=function(){return p},t.round=function(k){return arguments.length?(o=!!k,P()):o},t.padding=function(k){return arguments.length?(b=Math.min(1,S=+k),P()):b},t.paddingInner=function(k){return arguments.length?(b=Math.min(1,k),P()):b},t.paddingOuter=function(k){return arguments.length?(S=+k,P()):S},t.align=function(k){return arguments.length?(E=Math.max(0,Math.min(1,k)),P()):E},t.copy=function(){return co(n(),[c,h]).round(o).paddingInner(b).paddingOuter(S).align(E)},oh.apply(P(),arguments)}function CT(t){return function(){return t}}function AT(t){return+t}var Im=[0,1];function Ca(t){return t}function Gf(t,n){return(n-=t=+t)?function(a){return(a-t)/n}:CT(isNaN(n)?NaN:.5)}function IT(t,n){var a;return t>n&&(a=t,t=n,n=a),function(c){return Math.max(t,Math.min(n,c))}}function MT(t,n,a){var c=t[0],h=t[1],p=n[0],_=n[1];return h<c?(c=Gf(h,c),p=a(_,p)):(c=Gf(c,h),p=a(p,_)),function(o){return p(c(o))}}function PT(t,n,a){var c=Math.min(t.length,n.length)-1,h=new Array(c),p=new Array(c),_=-1;for(t[c]<t[0]&&(t=t.slice().reverse(),n=n.slice().reverse());++_<c;)h[_]=Gf(t[_],t[_+1]),p[_]=a(n[_],n[_+1]);return function(o){var b=Rv(t,o,1,c)-1;return p[b](h[b](o))}}function ny(t,n){return n.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function ry(){var t=Im,n=Im,a=op,c,h,p,_=Ca,o,b,S;function E(){var k=Math.min(t.length,n.length);return _!==Ca&&(_=IT(t[0],t[k-1])),o=k>2?PT:MT,b=S=null,P}function P(k){return k==null||isNaN(k=+k)?p:(b||(b=o(t.map(c),n,a)))(c(_(k)))}return P.invert=function(k){return _(h((S||(S=o(n,t.map(c),ua)))(k)))},P.domain=function(k){return arguments.length?(t=Array.from(k,AT),E()):t.slice()},P.range=function(k){return arguments.length?(n=Array.from(k),E()):n.slice()},P.rangeRound=function(k){return n=Array.from(k),a=rw,E()},P.clamp=function(k){return arguments.length?(_=k?!0:Ca,E()):_!==Ca},P.interpolate=function(k){return arguments.length?(a=k,E()):a},P.unknown=function(k){return arguments.length?(p=k,P):p},function(k,L){return c=k,h=L,E()}}function zT(){return ry()(Ca,Ca)}function DT(t,n,a,c){var h=Zv(t,n,a),p;switch(c=Ju(c??",f"),c.type){case"s":{var _=Math.max(Math.abs(t),Math.abs(n));return c.precision==null&&!isNaN(p=K2(h,_))&&(c.precision=p),ey(c,_)}case"":case"e":case"g":case"p":case"r":{c.precision==null&&!isNaN(p=J2(h,Math.max(Math.abs(t),Math.abs(n))))&&(c.precision=p-(c.type==="e"));break}case"f":case"%":{c.precision==null&&!isNaN(p=X2(h))&&(c.precision=p-(c.type==="%")*2);break}}return pp(c)}function ay(t){var n=t.domain;return t.ticks=function(a){var c=n();return Gv(c[0],c[c.length-1],a??10)},t.tickFormat=function(a,c){var h=n();return DT(h[0],h[h.length-1],a??10,c)},t.nice=function(a){a==null&&(a=10);var c=n(),h=0,p=c.length-1,_=c[h],o=c[p],b,S,E=10;for(o<_&&(S=_,_=o,o=S,S=h,h=p,p=S);E-- >0;){if(S=T_(_,o,a),S===b)return c[h]=_,c[p]=o,n(c);if(S>0)_=Math.floor(_/S)*S,o=Math.ceil(o/S)*S;else if(S<0)_=Math.ceil(_*S)/S,o=Math.floor(o*S)/S;else break;b=S}return t},t}function Ss(){var t=zT();return t.copy=function(){return ny(t,Ss())},oh.apply(t,arguments),ay(t)}function Mm(t){return function(n){return n<0?-Math.pow(-n,t):Math.pow(n,t)}}function LT(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function RT(t){return t<0?-t*t:t*t}function BT(t){var n=t(Ca,Ca),a=1;function c(){return a===1?t(Ca,Ca):a===.5?t(LT,RT):t(Mm(a),Mm(1/a))}return n.exponent=function(h){return arguments.length?(a=+h,c()):a},ay(n)}function sy(){var t=BT(ry());return t.copy=function(){return ny(t,sy()).exponent(t.exponent())},oh.apply(t,arguments),t}function FT(){return sy.apply(null,arguments).exponent(.5)}const bf=new Date,wf=new Date;function Pa(t,n,a,c){function h(p){return t(p=arguments.length===0?new Date:new Date(+p)),p}return h.floor=p=>(t(p=new Date(+p)),p),h.ceil=p=>(t(p=new Date(p-1)),n(p,1),t(p),p),h.round=p=>{const _=h(p),o=h.ceil(p);return p-_<o-p?_:o},h.offset=(p,_)=>(n(p=new Date(+p),_==null?1:Math.floor(_)),p),h.range=(p,_,o)=>{const b=[];if(p=h.ceil(p),o=o==null?1:Math.floor(o),!(p<_)||!(o>0))return b;let S;do b.push(S=new Date(+p)),n(p,o),t(p);while(S<p&&p<_);return b},h.filter=p=>Pa(_=>{if(_>=_)for(;t(_),!p(_);)_.setTime(_-1)},(_,o)=>{if(_>=_)if(o<0)for(;++o<=0;)for(;n(_,-1),!p(_););else for(;--o>=0;)for(;n(_,1),!p(_););}),a&&(h.count=(p,_)=>(bf.setTime(+p),wf.setTime(+_),t(bf),t(wf),Math.floor(a(bf,wf))),h.every=p=>(p=Math.floor(p),!isFinite(p)||!(p>0)?null:p>1?h.filter(c?_=>c(_)%p===0:_=>h.count(0,_)%p===0):h)),h}const OT=1e3,mp=OT*60,UT=mp*60,dc=UT*24,oy=dc*7,gp=Pa(t=>t.setHours(0,0,0,0),(t,n)=>t.setDate(t.getDate()+n),(t,n)=>(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*mp)/dc,t=>t.getDate()-1);gp.range;const _p=Pa(t=>{t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCDate(t.getUTCDate()+n)},(t,n)=>(n-t)/dc,t=>t.getUTCDate()-1);_p.range;const NT=Pa(t=>{t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCDate(t.getUTCDate()+n)},(t,n)=>(n-t)/dc,t=>Math.floor(t/dc));NT.range;function po(t){return Pa(n=>{n.setDate(n.getDate()-(n.getDay()+7-t)%7),n.setHours(0,0,0,0)},(n,a)=>{n.setDate(n.getDate()+a*7)},(n,a)=>(a-n-(a.getTimezoneOffset()-n.getTimezoneOffset())*mp)/oy)}const ly=po(0),Qu=po(1),jT=po(2),VT=po(3),rl=po(4),qT=po(5),GT=po(6);ly.range;Qu.range;jT.range;VT.range;rl.range;qT.range;GT.range;function mo(t){return Pa(n=>{n.setUTCDate(n.getUTCDate()-(n.getUTCDay()+7-t)%7),n.setUTCHours(0,0,0,0)},(n,a)=>{n.setUTCDate(n.getUTCDate()+a*7)},(n,a)=>(a-n)/oy)}const cy=mo(0),$u=mo(1),ZT=mo(2),HT=mo(3),al=mo(4),WT=mo(5),XT=mo(6);cy.range;$u.range;ZT.range;HT.range;al.range;WT.range;XT.range;const uo=Pa(t=>{t.setMonth(0,1),t.setHours(0,0,0,0)},(t,n)=>{t.setFullYear(t.getFullYear()+n)},(t,n)=>n.getFullYear()-t.getFullYear(),t=>t.getFullYear());uo.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:Pa(n=>{n.setFullYear(Math.floor(n.getFullYear()/t)*t),n.setMonth(0,1),n.setHours(0,0,0,0)},(n,a)=>{n.setFullYear(n.getFullYear()+a*t)});uo.range;const ho=Pa(t=>{t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCFullYear(t.getUTCFullYear()+n)},(t,n)=>n.getUTCFullYear()-t.getUTCFullYear(),t=>t.getUTCFullYear());ho.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:Pa(n=>{n.setUTCFullYear(Math.floor(n.getUTCFullYear()/t)*t),n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},(n,a)=>{n.setUTCFullYear(n.getUTCFullYear()+a*t)});ho.range;function Tf(t){if(0<=t.y&&t.y<100){var n=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return n.setFullYear(t.y),n}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function kf(t){if(0<=t.y&&t.y<100){var n=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return n.setUTCFullYear(t.y),n}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function ec(t,n,a){return{y:t,m:n,d:a,H:0,M:0,S:0,L:0}}function KT(t){var n=t.dateTime,a=t.date,c=t.time,h=t.periods,p=t.days,_=t.shortDays,o=t.months,b=t.shortMonths,S=tc(h),E=ic(h),P=tc(p),k=ic(p),L=tc(_),j=ic(_),q=tc(o),J=ic(o),ee=tc(b),ge=ic(b),_e={a:Ne,A:Le,b:ut,B:Ze,c:null,d:Bm,e:Bm,f:yk,g:Ak,G:Mk,H:mk,I:gk,j:_k,L:uy,m:vk,M:xk,p:qt,q:It,Q:Um,s:Nm,S:bk,u:wk,U:Tk,V:kk,w:Sk,W:Ek,x:null,X:null,y:Ck,Y:Ik,Z:Pk,"%":Om},Y={a:Ut,A:Kt,b:Jt,B:li,c:null,d:Fm,e:Fm,f:Rk,g:Zk,G:Wk,H:zk,I:Dk,j:Lk,L:fy,m:Bk,M:Fk,p:mi,q:Ji,Q:Um,s:Nm,S:Ok,u:Uk,U:Nk,V:jk,w:Vk,W:qk,x:null,X:null,y:Gk,Y:Hk,Z:Xk,"%":Om},le={a:pe,A:Fe,b:$e,B:ct,c:We,d:Lm,e:Lm,f:hk,g:Dm,G:zm,H:Rm,I:Rm,j:ok,L:uk,m:sk,M:lk,p:ve,q:ak,Q:pk,s:dk,S:ck,u:ek,U:tk,V:ik,w:$T,W:nk,x:mt,X:xe,y:Dm,Y:zm,Z:rk,"%":fk};_e.x=ie(a,_e),_e.X=ie(c,_e),_e.c=ie(n,_e),Y.x=ie(a,Y),Y.X=ie(c,Y),Y.c=ie(n,Y);function ie(rt,He){return function(Mt){var Qe=[],At=-1,ei=0,Ei=rt.length,ci,Nt,fi;for(Mt instanceof Date||(Mt=new Date(+Mt));++At<Ei;)rt.charCodeAt(At)===37&&(Qe.push(rt.slice(ei,At)),(Nt=Pm[ci=rt.charAt(++At)])!=null?ci=rt.charAt(++At):Nt=ci==="e"?" ":"0",(fi=He[ci])&&(ci=fi(Mt,Nt)),Qe.push(ci),ei=At+1);return Qe.push(rt.slice(ei,At)),Qe.join("")}}function ke(rt,He){return function(Mt){var Qe=ec(1900,void 0,1),At=Je(Qe,rt,Mt+="",0),ei,Ei;if(At!=Mt.length)return null;if("Q"in Qe)return new Date(Qe.Q);if("s"in Qe)return new Date(Qe.s*1e3+("L"in Qe?Qe.L:0));if(He&&!("Z"in Qe)&&(Qe.Z=0),"p"in Qe&&(Qe.H=Qe.H%12+Qe.p*12),Qe.m===void 0&&(Qe.m="q"in Qe?Qe.q:0),"V"in Qe){if(Qe.V<1||Qe.V>53)return null;"w"in Qe||(Qe.w=1),"Z"in Qe?(ei=kf(ec(Qe.y,0,1)),Ei=ei.getUTCDay(),ei=Ei>4||Ei===0?$u.ceil(ei):$u(ei),ei=_p.offset(ei,(Qe.V-1)*7),Qe.y=ei.getUTCFullYear(),Qe.m=ei.getUTCMonth(),Qe.d=ei.getUTCDate()+(Qe.w+6)%7):(ei=Tf(ec(Qe.y,0,1)),Ei=ei.getDay(),ei=Ei>4||Ei===0?Qu.ceil(ei):Qu(ei),ei=gp.offset(ei,(Qe.V-1)*7),Qe.y=ei.getFullYear(),Qe.m=ei.getMonth(),Qe.d=ei.getDate()+(Qe.w+6)%7)}else("W"in Qe||"U"in Qe)&&("w"in Qe||(Qe.w="u"in Qe?Qe.u%7:"W"in Qe?1:0),Ei="Z"in Qe?kf(ec(Qe.y,0,1)).getUTCDay():Tf(ec(Qe.y,0,1)).getDay(),Qe.m=0,Qe.d="W"in Qe?(Qe.w+6)%7+Qe.W*7-(Ei+5)%7:Qe.w+Qe.U*7-(Ei+6)%7);return"Z"in Qe?(Qe.H+=Qe.Z/100|0,Qe.M+=Qe.Z%100,kf(Qe)):Tf(Qe)}}function Je(rt,He,Mt,Qe){for(var At=0,ei=He.length,Ei=Mt.length,ci,Nt;At<ei;){if(Qe>=Ei)return-1;if(ci=He.charCodeAt(At++),ci===37){if(ci=He.charAt(At++),Nt=le[ci in Pm?He.charAt(At++):ci],!Nt||(Qe=Nt(rt,Mt,Qe))<0)return-1}else if(ci!=Mt.charCodeAt(Qe++))return-1}return Qe}function ve(rt,He,Mt){var Qe=S.exec(He.slice(Mt));return Qe?(rt.p=E.get(Qe[0].toLowerCase()),Mt+Qe[0].length):-1}function pe(rt,He,Mt){var Qe=L.exec(He.slice(Mt));return Qe?(rt.w=j.get(Qe[0].toLowerCase()),Mt+Qe[0].length):-1}function Fe(rt,He,Mt){var Qe=P.exec(He.slice(Mt));return Qe?(rt.w=k.get(Qe[0].toLowerCase()),Mt+Qe[0].length):-1}function $e(rt,He,Mt){var Qe=ee.exec(He.slice(Mt));return Qe?(rt.m=ge.get(Qe[0].toLowerCase()),Mt+Qe[0].length):-1}function ct(rt,He,Mt){var Qe=q.exec(He.slice(Mt));return Qe?(rt.m=J.get(Qe[0].toLowerCase()),Mt+Qe[0].length):-1}function We(rt,He,Mt){return Je(rt,n,He,Mt)}function mt(rt,He,Mt){return Je(rt,a,He,Mt)}function xe(rt,He,Mt){return Je(rt,c,He,Mt)}function Ne(rt){return _[rt.getDay()]}function Le(rt){return p[rt.getDay()]}function ut(rt){return b[rt.getMonth()]}function Ze(rt){return o[rt.getMonth()]}function qt(rt){return h[+(rt.getHours()>=12)]}function It(rt){return 1+~~(rt.getMonth()/3)}function Ut(rt){return _[rt.getUTCDay()]}function Kt(rt){return p[rt.getUTCDay()]}function Jt(rt){return b[rt.getUTCMonth()]}function li(rt){return o[rt.getUTCMonth()]}function mi(rt){return h[+(rt.getUTCHours()>=12)]}function Ji(rt){return 1+~~(rt.getUTCMonth()/3)}return{format:function(rt){var He=ie(rt+="",_e);return He.toString=function(){return rt},He},parse:function(rt){var He=ke(rt+="",!1);return He.toString=function(){return rt},He},utcFormat:function(rt){var He=ie(rt+="",Y);return He.toString=function(){return rt},He},utcParse:function(rt){var He=ke(rt+="",!0);return He.toString=function(){return rt},He}}}var Pm={"-":"",_:" ",0:"0"},On=/^\s*\d+/,JT=/^%/,YT=/[\\^$*+?|[\]().{}]/g;function Di(t,n,a){var c=t<0?"-":"",h=(c?-t:t)+"",p=h.length;return c+(p<a?new Array(a-p+1).join(n)+h:h)}function QT(t){return t.replace(YT,"\\$&")}function tc(t){return new RegExp("^(?:"+t.map(QT).join("|")+")","i")}function ic(t){return new Map(t.map((n,a)=>[n.toLowerCase(),a]))}function $T(t,n,a){var c=On.exec(n.slice(a,a+1));return c?(t.w=+c[0],a+c[0].length):-1}function ek(t,n,a){var c=On.exec(n.slice(a,a+1));return c?(t.u=+c[0],a+c[0].length):-1}function tk(t,n,a){var c=On.exec(n.slice(a,a+2));return c?(t.U=+c[0],a+c[0].length):-1}function ik(t,n,a){var c=On.exec(n.slice(a,a+2));return c?(t.V=+c[0],a+c[0].length):-1}function nk(t,n,a){var c=On.exec(n.slice(a,a+2));return c?(t.W=+c[0],a+c[0].length):-1}function zm(t,n,a){var c=On.exec(n.slice(a,a+4));return c?(t.y=+c[0],a+c[0].length):-1}function Dm(t,n,a){var c=On.exec(n.slice(a,a+2));return c?(t.y=+c[0]+(+c[0]>68?1900:2e3),a+c[0].length):-1}function rk(t,n,a){var c=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(n.slice(a,a+6));return c?(t.Z=c[1]?0:-(c[2]+(c[3]||"00")),a+c[0].length):-1}function ak(t,n,a){var c=On.exec(n.slice(a,a+1));return c?(t.q=c[0]*3-3,a+c[0].length):-1}function sk(t,n,a){var c=On.exec(n.slice(a,a+2));return c?(t.m=c[0]-1,a+c[0].length):-1}function Lm(t,n,a){var c=On.exec(n.slice(a,a+2));return c?(t.d=+c[0],a+c[0].length):-1}function ok(t,n,a){var c=On.exec(n.slice(a,a+3));return c?(t.m=0,t.d=+c[0],a+c[0].length):-1}function Rm(t,n,a){var c=On.exec(n.slice(a,a+2));return c?(t.H=+c[0],a+c[0].length):-1}function lk(t,n,a){var c=On.exec(n.slice(a,a+2));return c?(t.M=+c[0],a+c[0].length):-1}function ck(t,n,a){var c=On.exec(n.slice(a,a+2));return c?(t.S=+c[0],a+c[0].length):-1}function uk(t,n,a){var c=On.exec(n.slice(a,a+3));return c?(t.L=+c[0],a+c[0].length):-1}function hk(t,n,a){var c=On.exec(n.slice(a,a+6));return c?(t.L=Math.floor(c[0]/1e3),a+c[0].length):-1}function fk(t,n,a){var c=JT.exec(n.slice(a,a+1));return c?a+c[0].length:-1}function pk(t,n,a){var c=On.exec(n.slice(a));return c?(t.Q=+c[0],a+c[0].length):-1}function dk(t,n,a){var c=On.exec(n.slice(a));return c?(t.s=+c[0],a+c[0].length):-1}function Bm(t,n){return Di(t.getDate(),n,2)}function mk(t,n){return Di(t.getHours(),n,2)}function gk(t,n){return Di(t.getHours()%12||12,n,2)}function _k(t,n){return Di(1+gp.count(uo(t),t),n,3)}function uy(t,n){return Di(t.getMilliseconds(),n,3)}function yk(t,n){return uy(t,n)+"000"}function vk(t,n){return Di(t.getMonth()+1,n,2)}function xk(t,n){return Di(t.getMinutes(),n,2)}function bk(t,n){return Di(t.getSeconds(),n,2)}function wk(t){var n=t.getDay();return n===0?7:n}function Tk(t,n){return Di(ly.count(uo(t)-1,t),n,2)}function hy(t){var n=t.getDay();return n>=4||n===0?rl(t):rl.ceil(t)}function kk(t,n){return t=hy(t),Di(rl.count(uo(t),t)+(uo(t).getDay()===4),n,2)}function Sk(t){return t.getDay()}function Ek(t,n){return Di(Qu.count(uo(t)-1,t),n,2)}function Ck(t,n){return Di(t.getFullYear()%100,n,2)}function Ak(t,n){return t=hy(t),Di(t.getFullYear()%100,n,2)}function Ik(t,n){return Di(t.getFullYear()%1e4,n,4)}function Mk(t,n){var a=t.getDay();return t=a>=4||a===0?rl(t):rl.ceil(t),Di(t.getFullYear()%1e4,n,4)}function Pk(t){var n=t.getTimezoneOffset();return(n>0?"-":(n*=-1,"+"))+Di(n/60|0,"0",2)+Di(n%60,"0",2)}function Fm(t,n){return Di(t.getUTCDate(),n,2)}function zk(t,n){return Di(t.getUTCHours(),n,2)}function Dk(t,n){return Di(t.getUTCHours()%12||12,n,2)}function Lk(t,n){return Di(1+_p.count(ho(t),t),n,3)}function fy(t,n){return Di(t.getUTCMilliseconds(),n,3)}function Rk(t,n){return fy(t,n)+"000"}function Bk(t,n){return Di(t.getUTCMonth()+1,n,2)}function Fk(t,n){return Di(t.getUTCMinutes(),n,2)}function Ok(t,n){return Di(t.getUTCSeconds(),n,2)}function Uk(t){var n=t.getUTCDay();return n===0?7:n}function Nk(t,n){return Di(cy.count(ho(t)-1,t),n,2)}function py(t){var n=t.getUTCDay();return n>=4||n===0?al(t):al.ceil(t)}function jk(t,n){return t=py(t),Di(al.count(ho(t),t)+(ho(t).getUTCDay()===4),n,2)}function Vk(t){return t.getUTCDay()}function qk(t,n){return Di($u.count(ho(t)-1,t),n,2)}function Gk(t,n){return Di(t.getUTCFullYear()%100,n,2)}function Zk(t,n){return t=py(t),Di(t.getUTCFullYear()%100,n,2)}function Hk(t,n){return Di(t.getUTCFullYear()%1e4,n,4)}function Wk(t,n){var a=t.getUTCDay();return t=a>=4||a===0?al(t):al.ceil(t),Di(t.getUTCFullYear()%1e4,n,4)}function Xk(){return"+0000"}function Om(){return"%"}function Um(t){return+t}function Nm(t){return Math.floor(+t/1e3)}var Ho,lh,yp;Kk({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Kk(t){return Ho=KT(t),lh=Ho.format,yp=Ho.parse,Ho.utcFormat,Ho.utcParse,Ho}function Ko(t,n,a){this.k=t,this.x=n,this.y=a}Ko.prototype={constructor:Ko,scale:function(t){return t===1?this:new Ko(this.k*t,this.x,this.y)},translate:function(t,n){return t===0&n===0?this:new Ko(this.k,this.x+this.k*t,this.y+this.k*n)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};new Ko(1,0,0);Ko.prototype;function jm(t,n,a){const c=t.slice();return c[59]=n[a],c}function Vm(t,n,a){const c=t.slice();return c[59]=n[a],c}function Jk(t){let n,a,c;return{c(){n=Ae("h1"),n.textContent="Louisiana Locked Up:",a=Ge(),c=Ae("h1"),c.textContent="A Problem in Every Parish",O(n,"class","svelte-bpiw7r"),O(c,"class","sub svelte-bpiw7r")},m(h,p){fe(h,n,p),fe(h,a,p),fe(h,c,p)},p:Ft,d(h){h&&ce(n),h&&ce(a),h&&ce(c)}}}function qm(t){let n,a,c;function h(_){t[46](_)}let p={threshold:gS,$$slots:{foreground:[dS],background:[pS]},$$scope:{ctx:t}};return t[0].map!==void 0&&(p.id=t[0].map),n=new tv({props:p}),Bn.push(()=>Jf(n,"id",h)),{c(){nt(n.$$.fragment)},m(_,o){et(n,_,o),c=!0},p(_,o){const b={};o[0]&2147483647|o[1]&15|o[2]&4&&(b.$$scope={dirty:o,ctx:_}),!a&&o[0]&1&&(a=!0,b.id=_[0].map,Kf(()=>a=!1)),n.$set(b)},i(_){c||(Ie(n.$$.fragment,_),c=!0)},o(_){Re(n.$$.fragment,_),c=!1},d(_){tt(n,_)}}}function Yk(t){let n,a;return n=new er({props:{id:"rest-fill",type:"fill",paint:{"fill-color":"#fff","fill-opacity":.4}}}),{c(){nt(n.$$.fragment)},m(c,h){et(n,c,h),a=!0},p:Ft,i(c){a||(Ie(n.$$.fragment,c),a=!0)},o(c){Re(n.$$.fragment,c),a=!1},d(c){tt(n,c)}}}function Qk(t){let n,a;return n=new er({props:{id:"cad-fill",idKey:"county_key",type:"fill",paint:{"fill-color":"#97DFD1","fill-opacity":t[24]}}}),{c(){nt(n.$$.fragment)},m(c,h){et(n,c,h),a=!0},p(c,h){const p={};h[0]&16777216&&(p.paint={"fill-color":"#97DFD1","fill-opacity":c[24]}),n.$set(p)},i(c){a||(Ie(n.$$.fragment,c),a=!0)},o(c){Re(n.$$.fragment,c),a=!1},d(c){tt(n,c)}}}function $k(t){let n,a;return n=new er({props:{id:"sad-fill",idKey:"county_key",type:"line",paint:{"line-color":"#fff000","line-opacity":t[25],"line-width":5}}}),{c(){nt(n.$$.fragment)},m(c,h){et(n,c,h),a=!0},p(c,h){const p={};h[0]&33554432&&(p.paint={"line-color":"#fff000","line-opacity":c[25],"line-width":5}),n.$set(p)},i(c){a||(Ie(n.$$.fragment,c),a=!0)},o(c){Re(n.$$.fragment,c),a=!1},d(c){tt(n,c)}}}function eS(t){let n,a;return n=new er({props:{id:"outline-line",idKey:"fips",type:"line",paint:{"line-color":"#333","line-width":1.5}}}),{c(){nt(n.$$.fragment)},m(c,h){et(n,c,h),a=!0},p:Ft,i(c){a||(Ie(n.$$.fragment,c),a=!0)},o(c){Re(n.$$.fragment,c),a=!1},d(c){tt(n,c)}}}function tS(t){let n,a;return n=new mv({props:{content:t[18]&&t[21]=="pretrial"?`<strong>${t[2].parish.lookup[t[18]].name}</strong><br/>
                    On ${t[40](t[2].parish.lookup[t[18]].pretrial_date)},  ${io(t[2].parish.lookup[t[18]].total_jail_pretrial.toFixed(0))} people (${t[2].parish.lookup[t[18]].jail_pretrial_rate.toFixed(0)} per 10,000 residents) were detained pretrial in ${t[2].parish.lookup[t[18]].name} (population ${io(t[2].parish.lookup[t[18]].total_pop)}).`:t[18]&&t[21]=="admission"?`<strong>${t[2].parish.lookup[t[18]].name}</strong><br/>
                    In ${t[2].parish.lookup[t[18]].year},  ${t[2].parish.lookup[t[18]].prison_adm_count} people (${t[2].parish.lookup[t[18]].prison_adm_rate.toFixed(0)} per 10,000 residents) were sent to prison from ${t[2].parish.lookup[t[18]].name} (population ${io(t[2].parish.lookup[t[18]].total_pop)}).`:t[18]&&t[21]=="none"||t[18]&&t[21]=="over_1000_19"||t[18]&&t[21]=="over_1000_99"?`<strong>${t[2].parish.lookup[t[18]].name}</strong>`:""}}),{c(){nt(n.$$.fragment)},m(c,h){et(n,c,h),a=!0},p(c,h){const p={};h[0]&2359300&&(p.content=c[18]&&c[21]=="pretrial"?`<strong>${c[2].parish.lookup[c[18]].name}</strong><br/>
                    On ${c[40](c[2].parish.lookup[c[18]].pretrial_date)},  ${io(c[2].parish.lookup[c[18]].total_jail_pretrial.toFixed(0))} people (${c[2].parish.lookup[c[18]].jail_pretrial_rate.toFixed(0)} per 10,000 residents) were detained pretrial in ${c[2].parish.lookup[c[18]].name} (population ${io(c[2].parish.lookup[c[18]].total_pop)}).`:c[18]&&c[21]=="admission"?`<strong>${c[2].parish.lookup[c[18]].name}</strong><br/>
                    In ${c[2].parish.lookup[c[18]].year},  ${c[2].parish.lookup[c[18]].prison_adm_count} people (${c[2].parish.lookup[c[18]].prison_adm_rate.toFixed(0)} per 10,000 residents) were sent to prison from ${c[2].parish.lookup[c[18]].name} (population ${io(c[2].parish.lookup[c[18]].total_pop)}).`:c[18]&&c[21]=="none"||c[18]&&c[21]=="over_1000_19"||c[18]&&c[21]=="over_1000_99"?`<strong>${c[2].parish.lookup[c[18]].name}</strong>`:""),n.$set(p)},i(c){a||(Ie(n.$$.fragment,c),a=!0)},o(c){Re(n.$$.fragment,c),a=!1},d(c){tt(n,c)}}}function iS(t){let n,a,c,h;return n=new er({props:{id:"lad-fill",idKey:"code",colorKey:t[21]+"_color",outlineKey:t[21]+"_outline",data:t[1].parish.indicators,type:"fill",select:!0,selected:t[19],clickIgnore:!t[23],hover:!0,hovered:t[18],highlight:!0,highlighted:t[20],paint:{"fill-color":["case",["!=",["feature-state","color"],null],["feature-state","color"],"rgba(255, 255, 255, 0)"],"fill-opacity":1},$$slots:{default:[tS]},$$scope:{ctx:t}}}),n.$on("select",t[37]),n.$on("hover",t[39]),c=new er({props:{id:"lad-line",type:"line",paint:{"line-color":["case",["boolean",["feature-state","hovered"],!1],"#ff9000",["boolean",["feature-state","selected"],!1],"black",["boolean",["feature-state","highlighted"],!1],"black","#fff"],"line-width":["case",["boolean",["feature-state","hovered"],!1],2,["boolean",["feature-state","selected"],!1],2,["boolean",["feature-state","highlighted"],!1],3,.5]}}}),{c(){nt(n.$$.fragment),a=Ge(),nt(c.$$.fragment)},m(p,_){et(n,p,_),fe(p,a,_),et(c,p,_),h=!0},p(p,_){const o={};_[0]&2097152&&(o.colorKey=p[21]+"_color"),_[0]&2097152&&(o.outlineKey=p[21]+"_outline"),_[0]&2&&(o.data=p[1].parish.indicators),_[0]&524288&&(o.selected=p[19]),_[0]&8388608&&(o.clickIgnore=!p[23]),_[0]&262144&&(o.hovered=p[18]),_[0]&1048576&&(o.highlighted=p[20]),_[0]&2359300|_[2]&4&&(o.$$scope={dirty:_,ctx:p}),n.$set(o)},i(p){h||(Ie(n.$$.fragment,p),Ie(c.$$.fragment,p),h=!0)},o(p){Re(n.$$.fragment,p),Re(c.$$.fragment,p),h=!1},d(p){tt(n,p),p&&ce(a),tt(c,p)}}}function nS(t){let n,a,c,h;return n=new er({props:{id:"pad-fill",idKey:"geopin",type:"fill",paint:{"fill-color":"#ff3300","fill-opacity":t[26]}}}),c=new er({props:{id:"bldg-labels",type:"symbol",paint:{"text-halo-width":.75,"text-halo-color":"#fff","text-color":"#223476","text-opacity":t[26]},layout:{"text-field":["get","name"],visibility:"visible","text-variable-anchor":["top","bottom","left","right"],"text-radial-offset":.5,"text-size":14,"text-justify":"auto","text-padding":5}}}),{c(){nt(n.$$.fragment),a=Ge(),nt(c.$$.fragment)},m(p,_){et(n,p,_),fe(p,a,_),et(c,p,_),h=!0},p(p,_){const o={};_[0]&67108864&&(o.paint={"fill-color":"#ff3300","fill-opacity":p[26]}),n.$set(o);const b={};_[0]&67108864&&(b.paint={"text-halo-width":.75,"text-halo-color":"#fff","text-color":"#223476","text-opacity":p[26]}),c.$set(b)},i(p){h||(Ie(n.$$.fragment,p),Ie(c.$$.fragment,p),h=!0)},o(p){Re(n.$$.fragment,p),Re(c.$$.fragment,p),h=!1},d(p){tt(n,p),p&&ce(a),tt(c,p)}}}function rS(t){let n,a,c,h;return n=new er({props:{id:"ead-fill",idKey:"geopin",type:"fill",paint:{"fill-color":"#ff3300","fill-opacity":t[27]}}}),c=new er({props:{id:"bldg-labels2",type:"symbol",paint:{"text-halo-width":1,"text-halo-color":"#fff","text-color":"#223476","text-opacity":t[27]},layout:{"text-field":["get","name"],visibility:"visible","text-variable-anchor":["top","bottom","left","right"],"text-radial-offset":.5,"text-size":14,"text-justify":"auto","text-padding":5}}}),{c(){nt(n.$$.fragment),a=Ge(),nt(c.$$.fragment)},m(p,_){et(n,p,_),fe(p,a,_),et(c,p,_),h=!0},p(p,_){const o={};_[0]&134217728&&(o.paint={"fill-color":"#ff3300","fill-opacity":p[27]}),n.$set(o);const b={};_[0]&134217728&&(b.paint={"text-halo-width":1,"text-halo-color":"#fff","text-color":"#223476","text-opacity":p[27]}),c.$set(b)},i(p){h||(Ie(n.$$.fragment,p),Ie(c.$$.fragment,p),h=!0)},o(p){Re(n.$$.fragment,p),Re(c.$$.fragment,p),h=!1},d(p){tt(n,p),p&&ce(a),tt(c,p)}}}function aS(t){let n,a;return n=new er({props:{id:"facs",idKey:"uuid",data:t[3].facility.indicators,colorKey:t[22]+"_color",type:"circle",paint:{"circle-stroke-width":t[29],"circle-stroke-color":t[30],"circle-color":t[28],"circle-stroke-opacity":["get","GT_1000_beds_99"],"circle-radius":["step",["get","capacity"],5,100,7,500,9,1e3,11,2e3,13,5e3,10]}}}),{c(){nt(n.$$.fragment)},m(c,h){et(n,c,h),a=!0},p(c,h){const p={};h[0]&8&&(p.data=c[3].facility.indicators),h[0]&4194304&&(p.colorKey=c[22]+"_color"),h[0]&1879048192&&(p.paint={"circle-stroke-width":c[29],"circle-stroke-color":c[30],"circle-color":c[28],"circle-stroke-opacity":["get","GT_1000_beds_99"],"circle-radius":["step",["get","capacity"],5,100,7,500,9,1e3,11,2e3,13,5e3,10]}),n.$set(p)},i(c){a||(Ie(n.$$.fragment,c),a=!0)},o(c){Re(n.$$.fragment,c),a=!1},d(c){tt(n,c)}}}function sS(t){let n,a;return n=new er({props:{id:"gead-labels",type:"symbol",paint:{"text-halo-width":1,"text-halo-color":"#fff","text-color":"#333a5c","text-opacity":t[33]},layout:{"text-field":["get","facility_name"],visibility:"visible","text-variable-anchor":["top","bottom","left","right"],"text-radial-offset":1.5,"text-size":10,"text-justify":"left","text-padding":5,"text-allow-overlap":!(t[36]<420)}}}),{c(){nt(n.$$.fragment)},m(c,h){et(n,c,h),a=!0},p(c,h){const p={};h[1]&4&&(p.paint={"text-halo-width":1,"text-halo-color":"#fff","text-color":"#333a5c","text-opacity":c[33]}),n.$set(p)},i(c){a||(Ie(n.$$.fragment,c),a=!0)},o(c){Re(n.$$.fragment,c),a=!1},d(c){tt(n,c)}}}function oS(t){let n,a;return n=new er({props:{id:"grad-labels",type:"symbol",paint:{"text-halo-width":1,"text-halo-color":"#fff","text-color":"#333a5c","text-opacity":t[32]},layout:{"text-field":["get","facility_name"],visibility:"visible","text-anchor":"center","text-size":10,"text-justify":"left","text-padding":5,"text-allow-overlap":!(t[36]<420),"text-offset":[0,2]}}}),{c(){nt(n.$$.fragment)},m(c,h){et(n,c,h),a=!0},p(c,h){const p={};h[1]&2&&(p.paint={"text-halo-width":1,"text-halo-color":"#fff","text-color":"#333a5c","text-opacity":c[32]}),n.$set(p)},i(c){a||(Ie(n.$$.fragment,c),a=!0)},o(c){Re(n.$$.fragment,c),a=!1},d(c){tt(n,c)}}}function lS(t){let n,a;return n=new er({props:{id:"glad-labels",type:"symbol",paint:{"text-halo-width":1,"text-halo-color":"#fff","text-color":"#333a5c","text-opacity":t[31]},layout:{"text-field":["get","facility_name"],visibility:"visible","text-variable-anchor":["top","bottom","left","right"],"text-radial-offset":.5,"text-size":10,"text-justify":"left","text-padding":5,"text-allow-overlap":!(t[36]<420)}}}),{c(){nt(n.$$.fragment)},m(c,h){et(n,c,h),a=!0},p(c,h){const p={};h[1]&1&&(p.paint={"text-halo-width":1,"text-halo-color":"#fff","text-color":"#333a5c","text-opacity":c[31]}),n.$set(p)},i(c){a||(Ie(n.$$.fragment,c),a=!0)},o(c){Re(n.$$.fragment,c),a=!1},d(c){tt(n,c)}}}function cS(t){let n,a;return n=new er({props:{id:"gred-labels",type:"symbol",paint:{"text-halo-width":2.5,"text-halo-color":"#feffea","text-color":"#44986e","text-opacity":t[34]},layout:{"text-field":["get","rev"],visibility:"visible","text-variable-anchor":["top","bottom","left","right"],"text-radial-offset":.5,"text-size":["step",["get","est_doc_rev"],0,1,12,1e4,14,3e6,16,5e6,18,8e6,20,1e7,10],"text-justify":"left","text-padding":5}}}),{c(){nt(n.$$.fragment)},m(c,h){et(n,c,h),a=!0},p(c,h){const p={};h[1]&8&&(p.paint={"text-halo-width":2.5,"text-halo-color":"#feffea","text-color":"#44986e","text-opacity":c[34]}),n.$set(p)},i(c){a||(Ie(n.$$.fragment,c),a=!0)},o(c){Re(n.$$.fragment,c),a=!1},d(c){tt(n,c)}}}function uS(t){let n,a,c,h,p,_,o,b,S,E,P,k,L,j,q,J,ee,ge,_e,Y,le,ie,ke,Je;return n=new Ur({props:{id:"rest",type:"geojson",data:t[7],maxzoom:24,$$slots:{default:[Yk]},$$scope:{ctx:t}}}),c=new Ur({props:{id:"cad",type:"geojson",data:t[6],maxzoom:22,$$slots:{default:[Qk]},$$scope:{ctx:t}}}),p=new Ur({props:{id:"sad",type:"geojson",data:t[5],maxzoom:22,$$slots:{default:[$k]},$$scope:{ctx:t}}}),o=new Ur({props:{id:"outline",type:"geojson",data:t[11],maxzoom:22,$$slots:{default:[eS]},$$scope:{ctx:t}}}),S=new Ur({props:{id:"lad",type:"geojson",data:t[4],promoteId:"AREACD",maxzoom:22,$$slots:{default:[iS]},$$scope:{ctx:t}}}),P=new Ur({props:{id:"pad",type:"geojson",data:t[9],maxzoom:24,$$slots:{default:[nS]},$$scope:{ctx:t}}}),L=new Ur({props:{id:"ead",type:"geojson",data:t[10],maxzoom:24,$$slots:{default:[rS]},$$scope:{ctx:t}}}),q=new Ur({props:{id:"rad",type:"geojson",data:t[12],maxzoom:22,promoteId:"uuid",$$slots:{default:[aS]},$$scope:{ctx:t}}}),ee=new Ur({props:{id:"gead",type:"geojson",data:t[15],maxzoom:24,$$slots:{default:[sS]},$$scope:{ctx:t}}}),_e=new Ur({props:{id:"grad",type:"geojson",data:t[14],maxzoom:24,$$slots:{default:[oS]},$$scope:{ctx:t}}}),le=new Ur({props:{id:"glad",type:"geojson",data:t[13],maxzoom:24,$$slots:{default:[lS]},$$scope:{ctx:t}}}),ke=new Ur({props:{id:"gred",type:"geojson",data:t[16],maxzoom:24,$$slots:{default:[cS]},$$scope:{ctx:t}}}),{c(){nt(n.$$.fragment),a=Ge(),nt(c.$$.fragment),h=Ge(),nt(p.$$.fragment),_=Ge(),nt(o.$$.fragment),b=Ge(),nt(S.$$.fragment),E=Ge(),nt(P.$$.fragment),k=Ge(),nt(L.$$.fragment),j=Ge(),nt(q.$$.fragment),J=Ge(),nt(ee.$$.fragment),ge=Ge(),nt(_e.$$.fragment),Y=Ge(),nt(le.$$.fragment),ie=Ge(),nt(ke.$$.fragment)},m(ve,pe){et(n,ve,pe),fe(ve,a,pe),et(c,ve,pe),fe(ve,h,pe),et(p,ve,pe),fe(ve,_,pe),et(o,ve,pe),fe(ve,b,pe),et(S,ve,pe),fe(ve,E,pe),et(P,ve,pe),fe(ve,k,pe),et(L,ve,pe),fe(ve,j,pe),et(q,ve,pe),fe(ve,J,pe),et(ee,ve,pe),fe(ve,ge,pe),et(_e,ve,pe),fe(ve,Y,pe),et(le,ve,pe),fe(ve,ie,pe),et(ke,ve,pe),Je=!0},p(ve,pe){const Fe={};pe[0]&128&&(Fe.data=ve[7]),pe[2]&4&&(Fe.$$scope={dirty:pe,ctx:ve}),n.$set(Fe);const $e={};pe[0]&64&&($e.data=ve[6]),pe[0]&16777216|pe[2]&4&&($e.$$scope={dirty:pe,ctx:ve}),c.$set($e);const ct={};pe[0]&32&&(ct.data=ve[5]),pe[0]&33554432|pe[2]&4&&(ct.$$scope={dirty:pe,ctx:ve}),p.$set(ct);const We={};pe[0]&2048&&(We.data=ve[11]),pe[2]&4&&(We.$$scope={dirty:pe,ctx:ve}),o.$set(We);const mt={};pe[0]&16&&(mt.data=ve[4]),pe[0]&12320774|pe[2]&4&&(mt.$$scope={dirty:pe,ctx:ve}),S.$set(mt);const xe={};pe[0]&512&&(xe.data=ve[9]),pe[0]&67108864|pe[2]&4&&(xe.$$scope={dirty:pe,ctx:ve}),P.$set(xe);const Ne={};pe[0]&1024&&(Ne.data=ve[10]),pe[0]&134217728|pe[2]&4&&(Ne.$$scope={dirty:pe,ctx:ve}),L.$set(Ne);const Le={};pe[0]&4096&&(Le.data=ve[12]),pe[0]&1883242504|pe[2]&4&&(Le.$$scope={dirty:pe,ctx:ve}),q.$set(Le);const ut={};pe[0]&32768&&(ut.data=ve[15]),pe[1]&4|pe[2]&4&&(ut.$$scope={dirty:pe,ctx:ve}),ee.$set(ut);const Ze={};pe[0]&16384&&(Ze.data=ve[14]),pe[1]&2|pe[2]&4&&(Ze.$$scope={dirty:pe,ctx:ve}),_e.$set(Ze);const qt={};pe[0]&8192&&(qt.data=ve[13]),pe[1]&1|pe[2]&4&&(qt.$$scope={dirty:pe,ctx:ve}),le.$set(qt);const It={};pe[0]&65536&&(It.data=ve[16]),pe[1]&8|pe[2]&4&&(It.$$scope={dirty:pe,ctx:ve}),ke.$set(It)},i(ve){Je||(Ie(n.$$.fragment,ve),Ie(c.$$.fragment,ve),Ie(p.$$.fragment,ve),Ie(o.$$.fragment,ve),Ie(S.$$.fragment,ve),Ie(P.$$.fragment,ve),Ie(L.$$.fragment,ve),Ie(q.$$.fragment,ve),Ie(ee.$$.fragment,ve),Ie(_e.$$.fragment,ve),Ie(le.$$.fragment,ve),Ie(ke.$$.fragment,ve),Je=!0)},o(ve){Re(n.$$.fragment,ve),Re(c.$$.fragment,ve),Re(p.$$.fragment,ve),Re(o.$$.fragment,ve),Re(S.$$.fragment,ve),Re(P.$$.fragment,ve),Re(L.$$.fragment,ve),Re(q.$$.fragment,ve),Re(ee.$$.fragment,ve),Re(_e.$$.fragment,ve),Re(le.$$.fragment,ve),Re(ke.$$.fragment,ve),Je=!1},d(ve){tt(n,ve),ve&&ce(a),tt(c,ve),ve&&ce(h),tt(p,ve),ve&&ce(_),tt(o,ve),ve&&ce(b),tt(S,ve),ve&&ce(E),tt(P,ve),ve&&ce(k),tt(L,ve),ve&&ce(j),tt(q,ve),ve&&ce(J),tt(ee,ve),ve&&ce(ge),tt(_e,ve),ve&&ce(Y),tt(le,ve),ve&&ce(ie),tt(ke,ve)}}}function Gm(t){let n,a,c,h,p;return a=new ep({props:{style:zS,interactive:!1,location:{bounds:t[35].angola},$$slots:{default:[fS]},$$scope:{ctx:t}}}),{c(){n=Ae("div"),nt(a.$$.fragment),c=Ge(),h=Ae("div"),h.innerHTML=`<div id="angola-legend-hold" class="svelte-bpiw7r"><div class="line svelte-bpiw7r"></div>
                Louisiana plantations circa 1853</div>`,O(n,"id","angola"),O(n,"class","svelte-bpiw7r"),O(h,"id","angola-legend"),O(h,"class","svelte-bpiw7r")},m(_,o){fe(_,n,o),et(a,n,null),fe(_,c,o),fe(_,h,o),p=!0},p(_,o){const b={};o[0]&256|o[2]&4&&(b.$$scope={dirty:o,ctx:_}),a.$set(b)},i(_){p||(Ie(a.$$.fragment,_),p=!0)},o(_){Re(a.$$.fragment,_),p=!1},d(_){_&&ce(n),tt(a),_&&ce(c),_&&ce(h)}}}function hS(t){let n,a;return n=new er({props:{id:"chad-line",idKey:"county_key",type:"line",paint:{"line-color":"#97DFD1","line-opacity":.4,"line-width":3}}}),{c(){nt(n.$$.fragment)},m(c,h){et(n,c,h),a=!0},p:Ft,i(c){a||(Ie(n.$$.fragment,c),a=!0)},o(c){Re(n.$$.fragment,c),a=!1},d(c){tt(n,c)}}}function fS(t){let n,a;return n=new Ur({props:{id:"chad",type:"geojson",data:t[8],maxzoom:22,$$slots:{default:[hS]},$$scope:{ctx:t}}}),{c(){nt(n.$$.fragment)},m(c,h){et(n,c,h),a=!0},p(c,h){const p={};h[0]&256&&(p.data=c[8]),h[2]&4&&(p.$$scope={dirty:h,ctx:c}),n.$set(p)},i(c){a||(Ie(n.$$.fragment,c),a=!0)},o(c){Re(n.$$.fragment,c),a=!1},d(c){tt(n,c)}}}function Zm(t){let n,a,c,h,p,_=t[4].features,o=[];for(let b=0;b<_.length;b+=1)o[b]=Hm(jm(t,_,b));return{c(){n=Ae("div"),a=Ae("select"),c=Ae("option"),c.textContent="See data for each Parish.";for(let b=0;b<o.length;b+=1)o[b].c();c.__value=null,c.value=c.__value,O(a,"class","svelte-bpiw7r"),t[19]===void 0&&Es(()=>t[44].call(a)),O(n,"id","persistent-parish-data"),O(n,"class","svelte-bpiw7r")},m(b,S){fe(b,n,S),ue(n,a),ue(a,c);for(let E=0;E<o.length;E+=1)o[E].m(a,null);Qo(a,t[19]),h||(p=[Hi(a,"change",t[44]),Hi(a,"change",t[45])],h=!0)},p(b,S){if(S[0]&16){_=b[4].features;let E;for(E=0;E<_.length;E+=1){const P=jm(b,_,E);o[E]?o[E].p(P,S):(o[E]=Hm(P),o[E].c(),o[E].m(a,null))}for(;E<o.length;E+=1)o[E].d(1);o.length=_.length}S[0]&524304&&Qo(a,b[19])},d(b){b&&ce(n),Ia(o,b),h=!1,dr(p)}}}function Hm(t){let n,a=t[59].properties.AREANM+"",c,h,p;return{c(){n=Ae("option"),c=st(a),h=Ge(),n.__value=p=t[59].properties.AREANM,n.value=n.__value},m(_,o){fe(_,n,o),ue(n,c),ue(n,h)},p(_,o){o[0]&16&&a!==(a=_[59].properties.AREANM+"")&&hi(c,a),o[0]&16&&p!==(p=_[59].properties.AREANM)&&(n.__value=p,n.value=n.__value)},d(_){_&&ce(n)}}}function pS(t){let n,a,c,h,p,_,o,b,S,E;function P(q){t[43](q)}let k={style:PS,interactive:!1,location:{bounds:t[36]<420?t[35].lamobile:t[35].la},$$slots:{default:[uS]},$$scope:{ctx:t}};t[17]!==void 0&&(k.map=t[17]),h=new ep({props:k}),Bn.push(()=>Jf(h,"map",P));let L=t[0].map=="map12"&&Gm(t);b=new Cv({props:{lo:t[0].map}});let j=t[0].map!=="map15"&&Zm(t);return{c(){n=Ae("div"),a=Ae("figure"),c=Ae("div"),nt(h.$$.fragment),_=Ge(),L&&L.c(),o=Ge(),nt(b.$$.fragment),S=Ge(),j&&j.c(),O(c,"class","col-full height-full"),O(n,"slot","background")},m(q,J){fe(q,n,J),ue(n,a),ue(a,c),et(h,c,null),ue(c,_),L&&L.m(c,null),ue(n,o),et(b,n,null),ue(n,S),j&&j.m(n,null),E=!0},p(q,J){const ee={};J[0]&2147352318|J[1]&15|J[2]&4&&(ee.$$scope={dirty:J,ctx:q}),!p&&J[0]&131072&&(p=!0,ee.map=q[17],Kf(()=>p=!1)),h.$set(ee),q[0].map=="map12"?L?(L.p(q,J),J[0]&1&&Ie(L,1)):(L=Gm(q),L.c(),Ie(L,1),L.m(c,null)):L&&(Qn(),Re(L,1,1,()=>{L=null}),$n());const ge={};J[0]&1&&(ge.lo=q[0].map),b.$set(ge),q[0].map!=="map15"?j?j.p(q,J):(j=Zm(q),j.c(),j.m(n,null)):j&&(j.d(1),j=null)},i(q){E||(Ie(h.$$.fragment,q),Ie(L),Ie(b.$$.fragment,q),E=!0)},o(q){Re(h.$$.fragment,q),Re(L),Re(b.$$.fragment,q),E=!1},d(q){q&&ce(n),tt(h),L&&L.d(),tt(b),j&&j.d()}}}function Wm(t){let n,a,c,h,p,_=t[4].features,o=[];for(let b=0;b<_.length;b+=1)o[b]=Xm(Vm(t,_,b));return{c(){n=Ae("p"),a=Ae("select"),c=Ae("option"),c.textContent="Select one";for(let b=0;b<o.length;b+=1)o[b].c();c.__value=null,c.value=c.__value,O(a,"class","svelte-bpiw7r"),t[19]===void 0&&Es(()=>t[41].call(a))},m(b,S){fe(b,n,S),ue(n,a),ue(a,c);for(let E=0;E<o.length;E+=1)o[E].m(a,null);Qo(a,t[19]),h||(p=[Hi(a,"change",t[41]),Hi(a,"change",t[42])],h=!0)},p(b,S){if(S[0]&16){_=b[4].features;let E;for(E=0;E<_.length;E+=1){const P=Vm(b,_,E);o[E]?o[E].p(P,S):(o[E]=Xm(P),o[E].c(),o[E].m(a,null))}for(;E<o.length;E+=1)o[E].d(1);o.length=_.length}S[0]&524304&&Qo(a,b[19])},d(b){b&&ce(n),Ia(o,b),h=!1,dr(p)}}}function Xm(t){let n,a=t[59].properties.AREANM+"",c,h,p;return{c(){n=Ae("option"),c=st(a),h=Ge(),n.__value=p=t[59].properties.AREANM,n.value=n.__value},m(_,o){fe(_,n,o),ue(n,c),ue(n,h)},p(_,o){o[0]&16&&a!==(a=_[59].properties.AREANM+"")&&hi(c,a),o[0]&16&&p!==(p=_[59].properties.AREANM)&&(n.__value=p,n.value=n.__value)},d(_){_&&ce(n)}}}function dS(t){let n,a,c,h,p,_,o,b,S,E,P,k,L,j,q,J,ee,ge,_e,Y,le,ie,ke,Je,ve,pe,Fe,$e,ct,We,mt,xe,Ne,Le,ut,Ze,qt,It=t[4]&&Wm(t);return{c(){n=Ae("div"),a=Ae("section"),a.innerHTML=`<div class="col-medium"><p>Louisiana now has the second highest <a href="https://bjs.ojp.gov/sites/g/files/xyckuh236/files/media/document/p21st.pdf" target="_blank" class="svelte-bpiw7r"><strong>imprisonment rate</strong></a> in the nation. Despite modest declines in the prison population, mass
            incarceration remains a problem in every parish: the prison admission
            rate is greater than the national average in 92 percent of parishes and
            more than twice the national average in 63 percent of parishes.</p></div>`,c=Ge(),h=Ae("section"),h.innerHTML=`<div class="col-medium"><p>Mass incarceration is not only measured by the number of people in
            prison. People arrested but not convicted—that is, people in the
            “pretrial” period—are held in local jails. The <strong>pretrial incarceration rate</strong> in Louisiana is the highest in the nation and twice the national average.
            On a local level, the pretrial incarceration rate is greater than the
            national average in 89 percent of parishes and more than twice the national
            average in 59 percent of parishes.​</p></div>`,p=Ge(),_=Ae("section"),_.innerHTML=`<div class="col-medium"><p>Recent history illustrates how jail capacity has increased across
            the state. In 1999, there were only <span class="enormousjails svelte-bpiw7r">five parishes</span>
            with more than 1,000 <span class="localjails svelte-bpiw7r">jail beds</span>.</p></div>`,o=Ge(),b=Ae("section"),b.innerHTML=`<div class="col-medium"><p>One of these was Orleans Parish, which at the time had a sprawling
            complex with more than 7,500 jail beds.</p></div>`,S=Ge(),E=Ae("section"),E.innerHTML=`<div class="col-medium"><p>But in 2005, the complex was destroyed by Hurricane Katrina,
            prompting a dialogue on how much the city should invest in jailing
            people. Through the efforts of community advocates, the parish ended
            the practice of holding people for the state corrections department
            and limited the new jail’s capacity to 1,250 people. By 2019,
            Orleans Parish’s pretrial population had declined by 75 percent, and
            the total jail population had dropped by more than 80 percent.</p></div>`,P=Ge(),k=Ae("section"),k.innerHTML=`<div class="col-medium"><p>During this time, however, sheriffs across the state added
            14,000 jail beds, and there are now <span class="enormousjails svelte-bpiw7r">13 parishes</span>
            with more than <span class="localjails svelte-bpiw7r">1,000 jail beds</span>.​</p></div>`,L=Ge(),j=Ae("section"),j.innerHTML=`<div class="col-medium"><p><strong><span class="localjails svelte-bpiw7r">Local jails</span></strong> operated
            by sheriffs and police departments are the foundation of Louisiana’s
            carceral infrastructure. Sheriffs operate 85 jails with a combined capacity
            of more than 29,000 beds, while municipal police departments operate
            65 jails with a total of nearly 4,800 beds. This enables the state’s
            astronomical pretrial detention rates.</p></div>`,q=Ge(),J=Ae("section"),J.innerHTML=`<div class="col-medium"><p>This growth in jail capacity also means that Louisiana’s law
            enforcement agencies are uniquely invested in incarceration, as the
            state pays local jails “per diems” to hold people serving a state
            prison sentence. More than half of the 27,000 people that comprise
            Louisiana’s “prison population” are serving their sentence in a
            local jail. This arrangement costs the state less than building new
            prisons and <span class="financial svelte-bpiw7r">financially benefits</span> the sheriffs,
            while depriving incarcerated people of services like education and vocational
            training, which are more often available in prisons.</p></div>`,ee=Ge(),ge=Ae("section"),ge.innerHTML=`<div class="col-medium"><p>Dozens of sheriffs also operate <strong>Transitional Work Programs (TWP)</strong>
            that hold people who are nearing the end of their prison term. These
            programs release people during the day to work in the community, but
            take about
            <a href="https://app.lla.state.la.us/publicreports.nsf/87d9ddaec96efe3a86257f94007293f3/$file/0000e78f.pdf" target="_blank" class="svelte-bpiw7r">65 percent</a> of their wages for the jail, which also receives a payment from the
            state. Several private operators have TWP contracts with the state as
            well, and 11 parishes have built an additional facility solely to provide
            TWP beds.</p></div>`,_e=Ge(),Y=Ae("section"),Y.innerHTML=`<div class="col-medium"><p>In addition to the 150 jails operated by local law enforcement
            agencies, there are 11 <span class="privatejails svelte-bpiw7r">privately operated jails</span> with more than 10,000 beds combined. U.S. Immigration and Customs Enforcement
            (ICE) has contracts with the GEO Group to operate four detention facilities.
            And local sheriffs have partnerships with LaSalle Corrections and other
            private firms to operate seven additional jails, which principally hold
            people for the state but also hold people for ICE.</p></div>`,le=Ge(),ie=Ae("section"),ie.innerHTML='<div class="col-medium"><p>Louisiana has five federal prisons and eight state <span class="prisons svelte-bpiw7r">prisons</span>.</p></div>',ke=Ge(),Je=Ae("section"),Je.innerHTML=`<div class="col-medium"><p>One of these is the Louisiana State Penitentiary, more commonly
            called “Angola” after the plantation that once occupied the same
            site. Today, the prison’s plantation continues to produce cotton,
            sugar, corn, and other crops that were harvested during times of
            slavery—except today, incarcerated people tend the fields, an
            arrangement made possible by an exception in the 13th Amendment
            permitting slavery “as a punishment for crime.”</p></div>`,ve=Ge(),pe=Ae("section"),pe.innerHTML=`<div class="col-medium"><p>Looking at historical plantations next to modern-day jails and
            prisons, Louisiana’s evolution from mass enslavement to mass
            incarceration is undeniable. The state’s largest jails and prisons
            are situated squarely on the same land where Black people were
            enslaved to sustain the state’s agricultural industry. These
            facilities now use the forced labor of incarcerated people (who are
            disproportionally Black) to sustain the “corrections” industry.</p></div>`,Fe=Ge(),$e=Ae("section"),$e.innerHTML=`<div class="col-medium"><p>Adding youth prisons and jails to the facilities already outlined
            shows that there are more than 230 jails and prisons across
            Louisiana. In comparison, there are only 42 universities and
            colleges in the state.</p></div>`,ct=Ge(),We=Ae("section"),mt=Ae("a"),xe=Ge(),Ne=Ae("div"),Le=Ae("p"),Le.textContent=`These numbers matter: more facilities lead to more incarceration.
            The parishes with the most outsized jails often have the highest
            pretrial detention and prison incarceration rates.`,ut=Ge(),Ze=Ae("p"),Ze.innerHTML=`<strong>Visit your parish page to see how local policies add up to
              statewide mass incarceration. Scroll down to see Vera’s
              recommendations for tackling these issues.</strong>`,qt=Ge(),It&&It.c(),O(a,"data-id","map01"),O(h,"data-id","map02"),O(_,"data-id","map03"),O(b,"data-id","map04"),O(E,"data-id","map05"),O(k,"data-id","map06"),O(j,"data-id","map07"),O(J,"data-id","map08"),O(ge,"data-id","map09"),O(Y,"data-id","map10"),O(ie,"data-id","map11"),O(Je,"data-id","map12"),O(pe,"data-id","map13"),O($e,"data-id","map14"),O(mt,"id","parishes"),O(mt,"class","svelte-bpiw7r"),O(Ne,"class","col-medium"),O(We,"data-id","map15"),O(We,"id","browseparishes"),O(n,"slot","foreground")},m(Ut,Kt){fe(Ut,n,Kt),ue(n,a),ue(n,c),ue(n,h),ue(n,p),ue(n,_),ue(n,o),ue(n,b),ue(n,S),ue(n,E),ue(n,P),ue(n,k),ue(n,L),ue(n,j),ue(n,q),ue(n,J),ue(n,ee),ue(n,ge),ue(n,_e),ue(n,Y),ue(n,le),ue(n,ie),ue(n,ke),ue(n,Je),ue(n,ve),ue(n,pe),ue(n,Fe),ue(n,$e),ue(n,ct),ue(n,We),ue(We,mt),ue(We,xe),ue(We,Ne),ue(Ne,Le),ue(Ne,ut),ue(Ne,Ze),ue(Ne,qt),It&&It.m(Ne,null)},p(Ut,Kt){Ut[4]?It?It.p(Ut,Kt):(It=Wm(Ut),It.c(),It.m(Ne,null)):It&&(It.d(1),It=null)},d(Ut){Ut&&ce(n),It&&It.d()}}}function mS(t){let n,a,c,h,p,_,o,b,S,E,P,k,L,j;n=new J1({props:{$$slots:{default:[Jk]},$$scope:{ctx:t}}}),c=new G1({});let q=t[4]&&t[1].parish.indicators&&t[3].facility.indicators&&qm(t);return o=new H1({}),E=new v_({}),L=new Iv({}),{c(){nt(n.$$.fragment),a=Ge(),nt(c.$$.fragment),h=Ge(),q&&q.c(),p=Ge(),_=Ae("div"),nt(o.$$.fragment),b=Ge(),S=Ae("div"),nt(E.$$.fragment),P=Ge(),k=Ae("div"),nt(L.$$.fragment),O(S,"class","col-wide"),O(k,"class","col-wide"),O(_,"id","bottom"),O(_,"class","svelte-bpiw7r")},m(J,ee){et(n,J,ee),fe(J,a,ee),et(c,J,ee),fe(J,h,ee),q&&q.m(J,ee),fe(J,p,ee),fe(J,_,ee),et(o,_,null),ue(_,b),ue(_,S),et(E,S,null),ue(_,P),ue(_,k),et(L,k,null),j=!0},p(J,ee){const ge={};ee[2]&4&&(ge.$$scope={dirty:ee,ctx:J}),n.$set(ge),J[4]&&J[1].parish.indicators&&J[3].facility.indicators?q?(q.p(J,ee),ee[0]&26&&Ie(q,1)):(q=qm(J),q.c(),Ie(q,1),q.m(p.parentNode,p)):q&&(Qn(),Re(q,1,1,()=>{q=null}),$n())},i(J){j||(Ie(n.$$.fragment,J),Ie(c.$$.fragment,J),Ie(q),Ie(o.$$.fragment,J),Ie(E.$$.fragment,J),Ie(L.$$.fragment,J),j=!0)},o(J){Re(n.$$.fragment,J),Re(c.$$.fragment,J),Re(q),Re(o.$$.fragment,J),Re(E.$$.fragment,J),Re(L.$$.fragment,J),j=!1},d(J){tt(n,J),J&&ce(a),tt(c,J),J&&ce(h),q&&q.d(J),J&&ce(p),J&&ce(_),tt(o),tt(E),tt(L)}}}let Km="light";const gS=.65,_S="./data/parishes.json",yS="./data/orleansparishtopo.json",vS="./data/clippedtopo.json",xS="./data/franklin.json",bS="./data/restUS.json",wS="./data/wfel.json",TS="./data/bldg2005topo.json",kS="./data/bldg2023topo.json",SS="./data/statetopo.json",ES="./data/facility.json",CS="./data/twp.json",AS="./data/private.json",IS="./data/prison.json",MS="./data/estdocrev.json",PS="https://api.maptiler.com/maps/72c3ba93-41a4-4cb7-8f43-eb0d3c5797d7/style.json?key=FauA8RpnouVUuBS6hR1V",zS="https://api.maptiler.com/maps/hybrid/style.json?key=epSI7oxRYqxkl2HpZgcr";function io(t){var n=t.toString().split(".");return n[0]=n[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),n.join(".")}function DS(t,n,a){Kr.start({click:!1}),$o("theme",Km),V1(nc,Km);let c=y_(),h={},p={};Fn(()=>{p={...h}});const _=["parish"],o=["facility"],b={la:[[-95.0399448042286,28.595645625527535],[-88.58723191094903,33.39651900203391]],la2:[[-94.20437521837017,29.05549858060883],[-88.64342295552318,32.92697341963069]],lamobile:[[-94.16658071248452,25.45654294508548],[-89.31523133151606,35.632898417372274]],neworleans:[[-90.20218547121677,29.832442237380768],[-89.5287512047579,30.2826563423104]],neworleansmobile:[[-90.0994909234169,29.951175901295326],[-90.08906084005827,29.97318139970902]],orleansparishjail:[[-90.09584076786747,29.95885105594476],[-90.09124436292655,29.96202846489282]],angola:[[-91.64341265873233,30.93019793919344],[-91.56290347711851,30.9865779654985]],nolajailbldg:[[-90.1026537217127,29.956812140351577],[-90.08733946304126,29.965537706523364]],nolajailbldg2:[[-90.09702702023108,29.953342990656846],[-90.08936855325291,29.974661699522763]],nola2023:[[-90.09790954793945,29.95716669715467],[-90.0920981511653,29.962729653377394]]};let S={parish:{}},E={parish:{}},P={facility:{}},k={facility:{}},L,j,q,J,ee,ge,_e,Y,le,ie,ke,Je,ve,pe=null,Fe,$e,ct=[],We="admission",mt="none",xe=!1,Ne=0,Le=0,ut=0,Ze=0,qt,It,Ut,Kt=0,Jt=0,li=0,mi=0,rt=Rn("#app").node().getBoundingClientRect().width;function He(Tt){a(19,$e=Tt.detail.feature.properties.AREANM),Kr("/louisiana-locked-up/parish/"+$e),Tt.preventDefault()}function Mt(Tt){Kr("/louisiana-locked-up/parish/"+Tt),Tt.preventDefault()}function Qe(Tt){a(18,Fe=Tt.detail.id)}function At(Tt){pe&&pe.fitBounds(Tt,{animate:c,padding:30})}const ei={map:{map01:()=>{At(rt<420?b.lamobile:b.la),a(21,We="admission"),a(20,ct=[]),a(23,xe=!1),a(22,mt="none"),a(24,Ne=0),a(25,Le=0),a(26,ut=0),a(27,Ze=0),a(29,It=0),a(28,qt="rgba(0,0,0,0)"),a(30,Ut="rgba(255,255,255,0)"),a(31,Kt=0),a(32,Jt=0),a(33,li=0),a(34,mi=0)},map02:()=>{At(rt<420?b.lamobile:b.la),a(21,We="pretrial"),a(20,ct=[]),a(23,xe=!1),a(22,mt="none"),a(24,Ne=0),a(25,Le=0),a(26,ut=0),a(27,Ze=0),a(29,It=0),a(30,Ut="rgba(255,255,255,0)"),a(31,Kt=0),a(32,Jt=0),a(33,li=0),a(34,mi=0)},map03:()=>{At(rt<420?b.lamobile:b.la),a(20,ct=[]),a(21,We="over_1000_99"),a(23,xe=!1),a(22,mt="GT_1000_beds_99"),a(24,Ne=0),a(25,Le=0),a(26,ut=0),a(27,Ze=0),a(28,qt=["case",["!=",["feature-state","color"],null],["feature-state","color"],"rgba(255, 255, 255, 0)"]),a(29,It=["get","over_1000_99"]),a(30,Ut="rgba(255, 255, 255, 1)"),a(31,Kt=0),a(32,Jt=0),a(33,li=0),a(34,mi=0)},map04:()=>{a(20,ct=[]),At(rt<420?b.neworleansmobile:b.nolajailbldg),a(21,We="none"),a(23,xe=!1),a(22,mt=""),a(24,Ne=0),a(25,Le=1),a(26,ut=1),a(27,Ze=0),a(28,qt=["case",["!=",["feature-state","color"],null],["feature-state","color"],"rgba(255, 255, 255, 0)"]),a(29,It=0),a(30,Ut="rgba(255,255,255,0)"),a(31,Kt=0),a(32,Jt=0),a(34,mi=0)},map05:()=>{At(rt<420?b.neworleansmobile:b.nolajailbldg),a(20,ct=[]),a(21,We="none"),a(23,xe=!1),a(22,mt=""),a(24,Ne=0),a(25,Le=1),a(26,ut=0),a(27,Ze=1),a(28,qt=["case",["!=",["feature-state","color"],null],["feature-state","color"],"rgba(255, 255, 255, 0)"]),a(29,It=0),a(30,Ut="rgba(255,255,255,0)"),a(31,Kt=0),a(32,Jt=0),a(33,li=0),a(34,mi=0)},map06:()=>{At(rt<420?b.lamobile:b.la),a(20,ct=[]),a(21,We="over_1000_19"),a(23,xe=!1),a(22,mt="GT_1000_beds_19"),a(24,Ne=0),a(25,Le=0),a(26,ut=0),a(27,Ze=0),a(28,qt=["case",["!=",["feature-state","color"],null],["feature-state","color"],"rgba(255, 255, 255, 0)"]),a(29,It=["get","GT_1000_beds_19"]),a(30,Ut="rgba(255,255,255,1)"),a(31,Kt=0),a(32,Jt=0),a(33,li=0),a(34,mi=0)},map07:()=>{At(rt<420?b.lamobile:b.la),a(20,ct=[]),a(21,We="none"),a(23,xe=!1),a(22,mt="map_jails"),a(24,Ne=0),a(25,Le=0),a(26,ut=0),a(27,Ze=0),a(28,qt=["case",["!=",["feature-state","color"],null],["feature-state","color"],"rgba(255, 255, 255, 0)"]),a(29,It=["get","map_jails"]),a(30,Ut="rgba(255,255,255,1)"),a(31,Kt=0),a(32,Jt=0),a(33,li=0),a(34,mi=0)},map08:()=>{At(rt<420?b.lamobile:b.la),a(20,ct=[]),a(21,We="none"),a(23,xe=!1),a(22,mt=""),a(24,Ne=0),a(25,Le=0),a(26,ut=0),a(27,Ze=0),a(28,qt=["case",["!=",["feature-state","color"],null],["feature-state","color"],"rgba(255, 255, 255, 0)"]),a(29,It=0),a(30,Ut="rgba(255,255,255,0)"),a(31,Kt=0),a(32,Jt=0),a(33,li=0),a(34,mi=1)},map09:()=>{At(rt<420?b.lamobile:b.la),a(21,We="none"),a(20,ct=[]),a(23,xe=!1),a(22,mt="map_twp"),a(24,Ne=0),a(25,Le=0),a(26,ut=0),a(27,Ze=0),a(28,qt=["case",["!=",["feature-state","color"],null],["feature-state","color"],"rgba(255, 255, 255, 0)"]),a(29,It=["get","map_twp"]),a(30,Ut="rgba(255,255,255,1)"),a(31,Kt=1),a(32,Jt=0),a(33,li=0),a(34,mi=0)},map10:()=>{At(rt<420?b.lamobile:b.la),a(21,We="none"),a(20,ct=[]),a(23,xe=!1),a(22,mt="map_private"),a(24,Ne=0),a(25,Le=0),a(26,ut=0),a(27,Ze=0),a(28,qt=["case",["!=",["feature-state","color"],null],["feature-state","color"],"rgba(255, 255, 255, 0)"]),a(29,It=["get","map_private"]),a(30,Ut="rgba(255,255,255,1)"),a(31,Kt=0),a(32,Jt=1),a(33,li=0),a(34,mi=0)},map11:()=>{At(rt<420?b.lamobile:b.la),a(21,We="none"),a(20,ct=[]),a(23,xe=!1),a(22,mt="map_prison"),a(24,Ne=0),a(25,Le=0),a(26,ut=0),a(27,Ze=0),a(28,qt=["case",["!=",["feature-state","color"],null],["feature-state","color"],"rgba(255, 255, 255, 0)"]),a(29,It=["get","map_prison"]),a(30,Ut="rgba(255,255,255,1)"),a(31,Kt=0),a(32,Jt=0),a(33,li=1),a(34,mi=0)},map12:()=>{At(b.angola),a(21,We="none"),a(20,ct=[]),a(22,mt=""),a(23,xe=!1),a(24,Ne=1),a(25,Le=0),a(26,ut=0),a(27,Ze=0),a(29,It=0),a(28,qt=["case",["!=",["feature-state","color"],null],["feature-state","color"],"rgba(255, 255, 255, 0)"]),a(30,Ut="rgba(255,255,255,0)"),a(31,Kt=0),a(32,Jt=0),a(33,li=0),a(34,mi=0)},map13:()=>{At(rt<420?b.lamobile:b.la),a(21,We="none"),a(20,ct=[]),a(22,mt="map_all"),a(23,xe=!1),a(24,Ne=1),a(25,Le=0),a(26,ut=0),a(27,Ze=0),a(28,qt="rgba(255,255,255,0)"),a(29,It=.7),a(30,Ut="rgba(0,0,0,1)"),a(31,Kt=0),a(32,Jt=0),a(33,li=0),a(34,mi=0)},map14:()=>{At(rt<420?b.lamobile:b.la),a(21,We="none"),a(20,ct=[]),a(22,mt="map_all"),a(23,xe=!1),a(24,Ne=0),a(25,Le=0),a(26,ut=0),a(27,Ze=0),a(28,qt=["match",["get","facility_type"],"Jail","rgba(46,29,151,.9)","Prison","rgba(0,92,229, 0.9)","Juvenile","rgba(235,65,44,.9)","TWP Facility","rgba(255,158,68,0.9)","Holding Cell","rgba(177, 188, 255, 0.9)","#ccc"]),a(29,It=1),a(30,Ut="rgba(255,255,255,1)"),a(31,Kt=0),a(32,Jt=0),a(33,li=0),a(34,mi=0)},map15:()=>{At(rt<420?b.lamobile:b.la),a(21,We="pretrial"),a(20,ct=[]),a(22,mt="map_all"),a(24,Ne=0),a(25,Le=0),a(26,ut=0),a(27,Ze=0),a(28,qt="rgba(255,255,255,0)"),a(29,It=1),a(30,Ut="rgba(255,255,255,1)"),a(31,Kt=0),a(32,Jt=0),a(33,li=0),a(34,mi=0),a(23,xe=!0)}}};function Ei(Tt=[]){Tt.forEach(si=>{h[si]!=p[si]&&(ei[si][h[si]]&&ei[si][h[si]](),p[si]=h[si])})}const ci=yp("%m/%d/%y");_.forEach(Tt=>{Wd(`./data/data_${Tt}.csv`).then(si=>{si.forEach(Ee=>{Ee.jail_pretrial_rate=+Ee.jail_pretrial_rate.toFixed(1),Ee.prison_adm_rate=+Ee.prison_adm_rate.toFixed(1),Ee.over_1000_19=+Ee.over_1000_19,Ee.over_1000_99=+Ee.over_1000_99});let Ui=si.map(Ee=>({code:Ee.code,name:Ee.parish,prison_adm_count:Ee.prison_adm_count,year:Ee.year,prison_adm_rate:Ee.prison_adm_rate,total_pop:Ee.total_pop,jail_pretrial_rate:Ee.jail_pretrial_rate,total_jail_pretrial:Ee.total_jail_pretrial,pretrial_date:ci(Ee.pretrial_date)})),Qi={};Ui.forEach(Ee=>{Qi[Ee.code]=Ee}),a(2,E[Tt].array=Ui,E),a(2,E[Tt].lookup=Qi,E);let Oe=si.map((Ee,nn)=>({...Ui[nn],pretrial:Ee.jail_pretrial_rate,admission:Ee.prison_adm_rate,over_1000_19:Ee.over_1000_19,over_1000_99:Ee.over_1000_99}));Tt=="parish"&&["pretrial","admission","over_1000_19","over_1000_99"].forEach(Ee=>{let nn=Oe.map(Gt=>Gt[Ee]).sort((Gt,Ni)=>Gt-Ni),sn=Kd(Ee,nn);Oe.forEach((Gt,Ni)=>Oe[Ni][Ee+"_color"]=Xd(Gt[Ee],sn,Jd[Ee]))}),a(1,S[Tt].indicators=Oe,S)})}),o.forEach(Tt=>{Wd(`./data/data_${Tt}.csv`).then(si=>{si.forEach(Ee=>{Ee.capacity=+Ee.capacity,Ee.ice_active=+Ee.ice_capacity,Ee.num_facilities=+Ee.num_facilities,Ee.twp=+Ee.twp,Ee.parish_hold=+Ee.parish_hold,Ee.total_pop=+Ee.total_pop,Ee.map_twp=+Ee.map_twp,Ee.map_private=+Ee.map_private,Ee.map_prison=+Ee.map_prison,Ee.GT99=+Ee.GT_1000_beds_99,Ee.GT_1000_beds_99=+Ee.GT_1000_beds_99,Ee.GT_1000_beds_19=+Ee.GT_1000_beds_19,Ee.map_jails=+Ee.map_jails,Ee.ice=+Ee.ice});let Ui=si.map(Ee=>({uuid:Ee.uuid,name:Ee.facility_name})),Qi={};Ui.forEach(Ee=>{Qi[Ee.uuid]=Ee}),k[Tt].array=Ui,k[Tt].lookup=Qi;let Oe=si.map((Ee,nn)=>({...Ui[nn],map_twp:Ee.map_twp,map_private:Ee.map_private,map_prison:Ee.map_prison,GT_1000_beds_99:Ee.GT_1000_beds_99,GT_1000_beds_19:Ee.GT_1000_beds_19,map_jails:Ee.map_jails,map_all:1,ice:Ee.ice,gt99:+Ee.GT99,capacity:+Ee.capacity,why:+Ee.why,ind:nn}));Tt=="facility"&&["map_twp","map_private","map_prison","GT_1000_beds_99","GT_1000_beds_19","map_jails","map_all"].forEach(Ee=>{let nn=Oe.map(Gt=>Gt[Ee]).sort((Gt,Ni)=>Gt-Ni),sn=Kd(Ee,nn);Oe.forEach((Gt,Ni)=>Oe[Ni][Ee+"_color"]=Xd(Gt[Ee],sn,Jd[Ee]),Oe[Ee+"_outline"]="#fff")}),a(3,P[Tt].indicators=Oe,P)})}),Ya(_S,"la").then(Tt=>{Tt.features.sort((si,Ui)=>si.properties.AREANM.localeCompare(Ui.properties.AREANM)),a(4,L=Tt)}),Ya(yS,"orleansparish").then(Tt=>{a(5,j=Tt)}),Ya(vS,"plantations").then(Tt=>{a(6,q=Tt)}),Ya(wS,"westfplantations").then(Tt=>{a(8,ee=Tt)}),Ya(xS,"Franklin").then(Tt=>{}),Ya(bS,"restUS").then(Tt=>{a(7,J=Tt)}),Ya(TS,"nolabldg").then(Tt=>{a(9,ge=Tt)}),Ya(kS,"bldg2023").then(Tt=>{a(10,_e=Tt)}),Ya(SS,"state").then(Tt=>{a(11,Y=Tt)}),Jl(ES,"facilities").then(Tt=>{Tt.features.sort((si,Ui)=>Ui.properties.capacity-si.properties.capacity),a(12,le=Tt)}),Jl(CS,"twp").then(Tt=>{a(13,ie=Tt)}),Jl(AS,"private").then(Tt=>{a(14,ke=Tt)}),Jl(IS,"prison").then(Tt=>{a(15,Je=Tt)}),Jl(MS,"estdocrev").then(Tt=>{Tt.features.forEach(si=>{si.properties.est_doc_rev!==null&&(si.properties.rev="$"+io(si.properties.est_doc_rev.toFixed(0)))}),a(16,ve=Tt)});const Nt=lh("%B %d, %Y");function fi(){$e=Ef(this),a(19,$e),a(4,L)}const Qt=()=>Mt($e);function fn(Tt){pe=Tt,a(17,pe)}function kn(){$e=Ef(this),a(19,$e),a(4,L)}const Sn=()=>Mt($e);function Hn(Tt){t.$$.not_equal(h.map,Tt)&&(h.map=Tt,a(0,h))}return t.$$.update=()=>{t.$$.dirty[0]&1&&h&&Ei(Object.keys(ei))},[h,S,E,P,L,j,q,J,ee,ge,_e,Y,le,ie,ke,Je,ve,pe,Fe,$e,ct,We,mt,xe,Ne,Le,ut,Ze,qt,It,Ut,Kt,Jt,li,mi,b,rt,He,Mt,Qe,Nt,fi,Qt,fn,kn,Sn,Hn]}class LS extends _i{constructor(n){super(),gi(this,n,DS,mS,di,{},null,[-1,-1,-1])}}function RS(t){let n,a;return n=new LS({}),{c(){nt(n.$$.fragment)},m(c,h){et(n,c,h),a=!0},p:Ft,i(c){a||(Ie(n.$$.fragment,c),a=!0)},o(c){Re(n.$$.fragment,c),a=!1},d(c){tt(n,c)}}}class Jm extends _i{constructor(n){super(),gi(this,n,null,RS,di,{})}}function Ym(t,n,a){const c=t.slice();return c[21]=n[a],c}function Qm(t){let n,a=t[21].county+"",c,h,p;return{c(){n=Ae("option"),c=st(a),h=Ge(),n.__value=p=t[21].county,n.value=n.__value},m(_,o){fe(_,n,o),ue(n,c),ue(n,h)},p(_,o){o&2&&a!==(a=_[21].county+"")&&hi(c,a),o&2&&p!==(p=_[21].county)&&(n.__value=p,n.value=n.__value)},d(_){_&&ce(n)}}}function BS(t){let n,a,c,h,p,_,o,b,S,E,P,k,L,j,q,J,ee,ge=t[1],_e=[];for(let ie=0;ie<ge.length;ie+=1)_e[ie]=Qm(Ym(t,ge,ie));function Y(ie){t[8](ie)}let le={style:dy,interactive:!0,controls:!0,location:{bounds:t[3].la},options:{minZoom:6.5}};return t[0]!==void 0&&(le.map=t[0]),S=new ep({props:le}),Bn.push(()=>Jf(S,"map",Y)),{c(){n=Ae("div"),a=Ae("div"),a.innerHTML=`<div class="dotlegend-li svelte-rfhyu8"><div class="circ jail svelte-rfhyu8"></div>
      Jail</div> 
    <div class="dotlegend-li svelte-rfhyu8"><div class="circ prison svelte-rfhyu8"></div>
      Prison</div> 
    <div class="dotlegend-li svelte-rfhyu8"><div class="circ juvenile svelte-rfhyu8"></div>
      Juvenile</div> 
    <div class="dotlegend-li svelte-rfhyu8"><div class="circ twp svelte-rfhyu8"></div>
      TWP Facility</div> 
    <div class="dotlegend-li svelte-rfhyu8"><div class="circ holding svelte-rfhyu8"></div>
      Holding Cell</div>`,c=Ge(),h=Ae("select"),p=Ae("option"),p.textContent="Select Parish";for(let ie=0;ie<_e.length;ie+=1)_e[ie].c();_=Ge(),o=Ae("div"),b=Ae("div"),nt(S.$$.fragment),P=Ge(),k=Ae("nav"),L=Ge(),j=Ae("div"),O(a,"id","map_legend"),O(a,"class","svelte-rfhyu8"),p.__value=null,p.value=p.__value,O(h,"class","selectParish svelte-rfhyu8"),t[2]===void 0&&Es(()=>t[6].call(h)),O(b,"id","map"),O(b,"class","svelte-rfhyu8"),O(k,"id","mapmenu"),O(k,"class","svelte-rfhyu8"),O(j,"id","stylemenu"),O(j,"class","svelte-rfhyu8"),O(o,"class","map-wrap svelte-rfhyu8"),O(n,"id","group"),O(n,"class","svelte-rfhyu8")},m(ie,ke){fe(ie,n,ke),ue(n,a),ue(n,c),ue(n,h),ue(h,p);for(let Je=0;Je<_e.length;Je+=1)_e[Je].m(h,null);Qo(h,t[2]),ue(n,_),ue(n,o),ue(o,b),et(S,b,null),ue(o,P),ue(o,k),ue(o,L),ue(o,j),q=!0,J||(ee=[Hi(h,"change",t[6]),Hi(h,"change",t[7])],J=!0)},p(ie,[ke]){if(ke&2){ge=ie[1];let ve;for(ve=0;ve<ge.length;ve+=1){const pe=Ym(ie,ge,ve);_e[ve]?_e[ve].p(pe,ke):(_e[ve]=Qm(pe),_e[ve].c(),_e[ve].m(h,null))}for(;ve<_e.length;ve+=1)_e[ve].d(1);_e.length=ge.length}ke&6&&Qo(h,ie[2]);const Je={};!E&&ke&1&&(E=!0,Je.map=ie[0],Kf(()=>E=!1)),S.$set(Je)},i(ie){q||(Ie(S.$$.fragment,ie),q=!0)},o(ie){Re(S.$$.fragment,ie),q=!1},d(ie){ie&&ce(n),Ia(_e,ie),tt(S),J=!1,dr(ee)}}}const dy="https://api.maptiler.com/maps/72c3ba93-41a4-4cb7-8f43-eb0d3c5797d7/style.json?key=FauA8RpnouVUuBS6hR1V",FS="https://api.maptiler.com/maps/hybrid/style.json?key=epSI7oxRYqxkl2HpZgcr";function $m(t){var n=t.toString().split(".");return n[0]=n[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),n.join(".")}function OS(t,n,a){let{parishTitle:c}=n,h,p=y_(),_={},o,b,S=[],E=[],P=[],k;Fn(async()=>{const Y=await Nr("https://vera-insights-data-viz.s3.amazonaws.com/louisiana/la_bounding_boxes.csv");a(1,P=Y);const le=Y.filter(ie=>ie.county==c)[0];_={parish:[[+le.xmin,+le.ymax],[+le.xmax,+le.ymin]]},q(_.parish)});const L={la:[[-95.0399448042286,28.595645625527535],[-88.58723191094903,33.39651900203391]]};function j(Y){var le=Y.features[0].properties.NAME;Kr(le),le.preventDefault()}function q(Y){h&&h.fitBounds(Y,{animate:p,padding:30})}Fn(async()=>{o=await(await fetch("https://vera-insights-data-viz.s3.amazonaws.com/louisiana/louisiana_parishes.json")).json(),o.features.forEach(function(ve){ve.properties.NAME==c?ve.properties.selected=1:ve.properties.selected=0}),b=await(await fetch("https://vera-insights-data-viz.s3.amazonaws.com/louisiana/plantations.json")).json();let ie=null;S=await(await fetch("https://vera-insights-data-viz.s3.amazonaws.com/louisiana/points.json")).json(),S.features.forEach(ve=>{ve.properties.capacity=="N/A"?ve.properties.capacity=ve.properties.capacity:ve.properties.capacity=+ve.properties.capacity}),E={type:"FeatureCollection",features:S.features.filter(function(ve){return ve.properties.parish==c+" Parish"})},h.on("load",function(){h.addSource("parish_incarceration_rates",{type:"geojson",data:o,generateId:!0});const ve=h.getStyle().layers;let pe;for(let We=0;We<ve.length;We++)if(ve[We].type==="symbol"){pe=ve[We].id;break}h.addLayer({id:"parishes",source:"parish_incarceration_rates",type:"fill",paint:{"fill-color":["case",["==",["get","selected"],1],"#c9e3e7",["boolean",["feature-state","hovered"],!0],"#fff7f0","rgba(255,255,255,0)"],"fill-outline-color":"#000","fill-opacity":["case",["==",["get","selected"],1],.4,["boolean",["feature-state","hover"],!1],.5,0]}},pe),h.addSource("Plantation",{type:"geojson",data:b,generateId:!0}),h.addLayer({id:"Plantation",source:"Plantation",type:"fill",layout:{visibility:"none"},paint:{"fill-color":"#97DFD1"}},pe),h.addLayer({id:"parish-outlines",source:"parish_incarceration_rates",type:"line",paint:{"line-width":1.5}},pe);var Fe=new no.Popup({closeButton:!1,closeOnClick:!1});h.on("mousemove","parishes",We=>{We.features.length>0&&(ie!==null&&h.setFeatureState({source:"parish_incarceration_rates",id:ie},{hover:!1}),ie=We.features[0].id,h.setFeatureState({source:"parish_incarceration_rates",id:ie},{hover:!0})),h.getCanvas().style.cursor="pointer";var mt=[We.lngLat.lng,We.lngLat.lat],xe=We.features[0].properties.NAME_ALT;Fe.setLngLat(mt).setHTML(xe).addTo(h)}),h.on("click","parishes",We=>{var mt=We.features[0].properties.NAME;let xe=P.filter(Le=>Le.county==mt)[0],Ne={parish:[[+xe.xmin,+xe.ymax],[+xe.xmax,+xe.ymin]]};j(We),q(Ne.parish)}),h.on("mouseleave","parishes",()=>{ie!==null&&h.setFeatureState({source:"parish_incarceration_rates",id:ie},{hover:!1}),ie=null}),h.addSource("facility_data",{type:"geojson",data:E,generateId:!0}),h.addLayer({id:"facilities",source:"facility_data",type:"circle",paint:{"circle-color":["match",["get","type"],"Jail","#223b53","Prison","#fbb03b","TWP Facility","#e55e5e","Juvenile","#3bb2d0","Holding Cell","#0cb74c","#ccc"],"circle-radius":["step",["get","capacity"],5,100,7,500,9,1e3,11,2e3,13,5e3,10]}}),h.on("mousemove","facilities",We=>{h.getCanvas().style.cursor="pointer";var mt=[We.lngLat.lng,We.lngLat.lat];let xe;We.features[0].properties.capacity=="N/A"?xe="<strong>"+We.features[0].properties.facility_name+"</strong><br/>Type: "+We.features[0].properties.type+"<br/>Capacity: "+$m(We.features[0].properties.capacity)+"<br/>Operator: "+We.features[0].properties.operator:xe="<strong>"+We.features[0].properties.facility_name+"</strong><br/>Type: "+We.features[0].properties.type+"<br/>Capacity: "+$m(We.features[0].properties.capacity)+" beds<br/>Operator: "+We.features[0].properties.operator,Fe.setLngLat(mt).setHTML(xe).addTo(h)}),h.on("mouseleave","facilities",()=>{ie=null});const ct=document.getElementById("menu").getElementsByTagName("input");for(const We of ct)We.onclick=mt=>{console.log("layer",mt);const xe=mt.target.id;console.log("layerId",xe),xe=="sat"?h.setStyle(FS):xe=="streets"&&h.setStyle(dy)}}),h.on("idle",()=>{const ve=["Plantation"];for(const pe of ve){if(document.getElementById(pe))continue;const Fe=document.createElement("a");Fe.id=pe,Fe.href="#",Fe.textContent="Show "+pe+" Layer",Fe.className="",Fe.onclick=function(ct){const We=this.id;ct.preventDefault(),ct.stopPropagation(),h.getLayoutProperty(We,"visibility")==="visible"?(h.setLayoutProperty(We,"visibility","none"),this.className="",this.textContent="Show Plantation Layer"):(this.className="active",this.textContent="Hide Plantation Layer",h.setLayoutProperty(We,"visibility","visible"))},document.getElementById("mapmenu").appendChild(Fe)}})});function J(Y){Kr(Y),Y.preventDefault()}function ee(){k=Ef(this),a(2,k),a(1,P)}const ge=()=>J(k);function _e(Y){h=Y,a(0,h)}return t.$$set=Y=>{"parishTitle"in Y&&a(5,c=Y.parishTitle)},[h,P,k,L,J,c,ee,ge,_e]}class US extends _i{constructor(n){super(),gi(this,n,OS,BS,di,{parishTitle:5})}}function NS(t){return t===0?!0:t}function ks(t){return NS(t)?Array.isArray(t)?n=>t.map(a=>typeof a!="function"?n[a]:a(n)):typeof t!="function"?n=>n[t]:t:null}function jS(t){const n={};for(const a of t){if(Object(a)!==a)throw new TypeError("iterable for fromEntries should yield objects");const{"0":c,"1":h}=a;Object.defineProperty(n,c,{configurable:!0,enumerable:!0,writable:!0,value:h})}return n}function Sf(t,n={}){return jS(Object.entries(t).filter(([a,c])=>c!==void 0&&n[a]===void 0))}function VS(t,n,{sort:a=!1}={}){if(!Array.isArray(t))throw new TypeError(`The first argument of calcUniques() must be an array. You passed in a ${typeof t}. If you got this error using the <LayerCake> component, consider passing a flat array to the \`flatData\` prop. More info: https://layercake.graphics/guide/#flatdata`);if(Array.isArray(n)||n===void 0||n===null)throw new TypeError("The second argument of calcUniques() must be an object with field names as keys as accessor functions as values.");const c={},h=Object.keys(n),p=h.length;let _,o,b,S,E,P,k;const L=t.length;for(_=0;_<p;_+=1){for(k=new Set,S=h[_],E=n[S],o=0;o<L;o+=1)if(P=E(t[o]),Array.isArray(P)){const q=P.length;for(b=0;b<q;b+=1)k.add(P[b])}else k.add(P);const j=Array.from(k);c[S]=a===!0?j.sort():j}return c}function qS(t,n){if(!Array.isArray(t))throw new TypeError(`The first argument of calcExtents() must be an array. You passed in a ${typeof t}. If you got this error using the <LayerCake> component, consider passing a flat array to the \`flatData\` prop. More info: https://layercake.graphics/guide/#flatdata`);if(Array.isArray(n)||n===void 0||n===null)throw new TypeError("The second argument of calcExtents() must be an object with field names as keys as accessor functions as values.");const a={},c=Object.keys(n),h=c.length;let p,_,o,b,S,E,P,k;const L=t.length;for(p=0;p<h;p+=1){for(b=c[p],P=n[b],S=null,E=null,_=0;_<L;_+=1)if(k=P(t[_]),Array.isArray(k)){const j=k.length;for(o=0;o<j;o+=1)k[o]!==!1&&k[o]!==void 0&&k[o]!==null&&Number.isNaN(k[o])===!1&&((S===null||k[o]<S)&&(S=k[o]),(E===null||k[o]>E)&&(E=k[o]))}else k!==!1&&k!==void 0&&k!==null&&Number.isNaN(k)===!1&&((S===null||k<S)&&(S=k),(E===null||k>E)&&(E=k));a[b]=[S,E]}return a}function GS(t){return typeof t.bandwidth=="function"||ZS(Object.keys(t),["domain","range","unknown","copy"])?"ordinal":"other"}function ZS(t,n){return t.length!==n.length?!1:t.every(a=>n.includes(a))}function HS(t,n,a){const c=Object.keys(a).reduce((p,_)=>{const o=GS(a[_]);return p[o]||(p[o]={}),p[o][_]=n[_],p},{ordinal:!1,other:!1});let h={};return c.ordinal&&(h=VS(t,c.ordinal)),c.other&&(h={...h,...qS(t,c.other)}),h}function WS(t=[],n){return Array.isArray(n)===!0?n.map((a,c)=>a===null?t[c]:a):t}function Eu(t){return function([a,c]){return typeof c=="function"&&(c=c(a[t])),a?WS(a[t],c):c}}const sc={x:Ss,y:Ss,z:Ss,r:FT};function XS(t){return t.constant?"symlog":t.base?"log":t.exponent?t.exponent()===.5?"sqrt":"pow":"other"}function eg(t){return t}function KS(t){return n=>Math.log(t*n)}function JS(t){return n=>t*Math.exp(n)}function YS(t){return n=>Math.sign(n)*Math.log1p(Math.abs(n/t))}function QS(t){return n=>Math.sign(n)*Math.expm1(Math.abs(n))*t}function Cu(t){return function(a){return a<0?-Math.pow(-a,t):Math.pow(a,t)}}function $S(t){const n=XS(t);if(n==="log"){const a=Math.sign(t.domain()[0]);return{lift:KS(a),ground:JS(a),scaleType:n}}return n==="pow"?{lift:Cu(1),ground:Cu(1/1),scaleType:n}:n==="sqrt"?{lift:Cu(.5),ground:Cu(1/.5),scaleType:n}:n==="symlog"?{lift:YS(1),ground:QS(1),scaleType:n}:{lift:eg,ground:eg,scaleType:n}}function e3(t,n){if(typeof t.range!="function")throw new Error("Scale method `range` must be a function");if(typeof t.domain!="function")throw new Error("Scale method `domain` must be a function");if(!Array.isArray(n))return t.domain();t.domain().length!==2&&console.warn("[LayerCake] The scale is expected to have a domain of length 2 to use padding. Are you sure you want to use padding? Your scale's domain is:",t.domain()),t.range().length!==2&&console.warn("[LayerCake] The scale is expected to have a range of length 2 to use padding. Are you sure you want to use padding? Your scale's range is:",t.range());const{lift:a,ground:c}=$S(t),h=t.domain()[0],p=Object.prototype.toString.call(h)==="[object Date]",[_,o]=t.domain().map(L=>a(p?L.getTime():L)),[b,S]=t.range(),E=n[0]||0,P=n[1]||0,k=(o-_)/(Math.abs(S-b)-E-P);return[_-E*k,P*k+o].map(L=>c(p?new Date(L):L))}function t3(t,n,a,c,h){let p,_;return h===!0?(p=0,_=100):(p=t==="r"?1:0,_=t==="y"?a:t==="r"?25:n),c===!0?[_,p]:[p,_]}function i3(t,n,a,c,h,p){return h?typeof h=="function"?h({width:n,height:a}):h:t3(t,n,a,c,p)}function Au(t){return function([a,c,h,p,_,o,b,S,E,P]){if(c===null)return null;const k=i3(t,b,S,o,E,P),L=a===sc[t]?a():a.copy();return L.domain(h),(!L.interpolator||typeof L.interpolator=="function"&&L.interpolator().name.startsWith("identity"))&&L.range(k),p&&L.domain(e3(L,p)),(_===!0||typeof _=="number")&&(typeof L.nice=="function"?L.nice(typeof _=="number"?_:void 0):console.error(`[Layer Cake] You set \`${t}Nice: true\` but the ${t}Scale does not have a \`.nice\` method. Ignoring...`)),L}}function Iu([t,n]){return a=>{const c=t(a);return Array.isArray(c)?c.map(h=>n(h)):n(c)}}function Mu([t]){if(typeof t=="function"){if(typeof t.range=="function")return t.range();console.error("[LayerCake] Your scale doesn't have a `.range` method?")}return null}const n3=t=>({element:t[0]&4,width:t[0]&256,height:t[0]&512,aspectRatio:t[0]&1024,containerWidth:t[0]&128,containerHeight:t[0]&64}),tg=t=>({element:t[2],width:t[8],height:t[9],aspectRatio:t[10],containerWidth:t[7],containerHeight:t[6]});function ig(t){let n,a,c;const h=t[90].default,p=kr(h,t,t[89],tg);return{c(){n=Ae("div"),p&&p.c(),O(n,"class","layercake-container svelte-vhzpsp"),Es(()=>t[92].call(n)),Ht(n,"position",t[5]),Ht(n,"top",t[5]==="absolute"?"0":null),Ht(n,"right",t[5]==="absolute"?"0":null),Ht(n,"bottom",t[5]==="absolute"?"0":null),Ht(n,"left",t[5]==="absolute"?"0":null),Ht(n,"pointer-events",t[4]===!1?"none":null)},m(_,o){fe(_,n,o),p&&p.m(n,null),t[91](n),a=h1(n,t[92].bind(n)),c=!0},p(_,o){p&&p.p&&(!c||o[0]&1988|o[2]&134217728)&&Er(p,h,_,_[89],c?Sr(h,_[89],o,n3):Cr(_[89]),tg),o[0]&32&&Ht(n,"position",_[5]),o[0]&32&&Ht(n,"top",_[5]==="absolute"?"0":null),o[0]&32&&Ht(n,"right",_[5]==="absolute"?"0":null),o[0]&32&&Ht(n,"bottom",_[5]==="absolute"?"0":null),o[0]&32&&Ht(n,"left",_[5]==="absolute"?"0":null),o[0]&16&&Ht(n,"pointer-events",_[4]===!1?"none":null)},i(_){c||(Ie(p,_),c=!0)},o(_){Re(p,_),c=!1},d(_){_&&ce(n),p&&p.d(_),t[91](null),a()}}}function r3(t){let n,a,c=(t[3]===!0||typeof window<"u")&&ig(t);return{c(){c&&c.c(),n=mr()},m(h,p){c&&c.m(h,p),fe(h,n,p),a=!0},p(h,p){h[3]===!0||typeof window<"u"?c?(c.p(h,p),p[0]&8&&Ie(c,1)):(c=ig(h),c.c(),Ie(c,1),c.m(n.parentNode,n)):c&&(Qn(),Re(c,1,1,()=>{c=null}),$n())},i(h){a||(Ie(c),a=!0)},o(h){Re(c),a=!1},d(h){c&&c.d(h),h&&ce(n)}}}function a3(t,n,a){let c,h,p,_,o,b,S,E,P,k,L,j,q,J,ee,ge,_e,Y,le,ie,ke,Je,ve,pe,Fe,$e,ct,We,mt,xe,Ne,Le,ut,Ze,qt,It,Ut,Kt,Jt,li,mi,{$$slots:Ji={},$$scope:rt}=n,{ssr:He=!1}=n,{pointerEvents:Mt=!0}=n,{position:Qe="relative"}=n,{percentRange:At=!1}=n,{width:ei=void 0}=n,{height:Ei=void 0}=n,{containerWidth:ci=ei||100}=n,{containerHeight:Nt=Ei||100}=n,{element:fi=void 0}=n,{x:Qt=void 0}=n,{y:fn=void 0}=n,{z:kn=void 0}=n,{r:Sn=void 0}=n,{data:Hn=[]}=n,{xDomain:Tt=void 0}=n,{yDomain:si=void 0}=n,{zDomain:Ui=void 0}=n,{rDomain:Qi=void 0}=n,{xNice:Oe=!1}=n,{yNice:Ee=!1}=n,{zNice:nn=!1}=n,{rNice:sn=!1}=n,{xPadding:Gt=void 0}=n,{yPadding:Ni=void 0}=n,{zPadding:gn=void 0}=n,{rPadding:_n=void 0}=n,{xScale:tr=sc.x}=n,{yScale:ot=sc.y}=n,{zScale:Xt=sc.z}=n,{rScale:Zt=sc.r}=n,{xRange:Wi=void 0}=n,{yRange:Un=void 0}=n,{zRange:jt=void 0}=n,{rRange:An=void 0}=n,{xReverse:Yi=!1}=n,{yReverse:Ar=typeof ot.bandwidth!="function"}=n,{zReverse:ji=!1}=n,{rReverse:on=!1}=n,{padding:bi={}}=n,{extents:Ir={}}=n,{flatData:Nn=void 0}=n,{custom:_r={}}=n,Mr=!1;Fn(()=>{Mr=!0});const ki={},In=vi(At);wt(t,In,Te=>a(128,Kt=Te));const K=vi(ci);wt(t,K,Te=>a(7,Ut=Te));const D=vi(Nt);wt(t,D,Te=>a(6,It=Te));const U=vi(Sf(Ir));wt(t,U,Te=>a(127,qt=Te));const W=vi(Hn);wt(t,W,Te=>a(126,Ze=Te));const X=vi(Nn||Hn);wt(t,X,Te=>a(125,ut=Te));const se=vi(bi);wt(t,se,Te=>a(124,Le=Te));const me=vi(ks(Qt));wt(t,me,Te=>a(123,Ne=Te));const he=vi(ks(fn));wt(t,he,Te=>a(122,xe=Te));const ae=vi(ks(kn));wt(t,ae,Te=>a(121,mt=Te));const ye=vi(ks(Sn));wt(t,ye,Te=>a(120,We=Te));const Ue=vi(Tt);wt(t,Ue,Te=>a(119,ct=Te));const Ye=vi(si);wt(t,Ye,Te=>a(118,$e=Te));const Be=vi(Ui);wt(t,Be,Te=>a(117,Fe=Te));const kt=vi(Qi);wt(t,kt,Te=>a(116,pe=Te));const St=vi(Oe);wt(t,St,Te=>a(115,ve=Te));const ht=vi(Ee);wt(t,ht,Te=>a(114,Je=Te));const Dt=vi(nn);wt(t,Dt,Te=>a(113,ke=Te));const Bt=vi(sn);wt(t,Bt,Te=>a(112,ie=Te));const ri=vi(Yi);wt(t,ri,Te=>a(111,le=Te));const Vt=vi(Ar);wt(t,Vt,Te=>a(110,Y=Te));const Wt=vi(ji);wt(t,Wt,Te=>a(109,_e=Te));const ai=vi(on);wt(t,ai,Te=>a(108,ge=Te));const wi=vi(Gt);wt(t,wi,Te=>a(107,ee=Te));const Xi=vi(Ni);wt(t,Xi,Te=>a(106,J=Te));const Ii=vi(gn);wt(t,Ii,Te=>a(105,q=Te));const $i=vi(_n);wt(t,$i,Te=>a(104,j=Te));const Pr=vi(Wi);wt(t,Pr,Te=>a(103,L=Te));const jr=vi(Un);wt(t,jr,Te=>a(102,k=Te));const Si=vi(jt);wt(t,Si,Te=>a(101,P=Te));const pa=vi(An);wt(t,pa,Te=>a(100,E=Te));const Jr=vi(tr);wt(t,Jr,Te=>a(99,S=Te));const da=vi(ot);wt(t,da,Te=>a(98,b=Te));const ma=vi(Xt);wt(t,ma,Te=>a(97,o=Te));const Yr=vi(Zt);wt(t,Yr,Te=>a(96,_=Te));const ns=vi(ki);wt(t,ns,Te=>a(94,h=Te));const Qr=vi(_r);wt(t,Qr,Te=>a(95,p=Te));const rs=an([me,he,ae,ye],([Te,ti,ir,ln])=>{const nr={};return Te&&(nr.x=Te),ti&&(nr.y=ti),ir&&(nr.z=ir),ln&&(nr.r=ln),nr}),As=an([se,K,D],([Te])=>Object.assign({top:0,right:0,bottom:0,left:0},Te)),Is=an([K,D,As],([Te,ti,ir])=>{const ln={};return ln.top=ir.top,ln.right=Te-ir.right,ln.bottom=ti-ir.bottom,ln.left=ir.left,ln.width=ln.right-ln.left,ln.height=ln.bottom-ln.top,ln.width<=0&&Mr===!0&&console.warn("[LayerCake] Target div has zero or negative width. Did you forget to set an explicit width in CSS on the container?"),ln.height<=0&&Mr===!0&&console.warn("[LayerCake] Target div has zero or negative height. Did you forget to set an explicit height in CSS on the container?"),ln}),zr=an([Is],([Te])=>Te.width);wt(t,zr,Te=>a(8,Jt=Te));const Mn=an([Is],([Te])=>Te.height);wt(t,Mn,Te=>a(9,li=Te));const jn=an([X,rs,U,Jr,da,Yr,ma],([Te,ti,ir,ln,nr,Ba,xo])=>{const Vn={x:ln,y:nr,r:Ba,z:xo},Fa=Sf(ti,ir),ls=Object.fromEntries(Object.keys(Fa).map(ga=>[ga,Vn[ga]]));return Object.keys(Fa).length>0?{...HS(Te,Fa,ls),...ir}:{}}),$r=an([jn,Ue],Eu("x")),za=an([jn,Ye],Eu("y")),Da=an([jn,Be],Eu("z")),ea=an([jn,kt],Eu("r")),La=an([Jr,jn,$r,wi,St,ri,zr,Mn,Pr,In],Au("x")),as=an([me,La],Iu),ta=an([da,jn,za,Xi,ht,Vt,zr,Mn,jr,In],Au("y")),Ri=an([he,ta],Iu),ia=an([ma,jn,Da,Ii,Dt,Wt,zr,Mn,Si,In],Au("z")),yo=an([ae,ia],Iu),ss=an([Yr,jn,ea,$i,Bt,ai,zr,Mn,pa,In],Au("r")),Ms=an([ye,ss],Iu),os=an([La],Mu),vo=an([ta],Mu),ol=an([ia],Mu),ll=an([ss],Mu),Ra=an([zr,Mn],([Te,ti])=>Te/ti);wt(t,Ra,Te=>a(10,mi=Te));function Ps(Te){Bn[Te?"unshift":"push"](()=>{fi=Te,a(2,fi)})}function zs(){ci=this.clientWidth,Nt=this.clientHeight,a(0,ci),a(1,Nt)}return t.$$set=Te=>{"ssr"in Te&&a(3,He=Te.ssr),"pointerEvents"in Te&&a(4,Mt=Te.pointerEvents),"position"in Te&&a(5,Qe=Te.position),"percentRange"in Te&&a(51,At=Te.percentRange),"width"in Te&&a(52,ei=Te.width),"height"in Te&&a(53,Ei=Te.height),"containerWidth"in Te&&a(0,ci=Te.containerWidth),"containerHeight"in Te&&a(1,Nt=Te.containerHeight),"element"in Te&&a(2,fi=Te.element),"x"in Te&&a(54,Qt=Te.x),"y"in Te&&a(55,fn=Te.y),"z"in Te&&a(56,kn=Te.z),"r"in Te&&a(57,Sn=Te.r),"data"in Te&&a(58,Hn=Te.data),"xDomain"in Te&&a(59,Tt=Te.xDomain),"yDomain"in Te&&a(60,si=Te.yDomain),"zDomain"in Te&&a(61,Ui=Te.zDomain),"rDomain"in Te&&a(62,Qi=Te.rDomain),"xNice"in Te&&a(63,Oe=Te.xNice),"yNice"in Te&&a(64,Ee=Te.yNice),"zNice"in Te&&a(65,nn=Te.zNice),"rNice"in Te&&a(66,sn=Te.rNice),"xPadding"in Te&&a(67,Gt=Te.xPadding),"yPadding"in Te&&a(68,Ni=Te.yPadding),"zPadding"in Te&&a(69,gn=Te.zPadding),"rPadding"in Te&&a(70,_n=Te.rPadding),"xScale"in Te&&a(71,tr=Te.xScale),"yScale"in Te&&a(72,ot=Te.yScale),"zScale"in Te&&a(73,Xt=Te.zScale),"rScale"in Te&&a(74,Zt=Te.rScale),"xRange"in Te&&a(75,Wi=Te.xRange),"yRange"in Te&&a(76,Un=Te.yRange),"zRange"in Te&&a(77,jt=Te.zRange),"rRange"in Te&&a(78,An=Te.rRange),"xReverse"in Te&&a(79,Yi=Te.xReverse),"yReverse"in Te&&a(80,Ar=Te.yReverse),"zReverse"in Te&&a(81,ji=Te.zReverse),"rReverse"in Te&&a(82,on=Te.rReverse),"padding"in Te&&a(83,bi=Te.padding),"extents"in Te&&a(84,Ir=Te.extents),"flatData"in Te&&a(85,Nn=Te.flatData),"custom"in Te&&a(86,_r=Te.custom),"$$scope"in Te&&a(89,rt=Te.$$scope)},t.$$.update=()=>{t.$$.dirty[1]&8388608&&Qt&&a(87,ki.x=Qt,ki),t.$$.dirty[1]&16777216&&fn&&a(87,ki.y=fn,ki),t.$$.dirty[1]&33554432&&kn&&a(87,ki.z=kn,ki),t.$$.dirty[1]&67108864&&Sn&&a(87,ki.r=Sn,ki),t.$$.dirty[1]&268435456&&Tt&&a(87,ki.xDomain=Tt,ki),t.$$.dirty[1]&536870912&&si&&a(87,ki.yDomain=si,ki),t.$$.dirty[1]&1073741824&&Ui&&a(87,ki.zDomain=Ui,ki),t.$$.dirty[2]&1&&Qi&&a(87,ki.rDomain=Qi,ki),t.$$.dirty[2]&8192&&Wi&&a(87,ki.xRange=Wi,ki),t.$$.dirty[2]&16384&&Un&&a(87,ki.yRange=Un,ki),t.$$.dirty[2]&32768&&jt&&a(87,ki.zRange=jt,ki),t.$$.dirty[2]&65536&&An&&a(87,ki.rRange=An,ki),t.$$.dirty[1]&1048576&&Ti(In,Kt=At,Kt),t.$$.dirty[0]&1&&Ti(K,Ut=ci,Ut),t.$$.dirty[0]&2&&Ti(D,It=Nt,It),t.$$.dirty[2]&4194304&&Ti(U,qt=Sf(Ir),qt),t.$$.dirty[1]&134217728&&Ti(W,Ze=Hn,Ze),t.$$.dirty[1]&134217728|t.$$.dirty[2]&8388608&&Ti(X,ut=Nn||Hn,ut),t.$$.dirty[2]&2097152&&Ti(se,Le=bi,Le),t.$$.dirty[1]&8388608&&Ti(me,Ne=ks(Qt),Ne),t.$$.dirty[1]&16777216&&Ti(he,xe=ks(fn),xe),t.$$.dirty[1]&33554432&&Ti(ae,mt=ks(kn),mt),t.$$.dirty[1]&67108864&&Ti(ye,We=ks(Sn),We),t.$$.dirty[1]&268435456&&Ti(Ue,ct=Tt,ct),t.$$.dirty[1]&536870912&&Ti(Ye,$e=si,$e),t.$$.dirty[1]&1073741824&&Ti(Be,Fe=Ui,Fe),t.$$.dirty[2]&1&&Ti(kt,pe=Qi,pe),t.$$.dirty[2]&2&&Ti(St,ve=Oe,ve),t.$$.dirty[2]&4&&Ti(ht,Je=Ee,Je),t.$$.dirty[2]&8&&Ti(Dt,ke=nn,ke),t.$$.dirty[2]&16&&Ti(Bt,ie=sn,ie),t.$$.dirty[2]&131072&&Ti(ri,le=Yi,le),t.$$.dirty[2]&262144&&Ti(Vt,Y=Ar,Y),t.$$.dirty[2]&524288&&Ti(Wt,_e=ji,_e),t.$$.dirty[2]&1048576&&Ti(ai,ge=on,ge),t.$$.dirty[2]&32&&Ti(wi,ee=Gt,ee),t.$$.dirty[2]&64&&Ti(Xi,J=Ni,J),t.$$.dirty[2]&128&&Ti(Ii,q=gn,q),t.$$.dirty[2]&256&&Ti($i,j=_n,j),t.$$.dirty[2]&8192&&Ti(Pr,L=Wi,L),t.$$.dirty[2]&16384&&Ti(jr,k=Un,k),t.$$.dirty[2]&32768&&Ti(Si,P=jt,P),t.$$.dirty[2]&65536&&Ti(pa,E=An,E),t.$$.dirty[2]&512&&Ti(Jr,S=tr,S),t.$$.dirty[2]&1024&&Ti(da,b=ot,b),t.$$.dirty[2]&2048&&Ti(ma,o=Xt,o),t.$$.dirty[2]&4096&&Ti(Yr,_=Zt,_),t.$$.dirty[2]&16777216&&Ti(Qr,p=_r,p),t.$$.dirty[2]&33554432&&Ti(ns,h=ki,h),t.$$.dirty[2]&67108864&&$o("LayerCake",c)},a(88,c={activeGetters:rs,width:zr,height:Mn,percentRange:In,aspectRatio:Ra,containerWidth:K,containerHeight:D,x:me,y:he,z:ae,r:ye,custom:Qr,data:W,xNice:St,yNice:ht,zNice:Dt,rNice:Bt,xReverse:ri,yReverse:Vt,zReverse:Wt,rReverse:ai,xPadding:wi,yPadding:Xi,zPadding:Ii,rPadding:$i,padding:As,flatData:X,extents:jn,xDomain:$r,yDomain:za,zDomain:Da,rDomain:ea,xRange:os,yRange:vo,zRange:ol,rRange:ll,config:ns,xScale:La,xGet:as,yScale:ta,yGet:Ri,zScale:ia,zGet:yo,rScale:ss,rGet:Ms}),[ci,Nt,fi,He,Mt,Qe,It,Ut,Jt,li,mi,In,K,D,U,W,X,se,me,he,ae,ye,Ue,Ye,Be,kt,St,ht,Dt,Bt,ri,Vt,Wt,ai,wi,Xi,Ii,$i,Pr,jr,Si,pa,Jr,da,ma,Yr,ns,Qr,zr,Mn,Ra,At,ei,Ei,Qt,fn,kn,Sn,Hn,Tt,si,Ui,Qi,Oe,Ee,nn,sn,Gt,Ni,gn,_n,tr,ot,Xt,Zt,Wi,Un,jt,An,Yi,Ar,ji,on,bi,Ir,Nn,_r,ki,c,rt,Ji,Ps,zs]}class fo extends _i{constructor(n){super(),gi(this,n,a3,r3,di,{ssr:3,pointerEvents:4,position:5,percentRange:51,width:52,height:53,containerWidth:0,containerHeight:1,element:2,x:54,y:55,z:56,r:57,data:58,xDomain:59,yDomain:60,zDomain:61,rDomain:62,xNice:63,yNice:64,zNice:65,rNice:66,xPadding:67,yPadding:68,zPadding:69,rPadding:70,xScale:71,yScale:72,zScale:73,rScale:74,xRange:75,yRange:76,zRange:77,rRange:78,xReverse:79,yReverse:80,zReverse:81,rReverse:82,padding:83,extents:84,flatData:85,custom:86},null,[-1,-1,-1,-1,-1])}}const s3=t=>({element:t&1}),ng=t=>({element:t[0]});function o3(t){let n,a;const c=t[6].default,h=kr(c,t,t[5],ng);return{c(){n=Ae("div"),h&&h.c(),O(n,"class","layercake-layout-html svelte-1bu60uu"),Ht(n,"z-index",t[1]),Ht(n,"pointer-events",t[2]===!1?"none":null),Ht(n,"top",t[3].top+"px"),Ht(n,"right",t[3].right+"px"),Ht(n,"bottom",t[3].bottom+"px"),Ht(n,"left",t[3].left+"px")},m(p,_){fe(p,n,_),h&&h.m(n,null),t[7](n),a=!0},p(p,[_]){h&&h.p&&(!a||_&33)&&Er(h,c,p,p[5],a?Sr(c,p[5],_,s3):Cr(p[5]),ng),_&2&&Ht(n,"z-index",p[1]),_&4&&Ht(n,"pointer-events",p[2]===!1?"none":null),_&8&&Ht(n,"top",p[3].top+"px"),_&8&&Ht(n,"right",p[3].right+"px"),_&8&&Ht(n,"bottom",p[3].bottom+"px"),_&8&&Ht(n,"left",p[3].left+"px")},i(p){a||(Ie(h,p),a=!0)},o(p){Re(h,p),a=!1},d(p){p&&ce(n),h&&h.d(p),t[7](null)}}}function l3(t,n,a){let c,{$$slots:h={},$$scope:p}=n,{element:_=void 0}=n,{zIndex:o=void 0}=n,{pointerEvents:b=void 0}=n;const{padding:S}=fr("LayerCake");wt(t,S,P=>a(3,c=P));function E(P){Bn[P?"unshift":"push"](()=>{_=P,a(0,_)})}return t.$$set=P=>{"element"in P&&a(0,_=P.element),"zIndex"in P&&a(1,o=P.zIndex),"pointerEvents"in P&&a(2,b=P.pointerEvents),"$$scope"in P&&a(5,p=P.$$scope)},[_,o,b,c,S,p,h,E]}class go extends _i{constructor(n){super(),gi(this,n,l3,o3,di,{element:0,zIndex:1,pointerEvents:2})}}const c3=t=>({element:t&1}),rg=t=>({element:t[0]}),u3=t=>({element:t&1}),ag=t=>({element:t[0]});function h3(t){let n,a,c,h,p;const _=t[12].defs,o=kr(_,t,t[11],ag),b=t[12].default,S=kr(b,t,t[11],rg);return{c(){n=$t("svg"),a=$t("defs"),o&&o.c(),c=$t("g"),S&&S.c(),O(c,"class","layercake-layout-svg_g"),O(c,"transform",h="translate("+t[7].left+", "+t[7].top+")"),O(n,"class","layercake-layout-svg svelte-u84d8d"),O(n,"viewBox",t[4]),O(n,"width",t[5]),O(n,"height",t[6]),Ht(n,"z-index",t[2]),Ht(n,"pointer-events",t[3]===!1?"none":null)},m(E,P){fe(E,n,P),ue(n,a),o&&o.m(a,null),ue(n,c),S&&S.m(c,null),t[13](c),t[14](n),p=!0},p(E,[P]){o&&o.p&&(!p||P&2049)&&Er(o,_,E,E[11],p?Sr(_,E[11],P,u3):Cr(E[11]),ag),S&&S.p&&(!p||P&2049)&&Er(S,b,E,E[11],p?Sr(b,E[11],P,c3):Cr(E[11]),rg),(!p||P&128&&h!==(h="translate("+E[7].left+", "+E[7].top+")"))&&O(c,"transform",h),(!p||P&16)&&O(n,"viewBox",E[4]),(!p||P&32)&&O(n,"width",E[5]),(!p||P&64)&&O(n,"height",E[6]),P&4&&Ht(n,"z-index",E[2]),P&8&&Ht(n,"pointer-events",E[3]===!1?"none":null)},i(E){p||(Ie(o,E),Ie(S,E),p=!0)},o(E){Re(o,E),Re(S,E),p=!1},d(E){E&&ce(n),o&&o.d(E),S&&S.d(E),t[13](null),t[14](null)}}}function f3(t,n,a){let c,h,p,{$$slots:_={},$$scope:o}=n,{element:b=void 0}=n,{innerElement:S=void 0}=n,{zIndex:E=void 0}=n,{pointerEvents:P=void 0}=n,{viewBox:k=void 0}=n;const{containerWidth:L,containerHeight:j,padding:q}=fr("LayerCake");wt(t,L,ge=>a(5,c=ge)),wt(t,j,ge=>a(6,h=ge)),wt(t,q,ge=>a(7,p=ge));function J(ge){Bn[ge?"unshift":"push"](()=>{S=ge,a(1,S)})}function ee(ge){Bn[ge?"unshift":"push"](()=>{b=ge,a(0,b)})}return t.$$set=ge=>{"element"in ge&&a(0,b=ge.element),"innerElement"in ge&&a(1,S=ge.innerElement),"zIndex"in ge&&a(2,E=ge.zIndex),"pointerEvents"in ge&&a(3,P=ge.pointerEvents),"viewBox"in ge&&a(4,k=ge.viewBox),"$$scope"in ge&&a(11,o=ge.$$scope)},[b,S,E,P,k,c,h,p,L,j,q,o,_,J,ee]}class _o extends _i{constructor(n){super(),gi(this,n,f3,h3,di,{element:0,innerElement:1,zIndex:2,pointerEvents:3,viewBox:4})}}function sg(t,n,a){const c=t.slice();return c[18]=n[a],c[20]=a,c}function og(t){let n,a,c,h,p,_,o;function b(...P){return t[13](t[18],...P)}function S(...P){return t[14](t[18],...P)}function E(...P){return t[15](t[18],...P)}return{c(){n=$t("rect"),O(n,"class","group-rect"),O(n,"data-id",t[20]),O(n,"x",a=t[2].range()[0]),O(n,"y",c=t[3](t[18])),O(n,"height",h=t[4].bandwidth()),O(n,"width",p=t[5](t[18])),O(n,"fill",t[0])},m(P,k){fe(P,n,k),_||(o=[Hi(n,"mouseover",b),Hi(n,"focus",S),Hi(n,"mousemove",E)],_=!0)},p(P,k){t=P,k&4&&a!==(a=t[2].range()[0])&&O(n,"x",a),k&10&&c!==(c=t[3](t[18]))&&O(n,"y",c),k&16&&h!==(h=t[4].bandwidth())&&O(n,"height",h),k&34&&p!==(p=t[5](t[18]))&&O(n,"width",p),k&1&&O(n,"fill",t[0])},d(P){P&&ce(n),_=!1,dr(o)}}}function p3(t){let n,a,c,h=t[1],p=[];for(let _=0;_<h.length;_+=1)p[_]=og(sg(t,h,_));return{c(){n=$t("g");for(let _=0;_<p.length;_+=1)p[_].c();O(n,"class","bar-group")},m(_,o){fe(_,n,o);for(let b=0;b<p.length;b+=1)p[b].m(n,null);a||(c=[Hi(n,"mouseout",t[16]),Hi(n,"blur",t[17])],a=!0)},p(_,[o]){if(o&6207){h=_[1];let b;for(b=0;b<h.length;b+=1){const S=sg(_,h,b);p[b]?p[b].p(S,o):(p[b]=og(S),p[b].c(),p[b].m(n,null))}for(;b<p.length;b+=1)p[b].d(1);p.length=h.length}},i:Ft,o:Ft,d(_){_&&ce(n),Ia(p,_),a=!1,dr(c)}}}function d3(t,n,a){let c,h,p,_,o;const{data:b,xGet:S,yGet:E,xScale:P,yScale:k}=fr("LayerCake");wt(t,b,le=>a(1,c=le)),wt(t,S,le=>a(5,o=le)),wt(t,E,le=>a(3,p=le)),wt(t,P,le=>a(2,h=le)),wt(t,k,le=>a(4,_=le));let{fill:L="#97dfd1"}=n;const j=sl();function q(le){return function(ke){raise(this),ke.layerX!==0&&ke.layerY!==0&&j("mousemove",{e:ke})}}const J=(le,ie)=>j("mousemove",{e:ie,props:le}),ee=(le,ie)=>j("mousemove",{e:ie,props:le}),ge=(le,ie)=>q(),_e=le=>j("mouseout"),Y=le=>j("mouseout");return t.$$set=le=>{"fill"in le&&a(0,L=le.fill)},[L,c,h,p,_,o,b,S,E,P,k,j,q,J,ee,ge,_e,Y]}class ch extends _i{constructor(n){super(),gi(this,n,d3,p3,di,{fill:0})}}function lg(t,n,a){const c=t.slice();return c[19]=n[a],c[21]=a,c}function cg(t){let n,a;return{c(){n=$t("line"),O(n,"class","gridline svelte-19phsub"),O(n,"y1",a=t[11]*-1),O(n,"y2","0"),O(n,"x1","0"),O(n,"x2","0")},m(c,h){fe(c,n,h)},p(c,h){h&2048&&a!==(a=c[11]*-1)&&O(n,"y1",a)},d(c){c&&ce(n)}}}function ug(t){let n,a,c;return{c(){n=$t("line"),O(n,"class","tick-mark svelte-19phsub"),O(n,"y1",0),O(n,"y2",6),O(n,"x1",a=t[5]||t[7]?t[8].bandwidth()/2:0),O(n,"x2",c=t[5]||t[7]?t[8].bandwidth()/2:0)},m(h,p){fe(h,n,p)},p(h,p){p&416&&a!==(a=h[5]||h[7]?h[8].bandwidth()/2:0)&&O(n,"x1",a),p&416&&c!==(c=h[5]||h[7]?h[8].bandwidth()/2:0)&&O(n,"x2",c)},d(h){h&&ce(n)}}}function hg(t,n){let a,c,h,p=n[4](n[19])+"",_,o,b,S,E,P=n[0]!==!1&&cg(n),k=n[1]===!0&&ug(n);return{key:t,first:null,c(){a=$t("g"),P&&P.c(),c=mr(),k&&k.c(),h=$t("text"),_=st(p),O(h,"x",o=n[5]||n[7]?n[8].bandwidth()/2:0),O(h,"y",n[6]),O(h,"dx",""),O(h,"dy",""),O(h,"text-anchor",b=n[17](n[21])),O(h,"class","svelte-19phsub"),O(a,"class",S="tick tick-"+n[21]+" svelte-19phsub"),O(a,"transform",E="translate("+n[8](n[19])+","+Math.max(...n[10])+")"),this.first=a},m(L,j){fe(L,a,j),P&&P.m(a,null),ue(a,c),k&&k.m(a,null),ue(a,h),ue(h,_)},p(L,j){n=L,n[0]!==!1?P?P.p(n,j):(P=cg(n),P.c(),P.m(a,c)):P&&(P.d(1),P=null),n[1]===!0?k?k.p(n,j):(k=ug(n),k.c(),k.m(a,h)):k&&(k.d(1),k=null),j&528&&p!==(p=n[4](n[19])+"")&&hi(_,p),j&416&&o!==(o=n[5]||n[7]?n[8].bandwidth()/2:0)&&O(h,"x",o),j&64&&O(h,"y",n[6]),j&512&&b!==(b=n[17](n[21]))&&O(h,"text-anchor",b),j&512&&S!==(S="tick tick-"+n[21]+" svelte-19phsub")&&O(a,"class",S),j&1792&&E!==(E="translate("+n[8](n[19])+","+Math.max(...n[10])+")")&&O(a,"transform",E)},d(L){L&&ce(a),P&&P.d(),k&&k.d()}}}function fg(t){let n,a,c;return{c(){n=$t("line"),O(n,"class","baseline svelte-19phsub"),O(n,"y1",a=t[11]+.5),O(n,"y2",c=t[11]+.5),O(n,"x1","0"),O(n,"x2",t[12])},m(h,p){fe(h,n,p)},p(h,p){p&2048&&a!==(a=h[11]+.5)&&O(n,"y1",a),p&2048&&c!==(c=h[11]+.5)&&O(n,"y2",c),p&4096&&O(n,"x2",h[12])},d(h){h&&ce(n)}}}function m3(t){let n,a=[],c=new Map,h,p=t[9];const _=b=>b[19];for(let b=0;b<p.length;b+=1){let S=lg(t,p,b),E=_(S);c.set(E,a[b]=hg(E,S))}let o=t[2]===!0&&fg(t);return{c(){n=$t("g");for(let b=0;b<a.length;b+=1)a[b].c();h=mr(),o&&o.c(),O(n,"class","axis x-axis svelte-19phsub"),Fu(n,"snapTicks",t[3])},m(b,S){fe(b,n,S);for(let E=0;E<a.length;E+=1)a[E].m(n,null);ue(n,h),o&&o.m(n,null)},p(b,[S]){S&135155&&(p=b[9],a=c_(a,S,_,1,b,p,c,n,l_,hg,h,lg)),b[2]===!0?o?o.p(b,S):(o=fg(b),o.c(),o.m(n,null)):o&&(o.d(1),o=null),S&8&&Fu(n,"snapTicks",b[3])},i:Ft,o:Ft,d(b){b&&ce(n);for(let S=0;S<a.length;S+=1)a[S].d();o&&o.d()}}}function g3(t,n,a){let c,h,p,_,o,b;const{width:S,height:E,xScale:P,yRange:k}=fr("LayerCake");wt(t,S,ie=>a(12,b=ie)),wt(t,E,ie=>a(11,o=ie)),wt(t,P,ie=>a(8,p=ie)),wt(t,k,ie=>a(10,_=ie));let{gridlines:L=!0}=n,{tickMarks:j=!1}=n,{baseline:q=!1}=n,{snapTicks:J=!1}=n,{formatTick:ee=ie=>ie}=n,{ticks:ge=void 0}=n,{xTick:_e=0}=n,{yTick:Y=16}=n;function le(ie){if(J===!0){if(ie===0)return"start";if(ie===h.length-1)return"end"}return"middle"}return t.$$set=ie=>{"gridlines"in ie&&a(0,L=ie.gridlines),"tickMarks"in ie&&a(1,j=ie.tickMarks),"baseline"in ie&&a(2,q=ie.baseline),"snapTicks"in ie&&a(3,J=ie.snapTicks),"formatTick"in ie&&a(4,ee=ie.formatTick),"ticks"in ie&&a(18,ge=ie.ticks),"xTick"in ie&&a(5,_e=ie.xTick),"yTick"in ie&&a(6,Y=ie.yTick)},t.$$.update=()=>{t.$$.dirty&256&&a(7,c=typeof p.bandwidth=="function"),t.$$.dirty&262528&&a(9,h=Array.isArray(ge)?ge:c?p.domain():typeof ge=="function"?ge(p.ticks()):p.ticks(ge))},[L,j,q,J,ee,_e,Y,c,p,h,_,o,b,S,E,P,k,le,ge]}class ts extends _i{constructor(n){super(),gi(this,n,g3,m3,di,{gridlines:0,tickMarks:1,baseline:2,snapTicks:3,formatTick:4,ticks:18,xTick:5,yTick:6})}}function pg(t,n,a){const c=t.slice();return c[17]=n[a],c}function dg(t){let n,a,c;return{c(){n=$t("line"),O(n,"class","gridline svelte-df3iti"),O(n,"x2","100%"),O(n,"y1",a=t[4]+(t[8]?t[9].bandwidth()/2:0)),O(n,"y2",c=t[4]+(t[8]?t[9].bandwidth()/2:0))},m(h,p){fe(h,n,p)},p(h,p){p&784&&a!==(a=h[4]+(h[8]?h[9].bandwidth()/2:0))&&O(n,"y1",a),p&784&&c!==(c=h[4]+(h[8]?h[9].bandwidth()/2:0))&&O(n,"y2",c)},d(h){h&&ce(n)}}}function mg(t){let n,a,c,h;return{c(){n=$t("line"),O(n,"class","tick-mark svelte-df3iti"),O(n,"x1","0"),O(n,"x2",a=t[8]?-6:6),O(n,"y1",c=t[4]+(t[8]?t[9].bandwidth()/2:0)),O(n,"y2",h=t[4]+(t[8]?t[9].bandwidth()/2:0))},m(p,_){fe(p,n,_)},p(p,_){_&256&&a!==(a=p[8]?-6:6)&&O(n,"x2",a),_&784&&c!==(c=p[4]+(p[8]?p[9].bandwidth()/2:0))&&O(n,"y1",c),_&784&&h!==(h=p[4]+(p[8]?p[9].bandwidth()/2:0))&&O(n,"y2",h)},d(p){p&&ce(n)}}}function gg(t,n){let a,c,h,p=n[2](n[17])+"",_,o,b,S,E,P,k=n[0]!==!1&&dg(n),L=n[1]===!0&&mg(n);return{key:t,first:null,c(){a=$t("g"),k&&k.c(),c=mr(),L&&L.c(),h=$t("text"),_=st(p),O(h,"x",n[3]),O(h,"y",o=n[4]+(n[8]?n[9].bandwidth()/2:0)),O(h,"dx",b=n[8]?-9:n[5]),O(h,"dy",S=n[8]?4:n[6]),Ht(h,"text-anchor",n[8]?"end":n[7]),O(h,"class","svelte-df3iti"),O(a,"class",E="tick tick-"+n[17]+" svelte-df3iti"),O(a,"transform",P="translate("+(n[12][0]+(n[8]?n[11].left:0))+", "+n[9](n[17])+")"),this.first=a},m(j,q){fe(j,a,q),k&&k.m(a,null),ue(a,c),L&&L.m(a,null),ue(a,h),ue(h,_)},p(j,q){n=j,n[0]!==!1?k?k.p(n,q):(k=dg(n),k.c(),k.m(a,c)):k&&(k.d(1),k=null),n[1]===!0?L?L.p(n,q):(L=mg(n),L.c(),L.m(a,h)):L&&(L.d(1),L=null),q&1028&&p!==(p=n[2](n[17])+"")&&hi(_,p),q&8&&O(h,"x",n[3]),q&784&&o!==(o=n[4]+(n[8]?n[9].bandwidth()/2:0))&&O(h,"y",o),q&288&&b!==(b=n[8]?-9:n[5])&&O(h,"dx",b),q&320&&S!==(S=n[8]?4:n[6])&&O(h,"dy",S),q&384&&Ht(h,"text-anchor",n[8]?"end":n[7]),q&1024&&E!==(E="tick tick-"+n[17]+" svelte-df3iti")&&O(a,"class",E),q&7936&&P!==(P="translate("+(n[12][0]+(n[8]?n[11].left:0))+", "+n[9](n[17])+")")&&O(a,"transform",P)},d(j){j&&ce(a),k&&k.d(),L&&L.d()}}}function _3(t){let n,a=[],c=new Map,h,p=t[10];const _=o=>o[17];for(let o=0;o<p.length;o+=1){let b=pg(t,p,o),S=_(b);c.set(S,a[o]=gg(S,b))}return{c(){n=$t("g");for(let o=0;o<a.length;o+=1)a[o].c();O(n,"class","axis y-axis"),O(n,"transform",h="translate("+-t[11].left+", 0)")},m(o,b){fe(o,n,b);for(let S=0;S<a.length;S+=1)a[S].m(n,null)},p(o,[b]){b&8191&&(p=o[10],a=c_(a,b,_,1,o,p,c,n,l_,gg,null,pg)),b&2048&&h!==(h="translate("+-o[11].left+", 0)")&&O(n,"transform",h)},i:Ft,o:Ft,d(o){o&&ce(n);for(let b=0;b<a.length;b+=1)a[b].d()}}}function y3(t,n,a){let c,h,p,_,o;const{padding:b,xRange:S,yScale:E}=fr("LayerCake");wt(t,b,Y=>a(11,_=Y)),wt(t,S,Y=>a(12,o=Y)),wt(t,E,Y=>a(9,p=Y));let{gridlines:P=!0}=n,{tickMarks:k=!1}=n,{formatTick:L=Y=>Y}=n,{ticks:j=4}=n,{xTick:q=0}=n,{yTick:J=0}=n,{dxTick:ee=0}=n,{dyTick:ge=-4}=n,{textAnchor:_e="start"}=n;return t.$$set=Y=>{"gridlines"in Y&&a(0,P=Y.gridlines),"tickMarks"in Y&&a(1,k=Y.tickMarks),"formatTick"in Y&&a(2,L=Y.formatTick),"ticks"in Y&&a(16,j=Y.ticks),"xTick"in Y&&a(3,q=Y.xTick),"yTick"in Y&&a(4,J=Y.yTick),"dxTick"in Y&&a(5,ee=Y.dxTick),"dyTick"in Y&&a(6,ge=Y.dyTick),"textAnchor"in Y&&a(7,_e=Y.textAnchor)},t.$$.update=()=>{t.$$.dirty&512&&a(8,c=typeof p.bandwidth=="function"),t.$$.dirty&66304&&a(10,h=Array.isArray(j)?j:c?p.domain():typeof j=="function"?j(p.ticks()):p.ticks(j))},[P,k,L,q,J,ee,ge,_e,c,p,h,_,o,b,S,E,j]}class is extends _i{constructor(n){super(),gi(this,n,y3,_3,di,{gridlines:0,tickMarks:1,formatTick:2,ticks:16,xTick:3,yTick:4,dxTick:5,dyTick:6,textAnchor:7})}}const v3=t=>({detail:t&2}),_g=t=>({detail:t[1].detail}),x3=t=>({detail:t&1}),yg=t=>({detail:t[0].detail});function vg(t){let n,a;const c=t[4].default,h=kr(c,t,t[3],yg);return{c(){n=Ae("div"),h&&h.c(),O(n,"class","tooltip svelte-12op57k"),Ht(n,"top",t[0].detail.e.layerY+"px"),Ht(n,"left",t[0].detail.e.layerX-t[2]+"px")},m(p,_){fe(p,n,_),h&&h.m(n,null),a=!0},p(p,_){h&&h.p&&(!a||_&9)&&Er(h,c,p,p[3],a?Sr(c,p[3],_,x3):Cr(p[3]),yg),(!a||_&1)&&Ht(n,"top",p[0].detail.e.layerY+"px"),(!a||_&5)&&Ht(n,"left",p[0].detail.e.layerX-p[2]+"px")},i(p){a||(Ie(h,p),a=!0)},o(p){Re(h,p),a=!1},d(p){p&&ce(n),h&&h.d(p)}}}function xg(t){let n,a;const c=t[4].default,h=kr(c,t,t[3],_g);return{c(){n=Ae("div"),h&&h.c(),O(n,"class","tooltip svelte-12op57k"),Ht(n,"top",t[1].detail.e.layerY+"px"),Ht(n,"left",t[1].detail.e.layerX-t[2]+"px")},m(p,_){fe(p,n,_),h&&h.m(n,null),a=!0},p(p,_){h&&h.p&&(!a||_&10)&&Er(h,c,p,p[3],a?Sr(c,p[3],_,v3):Cr(p[3]),_g),(!a||_&2)&&Ht(n,"top",p[1].detail.e.layerY+"px"),(!a||_&6)&&Ht(n,"left",p[1].detail.e.layerX-p[2]+"px")},i(p){a||(Ie(h,p),a=!0)},o(p){Re(h,p),a=!1},d(p){p&&ce(n),h&&h.d(p)}}}function b3(t){let n,a,c,h=t[0].detail&&vg(t),p=t[1].detail&&xg(t);return{c(){h&&h.c(),n=Ge(),p&&p.c(),a=mr()},m(_,o){h&&h.m(_,o),fe(_,n,o),p&&p.m(_,o),fe(_,a,o),c=!0},p(_,[o]){_[0].detail?h?(h.p(_,o),o&1&&Ie(h,1)):(h=vg(_),h.c(),Ie(h,1),h.m(n.parentNode,n)):h&&(Qn(),Re(h,1,1,()=>{h=null}),$n()),_[1].detail?p?(p.p(_,o),o&2&&Ie(p,1)):(p=xg(_),p.c(),Ie(p,1),p.m(a.parentNode,a)):p&&(Qn(),Re(p,1,1,()=>{p=null}),$n())},i(_){c||(Ie(h),Ie(p),c=!0)},o(_){Re(h),Re(p),c=!1},d(_){h&&h.d(_),_&&ce(n),p&&p.d(_),_&&ce(a)}}}function w3(t,n,a){let{$$slots:c={},$$scope:h}=n,{evt:p={}}=n,{evt2:_={}}=n,{offset:o=50}=n;return t.$$set=b=>{"evt"in b&&a(0,p=b.evt),"evt2"in b&&a(1,_=b.evt2),"offset"in b&&a(2,o=b.offset),"$$scope"in b&&a(3,h=b.$$scope)},[p,_,o,h,c]}class bc extends _i{constructor(n){super(),gi(this,n,w3,b3,di,{evt:0,evt2:1,offset:2})}}function bg(t){const n={...t[13].props};t[14]=n}function wg(t){const n={...t[13].props};t[14]=n}function T3(t){let n,a,c,h,p,_;return n=new ts({props:{gridlines:!0,baseline:!0,snapTicks:!0,ticks:"4"}}),c=new is({props:{gridlines:!1}}),p=new ch({}),p.$on("mousemove",t[8]),p.$on("mouseout",t[9]),{c(){nt(n.$$.fragment),a=Ge(),nt(c.$$.fragment),h=Ge(),nt(p.$$.fragment)},m(o,b){et(n,o,b),fe(o,a,b),et(c,o,b),fe(o,h,b),et(p,o,b),_=!0},p:Ft,i(o){_||(Ie(n.$$.fragment,o),Ie(c.$$.fragment,o),Ie(p.$$.fragment,o),_=!0)},o(o){Re(n.$$.fragment,o),Re(c.$$.fragment,o),Re(p.$$.fragment,o),_=!1},d(o){tt(n,o),o&&ce(a),tt(c,o),o&&ce(h),tt(p,o)}}}function Tg(t){let n,a;return n=new bc({props:{evt:t[4],$$slots:{default:[k3,({detail:c})=>({13:c}),({detail:c})=>c?8192:0]},$$scope:{ctx:t}}}),{c(){nt(n.$$.fragment)},m(c,h){et(n,c,h),a=!0},p(c,h){const p={};h&16&&(p.evt=c[4]),h&40960&&(p.$$scope={dirty:h,ctx:c}),n.$set(p)},i(c){a||(Ie(n.$$.fragment,c),a=!0)},o(c){Re(n.$$.fragment,c),a=!1},d(c){tt(n,c)}}}function k3(t){wg(t);let n,a=t[14].parish+"",c,h,p,_=(+t[14].jail_pretrial_rate).toFixed(1)+"",o,b;return{c(){n=Ae("div"),c=st(a),h=Ae("br"),p=st(`
                  Pretrial Rate: `),o=st(_),b=st(` per
                  10,000 residents`),O(n,"class","row")},m(S,E){fe(S,n,E),ue(n,c),ue(n,h),ue(n,p),ue(n,o),ue(n,b)},p(S,E){wg(S),E&8192&&a!==(a=S[14].parish+"")&&hi(c,a),E&8192&&_!==(_=(+S[14].jail_pretrial_rate).toFixed(1)+"")&&hi(o,_)},d(S){S&&ce(n)}}}function S3(t){let n,a,c=t[5]!==!0&&Tg(t);return{c(){c&&c.c(),n=mr()},m(h,p){c&&c.m(h,p),fe(h,n,p),a=!0},p(h,p){h[5]!==!0?c?(c.p(h,p),p&32&&Ie(c,1)):(c=Tg(h),c.c(),Ie(c,1),c.m(n.parentNode,n)):c&&(Qn(),Re(c,1,1,()=>{c=null}),$n())},i(h){a||(Ie(c),a=!0)},o(h){Re(c),a=!1},d(h){c&&c.d(h),h&&ce(n)}}}function E3(t){let n,a,c,h;return n=new _o({props:{$$slots:{default:[T3]},$$scope:{ctx:t}}}),c=new go({props:{pointerEvents:!1,$$slots:{default:[S3]},$$scope:{ctx:t}}}),{c(){nt(n.$$.fragment),a=Ge(),nt(c.$$.fragment)},m(p,_){et(n,p,_),fe(p,a,_),et(c,p,_),h=!0},p(p,_){const o={};_&32816&&(o.$$scope={dirty:_,ctx:p}),n.$set(o);const b={};_&32816&&(b.$$scope={dirty:_,ctx:p}),c.$set(b)},i(p){h||(Ie(n.$$.fragment,p),Ie(c.$$.fragment,p),h=!0)},o(p){Re(n.$$.fragment,p),Re(c.$$.fragment,p),h=!1},d(p){tt(n,p),p&&ce(a),tt(c,p)}}}function C3(t){let n,a,c,h,p,_;return n=new ts({props:{gridlines:!0,baseline:!0,snapTicks:!0,ticks:"4"}}),c=new is({props:{gridlines:!1}}),p=new ch({}),p.$on("mousemove",t[10]),p.$on("mouseout",t[11]),{c(){nt(n.$$.fragment),a=Ge(),nt(c.$$.fragment),h=Ge(),nt(p.$$.fragment)},m(o,b){et(n,o,b),fe(o,a,b),et(c,o,b),fe(o,h,b),et(p,o,b),_=!0},p:Ft,i(o){_||(Ie(n.$$.fragment,o),Ie(c.$$.fragment,o),Ie(p.$$.fragment,o),_=!0)},o(o){Re(n.$$.fragment,o),Re(c.$$.fragment,o),Re(p.$$.fragment,o),_=!1},d(o){tt(n,o),o&&ce(a),tt(c,o),o&&ce(h),tt(p,o)}}}function kg(t){let n,a;return n=new bc({props:{evt2:t[6],$$slots:{default:[A3,({detail:c})=>({13:c}),({detail:c})=>c?8192:0]},$$scope:{ctx:t}}}),{c(){nt(n.$$.fragment)},m(c,h){et(n,c,h),a=!0},p(c,h){const p={};h&64&&(p.evt2=c[6]),h&40960&&(p.$$scope={dirty:h,ctx:c}),n.$set(p)},i(c){a||(Ie(n.$$.fragment,c),a=!0)},o(c){Re(n.$$.fragment,c),a=!1},d(c){tt(n,c)}}}function A3(t){bg(t);let n,a=t[14].parish+"",c,h,p,_=t[14].prison_adm_rate.toFixed(1)+"",o,b;return{c(){n=Ae("div"),c=st(a),h=Ae("br"),p=st(`
                  Admission Rate: `),o=st(_),b=st(` per 10,000
                  residents`),O(n,"class","row")},m(S,E){fe(S,n,E),ue(n,c),ue(n,h),ue(n,p),ue(n,o),ue(n,b)},p(S,E){bg(S),E&8192&&a!==(a=S[14].parish+"")&&hi(c,a),E&8192&&_!==(_=S[14].prison_adm_rate.toFixed(1)+"")&&hi(o,_)},d(S){S&&ce(n)}}}function I3(t){let n,a,c=t[7]!==!0&&kg(t);return{c(){c&&c.c(),n=mr()},m(h,p){c&&c.m(h,p),fe(h,n,p),a=!0},p(h,p){h[7]!==!0?c?(c.p(h,p),p&128&&Ie(c,1)):(c=kg(h),c.c(),Ie(c,1),c.m(n.parentNode,n)):c&&(Qn(),Re(c,1,1,()=>{c=null}),$n())},i(h){a||(Ie(c),a=!0)},o(h){Re(c),a=!1},d(h){c&&c.d(h),h&&ce(n)}}}function M3(t){let n,a,c,h;return n=new _o({props:{$$slots:{default:[C3]},$$scope:{ctx:t}}}),c=new go({props:{pointerEvents:!1,$$slots:{default:[I3]},$$scope:{ctx:t}}}),{c(){nt(n.$$.fragment),a=Ge(),nt(c.$$.fragment)},m(p,_){et(n,p,_),fe(p,a,_),et(c,p,_),h=!0},p(p,_){const o={};_&32960&&(o.$$scope={dirty:_,ctx:p}),n.$set(o);const b={};_&32960&&(b.$$scope={dirty:_,ctx:p}),c.$set(b)},i(p){h||(Ie(n.$$.fragment,p),Ie(c.$$.fragment,p),h=!0)},o(p){Re(n.$$.fragment,p),Re(c.$$.fragment,p),h=!1},d(p){tt(n,p),p&&ce(a),tt(c,p)}}}function P3(t){let n,a,c,h,p,_,o,b,S,E,P,k,L,j,q,J,ee,ge,_e,Y,le;return p=new US({props:{parishTitle:t[0]}}),k=new fo({props:{padding:{top:0,bottom:40,left:120},x:z3,y:Sg,yScale:co().paddingInner([.15]),xDomain:[0,t[2]],data:t[1],$$slots:{default:[E3]},$$scope:{ctx:t}}}),ge=new fo({props:{padding:{top:0,bottom:40,left:120},x:Zf,y:Sg,yScale:co().paddingInner([.15]),xDomain:[0,t[3]],data:t[1],$$slots:{default:[M3]},$$scope:{ctx:t}}}),{c(){n=Ae("div"),a=Ae("div"),a.innerHTML=`<p class="svelte-vmwqbp">Every region of Louisiana is harmed by mass incarceration: nearly every
      parish has a pretrial incarceration rate above the national average, and
      dozens of parishes send people to prison at rates above the national
      average. The prevalence of incarceration is hard to see in many places,
      owing to an alarming lack of transparency and data, as well as a
      convoluted carceral landscape where jails also function as prisons. But
      parish and state-level research by Vera aims to clarify this picture.</p>`,c=Ge(),h=Ae("div"),nt(p.$$.fragment),_=Ge(),o=Ae("div"),b=Ae("div"),S=Ae("h4"),S.textContent="Pretrial Incarceration Rate (2021)",E=Ge(),P=Ae("div"),nt(k.$$.fragment),L=Ge(),j=Ae("div"),q=Ae("h4"),q.textContent="Prison Admission Rate (2021)",J=Ge(),ee=Ae("div"),nt(ge.$$.fragment),_e=Ge(),Y=Ae("p"),Y.innerHTML=`State policy plays a major role in driving mass incarceration—as evidenced
    by a decrease in the state’s prison population that resulted, in part, from
    <a href="https://s32082.pcdn.co/wp-content/uploads/2022/10/2022-JRI-ANNUAL-Report-FinalREVISED102022.pdf" target="_blank">the 2017 Justice Reinvestment Package</a>. However, state-level reform alone is insufficient. Significant progress
    on justice reform requires change at the local level: arrest and pretrial
    detention are the “front door” to mass incarceration and decisions by local
    police, prosecutors, and judges dictate how many people are put behind bars
    and for how long. Local jails also play a part in state prison
    incarceration: After a
    <a href="https://www.nola.com/news/crime_police/louisiana-is-the-worlds-prison-capital/article_8feef59a-1196-5988-9128-1e8e7c9aefda.html" target="_blank">federal court ordered Louisiana to address prison overcrowding in the
      1990s</a>, many sheriffs expanded their jails, enabling them to receive revenue from
    the state for holding people sentenced to prison. As a result, many sheriffs
    are now reliant on these funds to support oversized jails. Given the role of
    local decisionmakers in dictating the use of jails and prisons, local
    governments have the power to scale back the use of incarceration and
    implement evidence-based solutions that will help Louisiana’s communities
    thrive.`,O(a,"id","stats"),O(a,"class","svelte-vmwqbp"),O(h,"id","map"),O(h,"class","svelte-vmwqbp"),O(S,"class","svelte-vmwqbp"),O(P,"class","chart-container svelte-vmwqbp"),O(b,"class","barchart svelte-vmwqbp"),O(q,"class","svelte-vmwqbp"),O(ee,"class","chart-container svelte-vmwqbp"),O(j,"class","barchart svelte-vmwqbp"),O(o,"id","barcomps"),O(o,"class","svelte-vmwqbp"),O(Y,"class","svelte-vmwqbp")},m(ie,ke){fe(ie,n,ke),ue(n,a),ue(n,c),ue(n,h),et(p,h,null),ue(n,_),ue(n,o),ue(o,b),ue(b,S),ue(b,E),ue(b,P),et(k,P,null),ue(o,L),ue(o,j),ue(j,q),ue(j,J),ue(j,ee),et(ge,ee,null),ue(n,_e),ue(n,Y),le=!0},p(ie,[ke]){const Je={};ke&1&&(Je.parishTitle=ie[0]),p.$set(Je);const ve={};ke&4&&(ve.xDomain=[0,ie[2]]),ke&2&&(ve.data=ie[1]),ke&32816&&(ve.$$scope={dirty:ke,ctx:ie}),k.$set(ve);const pe={};ke&8&&(pe.xDomain=[0,ie[3]]),ke&2&&(pe.data=ie[1]),ke&32960&&(pe.$$scope={dirty:ke,ctx:ie}),ge.$set(pe)},i(ie){le||(Ie(p.$$.fragment,ie),Ie(k.$$.fragment,ie),Ie(ge.$$.fragment,ie),le=!0)},o(ie){Re(p.$$.fragment,ie),Re(k.$$.fragment,ie),Re(ge.$$.fragment,ie),le=!1},d(ie){ie&&ce(n),tt(p),tt(k),tt(ge)}}}const Zf="prison_adm_rate",z3="jail_pretrial_rate",Sg="parish";function D3(t,n,a){let c=[],h,p;Fn(async()=>{const q=await Nr("https://vera-louisiana-data.s3.amazonaws.com/curated_data/clearinghouse/parish_incarceration_21.csv");a(1,c=q.filter(J=>J.parish==_+" Parish"||J.parish=="Louisiana"||J.parish=="U.S.")),c.forEach(J=>{J[Zf]=+J[Zf]}),a(2,h=cc(c,J=>+J.jail_pretrial_rate)),a(3,p=cc(c,J=>+J.prison_adm_rate))});let{parishTitle:_}=n;Fn(async()=>{window.scrollTo(0,0)});let o,b=!1,S,E=!1;const P=q=>a(4,o=a(5,b=q)),k=()=>a(5,b=!0),L=q=>a(6,S=a(7,E=q)),j=()=>a(7,E=!0);return t.$$set=q=>{"parishTitle"in q&&a(0,_=q.parishTitle)},[_,c,h,p,o,b,S,E,P,k,L,j]}class Eg extends _i{constructor(n){super(),gi(this,n,D3,P3,di,{parishTitle:0})}}function Cg(t,n,a){const c=t.slice();return c[17]=n[a],c[19]=a,c}function Ag(t,n,a){const c=t.slice();return c[17]=n[a],c[19]=a,c}function L3(t){let n,a,c,h,p,_=Cs(t[8])+"",o,b;return{c(){n=st("In "),a=st(t[0]),c=st(` Parish, there is
    `),h=st(t[6]),p=st(` prison with a capacity of
    `),o=st(_),b=st(" people.")},m(S,E){fe(S,n,E),fe(S,a,E),fe(S,c,E),fe(S,h,E),fe(S,p,E),fe(S,o,E),fe(S,b,E)},p(S,E){E&1&&hi(a,S[0]),E&64&&hi(h,S[6]),E&256&&_!==(_=Cs(S[8])+"")&&hi(o,_)},d(S){S&&ce(n),S&&ce(a),S&&ce(c),S&&ce(h),S&&ce(p),S&&ce(o),S&&ce(b)}}}function R3(t){let n,a,c,h,p,_=Cs(t[8])+"",o,b;return{c(){n=st("In "),a=st(t[0]),c=st(` Parish, there is
    `),h=st(t[6]),p=st(` jail with a capacity of
    `),o=st(_),b=st(" people.")},m(S,E){fe(S,n,E),fe(S,a,E),fe(S,c,E),fe(S,h,E),fe(S,p,E),fe(S,o,E),fe(S,b,E)},p(S,E){E&1&&hi(a,S[0]),E&64&&hi(h,S[6]),E&256&&_!==(_=Cs(S[8])+"")&&hi(o,_)},d(S){S&&ce(n),S&&ce(a),S&&ce(c),S&&ce(h),S&&ce(p),S&&ce(o),S&&ce(b)}}}function B3(t){let n,a,c,h,p,_=Cs(t[8])+"",o,b;return{c(){n=st("In "),a=st(t[0]),c=st(` Parish, there are
    `),h=st(t[6]),p=st(` prisons and jails with a combined capacity of
    `),o=st(_),b=st(" people.")},m(S,E){fe(S,n,E),fe(S,a,E),fe(S,c,E),fe(S,h,E),fe(S,p,E),fe(S,o,E),fe(S,b,E)},p(S,E){E&1&&hi(a,S[0]),E&64&&hi(h,S[6]),E&256&&_!==(_=Cs(S[8])+"")&&hi(o,_)},d(S){S&&ce(n),S&&ce(a),S&&ce(c),S&&ce(h),S&&ce(p),S&&ce(o),S&&ce(b)}}}function Ig(t){let n,a;return{c(){n=$t("rect"),O(n,"x",Math.floor(t[19]/t[9])*t[10]+Math.floor(t[19]/t[9])*t[11]),O(n,"y",t[9]*t[10]-(t[19]%t[9]*t[10]+t[19]%t[9]*t[11])),O(n,"width",t[10]),O(n,"height",t[10]),O(n,"fill",a=t[12][t[17].groupIndex])},m(c,h){fe(c,n,h)},p(c,h){h&16&&a!==(a=c[12][c[17].groupIndex])&&O(n,"fill",a)},d(c){c&&ce(n)}}}function F3(t){let n,a=t[17].facility_name+"",c,h,p=Cs(t[17].capacity)+"",_,o;return{c(){n=$t("text"),c=st(a),h=st(" ("),_=st(p),o=st(" beds)"),O(n,"x","25"),O(n,"y","13"),O(n,"class","svelte-tq0yyc")},m(b,S){fe(b,n,S),ue(n,c),ue(n,h),ue(n,_),ue(n,o)},p(b,S){S&128&&a!==(a=b[17].facility_name+"")&&hi(c,a),S&128&&p!==(p=Cs(b[17].capacity)+"")&&hi(_,p)},d(b){b&&ce(n)}}}function O3(t){let n,a=t[17].facility_name+"",c;return{c(){n=$t("text"),c=st(a),O(n,"x","25"),O(n,"y","13"),O(n,"class","svelte-tq0yyc")},m(h,p){fe(h,n,p),ue(n,c)},p(h,p){p&128&&a!==(a=h[17].facility_name+"")&&hi(c,a)},d(h){h&&ce(n)}}}function Mg(t){let n,a;function c(_,o){return window.innerWidth<600?O3:F3}let p=c()(t);return{c(){n=$t("g"),a=$t("rect"),p.c(),O(a,"width","15"),O(a,"height","15"),O(a,"fill",t[12][t[19]]),Ht(n,"transform","translate(0,"+t[19]*20+"px)")},m(_,o){fe(_,n,o),ue(n,a),p.m(n,null)},p(_,o){p.p(_,o)},d(_){_&&ce(n),p.d()}}}function U3(t){let n,a,c,h,p,_,o;function b(q,J){return q[6]>1?B3:q[6]==1&&q[7].map_jails>0?R3:L3}let S=b(t),E=S(t),P=t[4],k=[];for(let q=0;q<P.length;q+=1)k[q]=Ig(Ag(t,P,q));let L=t[7],j=[];for(let q=0;q<L.length;q+=1)j[q]=Mg(Cg(t,L,q));return{c(){n=Ae("p"),a=st(`Every parish is part of the state’s vast network of jails and prisons. There
  are more than 230 jails and prisons statewide that have the capacity to lock
  up more than 70,000 adults and children.
  `),E.c(),c=Ge(),h=Ae("div"),p=$t("svg");for(let q=0;q<k.length;q+=1)k[q].c();_=Ge(),o=$t("svg");for(let q=0;q<j.length;q+=1)j[q].c();O(n,"class","break-avoid"),O(p,"width",t[1]),O(p,"height",t[3]),O(o,"width",t[2]),O(o,"height",t[5]),O(o,"class","legend"),O(h,"id","waffle"),O(h,"class","svelte-tq0yyc")},m(q,J){fe(q,n,J),ue(n,a),E.m(n,null),fe(q,c,J),fe(q,h,J),ue(h,p);for(let ee=0;ee<k.length;ee+=1)k[ee].m(p,null);ue(h,_),ue(h,o);for(let ee=0;ee<j.length;ee+=1)j[ee].m(o,null)},p(q,[J]){if(S===(S=b(q))&&E?E.p(q,J):(E.d(1),E=S(q),E&&(E.c(),E.m(n,null))),J&7696){P=q[4];let ee;for(ee=0;ee<P.length;ee+=1){const ge=Ag(q,P,ee);k[ee]?k[ee].p(ge,J):(k[ee]=Ig(ge),k[ee].c(),k[ee].m(p,null))}for(;ee<k.length;ee+=1)k[ee].d(1);k.length=P.length}if(J&2&&O(p,"width",q[1]),J&8&&O(p,"height",q[3]),J&4224){L=q[7];let ee;for(ee=0;ee<L.length;ee+=1){const ge=Cg(q,L,ee);j[ee]?j[ee].p(ge,J):(j[ee]=Mg(ge),j[ee].c(),j[ee].m(o,null))}for(;ee<j.length;ee+=1)j[ee].d(1);j.length=L.length}J&4&&O(o,"width",q[2]),J&32&&O(o,"height",q[5])},i:Ft,o:Ft,d(q){q&&ce(n),E.d(),q&&ce(c),q&&ce(h),Ia(k,q),Ia(j,q)}}}function Cs(t){var n=t.toString().split(".");return n[0]=n[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),n.join(".")}function N3(t,n,a){let{parishname:c}=n,p=Rn("#app").node().getBoundingClientRect().width;var _,o,b,S=10,E=15,P=0,k=1,L,j=[];p<400?L=20:L=40;let q,J,ee=[],ge=0;var _e=["#012A41","#038AD8","#B7E2FB","#FBE798","#FDF0BF","#F7685E","#da392f","#940A00","#59C9A2","#054830","#F9DC66","#DD2113","#24AFFF"];return Fn(async()=>{const Y=await Nr("https://vera-louisiana-data.s3.amazonaws.com/curated_data/clearinghouse/facilities.csv");a(7,ee=Y.filter(le=>le.parish==c+" Parish"&&le.capacity!=="N/A")),a(6,J=ee.length),a(5,q=ee.length*22),ee.forEach(le=>{le.capacity=+le.capacity}),a(8,ge=qv(ee,le=>Wv(le,ie=>ie.capacity))),P=ge/(L*S),ee.forEach(function(le,ie){le.capacity=+le.capacity,le.units=Math.floor(le.capacity/P),a(4,j=j.concat(Array(le.units+1).join(1).split("").map(function(){return{squareValue:P,units:le.units,capacity:le.capacity,groupIndex:ie}})))}),a(1,_=E*L+L*k+25),a(2,o=E*L+L*k+65),a(3,b=E*S+S*k+25)}),t.$$set=Y=>{"parishname"in Y&&a(0,c=Y.parishname)},[c,_,o,b,j,q,J,ee,ge,S,E,k,_e]}class j3 extends _i{constructor(n){super(),gi(this,n,N3,U3,di,{parishname:0})}}function Pg(t,n,a){const c=t.slice();return c[17]=n[a],c[19]=a,c}function zg(t){let n,a,c;function h(...o){return t[10](t[17],...o)}function p(...o){return t[11](t[17],...o)}function _(...o){return t[12](t[17],...o)}return{c(){n=$t("path"),O(n,"class","path-line svelte-d6euqo"),O(n,"data-id",t[19]),O(n,"d",t[2]),O(n,"stroke",t[0])},m(o,b){fe(o,n,b),a||(c=[Hi(n,"mouseover",h),Hi(n,"focus",p),Hi(n,"mousemove",_)],a=!0)},p(o,b){t=o,b&4&&O(n,"d",t[2]),b&1&&O(n,"stroke",t[0])},d(o){o&&ce(n),a=!1,dr(c)}}}function V3(t){let n,a,c,h,p,_=t[1],o=[];for(let b=0;b<_.length;b+=1)o[b]=zg(Pg(t,_,b));return{c(){n=$t("path"),a=Ge(),c=$t("g");for(let b=0;b<o.length;b+=1)o[b].c();O(n,"class","path-line svelte-d6euqo"),O(n,"d",t[2]),O(n,"stroke",t[0]),O(c,"class","line-group")},m(b,S){fe(b,n,S),fe(b,a,S),fe(b,c,S);for(let E=0;E<o.length;E+=1)o[E].m(c,null);h||(p=[Hi(c,"mouseout",t[13]),Hi(c,"blur",t[14])],h=!0)},p(b,[S]){if(S&4&&O(n,"d",b[2]),S&1&&O(n,"stroke",b[0]),S&199){_=b[1];let E;for(E=0;E<_.length;E+=1){const P=Pg(b,_,E);o[E]?o[E].p(P,S):(o[E]=zg(P),o[E].c(),o[E].m(c,null))}for(;E<o.length;E+=1)o[E].d(1);o.length=_.length}},i:Ft,o:Ft,d(b){b&&ce(n),b&&ce(a),b&&ce(c),Ia(o,b),h=!1,dr(p)}}}function q3(t,n,a){let c,h,p,_;const{data:o,xGet:b,yGet:S,xScale:E,yScale:P}=fr("LayerCake");wt(t,o,Y=>a(1,_=Y)),wt(t,b,Y=>a(9,p=Y)),wt(t,S,Y=>a(8,h=Y));let{stroke:k="#ab00d6"}=n;const L=sl();function j(Y){return function(ie){raise(this),ie.layerX!==0&&ie.layerY!==0&&L("mousemove",{e:ie})}}const q=(Y,le)=>L("mousemove",{e:le,props:Y}),J=(Y,le)=>L("mousemove",{e:le,props:Y}),ee=(Y,le)=>j(),ge=Y=>L("mouseout"),_e=Y=>L("mouseout");return t.$$set=Y=>{"stroke"in Y&&a(0,k=Y.stroke)},t.$$.update=()=>{t.$$.dirty&770&&a(2,c="M"+_.map(Y=>p(Y)+","+h(Y)).join("L"))},[k,_,c,o,b,S,L,j,h,p,q,J,ee,ge,_e]}class my extends _i{constructor(n){super(),gi(this,n,q3,V3,di,{stroke:0})}}const G3=t=>({x:t&10,y:t&9,found:t&8,visible:t&4,e:t&16}),Dg=t=>({x:t[1](t[3])||0,y:t[0](t[3])||0,found:t[3],visible:t[2],e:t[4]});function Z3(t){let n,a,c,h,p;const _=t[21].default,o=kr(_,t,t[20],Dg);return{c(){n=Ae("div"),a=Ge(),o&&o.c(),O(n,"class","bg svelte-n2rx0m")},m(b,S){fe(b,n,S),fe(b,a,S),o&&o.m(b,S),c=!0,h||(p=[Hi(n,"mousemove",t[10]),Hi(n,"mouseout",t[22]),Hi(n,"blur",t[23])],h=!0)},p(b,[S]){o&&o.p&&(!c||S&1048607)&&Er(o,_,b,b[20],c?Sr(_,b[20],S,G3):Cr(b[20]),Dg)},i(b){c||(Ie(o,b),c=!0)},o(b){Re(o,b),c=!1},d(b){b&&ce(n),b&&ce(a),o&&o.d(b),h=!1,dr(p)}}}function H3(t,n,a){let c,h,p,_,o,b,S,E,{$$slots:P={},$$scope:k}=n;const{data:L,xGet:j,yGet:q,width:J,height:ee}=fr("LayerCake");wt(t,L,$e=>a(15,_=$e)),wt(t,j,$e=>a(18,S=$e)),wt(t,q,$e=>a(19,E=$e)),wt(t,J,$e=>a(17,b=$e)),wt(t,ee,$e=>a(16,o=$e));let ge=!1,_e={},Y={},{x:le="x"}=n,{y:ie="y"}=n,{searchRadius:ke=void 0}=n,{dataset:Je=void 0}=n;function ve($e){a(4,Y=$e);const ct=`layer${le.toUpperCase()}`,We=`layer${ie.toUpperCase()}`;a(3,_e=p.find($e[ct],$e[We],ke)||{}),a(2,ge=Object.keys(_e).length>0)}const pe=()=>a(2,ge=!1),Fe=()=>a(2,ge=!1);return t.$$set=$e=>{"x"in $e&&a(11,le=$e.x),"y"in $e&&a(12,ie=$e.y),"searchRadius"in $e&&a(13,ke=$e.searchRadius),"dataset"in $e&&a(14,Je=$e.dataset),"$$scope"in $e&&a(20,k=$e.$$scope)},t.$$.update=()=>{t.$$.dirty&788480&&a(1,c=le==="x"?S:E),t.$$.dirty&790528&&a(0,h=ie==="y"?E:S),t.$$.dirty&245763&&(p=Q_().extent([[-1,-1],[b+1,o+1]]).x(c).y(h).addAll(Je||_))},[h,c,ge,_e,Y,L,j,q,J,ee,ve,le,ie,ke,Je,_,o,b,S,E,k,P,pe,Fe]}class W3 extends _i{constructor(n){super(),gi(this,n,H3,Z3,di,{x:11,y:12,searchRadius:13,dataset:14})}}function Lg(t){const n=t[11](t[20]);t[22]=n}function Rg(t){let n,a,c,h,p=t[20][t[2].x]+"",_,o,b,S,E=t[22][2].value+"",P;return{c(){n=Ae("div"),a=Ge(),c=Ae("div"),h=Ae("div"),_=st(p),o=Ge(),b=Ae("div"),S=st("Total Prison Admissions: "),P=st(E),Ht(n,"left",t[17]+"px"),O(n,"class","line svelte-1ll29vg"),O(h,"class","row"),O(b,"class","row"),O(c,"class","tooltip svelte-1ll29vg"),Ht(c,"width",gy+"px"),Ht(c,"display",t[19]?"block":"none"),Ht(c,"top",t[4](t[22][2].value)+t[0]+"px"),Ht(c,"left",Math.min(Math.max(t[10],t[17]),t[5]-t[10])+"px")},m(k,L){fe(k,n,L),fe(k,a,L),fe(k,c,L),ue(c,h),ue(h,_),ue(c,o),ue(c,b),ue(b,S),ue(b,P)},p(k,L){L&131072&&Ht(n,"left",k[17]+"px"),L&1048580&&p!==(p=k[20][k[2].x]+"")&&hi(_,p),L&1048576&&E!==(E=k[22][2].value+"")&&hi(P,E),L&524288&&Ht(c,"display",k[19]?"block":"none"),L&1048593&&Ht(c,"top",k[4](k[22][2].value)+k[0]+"px"),L&131104&&Ht(c,"left",Math.min(Math.max(k[10],k[17]),k[5]-k[10])+"px")},d(k){k&&ce(n),k&&ce(a),k&&ce(c)}}}function X3(t){Lg(t);let n,a=t[19]===!0&&Rg(t);return{c(){a&&a.c(),n=mr()},m(c,h){a&&a.m(c,h),fe(c,n,h)},p(c,h){Lg(c),c[19]===!0?a?a.p(c,h):(a=Rg(c),a.c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null)},d(c){a&&a.d(c),c&&ce(n)}}}function K3(t){let n,a;return n=new W3({props:{dataset:t[1]||t[3],y:"x",$$slots:{default:[X3,({x:c,y:h,visible:p,found:_,e:o})=>({17:c,18:h,19:p,20:_,21:o}),({x:c,y:h,visible:p,found:_,e:o})=>(c?131072:0)|(h?262144:0)|(p?524288:0)|(_?1048576:0)|(o?2097152:0)]},$$scope:{ctx:t}}}),{c(){nt(n.$$.fragment)},m(c,h){et(n,c,h),a=!0},p(c,[h]){const p={};h&10&&(p.dataset=c[1]||c[3]),h&10092597&&(p.$$scope={dirty:h,ctx:c}),n.$set(p)},i(c){a||(Ie(n.$$.fragment,c),a=!0)},o(c){Re(n.$$.fragment,c),a=!1},d(c){tt(n,c)}}}const gy=150;function J3(t,n,a){let c,h,p,_;const{data:o,width:b,yScale:S,config:E}=fr("LayerCake");wt(t,o,Y=>a(3,h=Y)),wt(t,b,Y=>a(5,_=Y)),wt(t,S,Y=>a(4,p=Y)),wt(t,E,Y=>a(2,c=Y));const P=pp(","),k=Y=>Y.replace(/^\w/,le=>le.toUpperCase());let{formatTitle:L=Y=>Y}=n,{formatValue:j=Y=>isNaN(+Y)?Y:P(Y)}=n,{formatKey:q=Y=>k(Y)}=n,{offset:J=0}=n,{dataset:ee=void 0}=n;const ge=gy/2;function _e(Y){return Object.keys(Y).length===0?[]:Object.keys(Y).filter(ie=>ie!==c.x).map(ie=>({key:ie,value:Y[ie]})).sort((ie,ke)=>ke.value-ie.value)}return t.$$set=Y=>{"formatTitle"in Y&&a(12,L=Y.formatTitle),"formatValue"in Y&&a(13,j=Y.formatValue),"formatKey"in Y&&a(14,q=Y.formatKey),"offset"in Y&&a(0,J=Y.offset),"dataset"in Y&&a(1,ee=Y.dataset)},[J,ee,c,h,p,_,o,b,S,E,ge,_e,L,j,q]}class _y extends _i{constructor(n){super(),gi(this,n,J3,K3,di,{formatTitle:12,formatValue:13,formatKey:14,offset:0,dataset:1})}}function Y3(t){let n,a,c,h;return n=new ts({props:{ticks:6}}),c=new is({props:{ticks:4}}),{c(){nt(n.$$.fragment),a=Ge(),nt(c.$$.fragment)},m(p,_){et(n,p,_),fe(p,a,_),et(c,p,_),h=!0},i(p){h||(Ie(n.$$.fragment,p),Ie(c.$$.fragment,p),h=!0)},o(p){Re(n.$$.fragment,p),Re(c.$$.fragment,p),h=!1},d(p){tt(n,p),p&&ce(a),tt(c,p)}}}function Q3(t){let n,a,c,h;return n=new ts({props:{ticks:3}}),c=new is({props:{ticks:4}}),{c(){nt(n.$$.fragment),a=Ge(),nt(c.$$.fragment)},m(p,_){et(n,p,_),fe(p,a,_),et(c,p,_),h=!0},i(p){h||(Ie(n.$$.fragment,p),Ie(c.$$.fragment,p),h=!0)},o(p){Re(n.$$.fragment,p),Re(c.$$.fragment,p),h=!1},d(p){tt(n,p),p&&ce(a),tt(c,p)}}}function $3(t){let n,a,c,h,p;const _=[Q3,Y3],o=[];function b(S,E){return window.innerWidth<500?0:1}return n=b(),a=o[n]=_[n](t),h=new my({}),h.$on("mousemove",t[7]),h.$on("mouseout",t[8]),{c(){a.c(),c=Ge(),nt(h.$$.fragment)},m(S,E){o[n].m(S,E),fe(S,c,E),et(h,S,E),p=!0},p:Ft,i(S){p||(Ie(a),Ie(h.$$.fragment,S),p=!0)},o(S){Re(a),Re(h.$$.fragment,S),p=!1},d(S){o[n].d(S),S&&ce(c),tt(h,S)}}}function eE(t){let n,a;return n=new _y({props:{formatTitle:t[6],dataset:t[1]}}),{c(){nt(n.$$.fragment)},m(c,h){et(n,c,h),a=!0},p(c,h){const p={};h&2&&(p.dataset=c[1]),n.$set(p)},i(c){a||(Ie(n.$$.fragment,c),a=!0)},o(c){Re(n.$$.fragment,c),a=!1},d(c){tt(n,c)}}}function tE(t){let n,a,c,h;return n=new _o({props:{$$slots:{default:[$3]},$$scope:{ctx:t}}}),c=new go({props:{$$slots:{default:[eE]},$$scope:{ctx:t}}}),{c(){nt(n.$$.fragment),a=Ge(),nt(c.$$.fragment)},m(p,_){et(n,p,_),fe(p,a,_),et(c,p,_),h=!0},p(p,_){const o={};_&1072&&(o.$$scope={dirty:_,ctx:p}),n.$set(o);const b={};_&1026&&(b.$$scope={dirty:_,ctx:p}),c.$set(b)},i(p){h||(Ie(n.$$.fragment,p),Ie(c.$$.fragment,p),h=!0)},o(p){Re(n.$$.fragment,p),Re(c.$$.fragment,p),h=!1},d(p){tt(n,p),p&&ce(a),tt(c,p)}}}function iE(t){let n,a,c,h;return n=new ts({props:{ticks:2}}),c=new is({props:{ticks:4}}),{c(){nt(n.$$.fragment),a=Ge(),nt(c.$$.fragment)},m(p,_){et(n,p,_),fe(p,a,_),et(c,p,_),h=!0},i(p){h||(Ie(n.$$.fragment,p),Ie(c.$$.fragment,p),h=!0)},o(p){Re(n.$$.fragment,p),Re(c.$$.fragment,p),h=!1},d(p){tt(n,p),p&&ce(a),tt(c,p)}}}function nE(t){let n,a,c,h;return n=new ts({props:{ticks:1}}),c=new is({props:{ticks:4}}),{c(){nt(n.$$.fragment),a=Ge(),nt(c.$$.fragment)},m(p,_){et(n,p,_),fe(p,a,_),et(c,p,_),h=!0},i(p){h||(Ie(n.$$.fragment,p),Ie(c.$$.fragment,p),h=!0)},o(p){Re(n.$$.fragment,p),Re(c.$$.fragment,p),h=!1},d(p){tt(n,p),p&&ce(a),tt(c,p)}}}function rE(t){let n,a,c,h,p;const _=[nE,iE],o=[];function b(S,E){return window.innerWidth<500?0:1}return n=b(),a=o[n]=_[n](t),h=new my({}),{c(){a.c(),c=Ge(),nt(h.$$.fragment)},m(S,E){o[n].m(S,E),fe(S,c,E),et(h,S,E),p=!0},p:Ft,i(S){p||(Ie(a),Ie(h.$$.fragment,S),p=!0)},o(S){Re(a),Re(h.$$.fragment,S),p=!1},d(S){o[n].d(S),S&&ce(c),tt(h,S)}}}function aE(t){let n,a;return n=new _y({props:{formatTitle:t[6],dataset:t[2]}}),{c(){nt(n.$$.fragment)},m(c,h){et(n,c,h),a=!0},p(c,h){const p={};h&4&&(p.dataset=c[2]),n.$set(p)},i(c){a||(Ie(n.$$.fragment,c),a=!0)},o(c){Re(n.$$.fragment,c),a=!1},d(c){tt(n,c)}}}function sE(t){let n,a,c,h;return n=new _o({props:{$$slots:{default:[rE]},$$scope:{ctx:t}}}),c=new go({props:{$$slots:{default:[aE]},$$scope:{ctx:t}}}),{c(){nt(n.$$.fragment),a=Ge(),nt(c.$$.fragment)},m(p,_){et(n,p,_),fe(p,a,_),et(c,p,_),h=!0},p(p,_){const o={};_&1024&&(o.$$scope={dirty:_,ctx:p}),n.$set(o);const b={};_&1028&&(b.$$scope={dirty:_,ctx:p}),c.$set(b)},i(p){h||(Ie(n.$$.fragment,p),Ie(c.$$.fragment,p),h=!0)},o(p){Re(n.$$.fragment,p),Re(c.$$.fragment,p),h=!1},d(p){tt(n,p),p&&ce(a),tt(c,p)}}}function oE(t){let n,a,c,h,p,_,o,b,S,E,P,k,L;return S=new fo({props:{padding:{top:8,right:10,bottom:20,left:25},x:Bg,y:Jo,yNice:4,yDomain:[0,t[3]],data:t[1],$$slots:{default:[tE]},$$scope:{ctx:t}}}),k=new fo({props:{padding:{top:8,right:10,bottom:20,left:25},x:Bg,y:Jo,yNice:4,yDomain:[0,t[3]],data:t[2],$$slots:{default:[sE]},$$scope:{ctx:t}}}),{c(){n=Ae("div"),a=Ae("h4"),c=st("People from "),h=st(t[0]),p=st(" Parish Sent to Prison (1992-2014, 2019-2021)"),_=Ge(),o=Ae("div"),b=Ae("div"),nt(S.$$.fragment),E=Ge(),P=Ae("div"),nt(k.$$.fragment),O(a,"class","svelte-pzfb8c"),O(b,"class","chart-container first svelte-pzfb8c"),O(P,"class","chart-container second svelte-pzfb8c"),O(o,"id","container-wrap"),O(o,"class","svelte-pzfb8c"),O(n,"id","linechart"),O(n,"class","svelte-pzfb8c")},m(j,q){fe(j,n,q),ue(n,a),ue(a,c),ue(a,h),ue(a,p),ue(n,_),ue(n,o),ue(o,b),et(S,b,null),ue(o,E),ue(o,P),et(k,P,null),L=!0},p(j,[q]){(!L||q&1)&&hi(h,j[0]);const J={};q&8&&(J.yDomain=[0,j[3]]),q&2&&(J.data=j[1]),q&1074&&(J.$$scope={dirty:q,ctx:j}),S.$set(J);const ee={};q&8&&(ee.yDomain=[0,j[3]]),q&4&&(ee.data=j[2]),q&1028&&(ee.$$scope={dirty:q,ctx:j}),k.$set(ee)},i(j){L||(Ie(S.$$.fragment,j),Ie(k.$$.fragment,j),L=!0)},o(j){Re(S.$$.fragment,j),Re(k.$$.fragment,j),L=!1},d(j){j&&ce(n),tt(S),tt(k)}}}const Bg="year",Jo="total_prison_adm";function lE(t,n,a){let{parishname:c}=n,h=[],p=[],_=[],o=100;console.log("window.innerWidth",window.innerWidth),Fn(async()=>{h=(await Nr("https://vera-louisiana-data.s3.amazonaws.com/curated_data/clearinghouse/parish_prison_adm_trends.csv")).filter(j=>j.parish==c+" Parish"),h.forEach(function(j){j.year=+j.year,j.total_prison_adm=+j.total_prison_adm}),a(1,p=h.filter(j=>j.year<=2014)),a(2,_=h.filter(j=>j.year>=2019)),a(3,o=cc(h,j=>j.total_prison_adm)),p.forEach(j=>{j[Jo]=+j[Jo]}),_.forEach(j=>{j[Jo]=+j[Jo]})});const b=lh("%Y");let S,E=!1;const P=L=>a(4,S=a(5,E=L)),k=()=>a(5,E=!0);return t.$$set=L=>{"parishname"in L&&a(0,c=L.parishname)},[c,p,_,o,S,E,b,P,k]}class cE extends _i{constructor(n){super(),gi(this,n,lE,oE,di,{parishname:0})}}function Fg(t){const n={...t[37].props};t[38]=n}function uE(t){let n,a,c,h,p,_;return n=new ts({props:{gridlines:!0,baseline:!0,snapTicks:!0,ticks:"4"}}),c=new is({props:{gridlines:!1}}),p=new ch({props:{fill:"#0e002c"}}),p.$on("mousemove",t[5]),p.$on("mouseout",t[6]),{c(){nt(n.$$.fragment),a=Ge(),nt(c.$$.fragment),h=Ge(),nt(p.$$.fragment)},m(o,b){et(n,o,b),fe(o,a,b),et(c,o,b),fe(o,h,b),et(p,o,b),_=!0},p:Ft,i(o){_||(Ie(n.$$.fragment,o),Ie(c.$$.fragment,o),Ie(p.$$.fragment,o),_=!0)},o(o){Re(n.$$.fragment,o),Re(c.$$.fragment,o),Re(p.$$.fragment,o),_=!1},d(o){tt(n,o),o&&ce(a),tt(c,o),o&&ce(h),tt(p,o)}}}function Og(t){let n,a;return n=new bc({props:{evt:t[2],$$slots:{default:[hE,({detail:c})=>({37:c}),({detail:c})=>[0,c?64:0]]},$$scope:{ctx:t}}}),{c(){nt(n.$$.fragment)},m(c,h){et(n,c,h),a=!0},p(c,h){const p={};h[0]&4&&(p.evt=c[2]),h[1]&320&&(p.$$scope={dirty:h,ctx:c}),n.$set(p)},i(c){a||(Ie(n.$$.fragment,c),a=!0)},o(c){Re(n.$$.fragment,c),a=!1},d(c){tt(n,c)}}}function hE(t){Fg(t);let n,a=(+t[38].people).toFixed(0)+"",c,h;return{c(){n=Ae("div"),c=st(a),h=st(" people"),O(n,"class","row")},m(p,_){fe(p,n,_),ue(n,c),ue(n,h)},p(p,_){Fg(p),_[1]&64&&a!==(a=(+p[38].people).toFixed(0)+"")&&hi(c,a)},d(p){p&&ce(n)}}}function fE(t){let n,a,c=t[3]!==!0&&Og(t);return{c(){c&&c.c(),n=mr()},m(h,p){c&&c.m(h,p),fe(h,n,p),a=!0},p(h,p){h[3]!==!0?c?(c.p(h,p),p[0]&8&&Ie(c,1)):(c=Og(h),c.c(),Ie(c,1),c.m(n.parentNode,n)):c&&(Qn(),Re(c,1,1,()=>{c=null}),$n())},i(h){a||(Ie(c),a=!0)},o(h){Re(c),a=!1},d(h){c&&c.d(h),h&&ce(n)}}}function pE(t){let n,a,c,h;return n=new _o({props:{$$slots:{default:[uE]},$$scope:{ctx:t}}}),c=new go({props:{pointerEvents:!1,$$slots:{default:[fE]},$$scope:{ctx:t}}}),{c(){nt(n.$$.fragment),a=Ge(),nt(c.$$.fragment)},m(p,_){et(n,p,_),fe(p,a,_),et(c,p,_),h=!0},p(p,_){const o={};_[0]&12|_[1]&256&&(o.$$scope={dirty:_,ctx:p}),n.$set(o);const b={};_[0]&12|_[1]&256&&(b.$$scope={dirty:_,ctx:p}),c.$set(b)},i(p){h||(Ie(n.$$.fragment,p),Ie(c.$$.fragment,p),h=!0)},o(p){Re(n.$$.fragment,p),Re(c.$$.fragment,p),h=!1},d(p){tt(n,p),p&&ce(a),tt(c,p)}}}function dE(t){let n,a,c,h,p,_,o,b,S,E,P,k,L,j,q,J,ee,ge,_e;return a=new j3({props:{parishname:t[0]}}),L=new fo({props:{padding:{top:0,bottom:40,left:t[4]},x:Hf,y:mE,yScale:co().paddingInner([.15]),xDomain:[0,null],data:t[1],$$slots:{default:[pE]},$$scope:{ctx:t}}}),J=new cE({props:{parishname:t[0]}}),{c(){n=Ae("div"),nt(a.$$.fragment),c=Ge(),h=Ae("p"),h.textContent=`Incarceration takes many forms in Louisiana and includes state prisons, parish
  jails operated by sheriffs, jails operated by private companies, municipal
  jails operated by police departments, and sheriff-operated Transitional Work
  Programs. Many of these facilities are playing roles they should not play.
  This is especially true of jails: intended to hold only pretrial detainees and
  people serving short sentences, many Louisiana jails are holding people
  serving long prison sentences. All these facilities have a financial stake in
  filling their capacity. Ending Louisiana’s reliance on incarceration
  ultimately requires reducing capacity and permanently closing facilities.`,p=Ge(),_=Ae("div"),o=Ae("h4"),b=st("People held in "),S=st(t[0]),E=st(" Parish Jails, by Jurisdiction (November 26, 2021)"),P=Ge(),k=Ae("div"),nt(L.$$.fragment),j=Ge(),q=Ae("div"),nt(J.$$.fragment),ee=Ge(),ge=Ae("div"),ge.innerHTML=`<p><span class="rec svelte-1h9vuvp">Recommendation</span>: End Louisiana’s practice of housing
    distinct groups of people with vastly different needs in the same multi-use
    facilities; for example, housing juveniles at Louisiana State Penitentiary
    (Angola) and housing people with prison sentences in pretrial detention
    facilities, like parish jails. The state should use sentencing reform,
    applied retroactively, to reduce the number of incarcerated people to fit
    current Department of Public Safety &amp; Corrections capacity.</p> 
  <p><span class="rec svelte-1h9vuvp">Recommendation</span>: Pass a data transparency bill that
    standardizes the data a carceral facility must collect and report.</p> 
  <p><span class="rec svelte-1h9vuvp">Recommendation</span>: Reduce the prison population by
    providing parole eligibility after 20 years to people serving long sentences
    and after 25 years to those serving life sentences; making
    parole-eligibility and sentencing reforms available retroactively; and
    implementing a felony classification system to eliminate inconsistencies in
    sentencing and release.</p>`,O(n,"id","waffle"),O(h,"class","break-avoid"),O(k,"class","chart-container svelte-1h9vuvp"),O(_,"class","barchart svelte-1h9vuvp"),O(q,"id","lines"),O(q,"class","svelte-1h9vuvp"),O(ge,"id","recs")},m(Y,le){fe(Y,n,le),et(a,n,null),fe(Y,c,le),fe(Y,h,le),fe(Y,p,le),fe(Y,_,le),ue(_,o),ue(o,b),ue(o,S),ue(o,E),ue(_,P),ue(_,k),et(L,k,null),fe(Y,j,le),fe(Y,q,le),et(J,q,null),fe(Y,ee,le),fe(Y,ge,le),_e=!0},p(Y,le){const ie={};le[0]&1&&(ie.parishname=Y[0]),a.$set(ie),(!_e||le[0]&1)&&hi(S,Y[0]);const ke={};le[0]&16&&(ke.padding={top:0,bottom:40,left:Y[4]}),le[0]&2&&(ke.data=Y[1]),le[0]&12|le[1]&256&&(ke.$$scope={dirty:le,ctx:Y}),L.$set(ke);const Je={};le[0]&1&&(Je.parishname=Y[0]),J.$set(Je)},i(Y){_e||(Ie(a.$$.fragment,Y),Ie(L.$$.fragment,Y),Ie(J.$$.fragment,Y),_e=!0)},o(Y){Re(a.$$.fragment,Y),Re(L.$$.fragment,Y),Re(J.$$.fragment,Y),_e=!1},d(Y){Y&&ce(n),tt(a),Y&&ce(c),Y&&ce(h),Y&&ce(p),Y&&ce(_),tt(L),Y&&ce(j),Y&&ce(q),tt(J),Y&&ce(ee),Y&&ce(ge)}}}const Hf="people",mE="jurisdiction";function gE(t,n,a){let{parishname:c}=n,h=[],p=[];Fn(async()=>{h=(await Nr("https://vera-louisiana-data.s3.amazonaws.com/curated_data/clearinghouse/parish_facilities.csv")).filter(k=>k.parish==c+" Parish"),a(1,p=[{people:+h[0].held_for_doc_dpsc_2021,jurisdiction:"State DOC"},{people:+h[0].held_for_fed_dpsc_2021,jurisdiction:"Federal"},{people:+h[0].pretrial_dpsc_2021,jurisdiction:"Pretrial"},{people:+h[0].parish_minus_pretrial_dpsc_2021,jurisdiction:"Parish"},{people:+h[0].held_for_ice_ice_2021,jurisdiction:"ICE"}]),p.sort((k,L)=>L.people-k.people),p.forEach(k=>{k[Hf]=+k[Hf]})});let _,o=!1,b;window.innerWidth<600?b=80:b=120;const S=P=>a(2,_=a(3,o=P)),E=()=>a(3,o=!0);return t.$$set=P=>{"parishname"in P&&a(0,c=P.parishname)},[c,p,_,o,b,S,E]}class Ug extends _i{constructor(n){super(),gi(this,n,gE,dE,di,{parishname:0},null,[-1,-1])}}function Ng(t,n,a){const c=t.slice();c[30]=n[a],c[37]=a;const h=c[6](c[30]);c[31]=h;const p=c[5](c[30]);c[32]=p;const _=Array.isArray(c[32])?c[32][0]:c[32];c[33]=_;const o=c[9].bandwidth?c[9].bandwidth():c[7](c[30]);c[34]=o;const b=c[10](c[30]);return c[35]=b,c}function jg(t){let n,a=t[35]+"",c,h,p;return{c(){n=$t("text"),c=st(a),O(n,"x",h=t[33]+t[34]/2),O(n,"y",p=t[12]-t[31]-5),O(n,"text-anchor","middle"),O(n,"class","svelte-xn7mh7")},m(_,o){fe(_,n,o),ue(n,c)},p(_,o){o[0]&1280&&a!==(a=_[35]+"")&&hi(c,a),o[0]&928&&h!==(h=_[33]+_[34]/2)&&O(n,"x",h),o[0]&4416&&p!==(p=_[12]-_[31]-5)&&O(n,"y",p)},d(_){_&&ce(n)}}}function Vg(t){let n,a,c,h,p,_,o,b,S,E;function P(...q){return t[24](t[30],...q)}function k(...q){return t[25](t[30],...q)}function L(...q){return t[26](t[30],...q)}let j=t[3]&&t[35]&&jg(t);return{c(){n=$t("rect"),j&&j.c(),b=mr(),O(n,"class","group-rect"),O(n,"data-id",t[37]),O(n,"data-range",a=t[11](t[30])),O(n,"data-count",c=t[35]),O(n,"x",h=t[33]),O(n,"y",p=t[4](t[30])),O(n,"width",_=t[34]),O(n,"height",o=t[31]),O(n,"fill",t[0]),O(n,"stroke",t[1]),O(n,"stroke-width",t[2])},m(q,J){fe(q,n,J),j&&j.m(q,J),fe(q,b,J),S||(E=[Hi(n,"mouseover",P),Hi(n,"focus",k),Hi(n,"mousemove",L)],S=!0)},p(q,J){t=q,J[0]&2304&&a!==(a=t[11](t[30]))&&O(n,"data-range",a),J[0]&1280&&c!==(c=t[35])&&O(n,"data-count",c),J[0]&288&&h!==(h=t[33])&&O(n,"x",h),J[0]&272&&p!==(p=t[4](t[30]))&&O(n,"y",p),J[0]&896&&_!==(_=t[34])&&O(n,"width",_),J[0]&320&&o!==(o=t[31])&&O(n,"height",o),J[0]&1&&O(n,"fill",t[0]),J[0]&2&&O(n,"stroke",t[1]),J[0]&4&&O(n,"stroke-width",t[2]),t[3]&&t[35]?j?j.p(t,J):(j=jg(t),j.c(),j.m(b.parentNode,b)):j&&(j.d(1),j=null)},d(q){q&&ce(n),j&&j.d(q),q&&ce(b),S=!1,dr(E)}}}function _E(t){let n,a=t[8],c=[];for(let h=0;h<a.length;h+=1)c[h]=Vg(Ng(t,a,h));return{c(){n=$t("g");for(let h=0;h<c.length;h+=1)c[h].c();O(n,"class","column-group")},m(h,p){fe(h,n,p);for(let _=0;_<c.length;_+=1)c[_].m(n,null)},p(h,p){if(p[0]&6299647){a=h[8];let _;for(_=0;_<a.length;_+=1){const o=Ng(h,a,_);c[_]?c[_].p(o,p):(c[_]=Vg(o),c[_].c(),c[_].m(n,null))}for(;_<c.length;_+=1)c[_].d(1);c.length=a.length}},i:Ft,o:Ft,d(h){h&&ce(n),Ia(c,h)}}}function yE(t,n,a){let c,h,p,_,o,b,S,E,P,k;const{data:L,xGet:j,yGet:q,x:J,yRange:ee,xScale:ge,y:_e,height:Y,zGet:le,zScale:ie,z:ke}=fr("LayerCake");wt(t,L,Ne=>a(8,b=Ne)),wt(t,j,Ne=>a(5,o=Ne)),wt(t,q,Ne=>a(4,p=Ne)),wt(t,J,Ne=>a(11,P=Ne)),wt(t,ee,Ne=>a(23,_=Ne)),wt(t,ge,Ne=>a(9,S=Ne)),wt(t,_e,Ne=>a(10,E=Ne)),wt(t,Y,Ne=>a(12,k=Ne));let{fill:Je="royalblue"}=n,{stroke:ve="#000"}=n,{strokeWidth:pe=0}=n,{showLabels:Fe=!1}=n;const $e=sl();function ct(Ne){return function(ut){raise(this),ut.layerX!==0&&ut.layerY!==0&&$e("mousemove",{e:ut})}}const We=(Ne,Le)=>$e("mousemove",{e:Le,props:Ne}),mt=(Ne,Le)=>$e("mousemove",{e:Le,props:Ne}),xe=(Ne,Le)=>ct();return t.$$set=Ne=>{"fill"in Ne&&a(0,Je=Ne.fill),"stroke"in Ne&&a(1,ve=Ne.stroke),"strokeWidth"in Ne&&a(2,pe=Ne.strokeWidth),"showLabels"in Ne&&a(3,Fe=Ne.showLabels)},t.$$.update=()=>{t.$$.dirty[0]&32&&a(7,c=Ne=>{const Le=o(Ne);return Math.abs(Le[1]-Le[0])}),t.$$.dirty[0]&8388624&&a(6,h=Ne=>_[0]-p(Ne))},[Je,ve,pe,Fe,p,o,h,c,b,S,E,P,k,L,j,q,J,ee,ge,_e,Y,$e,ct,_,We,mt,xe]}class vE extends _i{constructor(n){super(),gi(this,n,yE,_E,di,{fill:0,stroke:1,strokeWidth:2,showLabels:3},null,[-1,-1])}}var qg={},xE={get exports(){return qg},set exports(t){qg=t}};(function(t,n){(function(a,c){c()})(Xo,function(){function a(S,E){return typeof E>"u"?E={autoBom:!1}:typeof E!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),E={autoBom:!E}),E.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(S.type)?new Blob(["\uFEFF",S],{type:S.type}):S}function c(S,E,P){var k=new XMLHttpRequest;k.open("GET",S),k.responseType="blob",k.onload=function(){b(k.response,E,P)},k.onerror=function(){console.error("could not download file")},k.send()}function h(S){var E=new XMLHttpRequest;E.open("HEAD",S,!1);try{E.send()}catch{}return 200<=E.status&&299>=E.status}function p(S){try{S.dispatchEvent(new MouseEvent("click"))}catch{var E=document.createEvent("MouseEvents");E.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),S.dispatchEvent(E)}}var _=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof Xo=="object"&&Xo.global===Xo?Xo:void 0,o=_.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),b=_.saveAs||(typeof window!="object"||window!==_?function(){}:"download"in HTMLAnchorElement.prototype&&!o?function(S,E,P){var k=_.URL||_.webkitURL,L=document.createElement("a");E=E||S.name||"download",L.download=E,L.rel="noopener",typeof S=="string"?(L.href=S,L.origin===location.origin?p(L):h(L.href)?c(S,E,P):p(L,L.target="_blank")):(L.href=k.createObjectURL(S),setTimeout(function(){k.revokeObjectURL(L.href)},4e4),setTimeout(function(){p(L)},0))}:"msSaveOrOpenBlob"in navigator?function(S,E,P){if(E=E||S.name||"download",typeof S!="string")navigator.msSaveOrOpenBlob(a(S,P),E);else if(h(S))c(S,E,P);else{var k=document.createElement("a");k.href=S,k.target="_blank",setTimeout(function(){p(k)})}}:function(S,E,P,k){if(k=k||open("","_blank"),k&&(k.document.title=k.document.body.innerText="downloading..."),typeof S=="string")return c(S,E,P);var L=S.type==="application/octet-stream",j=/constructor/i.test(_.HTMLElement)||_.safari,q=/CriOS\/[\d]+/.test(navigator.userAgent);if((q||L&&j||o)&&typeof FileReader<"u"){var J=new FileReader;J.onloadend=function(){var _e=J.result;_e=q?_e:_e.replace(/^data:[^;]*;/,"data:attachment/file;"),k?k.location.href=_e:location=_e,k=null},J.readAsDataURL(S)}else{var ee=_.URL||_.webkitURL,ge=ee.createObjectURL(S);k?k.location=ge:location.href=ge,k=null,setTimeout(function(){ee.revokeObjectURL(ge)},4e4)}});_.saveAs=b.saveAs=b,t.exports=b})})(xE);function Gg(t){const n={...t[13].props};t[14]=n}function Zg(t){let n,a,c,h,p,_,o,b,S,E,P,k,L,j,q,J,ee,ge,_e,Y,le,ie,ke,Je,ve,pe,Fe,$e,ct,We,mt,xe,Ne,Le,ut,Ze=t[3].total_jail_pretrial.toFixed(0)+"",qt,It,Ut,Kt,Jt=t[3].required_reduction.toFixed(0)+"",li,mi,Ji=(t[3].required_reduction_pct*100).toFixed(1)+"",rt,He;function Mt(Nt,fi){return Nt[3].required_reduction_pct>.95?wE:bE}let Qe=Mt(t),At=Qe(t);function ei(Nt,fi){return Nt[3].required_reduction_pct>.95?kE:TE}let Ei=ei(t),ci=Ei(t);return{c(){n=Ae("div"),a=$t("svg"),c=$t("defs"),h=$t("pattern"),p=$t("image"),_=Ge(),o=Ae("div"),b=$t("svg"),At.c(),S=$t("text"),E=st("reduction required"),ci.c(),k=$t("line"),q=$t("rect"),ge=$t("rect"),ie=$t("rect"),ke=$t("rect"),Je=$t("text"),ve=st("pretrial population"),pe=$t("text"),Fe=st("reduction required"),We=Ge(),mt=Ae("div"),xe=Ae("p"),Ne=st("As of "),Le=st(t[5]),ut=st(", there were "),qt=st(Ze),It=st(" held pretrial in "),Ut=st(t[0]),Kt=st(`’s jails. The number of people held
        pretrial needs to decrease by `),li=st(Jt),mi=st(" ("),rt=st(Ji),He=st(` percent) to
        align with the national average.`),l1(p,"xlink:href","data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPScxMCcgaGVpZ2h0PScxMCc+CiAgPHJlY3Qgd2lkdGg9JzEwJyBoZWlnaHQ9JzEwJyBmaWxsPSd3aGl0ZScvPgogIDxwYXRoIGQ9J00tMSwxIGwyLC0yCiAgICAgICAgICAgTTAsMTAgbDEwLC0xMAogICAgICAgICAgIE05LDExIGwyLC0yJyBzdHJva2U9J2JsYWNrJyBzdHJva2Utd2lkdGg9JzMnLz4KPC9zdmc+"),O(p,"x","0"),O(p,"y","0"),O(p,"width","10"),O(p,"height","10"),O(h,"id","diagonal-stripe-3"),O(h,"patternUnits","userSpaceOnUse"),O(h,"width","10"),O(h,"height","10"),O(a,"height","10"),O(a,"width","10"),O(a,"xmlns","http://www.w3.org/2000/svg"),O(a,"version","1.1"),O(S,"x","0"),O(S,"y",P=t[3].reductionLine),O(S,"fill","#000"),O(S,"class","svelte-1xnl78g"),O(k,"x1","140"),O(k,"y1",L=t[3].reductionLine2),O(k,"x2","200"),O(k,"y2",j=t[3].reductionLine2),O(k,"stroke","#000"),O(k,"class","svelte-1xnl78g"),O(q,"width",J=t[3].parishPretrialSquareSide),O(q,"height",ee=t[3].parishPretrialSquareSide),O(q,"x",t[4]),O(q,"y","0"),O(q,"fill","#0e002c"),O(ge,"width",_e=t[3].parishReductionSquareSide),O(ge,"height",Y=t[3].parishReductionSquareSide),O(ge,"x",t[4]),O(ge,"y",le=t[3].parishPretrialSquareSide-t[3].parishReductionSquareSide),O(ge,"stroke-width","2"),O(ge,"stroke-dasharray","3 6"),O(ge,"stroke","#ef4136"),O(ge,"fill","url(#diagonal-stripe-3)"),O(ge,"opacity",".8"),O(ie,"class","mobile_legend svelte-1xnl78g"),O(ie,"width","15"),O(ie,"height","15"),O(ie,"x","0"),O(ie,"y","210"),O(ie,"fill","#0e002c"),O(ke,"class","mobile_legend svelte-1xnl78g"),O(ke,"width","15"),O(ke,"height","15"),O(ke,"x","0"),O(ke,"y","230"),O(ke,"fill","url(#diagonal-stripe-3)"),O(ke,"stroke-width","2"),O(ke,"stroke-dasharray","3,6"),O(ke,"stroke","rgb(239, 65, 54)"),O(Je,"class","mobile_legend svelte-1xnl78g"),O(Je,"x","20"),O(Je,"y","222"),O(Je,"fill","#000"),O(pe,"class","mobile_legend svelte-1xnl78g"),O(pe,"x","20"),O(pe,"y","242"),O(pe,"fill","#000"),O(b,"height",$e=t[3].svgSizeH+"px"),O(b,"width",ct=t[3].svgSizeW+"px"),O(xe,"class","propdescription svelte-1xnl78g"),O(n,"id","proportion"),O(n,"class","svelte-1xnl78g")},m(Nt,fi){fe(Nt,n,fi),ue(n,a),ue(a,c),ue(c,h),ue(h,p),ue(n,_),ue(n,o),ue(o,b),At.m(b,null),ue(b,S),ue(S,E),ci.m(b,null),ue(b,k),ue(b,q),ue(b,ge),ue(b,ie),ue(b,ke),ue(b,Je),ue(Je,ve),ue(b,pe),ue(pe,Fe),ue(n,We),ue(n,mt),ue(mt,xe),ue(xe,Ne),ue(xe,Le),ue(xe,ut),ue(xe,qt),ue(xe,It),ue(xe,Ut),ue(xe,Kt),ue(xe,li),ue(xe,mi),ue(xe,rt),ue(xe,He)},p(Nt,fi){Qe===(Qe=Mt(Nt))&&At?At.p(Nt,fi):(At.d(1),At=Qe(Nt),At&&(At.c(),At.m(b,S))),fi&8&&P!==(P=Nt[3].reductionLine)&&O(S,"y",P),Ei===(Ei=ei(Nt))&&ci?ci.p(Nt,fi):(ci.d(1),ci=Ei(Nt),ci&&(ci.c(),ci.m(b,k))),fi&8&&L!==(L=Nt[3].reductionLine2)&&O(k,"y1",L),fi&8&&j!==(j=Nt[3].reductionLine2)&&O(k,"y2",j),fi&8&&J!==(J=Nt[3].parishPretrialSquareSide)&&O(q,"width",J),fi&8&&ee!==(ee=Nt[3].parishPretrialSquareSide)&&O(q,"height",ee),fi&16&&O(q,"x",Nt[4]),fi&8&&_e!==(_e=Nt[3].parishReductionSquareSide)&&O(ge,"width",_e),fi&8&&Y!==(Y=Nt[3].parishReductionSquareSide)&&O(ge,"height",Y),fi&16&&O(ge,"x",Nt[4]),fi&8&&le!==(le=Nt[3].parishPretrialSquareSide-Nt[3].parishReductionSquareSide)&&O(ge,"y",le),fi&8&&$e!==($e=Nt[3].svgSizeH+"px")&&O(b,"height",$e),fi&8&&ct!==(ct=Nt[3].svgSizeW+"px")&&O(b,"width",ct),fi&32&&hi(Le,Nt[5]),fi&8&&Ze!==(Ze=Nt[3].total_jail_pretrial.toFixed(0)+"")&&hi(qt,Ze),fi&1&&hi(Ut,Nt[0]),fi&8&&Jt!==(Jt=Nt[3].required_reduction.toFixed(0)+"")&&hi(li,Jt),fi&8&&Ji!==(Ji=(Nt[3].required_reduction_pct*100).toFixed(1)+"")&&hi(rt,Ji)},d(Nt){Nt&&ce(n),At.d(),ci.d()}}}function bE(t){let n,a,c;return{c(){n=$t("text"),a=st("pretrial population"),O(n,"x","0"),O(n,"y",c=t[3].parishPretrialLine),O(n,"fill","#000"),O(n,"class","svelte-1xnl78g")},m(h,p){fe(h,n,p),ue(n,a)},p(h,p){p&8&&c!==(c=h[3].parishPretrialLine)&&O(n,"y",c)},d(h){h&&ce(n)}}}function wE(t){let n,a,c;return{c(){n=$t("text"),a=st("pretrial population"),O(n,"x","0"),O(n,"y",c=t[3].parishPretrialLine+9),O(n,"fill","#000"),O(n,"class","svelte-1xnl78g")},m(h,p){fe(h,n,p),ue(n,a)},p(h,p){p&8&&c!==(c=h[3].parishPretrialLine+9)&&O(n,"y",c)},d(h){h&&ce(n)}}}function TE(t){let n,a,c;return{c(){n=$t("line"),O(n,"x1","140"),O(n,"y1",a=t[3].parishPretrialLine2),O(n,"x2","200"),O(n,"y2",c=t[3].parishPretrialLine2),O(n,"stroke","#000"),O(n,"class","svelte-1xnl78g")},m(h,p){fe(h,n,p)},p(h,p){p&8&&a!==(a=h[3].parishPretrialLine2)&&O(n,"y1",a),p&8&&c!==(c=h[3].parishPretrialLine2)&&O(n,"y2",c)},d(h){h&&ce(n)}}}function kE(t){let n,a,c;return{c(){n=$t("line"),O(n,"x1","140"),O(n,"y1",a=t[3].parishPretrialLine2+7),O(n,"x2","200"),O(n,"y2",c=t[3].parishPretrialLine2+7),O(n,"stroke","#000"),O(n,"class","svelte-1xnl78g")},m(h,p){fe(h,n,p)},p(h,p){p&8&&a!==(a=h[3].parishPretrialLine2+7)&&O(n,"y1",a),p&8&&c!==(c=h[3].parishPretrialLine2+7)&&O(n,"y2",c)},d(h){h&&ce(n)}}}function SE(t){let n,a,c,h,p,_;return n=new vE({}),n.$on("mousemove",t[8]),n.$on("mouseout",t[9]),c=new ts({props:{gridlines:!1,snapTicks:!0,ticks:"4"}}),p=new is({props:{gridlines:!0}}),{c(){nt(n.$$.fragment),a=Ge(),nt(c.$$.fragment),h=Ge(),nt(p.$$.fragment)},m(o,b){et(n,o,b),fe(o,a,b),et(c,o,b),fe(o,h,b),et(p,o,b),_=!0},p:Ft,i(o){_||(Ie(n.$$.fragment,o),Ie(c.$$.fragment,o),Ie(p.$$.fragment,o),_=!0)},o(o){Re(n.$$.fragment,o),Re(c.$$.fragment,o),Re(p.$$.fragment,o),_=!1},d(o){tt(n,o),o&&ce(a),tt(c,o),o&&ce(h),tt(p,o)}}}function Hg(t){let n,a;return n=new bc({props:{evt:t[6],$$slots:{default:[EE,({detail:c})=>({13:c}),({detail:c})=>c?8192:0]},$$scope:{ctx:t}}}),{c(){nt(n.$$.fragment)},m(c,h){et(n,c,h),a=!0},p(c,h){const p={};h&64&&(p.evt=c[6]),h&40960&&(p.$$scope={dirty:h,ctx:c}),n.$set(p)},i(c){a||(Ie(n.$$.fragment,c),a=!0)},o(c){Re(n.$$.fragment,c),a=!1},d(c){tt(n,c)}}}function EE(t){Gg(t);let n,a=(+t[14].total_jail_pretrial).toFixed(0)+"",c,h;return{c(){n=Ae("div"),c=st(a),h=st(" people"),O(n,"class","row")},m(p,_){fe(p,n,_),ue(n,c),ue(n,h)},p(p,_){Gg(p),_&8192&&a!==(a=(+p[14].total_jail_pretrial).toFixed(0)+"")&&hi(c,a)},d(p){p&&ce(n)}}}function CE(t){let n,a,c=t[7]!==!0&&Hg(t);return{c(){c&&c.c(),n=mr()},m(h,p){c&&c.m(h,p),fe(h,n,p),a=!0},p(h,p){h[7]!==!0?c?(c.p(h,p),p&128&&Ie(c,1)):(c=Hg(h),c.c(),Ie(c,1),c.m(n.parentNode,n)):c&&(Qn(),Re(c,1,1,()=>{c=null}),$n())},i(h){a||(Ie(c),a=!0)},o(h){Re(c),a=!1},d(h){c&&c.d(h),h&&ce(n)}}}function AE(t){let n,a,c,h;return n=new _o({props:{$$slots:{default:[SE]},$$scope:{ctx:t}}}),c=new go({props:{pointerEvents:!1,$$slots:{default:[CE]},$$scope:{ctx:t}}}),{c(){nt(n.$$.fragment),a=Ge(),nt(c.$$.fragment)},m(p,_){et(n,p,_),fe(p,a,_),et(c,p,_),h=!0},p(p,_){const o={};_&32960&&(o.$$scope={dirty:_,ctx:p}),n.$set(o);const b={};_&32960&&(b.$$scope={dirty:_,ctx:p}),c.$set(b)},i(p){h||(Ie(n.$$.fragment,p),Ie(c.$$.fragment,p),h=!0)},o(p){Re(n.$$.fragment,p),Re(c.$$.fragment,p),h=!1},d(p){tt(n,p),p&&ce(a),tt(c,p)}}}function IE(t){let n,a,c,h,p,_,o,b,S,E,P,k,L,j,q,J,ee,ge,_e=t[3].required_reduction_pct>=0&&Zg(t);return L=new fo({props:{padding:{top:0,right:0,bottom:20,left:20},x:Wf,y:ME,xScale:co().paddingInner([.05]).round(!0),xDomain:["1970","1978","1983","1988","1993","1999","2006","2013","2019","2021"],yDomain:[0,t[2]],data:t[1],$$slots:{default:[AE]},$$scope:{ctx:t}}}),{c(){n=Ae("p"),n.innerHTML=`In 2019, there were nearly 16,000 people held pretrial in Louisiana on a
  typical day—more than twice the national average per capita and more than five
  times the rate of the state with the lowest pretrial detention rate (New
  Hampshire). Louisiana law allows the state to hold people longer without trial
  or conviction than most other states, resulting in lengthy pretrial stays—<a href="https://www.laaclu.org/sites/default/files/field_documents/aclu_la_justicecantwaitreport_02102020_online.pdf" target="_blank">an average of 5.5 months</a>.`,a=Ge(),_e&&_e.c(),c=Ge(),h=Ae("p"),h.innerHTML=`Money bail criminalizes poverty by requiring people accused of a crime to pay
  hundreds or even thousands of dollars to be released before trial (often to
  the profit of the private bail bond industry). <a href="https://www.laaclu.org/sites/default/files/field_documents/aclu_la_justicecantwaitreport_02102020_online.pdf" target="_blank">Median bail</a>
  in Louisiana is nearly as high as the median salary. And it’s a system that costs
  taxpayers. For example, in 2015, extracting cash bail and other conviction-related
  fines and fees
  <a href="https://www.vera.org/downloads/publications/past-due-costs-consequences-charging-for-justice-new-orleans-fact-sheet.pdf" target="_blank">cost the City of New Orleans</a> $1.9 million more in jail costs than the revenue it generated for criminal legal
  agencies.`,p=Ge(),_=Ae("h4"),o=st("Pretrial jail population in "),b=st(t[0]),S=st(" Parish (1970-2021)"),E=Ge(),P=Ae("div"),k=Ae("div"),nt(L.$$.fragment),j=Ge(),q=Ae("p"),q.innerHTML=`<i>For complete detail on jail incarceration trends, including data for race
    and gender, see Vera’s <a href="https://trends.vera.org/" target="_blank">Incarceration Trends</a>.</i>`,J=Ge(),ee=Ae("div"),ee.innerHTML=`<p><span class="rec svelte-1xnl78g">Recommendation</span>: Pass legislation that allows people
    charged with non-violent felonies and misdemeanors to be issued a summons in
    lieu of arrest, and enact comprehensive bail reform so that money does not
    determine freedom.</p>`,O(n,"class","break-avoid"),O(h,"class","break-avoid"),O(k,"class","chart-container pretrial svelte-1xnl78g"),O(P,"id","wrap"),O(P,"class","svelte-1xnl78g"),O(q,"class","note"),O(ee,"id","recs")},m(Y,le){fe(Y,n,le),fe(Y,a,le),_e&&_e.m(Y,le),fe(Y,c,le),fe(Y,h,le),fe(Y,p,le),fe(Y,_,le),ue(_,o),ue(_,b),ue(_,S),fe(Y,E,le),fe(Y,P,le),ue(P,k),et(L,k,null),fe(Y,j,le),fe(Y,q,le),fe(Y,J,le),fe(Y,ee,le),ge=!0},p(Y,[le]){Y[3].required_reduction_pct>=0?_e?_e.p(Y,le):(_e=Zg(Y),_e.c(),_e.m(c.parentNode,c)):_e&&(_e.d(1),_e=null),(!ge||le&1)&&hi(b,Y[0]);const ie={};le&4&&(ie.yDomain=[0,Y[2]]),le&2&&(ie.data=Y[1]),le&32960&&(ie.$$scope={dirty:le,ctx:Y}),L.$set(ie)},i(Y){ge||(Ie(L.$$.fragment,Y),ge=!0)},o(Y){Re(L.$$.fragment,Y),ge=!1},d(Y){Y&&ce(n),Y&&ce(a),_e&&_e.d(Y),Y&&ce(c),Y&&ce(h),Y&&ce(p),Y&&ce(_),Y&&ce(E),Y&&ce(P),tt(L),Y&&ce(j),Y&&ce(q),Y&&ce(J),Y&&ce(ee)}}}const Wf="year",ME="total_jail_pretrial";function PE(t,n,a){let{parishname:c}=n,h=[],p,_=[],o=[],b,S,P=Rn("#app").node().getBoundingClientRect().width;P>400?b=200:b=0,Fn(async()=>{const J=await Nr("https://vera-louisiana-data.s3.amazonaws.com/curated_data/clearinghouse/pretrial_trends.csv");J.forEach(Fe=>{Fe.total_jail_pretrial=+Fe.total_jail_pretrial}),a(1,h=J.filter(Fe=>Fe.parish==c+" Parish")),a(2,p=cc(h,Fe=>Fe.total_jail_pretrial));const ee=await Nr("https://vera-louisiana-data.s3.amazonaws.com/curated_data/clearinghouse/pretrial_infographic.csv"),_e=(await Nr("https://vera-louisiana-data.s3.amazonaws.com/curated_data/clearinghouse/pretrial_date.csv")).filter(Fe=>Fe.parish==c+" Parish")[0].pretrial_date;let le=yp("%m/%d/%y")(_e);const ie=lh("%B %d, %Y");a(5,S=ie(le)),_=ee.filter(Fe=>Fe.parish==c+" Parish");let Je=200*200*_[0].required_reduction_pct,ve=Math.sqrt(Je),pe=Ss().domain([0,_[0].total_jail_pretrial]).range([0,200]);_.forEach(Fe=>{Fe.total_jail_pretrial=+Fe.total_jail_pretrial,Fe.required_reduction_pct=+Fe.required_reduction_pct,Fe.required_reduction=+Fe.required_reduction,Fe.parishPretrialSquareSide=pe(Fe.total_jail_pretrial),Fe.parishReductionSquareSide=ve,Fe.svgSizeW=420,Fe.svgSizeH=P>400?220:260,Fe.parishPretrialLine=(pe(Fe.total_jail_pretrial)-pe(Fe.total_jail_pretrial)*Fe.required_reduction_pct)/2,Fe.parishPretrialLine2=(pe(Fe.total_jail_pretrial)-pe(Fe.total_jail_pretrial)*Fe.required_reduction_pct)/2-4,Fe.reductionLine=pe(Fe.total_jail_pretrial)*Fe.required_reduction_pct/2+(pe(Fe.total_jail_pretrial)-pe(Fe.total_jail_pretrial)*Fe.required_reduction_pct),Fe.reductionLine2=pe(Fe.total_jail_pretrial)*Fe.required_reduction_pct/2+(pe(Fe.total_jail_pretrial)-pe(Fe.total_jail_pretrial)*Fe.required_reduction_pct)-4}),a(3,o=_[0])}),h.forEach(J=>{J[Wf]=+J[Wf]});let k,L=!1;const j=J=>a(6,k=a(7,L=J)),q=()=>a(7,L=!0);return t.$$set=J=>{"parishname"in J&&a(0,c=J.parishname)},[c,h,p,o,b,S,k,L,j,q]}class Wg extends _i{constructor(n){super(),gi(this,n,PE,IE,di,{parishname:0})}}function zE(t){let n,a,c,h,p,_,o,b,S,E,P,k;return{c(){n=Ae("h4"),a=st("Annual "),c=st(t[0]),h=st(" Parish government payroll, by function ("),p=st(t[3]),_=st(")"),o=Ge(),b=Ae("div"),S=Ge(),E=Ae("div"),P=Ge(),k=Ae("div"),k.innerHTML=`<div class="legend-item criminallegal svelte-1qt8esd"><div class="marker svelte-1qt8esd"></div> 
    <div class="name">Criminal Legal Spending</div></div> 
  <div class="legend-item other svelte-1qt8esd"><div class="marker svelte-1qt8esd"></div> 
    <div class="name">All Other Spending</div></div>`,O(b,"class","feature svelte-1qt8esd"),O(b,"id","chart"),O(E,"class","tooltip svelte-1qt8esd"),O(k,"class","legend svelte-1qt8esd")},m(L,j){fe(L,n,j),ue(n,a),ue(n,c),ue(n,h),ue(n,p),ue(n,_),fe(L,o,j),fe(L,b,j),t[4](b),fe(L,S,j),fe(L,E,j),t[5](E),fe(L,P,j),fe(L,k,j)},p(L,[j]){j&1&&hi(c,L[0]),j&8&&hi(p,L[3])},i:Ft,o:Ft,d(L){L&&ce(n),L&&ce(o),L&&ce(b),t[4](null),L&&ce(S),L&&ce(E),t[5](null),L&&ce(P),L&&ce(k)}}}function DE(t){var n=t.toString().split(".");return n[0]=n[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),n.join(".")}function LE(t,n,a){let{parishname:c}=n,p=Rn(".tabs").node().getBoundingClientRect().width,_,o=280;p<400?_=p-20:_=p-80;let b=[],S=[],E=[],P=[],k;bT().parentId(function(ee){return ee.id.substring(0,ee.id.lastIndexOf("."))}),Cm().size([_,o]).padding(1).round(!0);let L=Rn("body").append("div").attr("class","tooltip"),j;Fn(async()=>{b=(await Nr("https://vera-louisiana-data.s3.amazonaws.com/curated_data/clearinghouse/la_state_and_local_gov_employment_payroll_parish.csv")).filter(Le=>Le.parish==c&&Le.government_function!=="budget"),a(3,j=b[0].year),E=b.filter(Le=>Le.government_function=="budget.criminal.corrections"||Le.government_function=="budget.criminal.judicial_and_legal"||Le.government_function=="budget.criminal.police"),P=b.filter(Le=>Le.government_function!=="budget.criminal.corrections"&&Le.government_function!=="budget.criminal.judicial_and_legal"&&Le.government_function!=="budget.criminal.police"&&Le.government_function!=="budget.criminal.police.police_protection_other"&&Le.government_function!=="budget.criminal.police.police_protection_persons_with_power_of_arrest"&&Le.government_function!=="budget.criminal"&&Le.government_function!=="budget"),S=(await Nr("https://vera-louisiana-data.s3.amazonaws.com/curated_data/clearinghouse/la_state_and_local_gov_employment_payroll_municipality.csv")).filter(Le=>Le.parish==c&&Le.government_function!=="budget");let _e=Vv(S,Le=>Le.name_of_government),Y=[],le=[];for(let Le=0;Le<_e.length;Le++)Y.push(_e[Le][0]),le.push(_e[Le][1]);const ie=["budget.air_transportation","budget.all_other_and_unallocable","budget.criminal.corrections","budget.criminal.judicial_and_legal","budget.criminal.police","budget.education_elementary_and_secondary_other","budget.electric_power","budget.financial_administration","budget.fire_protection_firefighters","budget.fire_protection_other","budget.gas_supply","budget.health","budget.highways","budget.hospitals","budget.housing_and_community_development","budget.libraries","budget.natural_resources","budget.other_government_administration","budget.parks_and_recreation","budget.public_welfare","budget.sea_and_inland_port_facilities","budget.sewerage","budget.solid_waste_management","budget.transit","budget.water_supply"],ke=["Air Transportation","All Other & Unallocable","Corrections","Judicial and Legal","Police","Education","Electric Power","Financial Administration","Firefighters","Fire Protection Other","Gas Supply","Health","Highways","Hospitals","Housing & Community Development","Libraries","Natural Resources","Other Gov't Administration","Parks & Recreation","Public Welfare","Sea & Inland Port Facilities","Sewerage","Solid Waste Management","Transit","Water Supply"],Je=E.map(Le=>({name:ke[ie.indexOf(Le.government_function)],value:+Le.total_payroll_percent_of_total,payroll:+Le.total_payroll,employees:+Le.full_time_employees})),ve=P.map(Le=>({name:ke[ie.indexOf(Le.government_function)],value:+Le.total_payroll_percent_of_total,payroll:+Le.total_payroll,employees:+Le.full_time_employees}));for(let Le=0;Le<le.length;Le++)le[Le].map(ut=>({name:ke[ie.indexOf(ut.government_function)],value:+ut.total_payroll_percent_of_total,payroll:+ut.total_payroll,employees:+ut.full_time_employees}));var pe=o=100,Fe=Ss().domain([0,pe]).range([0,pe]),$e=Ss().domain([0,o]).range([0,o]);Yu().range(["#EF4136","#DA392F","#b6231a"]),Yu().range(["#2E1D97","#97DFD1","royalblue","#0E002C","#0A0319","navy","slateblue","#146571","#4625ae","#361694","#3d83da","#0553b3","#546a86","#6b91c0","#2d4d75"].map(function(Le){return Le=qu(Le),Le}));var ct=Cm().size([pe,o]).paddingInner(0).round(!1),We={name:"Budget",children:[{name:"Criminal Legal Spending",children:Je},{name:"Other",children:ve}]},mt=dp(We).sum(function(Le){return Le.value?Le.value:0}).sort(function(Le,ut){return ut.height-Le.height||ut.value-Le.value});ct(mt);var xe=Rn("#chart").append("div").attr("id","chartle"),Ne=xe.selectAll(".node").data(mt.descendants()).enter().append("div").attr("class",function(Le){return"node level-"+Le.depth}).attr("title",function(Le){return Le.data.name?Le.data.name:"null"});Ne.style("left",function(Le){return Fe(Le.x0)+"%"}).style("top",function(Le){return $e(Le.y0)+"%"}).style("width",function(Le){return Fe(Le.x1)-Fe(Le.x0)+"%"}).style("height",function(Le){return $e(Le.y1)-$e(Le.y0)+"%"}).style("background-color",function(Le){for(;Le.depth>2;)Le=Le.parent;return Le.data.name=="Corrections"||Le.data.name=="Police"||Le.data.name=="Judicial and Legal"?"#ef4136":"#0E002C"}).on("mouseover",function(Le,ut){var Ze=ut.data.name+"<br/>$"+DE(ut.data.payroll)+" ("+ut.data.value.toFixed(1)+"%)";Rn(L).html(Ze).style("visibility","visible")}).on("mousemove",function(Le,ut){Rn(L).style("top",Le.pageY+"px").style("left",Le.pageX+"px")}).on("mouseout",function(Le,ut){F_("rect").attr("stroke-width",0),Rn(L).style("visibility","hidden")}),Ne.append("p").text(function(Le){return Le.data.name?Le.data.name:"---"}).attr("class",function(Le){let ut=Rn(this).node(),Ze=ut.getBoundingClientRect().width,qt=ut.getBoundingClientRect().height,It=ut.parentNode,Ut=It.getBoundingClientRect().width,Kt=It.getBoundingClientRect().height;return Ze>Ut||qt+14>Kt?"label overflow":"label inbounds"})});function q(ee){Bn[ee?"unshift":"push"](()=>{k=ee,a(1,k)})}function J(ee){Bn[ee?"unshift":"push"](()=>{L=ee,a(2,L)})}return t.$$set=ee=>{"parishname"in ee&&a(0,c=ee.parishname)},[c,k,L,j,q,J]}class RE extends _i{constructor(n){super(),gi(this,n,LE,zE,di,{parishname:0})}}function BE(t){let n,a,c,h,p,_,o;return h=new RE({props:{parishname:t[0]}}),{c(){n=Ae("p"),n.innerHTML=`A large proportion of parish and municipal budgets support the criminal legal
  system. But incarceration does not guarantee safety—if it did, Louisiana would
  be one of the safest places in the world. Every dollar spent on policing and
  incarceration is money that could instead go towards cost-efficient systems
  that are <a href="https://www.brookings.edu/essay/a-new-community-safety-blueprint-how-the-federal-government-can-address-violence-and-harm-through-a-public-health-approach/" target="_blank">proven to produce safety and keep people out of jails and prisons</a>, like mental health care, education, vocational programs, and housing.`,a=Ge(),c=Ae("div"),nt(h.$$.fragment),p=Ge(),_=Ae("div"),_.innerHTML=`<p><span class="rec svelte-1lv3cy1">Recommendation</span>: Enact meaningful reforms that will
    allow for jail decarceration, and then close jails and repurpose carceral
    facilities for non-jail, non-detention purposes. Reducing corrections
    spending and ending mass incarceration in Louisiana will require lowering
    jail capacity. This means working towards permanently closing jails.</p>`,O(n,"class","break-avoid"),O(c,"id","treemap"),O(c,"class","svelte-1lv3cy1"),O(_,"id","recs"),O(_,"class","svelte-1lv3cy1")},m(b,S){fe(b,n,S),fe(b,a,S),fe(b,c,S),et(h,c,null),fe(b,p,S),fe(b,_,S),o=!0},p(b,[S]){const E={};S&1&&(E.parishname=b[0]),h.$set(E)},i(b){o||(Ie(h.$$.fragment,b),o=!0)},o(b){Re(h.$$.fragment,b),o=!1},d(b){b&&ce(n),b&&ce(a),b&&ce(c),tt(h),b&&ce(p),b&&ce(_)}}}function FE(t,n,a){let{parishname:c}=n;return Fn(async()=>{}),t.$$set=h=>{"parishname"in h&&a(0,c=h.parishname)},[c]}class Xg extends _i{constructor(n){super(),gi(this,n,FE,BE,di,{parishname:0})}}function OE(t){let n,a,c;return{c(){n=Ae("div"),a=Ge(),c=Ae("div"),O(n,"id","vis"),O(c,"class","tooltip svelte-1x80qnr")},m(h,p){fe(h,n,p),t[3](n),fe(h,a,p),fe(h,c,p),t[4](c)},p:Ft,i:Ft,o:Ft,d(h){h&&ce(n),t[3](null),h&&ce(a),h&&ce(c),t[4](null)}}}function UE(t,n,a){let{parishname:c}=n,h,p=[],_=Rn("body").append("div").attr("class","tooltip");Fn(async()=>{const S=await Nr("https://vera-louisiana-data.s3.amazonaws.com/curated_data/clearinghouse/arrests_long.csv");S.forEach(_e=>{if(_e.the_value=+_e.value,_e.parameter=_e.department.replace(/[^A-Z0-9]+/gi,""),_e.metric=="black_pt2_arrests_pct")return _e.segment="Pt 2 Arrests, Black (%)";if(_e.metric=="black_pop_pct")return _e.segment="Black Population (%)"});let E=S.filter(_e=>_e.parish==c+" Parish");var P=240,k=220,L={top:15,right:30,bottom:40,left:35},j=co().range([0,P]).padding(.1),q=Ss().range([k,30]),J=tx().scale(j),ee=Array.from(new Set(E.map(function(_e){return _e.segment})));j.domain(ee),p=Array.from(Uv(E,_e=>_e.parameter),([_e,Y])=>({key:_e,value:Y}));var ge=Rn("#vis").selectAll("svg").data(p).enter().append("svg").attr("id","dept").attr("height",k+L.bottom).attr("class",function(_e){return _e.value[0].parameter});ge.append("g").attr("transform","translate(0,"+16+")").append("text").text(_e=>_e.value[0].department),p.forEach(function(_e,Y){q.domain([0,cc(_e.value,function(ie){return ie.the_value})]),Rn("svg."+_e.value[0].parameter).selectAll(".bar").data(_e.value).enter().append("rect").attr("class","bar").attr("x",function(ie){return j(ie.segment)}).attr("width",j.bandwidth()).attr("y",function(ie){return q(ie.the_value)}).attr("height",function(ie){return k-q(ie.the_value)}).attr("stroke",ie=>ie.metric=="black_pt2_arrests_pct"?"none":"#97dfd1").attr("fill",ie=>ie.metric=="black_pt2_arrests_pct"?"#0e002c":"#97dfd1").on("mouseover",function(ie,ke){var Je=ke.the_value.toFixed(0)+"%";Rn(_).html(Je).style("visibility","visible")}).on("mousemove",function(ie,ke){Rn(_).style("top",ie.pageY+"px").style("left",ie.pageX+"px")}).on("mouseout",function(ie,ke){F_("rect").attr("stroke-width",0),Rn(_).style("visibility","hidden")}),Rn("svg."+_e.value[0].parameter).append("g").attr("transform","translate(0,"+k+")").call(J)})});function o(S){Bn[S?"unshift":"push"](()=>{h=S,a(0,h)})}function b(S){Bn[S?"unshift":"push"](()=>{_=S,a(1,_)})}return t.$$set=S=>{"parishname"in S&&a(2,c=S.parishname)},[h,_,c,o,b]}class NE extends _i{constructor(n){super(),gi(this,n,UE,OE,di,{parishname:2})}}function Kg(t){const n={...t[11].props};t[12]=n}function jE(t){let n,a,c,h,p,_;return n=new ts({props:{gridlines:!0,baseline:!0,snapTicks:!0,ticks:"4"}}),c=new is({props:{gridlines:!1}}),p=new ch({props:{fill:"#da392f"}}),p.$on("mousemove",t[7]),p.$on("mouseout",t[8]),{c(){nt(n.$$.fragment),a=Ge(),nt(c.$$.fragment),h=Ge(),nt(p.$$.fragment)},m(o,b){et(n,o,b),fe(o,a,b),et(c,o,b),fe(o,h,b),et(p,o,b),_=!0},p:Ft,i(o){_||(Ie(n.$$.fragment,o),Ie(c.$$.fragment,o),Ie(p.$$.fragment,o),_=!0)},o(o){Re(n.$$.fragment,o),Re(c.$$.fragment,o),Re(p.$$.fragment,o),_=!1},d(o){tt(n,o),o&&ce(a),tt(c,o),o&&ce(h),tt(p,o)}}}function Jg(t){let n,a;return n=new bc({props:{evt:t[5],$$slots:{default:[VE,({detail:c})=>({11:c}),({detail:c})=>c?2048:0]},$$scope:{ctx:t}}}),{c(){nt(n.$$.fragment)},m(c,h){et(n,c,h),a=!0},p(c,h){const p={};h&32&&(p.evt=c[5]),h&10240&&(p.$$scope={dirty:h,ctx:c}),n.$set(p)},i(c){a||(Ie(n.$$.fragment,c),a=!0)},o(c){Re(n.$$.fragment,c),a=!1},d(c){tt(n,c)}}}function VE(t){Kg(t);let n,a=t[12].department+"",c,h,p=(+t[12].pt2_arrests_pct).toFixed(0)+"",_,o;return{c(){n=Ae("div"),c=st(a),h=st(": "),_=st(p),o=st("% Part 2 Arrests"),O(n,"class","row")},m(b,S){fe(b,n,S),ue(n,c),ue(n,h),ue(n,_),ue(n,o)},p(b,S){Kg(b),S&2048&&a!==(a=b[12].department+"")&&hi(c,a),S&2048&&p!==(p=(+b[12].pt2_arrests_pct).toFixed(0)+"")&&hi(_,p)},d(b){b&&ce(n)}}}function qE(t){let n,a,c=t[6]!==!0&&Jg(t);return{c(){c&&c.c(),n=mr()},m(h,p){c&&c.m(h,p),fe(h,n,p),a=!0},p(h,p){h[6]!==!0?c?(c.p(h,p),p&64&&Ie(c,1)):(c=Jg(h),c.c(),Ie(c,1),c.m(n.parentNode,n)):c&&(Qn(),Re(c,1,1,()=>{c=null}),$n())},i(h){a||(Ie(c),a=!0)},o(h){Re(c),a=!1},d(h){c&&c.d(h),h&&ce(n)}}}function GE(t){let n,a,c,h;return n=new _o({props:{$$slots:{default:[jE]},$$scope:{ctx:t}}}),c=new go({props:{pointerEvents:!1,$$slots:{default:[qE]},$$scope:{ctx:t}}}),{c(){nt(n.$$.fragment),a=Ge(),nt(c.$$.fragment)},m(p,_){et(n,p,_),fe(p,a,_),et(c,p,_),h=!0},p(p,_){const o={};_&8288&&(o.$$scope={dirty:_,ctx:p}),n.$set(o);const b={};_&8288&&(b.$$scope={dirty:_,ctx:p}),c.$set(b)},i(p){h||(Ie(n.$$.fragment,p),Ie(c.$$.fragment,p),h=!0)},o(p){Re(n.$$.fragment,p),Re(c.$$.fragment,p),h=!1},d(p){tt(n,p),p&&ce(a),tt(c,p)}}}function ZE(t){let n,a,c,h,p,_,o,b,S,E,P,k,L,j,q,J,ee,ge,_e,Y,le,ie,ke,Je,ve,pe,Fe,$e,ct,We,mt;return S=new fo({props:{padding:{top:0,bottom:40,left:230},x:Xf,y:HE,yScale:co().paddingInner([.15]),xDomain:[0,null],data:t[1],$$slots:{default:[GE]},$$scope:{ctx:t}}}),pe=new NE({props:{parishname:t[0]}}),{c(){n=Ae("p"),n.textContent=`Entry into the criminal legal system begins with an arrest. The FBI classifies
  arrests as either “Part I” or “Part II.” Part I offenses include property
  crimes such as larceny (usually shoplifting or theft from a motor vehicle),
  burglary, and arson, as well as violent crimes such as aggravated assault,
  criminal homicide, rape, and robbery. Part II offenses include less serious
  offenses such as drug abuse violations, disorderly conduct, and gambling.`,a=Ge(),c=Ae("p"),c.textContent=`In Louisiana, 75 percent of arrests are Part II arrests. Any arrest can lead
  to cascading consequences: high bail leads to long pretrial detention, which
  leads to loss of employment, child custody, housing, and possessions. These
  consequences exacerbate trauma and harm mental health. It is therefore
  essential to consider whether these arrests are improving public safety and if
  there are better alternatives to the police in nonviolent situations.`,h=Ge(),p=Ae("div"),_=Ae("h4"),_.textContent="Part 2 Arrests, Proportion of Total Arrests (2018)",o=Ge(),b=Ae("div"),nt(S.$$.fragment),E=Ge(),P=Ae("p"),k=st(`Arrests are the rare part of the Louisiana criminal legal system where data on
  race is available. The disproportionate arrest of Black people in Louisiana,
  along with a heightened focus on lower-level offenses, leads to `),L=Ae("a"),L.textContent="long-term damage to communities of color and a distrust of the police",j=st(".  In "),q=st(t[0]),J=st(" Parish, Black people make up "),ee=st(t[2]),ge=st(` percent of the
  population but `),_e=st(t[3]),Y=st(` percent of people arrested for Part II
  offenses, which pose little threat to public safety.`),le=Ge(),ie=Ae("div"),ke=Ae("h4"),ke.textContent="Part 2 Arrests, Racial Disparity (2018)",Je=Ge(),ve=Ae("div"),nt(pe.$$.fragment),Fe=Ge(),$e=Ae("p"),$e.textContent="Source: Arrest Trends (2018) and U.S. Census American Community Survey (2020)",ct=Ge(),We=Ae("div"),We.innerHTML=`<p><span class="rec svelte-1y64uy">Recommendation</span>: Advance civilian responses to
    <a href="https://www.vera.org/behavioral-health-crisis-alternatives" target="_blank">911 calls that don’t require law enforcement</a>. Removing the police from encounters that don’t require them–like mental
    health crises,
    <a href="https://www.vera.org/ending-mass-incarceration/criminalization-racial-disparities/public-safety/redefining-public-safety-initiative/stop-the-stops" target="_blank">low-level traffic violations</a>, and noise complaints–is
    <a href="https://www.brookings.edu/essay/a-new-community-safety-blueprint-how-the-federal-government-can-address-violence-and-harm-through-a-public-health-approach/" target="_blank">proven to improve safety</a>, while also reducing arrests (and thus jail admissions).</p>`,O(n,"class","break-avoid"),O(b,"class","chart-container svelte-1y64uy"),O(p,"class","barchart svelte-1y64uy"),Ht(p,"height",t[4]*60+"px"),O(L,"href","https://www.vera.org/downloads/publications/for-the-record-unjust-burden-racial-disparities.pdf"),O(L,"target","_blank"),O(P,"class","disparities svelte-1y64uy"),O(ve,"id","grid"),O(ve,"class","svelte-1y64uy"),O(ie,"id","bar"),O(ie,"class","svelte-1y64uy"),O($e,"class","note"),O(We,"id","recs")},m(xe,Ne){fe(xe,n,Ne),fe(xe,a,Ne),fe(xe,c,Ne),fe(xe,h,Ne),fe(xe,p,Ne),ue(p,_),ue(p,o),ue(p,b),et(S,b,null),fe(xe,E,Ne),fe(xe,P,Ne),ue(P,k),ue(P,L),ue(P,j),ue(P,q),ue(P,J),ue(P,ee),ue(P,ge),ue(P,_e),ue(P,Y),fe(xe,le,Ne),fe(xe,ie,Ne),ue(ie,ke),ue(ie,Je),ue(ie,ve),et(pe,ve,null),fe(xe,Fe,Ne),fe(xe,$e,Ne),fe(xe,ct,Ne),fe(xe,We,Ne),mt=!0},p(xe,[Ne]){const Le={};Ne&2&&(Le.data=xe[1]),Ne&8288&&(Le.$$scope={dirty:Ne,ctx:xe}),S.$set(Le),(!mt||Ne&16)&&Ht(p,"height",xe[4]*60+"px"),(!mt||Ne&1)&&hi(q,xe[0]),(!mt||Ne&4)&&hi(ee,xe[2]),(!mt||Ne&8)&&hi(_e,xe[3]);const ut={};Ne&1&&(ut.parishname=xe[0]),pe.$set(ut)},i(xe){mt||(Ie(S.$$.fragment,xe),Ie(pe.$$.fragment,xe),mt=!0)},o(xe){Re(S.$$.fragment,xe),Re(pe.$$.fragment,xe),mt=!1},d(xe){xe&&ce(n),xe&&ce(a),xe&&ce(c),xe&&ce(h),xe&&ce(p),tt(S),xe&&ce(E),xe&&ce(P),xe&&ce(le),xe&&ce(ie),tt(pe),xe&&ce(Fe),xe&&ce($e),xe&&ce(ct),xe&&ce(We)}}}const Xf="pt2_arrests_pct",HE="department";function WE(t,n,a){let{parishname:c}=n,h=[],p=[],_=0,o=0,b;Fn(async()=>{const L=await Nr("https://vera-louisiana-data.s3.amazonaws.com/curated_data/clearinghouse/arrests.csv");L.forEach(q=>{q.pt2_arrests_pct=+q.pt2_arrests_pct,q.black_pop_pct=+q.black_pop_pct,q.black_pt2_arrests_pct=+q.black_pt2_arrests_pct}),a(1,h=L.filter(q=>q.parish==c+" Parish")),h.sort((q,J)=>J.pt2_arrests_pct-q.pt2_arrests_pct),p=(await Nr("https://vera-louisiana-data.s3.amazonaws.com/curated_data/clearinghouse/arrests_parish_sentence.csv")).filter(q=>q.parish==c+" Parish"),a(2,_=(+p[0].black_pop_pct).toFixed(0)),a(3,o=(+p[0].black_pt2_arrests_pct).toFixed(0)),a(4,b=h.length)}),h.forEach(L=>{L[Xf]=+L[Xf]}),Rn("body").append("div").attr("class","tooltip");let S,E=!1;const P=L=>a(5,S=a(6,E=L)),k=()=>a(6,E=!0);return t.$$set=L=>{"parishname"in L&&a(0,c=L.parishname)},[c,h,_,o,b,S,E,P,k]}class XE extends _i{constructor(n){super(),gi(this,n,WE,ZE,di,{parishname:0})}}function Yg(t,n,a){const c=t.slice();return c[4]=n[a],c}function Qg(t,n,a){const c=t.slice();return c[4]=n[a],c}function $g(t){let n,a,c=t[4].label+"",h,p,_,o,b;return{c(){n=Ae("li"),a=Ae("span"),h=st(c),p=Ge(),O(a,"class","tabitem svelte-1mfb3zm"),O(n,"class",_=Vd(t[0]===t[4].value?"active":"")+" svelte-1mfb3zm")},m(S,E){fe(S,n,E),ue(n,a),ue(a,h),ue(n,p),o||(b=Hi(a,"click",function(){eh(t[3](t[4].value))&&t[3](t[4].value).apply(this,arguments)}),o=!0)},p(S,E){t=S,E&2&&c!==(c=t[4].label+"")&&hi(h,c),E&3&&_!==(_=Vd(t[0]===t[4].value?"active":"")+" svelte-1mfb3zm")&&O(n,"class",_)},d(S){S&&ce(n),o=!1,b()}}}function e_(t){let n,a,c,h;var p=t[4].component;function _(o){return{props:{parishname:o[2]}}}return p&&(a=Ou(p,_(t))),{c(){n=Ae("div"),a&&nt(a.$$.fragment),c=Ge(),O(n,"class","box svelte-1mfb3zm")},m(o,b){fe(o,n,b),a&&et(a,n,null),ue(n,c),h=!0},p(o,b){const S={};if(b&4&&(S.parishname=o[2]),p!==(p=o[4].component)){if(a){Qn();const E=a;Re(E.$$.fragment,1,0,()=>{tt(E,1)}),$n()}p?(a=Ou(p,_(o)),nt(a.$$.fragment),Ie(a.$$.fragment,1),et(a,n,c)):a=null}else p&&a.$set(S)},i(o){h||(a&&Ie(a.$$.fragment,o),h=!0)},o(o){a&&Re(a.$$.fragment,o),h=!1},d(o){o&&ce(n),a&&tt(a)}}}function t_(t){let n,a,c=t[0]==t[4].value&&e_(t);return{c(){c&&c.c(),n=mr()},m(h,p){c&&c.m(h,p),fe(h,n,p),a=!0},p(h,p){h[0]==h[4].value?c?(c.p(h,p),p&3&&Ie(c,1)):(c=e_(h),c.c(),Ie(c,1),c.m(n.parentNode,n)):c&&(Qn(),Re(c,1,1,()=>{c=null}),$n())},i(h){a||(Ie(c),a=!0)},o(h){Re(c),a=!1},d(h){c&&c.d(h),h&&ce(n)}}}function KE(t){let n,a,c,h,p=t[1],_=[];for(let E=0;E<p.length;E+=1)_[E]=$g(Qg(t,p,E));let o=t[1],b=[];for(let E=0;E<o.length;E+=1)b[E]=t_(Yg(t,o,E));const S=E=>Re(b[E],1,1,()=>{b[E]=null});return{c(){n=Ae("ul");for(let E=0;E<_.length;E+=1)_[E].c();a=Ge();for(let E=0;E<b.length;E+=1)b[E].c();c=mr(),O(n,"class","svelte-1mfb3zm")},m(E,P){fe(E,n,P);for(let k=0;k<_.length;k+=1)_[k].m(n,null);fe(E,a,P);for(let k=0;k<b.length;k+=1)b[k].m(E,P);fe(E,c,P),h=!0},p(E,[P]){if(P&11){p=E[1];let k;for(k=0;k<p.length;k+=1){const L=Qg(E,p,k);_[k]?_[k].p(L,P):(_[k]=$g(L),_[k].c(),_[k].m(n,null))}for(;k<_.length;k+=1)_[k].d(1);_.length=p.length}if(P&7){o=E[1];let k;for(k=0;k<o.length;k+=1){const L=Yg(E,o,k);b[k]?(b[k].p(L,P),Ie(b[k],1)):(b[k]=t_(L),b[k].c(),Ie(b[k],1),b[k].m(c.parentNode,c))}for(Qn(),k=o.length;k<b.length;k+=1)S(k);$n()}},i(E){if(!h){for(let P=0;P<o.length;P+=1)Ie(b[P]);h=!0}},o(E){b=b.filter(Boolean);for(let P=0;P<b.length;P+=1)Re(b[P]);h=!1},d(E){E&&ce(n),Ia(_,E),E&&ce(a),Ia(b,E),E&&ce(c)}}}function JE(t,n,a){let{items:c=[]}=n,{activeTabValue:h=1}=n,{parishname:p}=n;const _=o=>()=>a(0,h=o);return t.$$set=o=>{"items"in o&&a(1,c=o.items),"activeTabValue"in o&&a(0,h=o.activeTabValue),"parishname"in o&&a(2,p=o.parishname)},[h,c,p,_]}class YE extends _i{constructor(n){super(),gi(this,n,JE,KE,di,{items:1,activeTabValue:0,parishname:2})}}const QE=t=>({parishname:t&1}),i_=t=>({parishname:t[0]});function $E(t){let n,a,c,h,p,_,o,b,S,E,P,k,L,j,q,J,ee,ge,_e,Y,le,ie,ke,Je,ve,pe,Fe,$e,ct,We;const mt=t[6].default,xe=kr(mt,t,t[5],i_);return j=new Eg({props:{parishTitle:t[3]}}),ee=new YE({props:{items:t[1],parishname:t[2]}}),ke=new Eg({props:{parishTitle:t[3]}}),Fe=new v_({}),{c(){n=Ae("div"),xe&&xe.c(),a=Ge(),c=Ae("div"),h=Ae("div"),p=Ae("a"),p.textContent="Louisiana Locked Up: A Problem in Every Parish",_=st(`
      / `),o=st(t[2]),b=st(`
      Parish`),S=Ge(),E=Ae("div"),P=Ae("h1"),P.textContent=`${t[2]} Parish`,k=Ge(),L=Ae("section"),nt(j.$$.fragment),q=Ge(),J=Ae("section"),nt(ee.$$.fragment),ge=Ge(),_e=Ae("div"),Y=Ae("h1"),Y.textContent=`${t[2]} Parish`,le=Ge(),ie=Ae("section"),nt(ke.$$.fragment),Je=Ge(),ve=Ae("div"),pe=Ae("section"),nt(Fe.$$.fragment),O(p,"href","#parishes"),O(p,"class","jumpto"),O(h,"id","breadcrumb"),O(h,"class","svelte-4i2o49"),O(c,"id","parish_header"),O(c,"class","svelte-4i2o49"),O(P,"class","parish__title svelte-4i2o49"),O(L,"class","top svelte-4i2o49"),O(J,"class","tabs"),O(J,"data-html2canvas-ignore","true"),O(E,"id","parish__container"),O(E,"class","svelte-4i2o49"),O(Y,"class","parish__title_pdf svelte-4i2o49"),O(ie,"class","top svelte-4i2o49"),O(_e,"id","parish__container__pdf"),O(_e,"class","svelte-4i2o49"),O(pe,"class","about_data"),O(ve,"id","parish_footer"),O(ve,"class","svelte-4i2o49"),O(n,"id","center"),O(n,"class","svelte-4i2o49")},m(Ne,Le){fe(Ne,n,Le),xe&&xe.m(n,null),ue(n,a),ue(n,c),ue(c,h),ue(h,p),ue(h,_),ue(h,o),ue(h,b),ue(n,S),ue(n,E),ue(E,P),ue(E,k),ue(E,L),et(j,L,null),ue(E,q),ue(E,J),et(ee,J,null),ue(n,ge),ue(n,_e),ue(_e,Y),ue(_e,le),ue(_e,ie),et(ke,ie,null),ue(n,Je),ue(n,ve),ue(ve,pe),et(Fe,pe,null),$e=!0,ct||(We=Hi(p,"click",t[4]),ct=!0)},p(Ne,[Le]){xe&&xe.p&&(!$e||Le&33)&&Er(xe,mt,Ne,Ne[5],$e?Sr(mt,Ne[5],Le,QE):Cr(Ne[5]),i_);const ut={};Le&2&&(ut.items=Ne[1]),ee.$set(ut)},i(Ne){$e||(Ie(xe,Ne),Ie(j.$$.fragment,Ne),Ie(ee.$$.fragment,Ne),Ie(ke.$$.fragment,Ne),Ie(Fe.$$.fragment,Ne),$e=!0)},o(Ne){Re(xe,Ne),Re(j.$$.fragment,Ne),Re(ee.$$.fragment,Ne),Re(ke.$$.fragment,Ne),Re(Fe.$$.fragment,Ne),$e=!1},d(Ne){Ne&&ce(n),xe&&xe.d(Ne),tt(j),tt(ee),tt(ke),tt(Fe),ct=!1,We()}}}function eC(t,n,a){let{$$slots:c={},$$scope:h}=n;sl();let{params:p}=n;const _=async()=>{};let o=p.id,b=o,S=[];Fn(async()=>{window.scrollTo(0,0),_(),o=="Catahoula"||o=="Iberia"||o=="Grant"?a(1,S=[{label:"Jail and Prisons",value:1,component:Ug},{label:"Pretrial",value:3,component:Wg},{label:"Budget",value:4,component:Xg}]):a(1,S=[{label:"Jail and Prisons",value:1,component:Ug},{label:"Arrests",value:2,component:XE},{label:"Pretrial",value:3,component:Wg},{label:"Budget",value:4,component:Xg}])});function E(){Kr("/louisiana-locked-up/"),window.scrollTo({bottom:0,behavior:"smooth"})}return t.$$set=P=>{"params"in P&&a(0,p=P.params),"$$scope"in P&&a(5,h=P.$$scope)},[p,S,o,b,E,h,c]}class tC extends _i{constructor(n){super(),gi(this,n,eC,$E,di,{params:0})}}function iC(t){let n;return{c(){n=Ae("div"),n.innerHTML=`<div id="breadcrumb"><a href="/louisiana-locked-up/">Louisiana Locked Up: A Problem in Every Parish</a> / About the Data</div> 
  <h1 class="svelte-ep3o1">About the Data</h1> 
  <p>Vera collected data for Louisiana’s prisons, jails, and juvenile justice
    facilities using information published on state and local government
    websites and the U.S. Bureau of Justice Statistics 2019 Census of Jails.
    Vera collected pretrial population data from reports prepared by the
    Louisiana Department of Public Safety &amp; Corrections (DPS&amp;C). Vera collected
    prison admission data from the DPS&amp;C Briefing Book. Vera collected arrest
    data from the FBI Uniform Crime Report accessed via Vera’s Arrest Trends
    tool. Vera collected budget data from the U.S. Census Annual Survey of
    Public Employment &amp; Payroll</p> 
  <section><h2 class="svelte-ep3o1">Jails</h2> 
    <p>Vera compiled data for Louisiana’s jails using information obtained from
      the U.S. Bureau of Justice Statistics <a href="https://www.icpsr.umich.edu/web/NACJD/studies/38323/versions/V1" target="_blank">Census of Jails (2019)</a>
      and the DPS&amp;C
      <a href="https://doc.louisiana.gov/about-the-dpsc/facility-locations/" target="_blank">facilities directory</a>, which includes directly operated state prisons as well as the many
      “local facilities” (jails) the department uses to hold people that have
      received a state prison sentence. Vera used information from
      <a href="https://www.incarcerationtransparency.org/" target="_blank">Incarceration Transparency</a>
      to identify facilities that were not included in the aforementioned sources.
      Memos on the Incarceration Transparency website (e.g.,
      <a href="https://www.incarcerationtransparency.org/wp-content/uploads/2022/01/Claiborne-Parish-Detention-Center-Memo.pdf" target="_blank">Claiborne Parish</a>) were helpful to discern the number of facilities in a parish and
      details about their capacity and operators.</p> 

    <p>Discrepancies between these lists required follow-up research (e.g.,
      review of government agency websites, news articles, and phone calls to
      jails) to determine a facility’s current operator, capacity, address, and
      whether it operates a Transitional Work Program (TWP). For example, some
      municipal jails were not reported in the Census of Jails but were included
      in research on the Incarceration Transparency website (e.g., Westlake City
      Jail). Consequently, Vera contacted every city police department included
      in a <a href="http://www.lsp.org/links_city.html" target="_blank">directory</a> published by the Louisiana State Police to discern whether they operated
      a jail and, if so, the capacity and location of the facility.</p> 

    <p>Vera counted each facility as distinct if it had its own address. Vera
      gathered information on the capacity for correctional facilities from the
      <a href="https://lclelsac.com/wp-content/uploads/2022/04/2021-SSLCFPR-Report.pdf" target="_blank">2021 Status of State and Local Corrections Facilities and Program
        Report (SSLCFPR)</a>, which was prepared by the Louisiana Commission on Law Enforcement and
      Administration of Criminal Justice. Vera researchers used facility
      directories on the
      <a href="https://lasallecorrections.com/locations/" target="_blank">La Salle Corrections</a>
      and
      <a href="https://www.geogroup.com/Locations" target="_blank">GEO Group</a>
      websites to identify the facilities operated by these companies.</p> 

    <p>Discerning which facilities currently operate a TWP required extensive
      research because of errors in the DPS&amp;C facility directory and
      inconsistencies between the department’s most recent reports (the <a href="https://s32082.pcdn.co/wp-content/uploads/2022/06/Catalog-of-Rehabiltation-Program-2021.pdf" target="_blank">2021 Catalog of Rehabilitative Programs</a>
      and the
      <a href="https://lclelsac.com/wp-content/uploads/2022/04/2021-SSLCFPR-Report.pdf" target="_blank">2021 Status of State and Local Corrections Facilities and Program
        Report</a>). In instances of conflicting information, Vera researchers called
      parish sheriffs to confirm whether they operate a TWP program.</p> 

    <p>Vera estimated the revenue DPS&amp;C paid to local facilities in 2021 by
      multiplying the number of people held for DPS&amp;C in November 20201, per the
      DPS&amp;C <a href="https://jlcb.legis.la.gov/Docs/2021/dec/December%202021%20RTC%20Act%20119%20of%202021%20Corrections.pdf" target="_blank">Report of the Offender Census at Local Correctional Facilities</a>, by the daily rate of $26.39 ($9,632 annually). Vera estimated revenue
      DPS&amp;C paid to local facilities for people in the TWP by multiplying this
      population in November 2021 by the daily rate of $11.25 ($4,160 annually).
      According to the December 10, 2021 DPS&amp;C report to the Joint Legislative
      Committee on the Budget, $12.25 is paid to contracted TWP providers who
      fill the available beds first with TWP participants. The other providers
      are paid a per diem of $16.39 because they do not have a contract with
      Corrections that guarantees the department will place TWP offenders with
      their program first. Vera used the lesser of these two rates because the
      researchers did not know the nature of each contract.</p> 

    <p>Vera obtained information on the U.S. Immigration and Customs Enforcement
      (ICE) population held in jails from archived copies of the agency’s
      <a href="https://www.ice.gov/detain/detention-management" target="_blank">Detention Statistics</a>
      because the DPS&amp;C
      <a href="https://jlcb.legis.la.gov/Docs/2021/dec/December%202021%20RTC%20Act%20119%20of%202021%20Corrections.pdf" target="_blank">report of the Offender Census at Local Correctional Facilities</a> does not include ICE statistics for the facilities that are operated by GEO
      Group under contracts with ICE. Vera computed the ICE Average Daily Population
      for the period December 4, 2021 – December 18, 2021 to estimate the ICE population
      at approximately the same time as the rest of the jail population for the parish.</p></section> 
  <section><h2 class="svelte-ep3o1">Pretrial population</h2> 
    <p>Vera collected 2021 parish-level pretrial jail population data from the
      DPS&amp;C <a href="https://jlcb.legis.la.gov/Docs/2021/dec/December%202021%20RTC%20Act%20119%20of%202021%20Corrections.pdf" target="_blank">report of the Offender Census at Local Correctional Facilities</a>. DPS&amp;C supplied these reports in memorandum to the
      <a href="https://jlcb.legis.la.gov/default_Archives2021" target="_blank">Joint Legislative Committee on the Budget (JLCB)</a> because DPS&amp;C pays local jails to hold more than half the state’s prison
      population. The report includes the operational capacity of each “local facility”
      (jail) and provides the number of people the jail holds for DPS&amp;C, the DPS&amp;C
      Transitional Work Program, U.S. Immigration and Customs Enforcement (ICE),
      “Federal Offenders” (the U.S. Marshals and Bureau of Prisons), as well as the
      number of people held “pretrial” and in “Parish” custody (meaning a jail sentence).</p> 

    <p>Pretrial data for 58 of the 64 parishes is as of November 26, 2021, which
      Vera obtained from a December 10, 2021, <a href="https://jlcb.legis.la.gov/Docs/2021/dec/December%202021%20RTC%20Act%20119%20of%202021%20Corrections.pdf" target="_blank">memo</a> to the JLCB. Vera collected data from earlier reports in 2021 for six parishes
      that did not supply pretrial data in the November report: Allen Parish (April
      2021), Cameron Parish (July 2021), Jackson Parish (May 2021), Richland Parish
      (July 2021), St. Mary Parish (July 2021), and Terrebonne Parish (July 2021).
      Although Richland and St. Mary reported November 2021 data, the pretrial populations
      in this report (four and three, respectively) were conspicuously low compared
      to values in July (21 and 127, respectively), so Vera instead used pretrial
      data from July 2021.</p> 

    <p>Nine parishes (Acadia, Beauregard, Caldwell, De Soto, Morehouse,
      Plaquemines, Pointe Coupee, Sabine, and St. Landry) indicated that their
      pretrial population was “0” in the data they supplied to DPS&amp;C in all
      their 2021 reports. This is not plausible given the number of people these
      same parishes sentenced to prison annually, and this information also
      conflicts with the pretrial population data these parishes reported in the
      last <a href="https://www.icpsr.umich.edu/web/NACJD/studies/38323/versions/V1" target="_blank">Census of Jails (2019)</a>
      conducted by the U.S. Bureau of Justice Statistics (BJS). These same parishes,
      however, reported to DPS&amp;C a sizable number of people held for the “parish”
      (i.e., jail sentences) that is consistent with the pretrial population they
      supplied to BJS in 2019. As some jail management data systems do not record
      an individual person’s sentence status, Vera assumed that these jails indicated
      all people as “parish” because it would be time consuming to make the distinction
      between Pretrial and Parish (locally sentenced) in their monthly reports to
      DPS&amp;C. For these counties, Vera assumed that 90 percent of the people denoted
      as being in parish custody were actually being held pretrial. Vera made this
      assumption because 90 percent of people, statewide, held by a local authority
      are in pretrial status according to the
      <a href="https://jlcb.legis.la.gov/Docs/2021/dec/December%202021%20RTC%20Act%20119%20of%202021%20Corrections.pdf" target="_blank">report of the Offender Census at Local Correctional Facilities</a>.</p> 

    <p>Vera accessed parish-level jail population data for the years prior to
      2020 from the BJS Census of Jails, via Vera’s Incarceration Trends
      dataset. The Census of Jails, unlike the 2021 DPS&amp;C report of the Offender
      Census at Local Correctional Facilities, does not differentiate people
      held for ICE and the United States Marshall Service (USMS) from the
      pretrial population, which jails generally include in their counts of the
      “unconvicted” (i.e., pretrial) population to BJS. Consequently,
      differences between the 2021 pretrial population and prior years may be
      partly on account of this definitional difference in the parishes that
      hold people for ICE and USMS. Note also that the pretrial population data
      is a single-day count, which was November 26, 2021, in the DPS&amp;C data and
      the last weekday in June in the Census of Jails data. Jail populations
      fluctuate daily and year-over-year differences could be an artifact of
      measuring the population on a single day.</p></section> 
  <section><h2 class="svelte-ep3o1">Prisons</h2> 
    <p>Vera sourced data on the location of state prisons from the DPS&amp;C <a href="https://doc.louisiana.gov/about-the-dpsc/facility-locations/" target="_blank">online facility directory</a>
      and the Louisiana Commission on Law Enforcement
      <a href="https://lclelsac.com/wp-content/uploads/2022/04/2021-SSLCFPR-Report.pdf" target="_blank">2021 Status of State and Local Corrections Facilities and Program
        Report</a>. Vera sourced information on state prison capacity from the BJS
      <a href="https://www.icpsr.umich.edu/web/NACJD/studies/38325/versions/V2" target="_blank">Census of State and Federal Adult Correctional Facilities (2019)</a>. Vera sourced data on facilities operated by the U.S. Bureau of Prisons
      from the bureau’s
      <a href="https://www.bop.gov/locations/list.jsp" target="_blank">website</a>.</p></section> 
  <section><h2 class="svelte-ep3o1">Prison admissions</h2> 
    <p>Vera collected parish-level prison admission data for <a href="https://s32082.pcdn.co/wp-content/uploads/2021/06/Jan-21-Full-bb.pdf" target="_blank">2019</a>,
      <a href="https://s32082.pcdn.co/wp-content/uploads/2021/10/0m-Full-Briefing-Book.pdf" target="_blank">2020</a>, and
      <a href="https://s32082.pcdn.co/wp-content/uploads/2022/09/0m-Full-Briefing-Book-July-2022-Website.pdf" target="_blank">2021</a>
      from the DPS&amp;C Briefing Book. Vera collected parish-level prison admission
      data for 1992 through 2014 from the BJS National Corrections Reporting Program
      (NCRP), accessed via Vera’s
      <a href="https://github.com/vera-institute/incarceration-trends" target="_blank">Incarceration Trends Dataset</a>.</p></section> 
  <section><h2 class="svelte-ep3o1">Juvenile justice facilities</h2> 
    <p>Vera researchers compiled information for juvenile detention centers
      (i.e., “youth jails”) using data from city and parish websites. There are
      five <a href="https://ojj.la.gov/about-ojj/administrative-functions/ojj-secure-care-facilities/" target="_blank">secure care</a>
      residential facilities (i.e., “youth prisons”) for males in the custody of
      the Louisiana Office of Juvenile Justice (OJJ). Females in OJJ custody are
      housed at Ware Youth Center, which operates under a contract with OJJ. There
      are 18 non-secure residential facilities for youth who have been adjudicated.
      These residential facilities comprise group homes, transitional living programs,
      emergency shelters, and family homes. Vera compiled information for these facilities
      through various OJJ reports, including
      <a href="https://ojj.la.gov/policies-systems/federal-laws/prea/ojj-prea-resourcesreports/" target="_blank">Prison Rape Elimination Act (PREA) Annual Reports</a>, Contract Facility Audit Reports,
      <a href="https://ojj.la.gov/wp-content/uploads/2018/10/MonitoringEffectivenessofCommunityBased-ServicesFY2017.pdf" target="_blank">Monitoring Effectiveness of Community-Based Services</a>, and
      <a href="https://ojj.la.gov/wp-content/uploads/2018/01/Act499TrendReportFY2017_-finalforwebsite-1.pdf" target="_blank">Annual Report of Youth Served</a>.</p> 

    <p>Vera compiled juvenile facility capacity information from PREA reports and
      through email and phone calls to facilities. Vera verified all facility
      information through a <a href="https://webapps.dcfs.la.gov/carefacility/facility/list?parish=&amp;d-3991717-p=1" target="_blank">list of licensed facilities</a> from the Louisiana Department of Children and Family Services, which holds
      licensing authority over Louisiana juvenile facilities.</p></section> 
  <section><h2 class="svelte-ep3o1">Arrests</h2> 
    <p>Arrest data comes from the FBI Uniform Crime Report (2018) accessed via
      Vera’s <a href="https://arresttrends.vera.org/" target="_blank">Arrest Trends</a>. Vera researchers calculated arrest rates using population data from the
      U.S. Census Bureau’s
      <a href="https://data.census.gov/table?g=040XX00US22$1600000&amp;y=2020&amp;d=DEC+Redistricting+Data+(PL+94-171)" target="_blank">2020 Decennial Census</a>, which provides city-level demographic data, and the Census Bureau’s
      <a href="https://www.census.gov/data/tables/time-series/demo/popest/2010s-counties-detail.html" target="_blank">County Characteristics Resident Population Estimates</a> (July 1, 2019), which provides parish-level demographic data.</p></section> 
  <section><h2 class="svelte-ep3o1">Spending</h2> 
    <p>Vera collected data on parish- and municipal-government spending from the
      U.S. Census Bureau’s <a href="https://www.census.gov/programs-surveys/apes.html" target="_blank">Annual Survey of Public Employment &amp; Payroll</a>. Vera collected 2021 data when it was available and 2017 data when 2021
      data was not available. (Vera adjusted the data to 2021 dollars using
      Consumer Price Index for all Urban Consumers data from the
      <a href="https://www.bls.gov/regions/new-england/data/consumerpriceindex_us_table.htm" target="_blank">Bureau of Labor Statistics</a> of the United States Department of Labor.) Payroll amounts represent gross
      payroll for the one-month period of March in the survey year. Gross payroll
      includes all salaries, wages, fees, commissions, bonuses, or awards. Vera researchers
      multiplied total payroll amounts by 12 to determine payroll for a one-year
      period. Payroll expenses comprise the majority, but not all, of government
      expenses and excludes costs such as supplies, materials, and contracted services.
      However, the payroll provides a representation of the allocation of budget
      resources across government functions (e.g., human services, parks, police,
      corrections, etc.).</p></section> 
  <section><h2 class="svelte-ep3o1">Demographic Data</h2> 
    <p>Demographic data to compute parish per-capita incarceration rates comes
      from Vera’s <a href="https://github.com/vera-institute/incarceration-trends" target="_blank">Incarceration Trends Project (ITP)</a>. The demographic data used in ITP comes from the National Cancer
      Institute’s (NCI)
      <a href="https://seer.cancer.gov/popdata/download.html" target="_blank">U.S. County Population Data, 1969-2020</a>. The source of NCI’s data is the Centers for Disease Control and
      Prevention’s (CDC)
      <a href="https://wonder.cdc.gov/bridged-race-population.html" target="_blank">Bridged-Race Population Estimates, 1990-2020</a>. Vera used population data for 2020 to compute incarceration rates for
      the period since 2020.</p> 

    <p>Vera calculated incarceration rates using parish population data from the
      U.S. census, and these rates are expressed per 10,000 parish residents.
      Although incarceration rates are conventionally expressed per 100,000,
      Vera computed parish rates per 10,000 to make these statistics more
      legible in the 50 parishes that have fewer than 100,000 residents.</p></section> 
  <section><h2 class="svelte-ep3o1">Geographic Data</h2> 
    <p>Vera collected data for the footprints of Louisiana’s historical
      plantations from an <a href="https://www.loc.gov/item/2006629768/" target="_blank">1853 map</a>
      of Louisiana by John La Tourrette. Vera researchers downloaded the digital
      image as a TIFF file and adjusted the image levels, contrast, and tone to aid
      in the clear identification of plots of land. The researchers then pulled the
      image into QGIS’s Georeferencer and identified 29 ground control points (GCPs).
      The researchers took the control points from a geojson file of Louisiana’s
      state outline. Vera then applied a transformation model—using the Polynomial
      2 transformation type and the Nearest Neighbor resampling method—to the points
      in order to warp the image to fit the
      <a href="https://epsg.io/4269" target="_blank">EPSG:4269</a> coordinate reference
      system (CRS). The researchers then created a new vector layer with the geometry
      type set to polygon, with the specified CRS set to EPSG:4269, and created polygons
      for each plantation on the La Tourrette map. The researchers added a unique
      identifier as an attribute to each polygon and included the landowner as another
      attribute when noted (and legible). Researchers double checked the plots against
      the georeferenced map and validated all geometries.</p> 

    <p>Vera derived the Orleans Parish buildings from a shapefile of <a href="https://archive.nyu.edu/handle/2451/43840" target="_blank">New Orleans building footprints</a>
      held by Bobst Library, New York University. Vera referenced the buildings in
      this file against a
      <a href="https://www.opso.us/ppt/presentation20101018.pdf" target="_blank">presentation of the Orleans Parish Sheriff’s Office</a>
      showing facility use in 2005, 2010, and 2012, and an
      <a href="https://www.laaclu.org/sites/default/files/field_documents/2006_Report_OPP_Katrina_Insert_0.pdf" target="_blank">ACLU map of post-Katrina facility damage</a>. Many of the buildings no longer in use by the parish (e.g. Community
      Corrections Center, Orleans Parish Prison) are still standing, and were
      therefore still in the building footprint shapefile.</p> 

    <p>State, parish, and census tract geographies come from <a href="https://www.census.gov/geographies/mapping-files/time-series/geo/carto-boundary-file.html" target="_blank">census.gov</a>. The detailed outline of Orleans Parish comes from the Stanford
      <a href="https://purl.stanford.edu/sm333bn0683" target="_blank">National Transportation Atlas Database</a>.</p></section>`,O(n,"id","wrap"),O(n,"class","svelte-ep3o1")},m(a,c){fe(a,n,c)},p:Ft,i:Ft,o:Ft,d(a){a&&ce(n)}}}function nC(t){return Fn(async()=>{window.scrollTo(0,0)}),[]}class rC extends _i{constructor(n){super(),gi(this,n,nC,iC,di,{})}}function aC(t){let n;return{c(){n=Ae("header"),n.innerHTML=`<div class="rowTop svelte-9nsqyw"><div class="rowTop-container svelte-9nsqyw"><nav id="primary" class="svelte-9nsqyw"><ul class="svelte-9nsqyw"><li class="svelte-9nsqyw"><a href="https://www.vera.org/who-we-are" class="svelte-9nsqyw"><div class="textWrap svelte-9nsqyw">Who We Are
                <div class="textWrap-icon svelte-9nsqyw"></div></div></a> 
            <ul class="svelte-9nsqyw"><li class="svelte-9nsqyw"><a href="https://www.vera.org/who-we-are" class="svelte-9nsqyw"><span class="liText svelte-9nsqyw">Who We Are</span></a></li> 
              <li class="svelte-9nsqyw"><a href="https://www.vera.org/who-we-are/about-us" class="svelte-9nsqyw"><span class="liText svelte-9nsqyw">About Us</span></a></li> 
              <li class="svelte-9nsqyw"><a href="https://www.vera.org/who-we-are/message-from-the-president" class="svelte-9nsqyw"><span class="liText svelte-9nsqyw">Message from the President</span></a></li> 
              <li class="svelte-9nsqyw"><a href="https://www.vera.org/who-we-are/people" class="svelte-9nsqyw"><span class="liText svelte-9nsqyw">People</span></a></li> 
              <li class="svelte-9nsqyw"><a href="https://www.vera.org/who-we-are/locations" class="svelte-9nsqyw"><span class="liText svelte-9nsqyw">Locations</span></a></li> 
              <li class="svelte-9nsqyw"><a href="https://www.vera.org/careers" class="svelte-9nsqyw"><span class="liText svelte-9nsqyw">Careers</span></a></li> 
              <li class="svelte-9nsqyw"><a href="https://www.vera.org/who-we-are/financials" class="svelte-9nsqyw"><span class="liText svelte-9nsqyw">Financials</span></a></li> 
              <li class="svelte-9nsqyw"><a href="https://www.vera.org/contact" class="svelte-9nsqyw"><span class="liText svelte-9nsqyw">Contact Us</span></a></li></ul></li> 
          <li class="svelte-9nsqyw"><a href="https://www.vera.org/what-we-do" class="svelte-9nsqyw"><div class="textWrap svelte-9nsqyw">What We Do
                <div class="textWrap-icon svelte-9nsqyw"></div></div></a> 
            <ul class="svelte-9nsqyw"><li class="svelte-9nsqyw"><a href="https://www.vera.org/what-we-do" class="svelte-9nsqyw"><span class="liText svelte-9nsqyw">What We Do</span></a></li> 
              <li class="svelte-9nsqyw"><a href="https://www.vera.org/our-strategic-priorities" class="svelte-9nsqyw"><span class="liText svelte-9nsqyw">Strategic Priorities</span></a></li></ul></li> 
          <li class="svelte-9nsqyw"><a href="https://www.vera.org/get-involved" class="svelte-9nsqyw"><div class="textWrap svelte-9nsqyw">Get Involved
                <div class="textWrap-icon svelte-9nsqyw"></div></div></a> 
            <ul class="svelte-9nsqyw"><li class="svelte-9nsqyw"><a href="https://www.vera.org/get-involved" class="svelte-9nsqyw"><span class="liText svelte-9nsqyw">Get Involved</span></a></li> 
              <li class="svelte-9nsqyw"><a href="https://shop.vera.org/" class="svelte-9nsqyw"><span class="liText svelte-9nsqyw">The Vera Shop</span></a></li> 
              <li class="svelte-9nsqyw"><a href="https://www.vera.org/get-involved/ways-to-give" class="svelte-9nsqyw"><span class="liText svelte-9nsqyw">Ways to Give</span></a></li> 
              <li class="svelte-9nsqyw"><a href="https://www.vera.org/get-involved/partner-with-vera" class="svelte-9nsqyw"><span class="liText svelte-9nsqyw">Partner with Vera</span></a></li> 
              <li class="svelte-9nsqyw"><a href="https://www.vera.org/events" class="svelte-9nsqyw"><span class="liText svelte-9nsqyw">Events</span></a></li></ul></li></ul></nav> 
      <section class="top-nav-mobile svelte-9nsqyw"><input id="menu-toggle" type="checkbox" class="svelte-9nsqyw"/> 
        <label class="menu-button-container svelte-9nsqyw" for="menu-toggle"><div class="menu-button svelte-9nsqyw"></div></label> 
        <span class="menulabel svelte-9nsqyw">Menu</span> 
        <ul class="menu svelte-9nsqyw"><a href="https://www.vera.org/ending-mass-incarceration" class="svelte-9nsqyw"><li class="svelte-9nsqyw">Ending Mass Incarceration</li></a> 

          <a href="https://www.vera.org/investing-in-communities" class="svelte-9nsqyw"><li class="svelte-9nsqyw">Investing in Communities</li></a> 

          <a href="https://www.vera.org/solutions-research" class="svelte-9nsqyw"><li class="svelte-9nsqyw">Solutions &amp; Research</li></a> 
          <a href="https://www.vera.org/news-and-stories" class="svelte-9nsqyw"><li class="svelte-9nsqyw">News &amp; Stories</li></a></ul></section> 
      <nav class="whowhat svelte-9nsqyw"><div class="menu-center svelte-9nsqyw"><h1 class="svelte-9nsqyw"><a class="logo svelte-9nsqyw" href="https://www.vera.org">Vera Institute of Justice</a></h1></div> 
        <div class="d-md-block menu-right donate svelte-9nsqyw"><a href="https://secure.vera.org/a/donate" class="button arrow svelte-9nsqyw">Donate</a></div></nav></div></div> 
  <nav id="secondary" class="svelte-9nsqyw"><ul class="svelte-9nsqyw"><li class="svelte-9nsqyw"><a href="https://www.vera.org/ending-mass-incarceration" class="svelte-9nsqyw">Ending Mass Incarceration</a> 
        <ul class="svelte-9nsqyw"><li class="svelte-9nsqyw"><a href="https://www.vera.org/ending-mass-incarceration" class="svelte-9nsqyw"><div class="hover-arrow svelte-9nsqyw">Ending Mass Incarceration</div> 
              <span class="svelte-9nsqyw">About the problem, the history of mass incarceration, trends
                and statistics</span></a></li> 
          <li class="svelte-9nsqyw"><a href="https://www.vera.org/ending-mass-incarceration/criminalization-racial-disparities" class="svelte-9nsqyw"><div class="hover-arrow svelte-9nsqyw">Criminalization and Racial Disparities</div> 
              <span class="svelte-9nsqyw">Ending the criminalization of people of color, immigrants, and
                people experiencing poverty</span></a></li> 

          <li class="svelte-9nsqyw"><a href="https://www.vera.org/ending-mass-incarceration/reducing-incarceration" class="svelte-9nsqyw"><div class="hover-arrow svelte-9nsqyw">Reducing Incarceration</div> 
              <span class="svelte-9nsqyw">Drastically reducing the use of jails, prisons, and detention
                centers</span></a></li> 

          <li class="svelte-9nsqyw"><a href="https://www.vera.org/ending-mass-incarceration/dignity-behind-bars" class="svelte-9nsqyw"><div class="hover-arrow svelte-9nsqyw">Dignity Behind Bars</div> 
              <span class="svelte-9nsqyw">Centering dignity and minimizing the harms of criminal legal
                and immigration system involvement</span></a></li></ul></li> 
      <li class="svelte-9nsqyw"><a href="https://www.vera.org/investing-in-communities" class="svelte-9nsqyw">Investing in Communities</a></li> 
      <li class="svelte-9nsqyw"><a href="https://www.vera.org/solutions-research" class="svelte-9nsqyw">Solutions &amp; Research</a></li> 
      <li class="svelte-9nsqyw"><a href="https://www.vera.org/get-involved" class="svelte-9nsqyw">News</a> 
        <ul class="svelte-9nsqyw"><li class="svelte-9nsqyw"><a href="https://www.vera.org/news-and-stories" class="svelte-9nsqyw"><div class="hover-arrow svelte-9nsqyw">Latest News &amp; Stories</div> 
              <span class="svelte-9nsqyw">Ideas, opinions, and strategies to end mass incarceration</span></a></li> 
          <li class="svelte-9nsqyw"><a href="https://www.vera.org/media-center" class="svelte-9nsqyw"><div class="hover-arrow svelte-9nsqyw">Media Center</div> 
              <span class="svelte-9nsqyw">Press releases and media coverage</span></a></li></ul></li></ul></nav>`,O(n,"class","header-v2 svelte-9nsqyw")},m(a,c){fe(a,n,c)},p:Ft,i:Ft,o:Ft,d(a){a&&ce(n)}}}class sC extends _i{constructor(n){super(),gi(this,n,null,aC,di,{})}}function oC(t){let n;return{c(){n=Ae("footer"),n.innerHTML=`<div id="vera" class="svelte-1x97hmj"><div id="mobilewrap" class="svelte-1x97hmj"><div class="section svelte-1x97hmj"><div id="logo" class="svelte-1x97hmj"><a href="https://www.vera.org"><img id="logo" src="https://www.vera.org/dist/img/v2/vera-horizontal.svg" class="svelte-1x97hmj"/></a></div> 
        <p class="address svelte-1x97hmj">34 35th Street<br/>
          Suite 4-2A<br/>
          Brooklyn, NY 11232</p> 
        <p class="phone svelte-1x97hmj">212-334-1300</p></div> 
      <div class="section footer-menu svelte-1x97hmj"><ul class="svelte-1x97hmj"><li class="svelte-1x97hmj"><a href="https://www.vera.org/who-we-are/about-us" class="svelte-1x97hmj">About Us</a></li> 
          <li class="svelte-1x97hmj"><a href="https://www.vera.org/careers" class="svelte-1x97hmj">Careers</a></li> 
          <li class="svelte-1x97hmj"><a href="https://www.vera.org/events" class="svelte-1x97hmj">Events</a></li> 
          <li class="svelte-1x97hmj"><a href="https://www.vera.org/media-center" class="svelte-1x97hmj">Media</a></li> 
          <li class="svelte-1x97hmj"><a href="https://www.vera.org/contact" class="svelte-1x97hmj">Contact Us</a></li></ul></div> 
      <div class="section soc svelte-1x97hmj"><p class="keep svelte-1x97hmj">Keep up with us on social media.</p> 
        <div class="social-icons svelte-1x97hmj"><a href="https://www.twitter.com/intent/tweet?url=https%3A%2F%2Fwww.vera.org%2F&amp;amp;text=Home %20%40verainstitute" class="share-link social-share-link receives-color svelte-1x97hmj" target="_blank"><svg class="svg-inline--fa svelte-1x97hmj" aria-hidden="true" prefix="fab" data-icon="twitter" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a> 
          <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.vera.org%2F&amp;caption=Home%20&amp;picture=https://www.vera.org/dist/img/social-fallback.jpg&amp;description=" class="share-link social-share-link receives-color svelte-1x97hmj" target="_blank"><svg class="svg-inline--fa svelte-1x97hmj" aria-hidden="true" prefix="fab" data-icon="facebook" role="img" viewBox="0 0 320 512"><path fill="currentColor" d="M279.14 288l14.22-92.66h-88.91v-60.13c0-25.35 12.42-50.06 52.24-50.06h40.42V6.26S260.43 0 225.36 0c-73.22 0-121.08 44.38-121.08 124.72v70.62H22.89V288h81.39v224h100.17V288z"></path></svg></a> 
          <a href="https://www.instagram.com/verainstitute/" target="_blank" class="svelte-1x97hmj"><svg class="svg-inline--fa svelte-1x97hmj" aria-hidden="true" prefix="fab" data-icon="instagram" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"></path></svg></a> 
          <a href="https://www.youtube.com/channel/UCdUfqPJeOB_bHFdx1IhR0jQ" target="_blank" class="svelte-1x97hmj"><svg class="svg-inline--fa svelte-1x97hmj" aria-hidden="true" prefix="fab" data-icon="youtube" role="img" viewBox="0 0 576 512"><path fill="currentColor" d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg></a></div></div></div> 

    <div class="section svelte-1x97hmj"><div id="transformative" class="svelte-1x97hmj"><p>Transformative change, sent to your inbox.</p> 
        <button class="button orange arrow svelte-1x97hmj">Add your email</button></div></div></div> 
  <div id="terms" class="svelte-1x97hmj"><ul class="svelte-1x97hmj"><li class="svelte-1x97hmj">© Vera Institute of Justice. All rights reserved.</li> 
      <li class="svelte-1x97hmj"><a href="https://www.vera.org/terms-of-use" class="svelte-1x97hmj">Terms of Use</a></li> 
      <li class="svelte-1x97hmj"><a href="https://www.vera.org/gsa-advantage" class="svelte-1x97hmj">GSA Advantage</a></li></ul></div>`,O(n,"class","svelte-1x97hmj")},m(a,c){fe(a,n,c)},p:Ft,i:Ft,o:Ft,d(a){a&&ce(n)}}}class lC extends _i{constructor(n){super(),gi(this,n,null,oC,di,{})}}function cC(t){let n,a,c,h,p,_,o;n=new sC({});var b=t[0];function S(E){return{props:{params:E[1]}}}return b&&(h=Ou(b,S(t))),_=new lC({}),{c(){nt(n.$$.fragment),a=Ge(),c=Ae("div"),h&&nt(h.$$.fragment),p=Ge(),nt(_.$$.fragment),O(c,"id","center"),O(c,"class","svelte-17lcfot")},m(E,P){et(n,E,P),fe(E,a,P),fe(E,c,P),h&&et(h,c,null),fe(E,p,P),et(_,E,P),o=!0},p(E,[P]){const k={};if(P&2&&(k.params=E[1]),b!==(b=E[0])){if(h){Qn();const L=h;Re(L.$$.fragment,1,0,()=>{tt(L,1)}),$n()}b?(h=Ou(b,S(E)),nt(h.$$.fragment),Ie(h.$$.fragment,1),et(h,c,null)):h=null}else b&&h.$set(k)},i(E){o||(Ie(n.$$.fragment,E),h&&Ie(h.$$.fragment,E),Ie(_.$$.fragment,E),o=!0)},o(E){Re(n.$$.fragment,E),h&&Re(h.$$.fragment,E),Re(_.$$.fragment,E),o=!1},d(E){tt(n,E),E&&ce(a),E&&ce(c),h&&tt(h),E&&ce(p),tt(_,E)}}}function uC(t,n,a){let c,h;return Kr("/louisiana-locked-up/",()=>a(0,c=Jm)),Kr("/louisiana-locked-up/#parishes",()=>a(0,c=Jm)),Kr("/louisiana-locked-up/parish/:id",(p,_)=>{a(1,h=p.params),_()},()=>a(0,c=tC)),Kr("/louisiana-locked-up/about-data",()=>a(0,c=rC)),Kr.start(),[c,h]}class hC extends _i{constructor(n){super(),gi(this,n,uC,cC,di,{})}}new hC({target:document.getElementById("app")});
