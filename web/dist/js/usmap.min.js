/**
 * @project        vera
 * @author         Dylan Viola, Hyperakt
 * @build          Mon, Feb 14, 2022 8:25 PM ET
 * @copyright      Copyright (c) 2022, 
 *
 */
"use strict";function UsMap(t){var e=t.selector;return new Promise(function(a,t){var r=d3.select(e);d3.json("/dist/map/us.json",function(t,e){if(t)throw t;t=d3.geoAlbersUsa().translate([480,300]).scale([1250]),t=d3.geoPath().projection(t);r.attr("viewBox","0 0 960 600"),r.attr("style","display: block;");r.append("g").attr("class","states").selectAll("path").data(topojson.feature(e,e.objects.states).features).enter().append("path").attr("vector-effect","non-scaling-stroke").attr("class","state").attr("fill","white").attr("d",t).attr("stroke","#000").attr("stroke-width",1).attr("data-fips",function(t){return t.id}).attr("data-code",function(t){return t.properties.code});a(r)})})}function UsMapIncarcerationRegions(t){var o=t.map,a=t.csvUrl,i=t.highlight,s=t.cmsData,c="#fff",e="#EF4136",r="#f0bab5";return new Promise(function(t,e){d3.csv(a,function(t){var e=t.states_in_division.replace(/\'|\[|\]|\s/g,"").split(",").map(function(t){return t.trim()});return t.regions=e,t},function(t,a){var e=o.selectAll(".state");e.datum(function(e){var t=a.find(function(t){return t.state===e.properties.code});return t?(t.fill=c,t.regions=t.regions.map(function(e){var t=a.find(function(t){return t.state===e});return{key:e,value:+t.total_state_incarceration_2015}}),e.data=t):console.log("mising "+e.properties.code),e}),e.attr("fill",d);var r=d3.select("body").append("div").attr("style","display: none");e.attr("data-tooltip-content",function(t){return"#TT"+o.attr("id")+t.properties.code}).each(function(t){var e,a;t.data&&((e=r.append("div").attr("class","tooltip-template tooltip--incarceration-regions").attr("id","TT"+o.attr("id")+t.properties.code)).append("div").text(t.properties.name).attr("class","title"),(a=e.append("div").attr("class","data").append("div")).append("div").attr("class","label").text("Total incarceration 2015"),a.append("div").attr("class","value").text(format(t.data.total_state_incarceration_2015)),(a=e.append("div")).append("div").attr("class","label").text("Regional Ranking"),a.append("div").attr("class","value").text(t.data.regional_rank),(t=s[t.properties.code]?s[t.properties.code].pdfUrl:null)&&e.append("div").append("a").attr("href",t).attr("target","_blank").attr("rel","noopener noreferer").text("Get Fact Sheet"))}),$(e.nodes()).tooltipster({theme:["tooltipster-noir","tooltipster-noir-customized"],interactive:!0}),i&&l(o.select('[data-code="'+i+'"]'));var n=void 0;i||(n=setInterval(function(){var t=a[Math.floor(Math.random()*a.length)].state;e.attr("fill",c),l(o.select('[data-code="'+t+'"]'))},1e3),o.on("mouseover",function(){"path"!==d3.event.target.nodeName&&e.attr("fill",c),clearInterval(n)})),e.on("mouseover",function(){e.attr("fill",c),l(d3.select(this))}).on("mouseout",function(t){d3.select(this).attr("fill",d).call(function(t){t=t.datum().data.regions;t&&t.forEach(function(t){o.select('[data-code="'+t.key+'"]').attr("fill",d)})}),i&&l(o.select('[data-code="'+i+'"]'))}).on("click",function(t){s&&s[t.properties.code]&&(window.location.href=s[t.properties.code].url+window.location.search)})})});function l(t){t.attr("fill",e).call(function(t){var e=t.datum().data,t=e.regions;t&&t.filter(function(t){return t.key!==e.state}).forEach(function(t){o.select('[data-code="'+t.key+'"]').attr("fill",r)})})}function d(t){return t.data?t.data.fill:c}}var format=function(t){return(+t).toLocaleString(void 0,{maximumFractionDigits:0})};