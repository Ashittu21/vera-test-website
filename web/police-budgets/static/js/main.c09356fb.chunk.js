(this["webpackJsonppolice-budgets"]=this["webpackJsonppolice-budgets"]||[]).push([[0],{40:function(e,t,n){e.exports=n.p+"static/media/Consolidated_72PoliceDepartments.3db1b138.csv"},43:function(e,t,n){e.exports=n.p+"static/media/carrot.f3e14036.svg"},51:function(e,t,n){e.exports=n(89)},56:function(e,t,n){},57:function(e,t,n){},58:function(e,t,n){},59:function(e,t,n){},62:function(e,t,n){},89:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n.n(a),r=n(39),l=n.n(r),u=(n(56),n(3)),i=(n(57),n(40)),o=n.n(i),s=n(92),m=n(5),d=(n(58),n(47)),f=(n(59),Object(a.createContext)(1)),v=function(e){return c.a.createElement(f.Consumer,null,(function(t){return c.a.createElement(f.Provider,{value:t+1},e.children)}))},g=function(e){return c.a.createElement(f.Consumer,null,(function(t){var n="h"+Math.min(t,6);return c.a.createElement(n,e)}))},E=n(17),b=n(41),y=function(e,t){switch(t.type){case"setValue":return Object(m.a)(Object(m.a)({},e),{},{changes:Object(m.a)(Object(m.a)({},e.changes),{},Object(E.a)({},t.key,t.value))});default:return e}},p={changes:{}},h=function(e){var t=Object(b.useStorageReducer)(localStorage,"".concat(e," Police Budget"),y,p),n=Object(u.a)(t,2),a=n[0],c=n[1];return{state:a,setValue:function(e){return function(t){c({type:"setValue",key:e,value:t})}}}},O=n(48),j=n(43),P=n.n(j),B=function(){return c.a.createElement(O.a,{src:P.a})};n(62),n(46);var w=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),k=function e(t){var n=t.data,r=t.state,l=t.setValue,u=Object(a.useContext)(f),i=Object.keys(n).sort((function(e,t){var a=A(n[e]),c=A(n[t]);return a>c?-1:a<c?1:0})),o=r.changes;return 1!==i.length||Array.isArray(n[i[0]])?c.a.createElement(v,null,c.a.createElement("div",{style:{marginLeft:"".concat(u>1?2:0,"rem")}},i.map((function(t){if(Array.isArray(n[t]))return c.a.createElement("div",{key:t,className:"PoliceBudget-lineitem PoliceBudget-lineitem--final"},c.a.createElement(g,null,t),c.a.createElement("div",{className:"PoliceBudget-lineitem-adjust"},c.a.createElement(x,{value:o[t],onChange:l(n[t][0].uid)})),c.a.createElement("div",null,w.format(n[t][0].total)));var a=function e(t){return Array.isArray(t)?t[0].uid:e(t[Object.keys(t)[0]])}(n[t]),u=C(n[t]),s=A(n[t]),m=A(n[t],o),d=n[i[i.indexOf(t)+1]]&&C(n[i[i.indexOf(t)+1]]);return c.a.createElement(N,{key:t,title:t,nextLevel:u,nextIsParent:d,value:o[a],setValue:l(a),before:s,after:m},u&&c.a.createElement("div",null,c.a.createElement(e,{data:u,state:r,setValue:l})))})))):c.a.createElement(e,{data:n[i[0]],state:r,setValue:l})},N=function(e){var t=e.nextLevel,n=e.nextIsParent,r=e.title,l=e.value,i=e.setValue,o=e.before,s=e.after,m=e.children,d=Object(a.useState)(!1),f=Object(u.a)(d,2),v=f[0],E=f[1],b=o!==s;return c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"PoliceBudget-lineitem ".concat(t?"":"PoliceBudget-lineitem--final"," ").concat(n?"PoliceBudget-lineitem--last":""," ").concat(b?"PoliceBudget-lineitem--haschange":"","\n        ")},c.a.createElement("div",{className:"PoliceBudget-line-item-heading"},t?c.a.createElement("button",{className:"PoliceBudget-lineitem-toggle ".concat(v?"is-open":""),onClick:function(){return E(!v)}},c.a.createElement(B,null),c.a.createElement(g,null,r)):c.a.createElement(g,null,r)),c.a.createElement("div",{className:"PoliceBudget-lineitem-adjust"},!t&&c.a.createElement(x,{value:l,onChange:i})),c.a.createElement("div",null,w.format(o)),c.a.createElement("div",{className:"PoliceBudget-lineitem-after"},w.format(s))),v&&m)},x=function(e){var t=e.value,n=e.onChange;return c.a.createElement("input",{className:"PoliceBudget-adjust",type:"number",value:t||0,increment:1,max:100,min:-100,onChange:function(e){return n(+e.target.value)}})};function C(e){if(Array.isArray(e))return null;var t=Object.keys(e);return 1===t.length?C(e[t[0]]):e}var A=function e(t,n){return Array.isArray(t)?a(t):Object.values(t).reduce((function(t,c){return t+(Array.isArray(c)?a(c):e(c,n))}),0);function a(e){return e.reduce((function(e,t){var a=n&&n[t.uid]?1-n[t.uid]/100:1;return e+ +t.total*a}),0)}},S=function(e){var t=e.cityLabel,n=e.city,a=e.data,r=h(n),l=r.state,u=r.setValue,i=A(a),o=A(a,l.changes);return c.a.createElement("div",{className:"PoliceBudget"},c.a.createElement("div",{className:"PoliceBudget-main"},c.a.createElement("div",{className:"PoliceBudget-title"},c.a.createElement("h1",null,t)),c.a.createElement("div",{className:"PoliceBudget-lineitem PoliceBudget-header"},c.a.createElement("div",null,"Category"),c.a.createElement("div",null,"% Reduction"),c.a.createElement("div",null,"Before"),c.a.createElement("div",null,"After")),c.a.createElement("div",{className:"PoliceBudget-budget"},c.a.createElement(k,{data:a,state:l,setValue:u})),c.a.createElement("div",{className:"PoliceBudget-lineitem PoliceBudget-lineitem--total"},c.a.createElement("div",null,"Total"),c.a.createElement("div",null),c.a.createElement("div",null,w.format(i)),c.a.createElement("div",null,w.format(o)))),c.a.createElement("div",{className:"PoliceBudget-visualization"},c.a.createElement(L,{label:"Total Spending",value:w.format(i)}),c.a.createElement(L,{label:"Proposed Spending",value:w.format(o)})))},L=function(e){var t=e.label,n=e.value;return c.a.createElement("div",{className:"PoliceBudget-total"},c.a.createElement("div",{className:"PoliceBudget-total-label"},t),c.a.createElement("div",{className:"PoliceBudget-total-value"},n))},V=function(e){var t=e.data,n=I(t),r=n.data,l=n.slugTitle,i=Object.keys(l).map((function(e){return{value:e,label:l[e]}})),o=window.PoliceBudgetCity||null,s=o&&i.find((function(e){return e.value===o})),m=Object(a.useState)(s?s.value:i[0].value),f=Object(u.a)(m,2),v=f[0],g=f[1],E=l[v];return Object(a.useEffect)((function(){var e=i.map((function(e){return e.value})),t=function(t){"ArrowUp"===t.key?function(){var t=e.indexOf(v),n=i[t+1]?i[t+1]:i[0];g(n.value)}():"ArrowDown"===t.key&&function(){var t=e.indexOf(v),n=i[t-1]?i[t-1]:i[e.length-1];g(n.value)}()};return window.addEventListener("keydown",t),function(){return window.removeEventListener("keydown",t)}}),[v,i]),c.a.createElement("div",{className:"CitySwitcher"},!s&&c.a.createElement(d.a,{options:i,value:i.find((function(e){return e.value===v})),onChange:function(e){g(e.value)}}),c.a.createElement(S,{cityLabel:E,city:v,data:r[v]}))},I=function(e){var t={},n=e.map((function(e){var n="".concat(e.City.trim().toLowerCase().replace(/\s/g,"-"),"-").concat(e["State Abb"].trim().toLowerCase());return t[n]||(t[n]="".concat(e.City.trim(),", ").concat(e["State Abb"].trim())),Object(m.a)({uid:"".concat(e.department,"-").concat(e.expensecat,"-").concat(e.subdep,"-").concat(e.expensedescrip,"-").concat(e.personneltype),slug:n},e)})).reduce((function(e,t){return e[t.slug]||(e[t.slug]=[]),e[t.slug].push(t),e}),{});return{data:T(n),slugTitle:t}},T=function(e){return Object.keys(e).reduce((function(t,n){return t[n]=D("department",e[n]),Object.keys(t[n]).forEach((function(e){t[n][e]=D("expensecat",t[n][e]),Object.keys(t[n][e]).forEach((function(a){t[n][e][a]=D("subdep",t[n][e][a]),Object.keys(t[n][e][a]).forEach((function(c){t[n][e][a][c]=D("expensedescrip",t[n][e][a][c]),Object.keys(t[n][e][a][c]).forEach((function(r){t[n][e][a][c][r]=D("personneltype",t[n][e][a][c][r])}))}))}))})),t}),{})},D=function(e,t){return t.reduce((function(t,n){return t[n[e]]||(t[n[e]]=[]),t[n[e]].push(n),t}),{})},U=function(){var e=F(o.a);return e?c.a.createElement(V,{data:e}):c.a.createElement("div",null,"Loading")},F=function(e){var t=Object(a.useState)(),n=Object(u.a)(t,2),c=n[0],r=n[1];return Object(a.useEffect)((function(){fetch(e).then((function(e){return e.text()})).then((function(e){r(Object(s.a)(e))}))}),[r,e]),c};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(c.a.createElement(U,null),document.getElementById("PoliceBudgets")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[51,1,2]]]);
//# sourceMappingURL=main.c09356fb.chunk.js.map