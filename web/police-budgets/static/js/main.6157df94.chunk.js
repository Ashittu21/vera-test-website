(this["webpackJsonppolice-budgets"]=this["webpackJsonppolice-budgets"]||[]).push([[0],{40:function(e,t,a){e.exports=a.p+"static/media/ConsolidatedExp_72PoliceDepartments.6b3491cd.csv"},43:function(e,t,a){e.exports=a.p+"static/media/carrot.f3e14036.svg"},51:function(e,t,a){e.exports=a(89)},56:function(e,t,a){},57:function(e,t,a){},58:function(e,t,a){},59:function(e,t,a){},62:function(e,t,a){},89:function(e,t,a){"use strict";a.r(t);var n=a(1),c=a.n(n),l=a(39),r=a.n(l),i=(a(56),a(3)),u=(a(57),a(40)),o=a.n(u),s=a(92),m=a(4),d=(a(58),a(47)),f=(a(59),Object(n.createContext)(1)),v=function(e){return c.a.createElement(f.Consumer,null,(function(t){return c.a.createElement(f.Provider,{value:t+1},e.children)}))},g=function(e){return c.a.createElement(f.Consumer,null,(function(t){var a="h"+Math.min(t,6);return c.a.createElement(a,e)}))},E=a(17),b=a(41),h=function(e,t){switch(t.type){case"setValue":return Object(m.a)(Object(m.a)({},e),{},{changes:Object(m.a)(Object(m.a)({},e.changes),{},Object(E.a)({},t.key,t.value))});default:return e}},y={changes:{}},p=function(e){var t=Object(b.useStorageReducer)(localStorage,"".concat(e," Police Budget"),h,y),a=Object(i.a)(t,2),n=a[0],c=a[1];return{state:n,setValue:function(e){return function(t){c({type:"setValue",key:e,value:t})}}}},P=a(48),B=a(43),j=a.n(B),O=function(){return c.a.createElement(P.a,{src:j.a})};a(62),a(46);var N=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}),w=function e(t){var a=t.data,l=t.state,r=t.setValue,i=Object(n.useContext)(f),u=Object.keys(a).sort((function(e,t){var n=C(a[e]),c=C(a[t]);return n>c?-1:n<c?1:0})),o=l.changes;return 1!==u.length||Array.isArray(a[u[0]])?c.a.createElement(v,null,c.a.createElement("div",{style:{marginLeft:"".concat(i>1?1.5:0,"rem")}},u.map((function(t){if(Array.isArray(a[t]))return c.a.createElement("div",{key:t,className:"PoliceBudget-lineitem PoliceBudget-lineitem--final"},c.a.createElement(g,null,t),c.a.createElement("div",{className:"PoliceBudget-lineitem-adjust"},c.a.createElement(x,{value:o[t],onChange:r(a[t][0].uid)})),c.a.createElement("div",null,N.format(a[t][0].total)));var n=function e(t){return Array.isArray(t)?t[0].uid:e(t[Object.keys(t)[0]])}(a[t]),i=A(a[t]),s=C(a[t]),m=C(a[t],o),d=a[u[u.indexOf(t)+1]]&&A(a[u[u.indexOf(t)+1]]);return c.a.createElement(k,{key:t,title:t,nextLevel:i,nextIsParent:d,value:o[n],setValue:r(n),before:s,after:m},i&&c.a.createElement("div",null,c.a.createElement(e,{data:i,state:l,setValue:r})))})))):c.a.createElement(e,{data:a[u[0]],state:l,setValue:r})},k=function(e){var t=e.nextLevel,a=e.nextIsParent,l=e.title,r=e.value,u=e.setValue,o=e.before,s=e.after,m=e.children,d=Object(n.useState)(!1),f=Object(i.a)(d,2),v=f[0],E=f[1],b=function(){return E(!v)},h=o!==s;return c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"PoliceBudget-lineitem ".concat(t?"":"PoliceBudget-lineitem--final"," ").concat(a?"PoliceBudget-lineitem--last":""," ").concat(h?"PoliceBudget-lineitem--haschange":"","\n        ")},c.a.createElement("div",{className:"PoliceBudget-lineitem-heading"},t?c.a.createElement("button",{className:"PoliceBudget-lineitem-toggle ".concat(v?"is-open":""),onClick:b},c.a.createElement(O,null),c.a.createElement(g,null,l)):c.a.createElement(g,null,l)),c.a.createElement("div",{className:"PoliceBudget-lineitem-adjust"},t?!v&&c.a.createElement("button",{className:"PoliceBudget-lineitem-adjust-toggle ".concat(v?"is-open":""),onClick:b},"Adjust"):c.a.createElement(x,{value:r,onChange:u})),c.a.createElement("div",{className:"PoliceBudget-lineitem-before"},N.format(o)),c.a.createElement("div",{className:"PoliceBudget-lineitem-after"},N.format(s))),v&&m)},x=function(e){var t=e.value,a=e.onChange;return c.a.createElement("div",{className:"PoliceBudget-adjust"},c.a.createElement("input",{type:"number",value:t||0,increment:1,max:100,min:-100,onChange:function(e){return a(+e.target.value)}}),"%")};function A(e){if(Array.isArray(e))return null;var t=Object.keys(e);return 1===t.length?A(e[t[0]]):e}var C=function e(t,a){return Array.isArray(t)?n(t):Object.values(t).reduce((function(t,c){return t+(Array.isArray(c)?n(c):e(c,a))}),0);function n(e){return e.reduce((function(e,t){var n=a&&a[t.uid]?1-a[t.uid]/100:1;return e+t.total*n}),0)}},L=function(e){var t=e.cityLabel,a=e.city,n=e.data,l=p(a),r=l.state,i=l.setValue,u=C(n),o=C(n,r.changes);return c.a.createElement("div",{className:"PoliceBudget"},c.a.createElement("div",{className:"PoliceBudget-main"},c.a.createElement("div",{className:"PoliceBudget-title"},c.a.createElement("div",null,"Adjust the police budget in"),c.a.createElement("h1",null,t)),c.a.createElement("div",{className:"PoliceBudget-lineitem PoliceBudget-header"},c.a.createElement("div",{className:"PoliceBudget-lineitem-heading"},"Category"),c.a.createElement("div",{className:"PoliceBudget-lineitem-adjust"},"% Reduction"),c.a.createElement("div",{className:"PoliceBudget-lineitem-before"},"FY2020"),c.a.createElement("div",{className:"PoliceBudget-lineitem-after"},"Proposed")),c.a.createElement("div",{className:"PoliceBudget-budget"},c.a.createElement(w,{data:n,state:r,setValue:i})),c.a.createElement("div",{className:"PoliceBudget-lineitem PoliceBudget-lineitem--total ".concat(u!==o?"PoliceBudget-lineitem--haschange":"")},c.a.createElement("div",{className:"PoliceBudget-lineitem-heading"},"Total"),c.a.createElement("div",{className:"PoliceBudget-lineitem-adjust"}),c.a.createElement("div",{className:"PoliceBudget-lineitem-before"},N.format(u)),c.a.createElement("div",{className:"PoliceBudget-lineitem-after"},N.format(o)))),c.a.createElement("div",{className:"PoliceBudget-visualization"},c.a.createElement(V,{label:"FY2020",value:N.format(u),className:"PoliceBudget-total-before"}),c.a.createElement(V,{label:"Proposed",value:N.format(o),className:"PoliceBudget-total-after"}),c.a.createElement(V,{label:"Savings",value:"".concat(N.format(u-o)," (").concat(Math.round(100*(u-o)/u),"%)")})))},V=function(e){var t=e.label,a=e.value,n=e.className,l=void 0===n?"":n;return c.a.createElement("div",{className:"PoliceBudget-total ".concat(l)},c.a.createElement("div",{className:"PoliceBudget-total-label"},t),c.a.createElement("div",{className:"PoliceBudget-total-value"},a))},S=function(e){var t=e.data,a=F(t),l=a.data,r=a.slugTitle,u=Object.keys(r).map((function(e){return{value:e,label:r[e]}})),o=window.PoliceBudgetCity||null,s=o&&u.find((function(e){return e.value===o})),m=Object(n.useState)(s?s.value:u[0].value),f=Object(i.a)(m,2),v=f[0],g=f[1],E=r[v];return Object(n.useEffect)((function(){var e=u.map((function(e){return e.value})),t=function(t){"ArrowUp"===t.key?function(){var t=e.indexOf(v),a=u[t+1]?u[t+1]:u[0];g(a.value)}():"ArrowDown"===t.key&&function(){var t=e.indexOf(v),a=u[t-1]?u[t-1]:u[e.length-1];g(a.value)}()};return window.addEventListener("keydown",t),function(){return window.removeEventListener("keydown",t)}}),[v,u]),c.a.createElement("div",{className:"CitySwitcher"},!s&&c.a.createElement(d.a,{options:u,value:u.find((function(e){return e.value===v})),onChange:function(e){g(e.value)}}),c.a.createElement(L,{cityLabel:E,city:v,data:l[v]}))},F=function(e){console.log(e);var t={},a=e.map((function(e){var a="".concat(e.city.trim().toLowerCase().replace(/\s/g,"-"),"-").concat(e.stateAbb.trim().toLowerCase());return t[a]||(t[a]="".concat(e.city.trim(),", ").concat(e.stateAbb.trim())),Object(m.a)(Object(m.a)({},e),{},{uid:"".concat(e.department,"-").concat(e.expensecat,"-").concat(e.subdep,"-").concat(e.expensedescrip,"-").concat(e.personneltype),slug:a,total:parseInt(e.total)})})).reduce((function(e,t){return e[t.slug]||(e[t.slug]=[]),e[t.slug].push(t),e}),{}),n=I(a);return console.log(n),{data:n,slugTitle:t}},I=function(e){return Object.keys(e).reduce((function(t,a){return t[a]=D("department",e[a]),Object.keys(t[a]).forEach((function(e){t[a][e]=D("expensecat",t[a][e]),Object.keys(t[a][e]).forEach((function(n){t[a][e][n]=D("subdep",t[a][e][n]),Object.keys(t[a][e][n]).forEach((function(c){t[a][e][n][c]=D("expensedescrip",t[a][e][n][c]),Object.keys(t[a][e][n][c]).forEach((function(l){t[a][e][n][c][l]=D("personneltype",t[a][e][n][c][l])}))}))}))})),t}),{})},D=function(e,t){return t.reduce((function(t,a){return t[a[e]]||(t[a[e]]=[]),t[a[e]].push(a),t}),{})},T=function(){var e=U(o.a);return e?c.a.createElement(S,{data:e}):c.a.createElement("div",null,"Loading")},U=function(e){var t=Object(n.useState)(),a=Object(i.a)(t,2),c=a[0],l=a[1];return Object(n.useEffect)((function(){fetch(e).then((function(e){return e.text()})).then((function(e){l(Object(s.a)(e))}))}),[l,e]),c};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(c.a.createElement(T,null),document.getElementById("PoliceBudgets")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[51,1,2]]]);
//# sourceMappingURL=main.6157df94.chunk.js.map